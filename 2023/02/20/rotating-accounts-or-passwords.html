<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Rotating Accounts or Passwords? | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2023/02/20/rotating-accounts-or-passwords.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Rotating Accounts or Passwords? | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2023/02/20/rotating-accounts-or-passwords.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2023-02-20T12:13:14Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/schloss.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Rotating Accounts or Passwords?' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/schloss.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="rotating-accounts-or-passwords-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Rotating Accounts or Passwords?
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>February 20, 2023</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/schloss.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2023/02/18/this-is-not-a-drill.html">This is not a Drill, this is just Tuesday</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2023/03/06/selecting-random-rows.html">MySQL: Selecting random rows</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>Some applications allow you to have multiple passwords.
For example, in <a href="https://dev.mysql.com/doc/refman/8.0/en/password-management.html#dual-passwords" target="_blank" rel="noopener">MySQL, since 8.0.14 you can dual passwords for an account</a>

.
Also, <a href="https://redis.io/docs/management/security/acl/#create-and-edit-user-acls-with-the-acl-setuser-command" target="_blank" rel="noopener">Redis 6 allows you to have multiple passwords on an account ACL</a>

.</p>
<h1 id="personal-accounts-and-machine-accounts">
    <a href="#personal-accounts-and-machine-accounts">
	Personal Accounts and Machine Accounts.
    </a>
</h1>
<p>When running services in a production system, the services sometimes have personal accounts (PAs) that allow humans to login and perform actions on the service.
Often, these accounts are very limited in number (in production), and privileged.</p>
<p>Also, you have clients connecting to the system.
These are called Non-Personal Accounts, Machine Accounts or Service Accounts (MA) in many environments.
Machine Accounts are not used by humans, but are a set of credentials used by client applications to work with a service.</p>
<p>It is good practice to assign a different MA to each application using a service,  and to rotate credentials regularly and quickly for each MA.
In many environments doing this is even a compliance requirement.</p>
<h1 id="different-usernames-are-helpful">
    <a href="#different-usernames-are-helpful">
	Different Usernames are helpful
    </a>
</h1>
<p>Assigning different identities (different usernames) to different applications is useful in many ways:</p>
<ul>
<li>Access permissions are tied to identities, so different identities are a requirement to separate different sets of permissions.</li>
<li>Also, different identities allow you to attribute activity in the service to the identity, thus make monitoring, auditing and accounting possible.
It is much easier to identify a misbehaving application, if all applications using your service have different user account names.</li>
</ul>
<h1 id="dynamically-assigned-credentials">
    <a href="#dynamically-assigned-credentials">
	Dynamically assigned credentials
    </a>
</h1>
<p>Very often credentials are not stored at all in the client configuration, but are requested dynamically on-demand from another service, the Secrets Manager or Vault.
It is either part of a cloud control plane, and can leverage trust from the cloud infrastructure to know who is who and what to allow,
or it is an external service such as a Hashicorp Vault.</p>
<p>In any case, the application would not store Database or Redis username and passwords in configuration files any more,
but ask the secrets manager to provide these credentials at runtime, receive them, and then store them only in memory.
They would also be expired and re-requested in regular intervals, on a multiple-minutes to hour scale.</p>
<p>This allows the Secrets Manager to perform account operations, such as password or account rotation.</p>
<h1 id="account-rotation-or-password-rotation">
    <a href="#account-rotation-or-password-rotation">
	Account Rotation or Password Rotation?
    </a>
</h1>
<p>Rotating MA passwords is often a requirement, and most environments also require a comparatively high rotation frequency (&ldquo;once per week&rdquo;, which qualifies as &ldquo;high&rdquo; in database timescales).</p>
<p>Some services, such as MySQL and Redis given as examples above, allow you to associate multiple password with a single account.
Many others do not, in them username (&ldquo;identity&rdquo;) and password (&ldquo;authentication&rdquo;) are a 2-tuple.</p>
<p>Rotating passwords, when taken literally, is hard with such services, because changing the password atomically in the server and all its clients is impossible.
There is always some overlap during which the service already has the new password (and implicitly invalidated the old password),
while the clients are still using the old password.
If you rotated the password with traditional methods, there would be a discrepancy between clients and servers in password knowledge, and thus failed logins.</p>
<p>One way around that is provisioning new MA accounts for an application, and then feeding the applications not only new passwords, but completely new credentials.
Thus,</p>
<ul>
<li>an application <code>androidapp</code> would see the old user <code>androidapp_23ad63</code> with a generated password <code>BBLA32Tm9feoAGpN</code>,</li>
<li>then account rotation would additionally create <code>androidapp_8760d3</code> with the password <code>cts6Me5c7T4q6Dq2</code> and the same authorizations in the service,</li>
<li>then the account rotation would test that this newly creates account works as desired,</li>
<li>then the account rotation would stop handing out the old credentials (<code>23ad63</code>) to clients, and start serving the new credentials (<code>8760d3</code>),</li>
<li>then the account rotation would over the course of an hour observe the old account not being used anymore, and the new account picking up traffic,
<ul>
<li>then the account rotation would see the old <code>23ad63</code> account being silent for two hours, and eventually lock and deprovision it</li>
<li>or this does not work as expected, and <code>23ad63</code> stays active past the deadline, in which case we raise an alarm.</li>
</ul>
</li>
</ul>
<h2 id="why-no-observability">
    <a href="#why-no-observability">
	Why no observability?
    </a>
</h2>
<p>Account rotation has some advantages over password rotation:
First: it works with any application, even those that have no support for multiple passwords.
Lack of multiple password support is stopping no-one from implementing rotation, it is just account and not password rotation you need to build.</p>
<p>Then:
Even in MySQL and Redis it was not immediately obvious to me how password rotation can be validated to function correctly.
That is, I have been unable to find a way to isolate instances of logins using the &ldquo;non-primary&rdquo; (or old) password, and somehow make sure that all logins in the last hour or so have been using the newly updated password.</p>
<blockquote>
<p>As an engineer running the application, I would want to make sure that the old password is unused before I ask the service to deprovision it.</p></blockquote>
<p>But observability on this seems to be completely non-existent.
Which is weird, because any security engineer will tell you that a control is only valid, if you can verify it is working as intended.</p>
<p>With account rotation, usage of old accounts is immediately visible.
The system can check if the old account is still being used, and once it isn&rsquo;t anymore, it can deprovision it.
If the old account does not go silent within some timeout, we can alert on this, identity the team responsible for the application, and sit down to talk about credential caching.</p>
<p>Thus, I would rate the implementation of any password rotation feature that does not have good observability built in as incomplete.</p>
<h2 id="an-authorization-problem">
    <a href="#an-authorization-problem">
	An authorization problem
    </a>
</h2>
<p>Conversely, while account rotation has automatically good observability, it complicates authorisation.
Authorisation is the set of permissions ties to an identity, the <code>GRANT</code>s in SQL-lingo.</p>
<p>If you rotate accounts, you are essentially creating new accounts and drop old accounts on a schedule.
That means</p>
<ul>
<li>either store the authorization outside the system</li>
<li>or you can leverage a role system.</li>
</ul>
<p>In the latter case, you would create a role <code>androidapp</code>, and assign it the authorizations, then make sure all <code>androidapp%</code> accounts are members of the role, inheriting the role authorizations with no individual per-account rules.</p>
<p>Most, but not all systems have a role-system for accounts similar to MySQL 8 roles, in which you assign authorizations to groups instead of individual accounts.
If you have it, implementing account rotation without complicating authorization is comparatively easy.</p>
<h1 id="summary">
    <a href="#summary">
	Summary
    </a>
</h1>
<ul>
<li>Having a secrets manager that hands out secrets to services and clients is useful, because it allows you to prevent materialization of secrets.
<ul>
<li>One of the primary features of clouds (private and public) would be that the control-plane of the cloud can attest identity of instances, and would allow you to solve authentication trivially.
Sadly, Openstack and all Openstack derives private and public clouds seem to not implement that (and thus offer no IAM to services based on control-plane trust).</li>
<li>For those where the cloud control-plane does not offer IAM, Hashivault can help out a lot.</li>
</ul>
</li>
<li>Some applications have the ability to have multiple passwords per identity, to allow easier password rotation.
<ul>
<li>The value of that feature is greatly diminished by a lack of observability. Any control is only complete if it can be verified to work.
We need to be able to see if old deprecated passwords are unused in order to safely deprovision them.</li>
</ul>
</li>
<li>Even without multiple passwords, we can always leverage a secrets manager and some relatively simple external driver to rotate accounts instead.
<ul>
<li>This is complicated by the fact that many applications bind authorizations (access permissions) to identities (usernames).</li>
<li>We can use roles to work around that, and assign authorizations to these roles, then have the identity inherit from the role.</li>
</ul>
</li>
<li>Implementing either account rotation or password rotation still requires additional work: an external driver, safeguards, monitoring and alerting, plus an update of the documentation.
In neither case you will be done by simply turning on a feature.</li>
</ul>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_en
				</a>
				
				<a href="/tags/#devops" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				devops
				</a>
				
				<a href="/tags/#security" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				security
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2023-02-20-rotating-accounts-or-passwords.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2023/02/18/this-is-not-a-drill.html">This is not a Drill, this is just Tuesday</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2023/03/06/selecting-random-rows.html">MySQL: Selecting random rows</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
