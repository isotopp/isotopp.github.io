<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotopp@chaos.social)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.135.0">
<meta property="og:title" content='Die wunderbare Welt von Isotopp | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotopp@chaos.social)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotopp@chaos.social)' />
<meta property="og:url" content="https://blog.koehntopp.info/" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2024-09-30T04:05:06Z' />
<meta name="fediverse:creator" content="">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='' />
<meta property="twitter:title" content='' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotopp@chaos.social)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.c633d67ea69accc92e157b3bbbfff14c50111ba56cd6d012f7908af439b86163.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            
<div class="page mb-4">
  <div class='row justify-content-center text-center my-4 mx-0'>
    <header class="headerbanner">
      <div class='col'>
        <h1 class="title mb-lg-4 text-white">
          Die wunderbare Welt von Isotopp
        </h1>
      </div>
      <img src='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg'>
    </header>
  </div>

  
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/17/building-the-cycling-city.html" class='text-decoration-none text-dark'>Fertig gelesen: Building the Cycling City</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 17, 2020
        </div>

        <div class='mt-3'><p>Melissa and Chris Bruntlett have been living in Vancouver close to the
station, and decided to do as many daily runs as possible without a car,
using public transport or bikes. In late 2015, early 2016 they did an
extended visit to the Netherlands which resulted in a changed world view
about what proper Urban Infrastructure can look like. Meanwhile they are
living with two kids near Delft, in the Netherlands.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/16/fertig-gelesen-defensive-baking.html" class='text-decoration-none text-dark'>Fertig gelesen: A Wizard&#39;s Guide To Defensive Baking</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 16, 2020
        </div>

        <div class='mt-3'><p><a href="https://www.amazon.de/Wizards-Guide-Defensive-Baking-English-ebook/dp/B08CJ86Y1W" target="_blank" rel="noopener">A Wizard&rsquo;s Guide To Defensive Baking</a>


is a Yound Adult Coming-of-Age story about Mona. Mona works in her aunt&rsquo;s
bakery, and also is a hedge wizard. Her talent is mostly limited to
influencing dough and baked goods, her familiar is a sourdough starter named
Bob.</p>
<p><a href="https://www.amazon.de/Wizards-Guide-Defensive-Baking-English-ebook/dp/B08CJ86Y1W" target="_blank" rel="noopener"><p class="md__image">
  <img src="/uploads/2020/08/defensive-baking.jpg" alt=""  />
</p>

</a>

</p>
<p><em>A Wizards Guide To Defensive Baking</em>, T. Kingfisher, <a href="https://www.amazon.de/Wizards-Guide-Defensive-Baking-English-ebook/dp/B08CJ86Y1W" target="_blank" rel="noopener">Amazon</a>

</p>
<p>Mona is a 14-year-old girl living in Riverbraid, a random city-state near a
river in the floodplain of an otherwise unnamed country that vaguely feels
like northern Italy during renaissance times. Working in her aunts bakery,
her talent of being able to magically influence dough and baked goods comes
in handy in production, and sometimes she lets a few Gingerbread men dance
to amuse the customers.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/14/eli5-epic-vs-apple-and-google.html" class='text-decoration-none text-dark'>ELI5: Epic vs Apple and Google</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 14, 2020
        </div>

        <div class='mt-3'><p><a href="https://twitter.com/jpmens/status/1294156181100007425" target="_blank" rel="noopener">@jpmens asked</a>

 on Twitter:</p>
<p><a href="https://twitter.com/jpmens/status/1294156181100007425" target="_blank" rel="noopener"><p class="md__image">
  <img src="/uploads/2020/08/fortnite.jpg" alt=""  />
</p>

</a>

</p>
<p><em>What is Fortnite? #outingmyself</em></p>
<p>Assuming <a href="https://xkcd.com/1053/" target="_blank" rel="noopener">XKCD 1053</a>

.</p>
<h2 id="fortnite">
    <a href="#fortnite">
	Fortnite
    </a>
</h2>
<p>Fortnite is a game made by Epic Games. They also make the Unreal Engine, which powers many modern computer games. Fortnite together with Roblox and Minecraft it is the set of games played most by people under 20.</p>
<p>You want to follow <a href="https://twitter.com/ballmatthew" target="_blank" rel="noopener">Matthew Ball</a>

.</p>
<p>Fortnite is a Battle Royal game, a 1st person shooter, in which a matchmaker puts you together with a set of other people of similar skill, drops you into an arena of ever shrinking size. You got to collect ammo and weapons, build fortifications and kill the others.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/04/mysql-foreign-key-constraints-and-locking.html" class='text-decoration-none text-dark'>MySQL Foreign Key Constraints and Locking</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 4, 2020
        </div>

        <div class='mt-3'><p>Since we now know how to look at the state of locking in a live database, let&rsquo;s look at what happens when we run a normal insert or update and an insert or update with foreign key relationships defined, and compare.</p>
<p>We will be using the tables and structures from our previous examples, a simple 1:n relationship between <code>a</code> and <code>b</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">a_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">30</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">40</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">b_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">a_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">b_id</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">a_id</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">a_id_exists</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">RESTRICT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">RESTRICT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>or the same definition for <code>b</code> without the constraint.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/03/mysql-foreign-keys-and-foreign-key-constraints.html" class='text-decoration-none text-dark'>MySQL Foreign Keys and Foreign Key Constraints</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 3, 2020
        </div>

        <div class='mt-3'><p>Foreign Keys are what links tables together and turns a set of tables into a model. Foreign Key Constraints are conditions that must be true for the content of the tables to be an internally consistent model. Foreign Key Constraints can be defined and enforced in InnoDB, but this comes at a considerable price, and for some it may hurt more than it is worth.</p>
<p><p class="md__image">
  <img src="/uploads/2020/08/fk.png" alt=""  />
</p>

</p>
<p><em>A very simple shop as an ER-model. <code>order_id</code> is the primary key of the Orders table.  <code>customer_id</code> in the Orders table is a foreign key: The primary key of another (&ldquo;foreign&rdquo;) table in this table. Foreign keys can model relationships between tables (&ldquo;entities&rdquo;) in an entity-relationship diagram.</em></p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/02/mysql-deadlocks-with-insert.html" class='text-decoration-none text-dark'>MySQL Deadlocks with INSERT</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 2, 2020
        </div>

        <div class='mt-3'><p>Support Channel. &ldquo;Hi, I am getting deadlocks in the database, and they occur when I have to roll back the transactions but if we don&rsquo;t have to roll back all transactions get executed.&rdquo;
Wait, what?
After some back and forth it becomes clear that the Dev experiences deadlocks and has data:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pager</span><span class="w"> </span><span class="k">less</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="n">innodb</span><span class="w"> </span><span class="n">status</span><span class="err">\</span><span class="k">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">MySQL</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="mi">142531</span><span class="p">,</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="mi">139990258222848</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="mi">4799571</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">somehost</span><span class="p">.</span><span class="n">somedomain</span><span class="w"> </span><span class="n">someuser</span><span class="w"> </span><span class="k">update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">sometable</span><span class="w"> </span><span class="p">(</span><span class="n">identifier_id</span><span class="p">,</span><span class="w"> </span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;d4e84cb1-4d56-4d67-9d16-1d548fd26b55&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EUR&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">HOLDS</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="k">LOCK</span><span class="p">(</span><span class="n">S</span><span class="p">):</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RECORD</span><span class="w"> </span><span class="n">LOCKS</span><span class="w"> </span><span class="k">space</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="mi">3523</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="mi">1106463</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="mi">224</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="n">somedb</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">sometable</span><span class="o">`</span><span class="w"> </span><span class="n">trx</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="mi">9843342279</span><span class="w"> </span><span class="k">lock</span><span class="w"> </span><span class="k">mode</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="n">locks</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">rec</span><span class="w">
</span></span></span></code></pre></div><p>and that is weird because of the <code>lock mode S locks gap</code> in the last line. We get the exact same statement with the exact same value on the second thread, but with <code>lock mode X locks gap</code>.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/08/01/mysql-locks-and-deadlocks.html" class='text-decoration-none text-dark'>MySQL: Locks and Deadlocks</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          August 1, 2020
        </div>

        <div class='mt-3'><p>In a <a href="/2020/07/30/mysql-transactions---writing-data.html">previous article</a>

 we wrote data to the database using atomic update statements, and then using transactions with <code>SELECT ... FOR UPDATE</code>. In this article we will look at what happens when we continue doing this, in a more complicated way. Source code for this article is also <a href="https://github.com/isotopp/mysql-dev-examples/blob/master/mysql-deadlock/deadlock.py" target="_blank" rel="noopener">available on GitHub.com</a>

.</p>
<h2 id="a-simple-row-lock">
    <a href="#a-simple-row-lock">
	A simple row lock
    </a>
</h2>
<p>But first let&rsquo;s do things manually: We create a table <code>kris</code> with an integer primary key column and a secondary unindexed data column. We are filling it with some records with gaps between the primary keys.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/07/30/mysql-transactions---writing-data.html" class='text-decoration-none text-dark'>MySQL Transactions - writing data</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          July 30, 2020
        </div>

        <div class='mt-3'><p>Using the framework for testing we created in earlier articles, let&rsquo;s try to
modify some data. We are writing a small program that increments a counter.
Our table looks like this, and contains 10 counters:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">counter</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>We are using some very simple programming to increment a counter:</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/07/29/mysql-transactions-the-logical-view.html" class='text-decoration-none text-dark'>MySQL Transactions - the logical side</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          July 29, 2020
        </div>

        <div class='mt-3'><p>After having a look <a href="/2020/07/27/mysql-transactions.html">how MySQL handles transactions physically</a>

, let&rsquo;s have a look at what is
going on from a logical point of view.</p>
<p>We are using a test table called demo with an id and a counter field, both
integer. In it, we have 10 counters, all set to 0.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">counter</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">demo</span><span class="o">`</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>In one session, we start a transaction and modify a counter value. We do not
commit anything.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/07/28/mysql-connection-scoped-state.html" class='text-decoration-none text-dark'>MySQL Connection Scoped State</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@chaos.social" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://chaos.social/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          July 28, 2020
        </div>

        <div class='mt-3'><p>MySQL speaks its own proprietary protocol.
It cannot be routed by an HTTP proxy, and a MySQL connection is entire unlike an HTTP connection.
Specifically, a lot of state and configuration is tied to a MySQL connection, and it cannot be recovered on disconnect.</p>
<h2 id="what-state-is-tied-to-a-connection">
    <a href="#what-state-is-tied-to-a-connection">
	What state is tied to a connection?
    </a>
</h2>
<h3 id="transactions">
    <a href="#transactions">
	Transactions
    </a>
</h3>
<p>A disconnect implies a <code>ROLLBACK</code>.
So if you are in a transaction, all changes to the database that you attempted are lost, rolled back, as if they never happened.<br>
It is not enough to retry the last statement, you need to jump back to the beginning of the transaction.</p></div>

    </div>
  </div>

  <div class='row mb-4 py-4 mx-0 justify-content-center'>
    <div class='col-lg-8 fs-5'>
    
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/25.html" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/24.html" aria-label="Page 24" class="page-link" role="button">24</a>
      </li>
      <li class="page-item">
        <a href="/page/25.html" aria-label="Page 25" class="page-link" role="button">25</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 26" class="page-link" role="button">26</a>
      </li>
      <li class="page-item">
        <a href="/page/27.html" aria-label="Page 27" class="page-link" role="button">27</a>
      </li>
      <li class="page-item">
        <a href="/page/28.html" aria-label="Page 28" class="page-link" role="button">28</a>
      </li>
      <li class="page-item">
        <a href="/page/27.html" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/110.html" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
    </div>
  </div>


    
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://chaos.social/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
