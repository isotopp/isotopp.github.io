<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.138.0">
<meta property="og:title" content='Die wunderbare Welt von Isotopp | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2024-10-28T05:06:07Z' />
<meta name="fediverse:creator" content="">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='' />
<meta property="twitter:title" content='' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            
<div class="page mb-4">
  <div class='row justify-content-center text-center my-4 mx-0'>
    <header class="headerbanner">
      <div class='col'>
        <h1 class="title mb-lg-4 text-white">
          Die wunderbare Welt von Isotopp
        </h1>
      </div>
      <img src='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg'>
    </header>
  </div>

  
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/25/mysql-dynamic-partitions-suck.html" class='text-decoration-none text-dark'>MySQL: automatic partitions surely would be nice</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 25, 2020
        </div>

        <div class='mt-3'><p>In <a href="/2020/09/24/mysql-deleting-data.html">Deleting data</a>

 we have been looking at a process that loads data into MySQL, leveraging partitions to make it easier and faster to later get rid of the data again. For this, we created three processes, a data loader process, and two observers - one for creating partitions, and one for deleting them.</p>
<p>The observer processes have been running <code>ANALYZE TABLES</code> and then polling <code>INFORMATION_SCHEMA.PARTITIONS</code> every 1/10th of a second to check if intervention is needed. They then have been dynamically generating the necessary <code>ALTER TABLE</code> statements maintaining the proper partitioning of the table by adding and dropping additional partitions.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/24/mysql-deleting-data.html" class='text-decoration-none text-dark'>MySQL: Deleting data</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 24, 2020
        </div>

        <div class='mt-3'><p>Completing the data lifecycle is often harder than originally expected:
Deleting data can sometimes cost way more than inserting it in the first place.
MySQL Partitions can offer a way out.
We have an <a href="/2020/05/13/deleting-data-from-mysql.html">earlier post</a>

 on the subject.</p>
<h2 id="a-sample-table-and-a-problem-statement">
    <a href="#a-sample-table-and-a-problem-statement">
	A sample table, and a problem statement
    </a>
</h2>
<p>Let&rsquo;s define a kind of log table, to which data is added with an <code>auto_increment</code> id value and some data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">click</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">MySQLdb</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">MySQLdb.cursors</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">db_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span><span class="o">=</span><span class="s2">&#34;kris&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">passwd</span><span class="o">=</span><span class="s2">&#34;geheim&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span><span class="o">=</span><span class="s2">&#34;kris&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursorclass</span><span class="o">=</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@click.group</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Load and delete data using partitions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sql</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@sql.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">setup_tables</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql_setup</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;drop table if exists data&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34; create table data (
</span></span></span><span class="line"><span class="cl"><span class="s2">                id integer not null primary key auto_increment,
</span></span></span><span class="line"><span class="cl"><span class="s2">                d varchar(64) not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">                e varchar(64) not null
</span></span></span><span class="line"><span class="cl"><span class="s2">        )&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;alter table data partition by range (id) ( partition p1 values less than (10000))&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;insert into data (id, d, e) values ( 1, &#39;keks&#39;, &#39;keks&#39; )&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;commit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">db_config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">sql_setup</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;setup_tables: failed </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sql</span><span class="p">()</span>
</span></span></code></pre></div><p>This is our basic Python framework for experimentation, using the <code>click</code> framework, and a command <code>setup-tables</code>. This command will run a number of SQL statements to initialize our log table named <code>data</code>.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/23/mylogin-cnf.html" class='text-decoration-none text-dark'>MySQL: Provisioning .mylogin.cnf</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 23, 2020
        </div>

        <div class='mt-3'><p>MySQL uses connection and config parameters from a number of possible sources. The easiest way to find out where it is looking for config files is to run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> mysql --help <span class="p">|</span> grep cnf
</span></span><span class="line"><span class="cl"><span class="go">                      order of preference, my.cnf, $MYSQL_TCP_PORT,
</span></span></span><span class="line"><span class="cl"><span class="go">/etc/my.cnf /etc/mysql/my.cnf /Users/kkoehntopp/homebrew/etc/my.cnf ~/.my.cnf
</span></span></span></code></pre></div><p>As can be seen, my version of the MySQL client checks in this order</p>
<ul>
<li>/etc/my.cnf</li>
<li>/etc/mysql/my.cnf</li>
<li>/Users/kkoehntopp/homebrew/etc/my/cnf</li>
<li>~/.my.cnf</li>
</ul>
<p>The cnf file is a file in dot-ini syntax, so you have <code>[groups]</code> and each group contains lines with <code>key = value</code> pairs. Which groups are read?</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/22/alter-table-for-uuid.html" class='text-decoration-none text-dark'>MySQL: ALTER TABLE for UUID</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 22, 2020
        </div>

        <div class='mt-3'><p>A question to the internal <code>#DBA</code> channel at work: »Is it possible to change a column type from <code>BIGINT</code> to <code>VARCHAR </code>? Will the numbers be converted into a string version of the number or will be it a byte-wise transition that will screw the values?«</p>
<p>Asking yielded more information: »The use-case is to have strings, to have UUIDs.«</p>
<p>So we have two questions to answer:</p>
<ul>
<li>Is <code>ALTER TABLE t CHANGE COLUMN c</code> lossy?</li>
<li><code>INTEGER AUTO_INCREMENT</code> vs. <code>UUID</code></li>
</ul>
<h2 id="is-alter-table-t-change-column-c-lossy">
    <a href="#is-alter-table-t-change-column-c-lossy">
	Is ALTER TABLE t CHANGE COLUMN c lossy?
    </a>
</h2>
<p><code>ALTER TABLE</code> is not lossy. We can test.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/18/mysql-encoding-fields-for-great-profit.html" class='text-decoration-none text-dark'>MySQL: Encoding fields for great profit.</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 18, 2020
        </div>

        <div class='mt-3'><p>Iterating schemas over time is not an uncommon thing. Often requirements emerge only after you have data, and then directed action is possible. Consequently, working on existing data, and structuring and cleaning it up is a common task.</p>
<p>In today&rsquo;s example we work with a log table that logged state transitions of things in freeform <code>VARCHAR</code> fields. After some time the log table grew quite sizeable, and the log strings are repeated rather often, contributing to the overall size of the table considerably.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/17/mein-selbstfahrendes-auto-hat-kameras-oh-nein.html" class='text-decoration-none text-dark'>Mein selbstfahrendes Auto hat Kameras, oh nein!</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 17, 2020
        </div>

        <div class='mt-3'><p>Bei der ARD ist man empört! <a href="https://www.heise.de/news/Teslas-Kameras-ARD-rueckt-Datenschutzbedenken-ins-Licht-4904167.html" target="_blank" rel="noopener">Teslas Kameras: ARD rückt Datenschutzbedenken ins Licht</a>

. Will sagen, jemand hat älteren Personen gesteckt, daß ein selbstfahrendes Auto wenig überraschend Kameras braucht, um bei seiner bestimmungsgemäße Verwendung weniger ältere Personen überzumöllern.</p>
<p>So weit so wenig überraschend.</p>
<p>Bei einem Tesla sind es 9, bei anderen Automobilen anderer Hersteller noch mehr, und Radar, und Lidar und weitere Sensorsysteme. Problematisch sind nur Kameras, weil Menschen als visuelle Wesen zum Bild eine emotional andere Beziehung haben als zu anderen Daten, die objektiv nicht weniger kritisch sind. Aber Bilder, das ist Hexenwerk, das die Seele stiehlt, das muß man dringend streng kontrollieren.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/09/feeds-tagged-and-a-mysql-feed.html" class='text-decoration-none text-dark'>Feeds tagged, and a MySQL feed</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 9, 2020
        </div>

        <div class='mt-3'><p>I have made changes to the RSS Feed of this blog:</p>
<ol>
<li>Each <code>&lt;item/&gt;</code> does now contain a container <code>&lt;tags/&gt;</code>, inside a sequence of <code>&lt;tag/&gt;</code> containers, with each posts tags.</li>
<li>There is now a second RSS feed for posts tagged <code>#mysql</code>, because of demand. You can find it at <a href="https://blog.koehntopp.info/feed_mysql.xml" target="_blank" rel="noopener">https://blog.koehntopp.info/feed_mysql.xml</a>

.</li>
</ol>
<p>Example for the tags:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;channel&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;title&gt;</span>Die wunderbare Welt von Isotopp<span class="nt">&lt;/title&gt;</span>
</span></span><span class="line"><span class="cl">	...
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;item&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;title&gt;</span>A post title<span class="nt">&lt;/title&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;link&gt;</span>https://blog.koehntopp.info/2020/09/...<span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;guid</span> <span class="na">isPermalink=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>/2020/09/...<span class="nt">&lt;/guid&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;tags&gt;&lt;tag&gt;</span>lang_en<span class="nt">&lt;/tag&gt;&lt;tag&gt;</span>mysql<span class="nt">&lt;/tag&gt;&lt;tag&gt;</span>database<span class="nt">&lt;/tag&gt;&lt;/tags&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&lt;description&gt;</span>blah blah blah<span class="nt">&lt;/description&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;/item&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/channel&gt;</span>
</span></span></code></pre></div><p>So if you want only the MySQL content, subscribe to <a href="https://blog.koehntopp.info/feed_mysql.xml" target="_blank" rel="noopener">this feed</a>

, if you want all the content, subscribe to <a href="https://blog.koehntopp.info/feed.xml" target="_blank" rel="noopener">the original feed</a>

. In both cases, use the <code>&lt;tags/&gt;</code> to filter further down.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/07/mysql-from-a-developers-perspective.html" class='text-decoration-none text-dark'>MySQL from a Developers Perspective</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 7, 2020
        </div>

        <div class='mt-3'><p>So this has turned into a small series, explaining how to work with MYSQL from a developers perspective. This post is intended as a directory for the individual articles. It will be amended and re-dated as necessary.</p>
<p>The code for the series is also available in <a href="https://github.com/isotopp/mysql-dev-examples.git" target="_blank" rel="noopener">isotopp/mysql-dev-examples</a>

 on GitHub.</p>
<p>The Tag <a href="https://blog.koehntopp.info/tags/#mysqldev" target="_blank" rel="noopener">#mysqldev</a>

 will reference all articles from this series.</p>
<ul>
<li>
<p><a href="/2020/07/27/mysql-transactions.html">MySQL Transactions - the physical side</a>

.
Looking at how MySQL InnoDB handles transactions on the physical media, enabling rollback and commit. Introduces a number of important concepts: The Undo-Log, the Redo-Log, the Doublewrite Buffer, and the corrosponding in memory structures, the Log Buffer and the InnoDB Buffer Pool, as well as the concept of a page.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/07/mysql-generated-columns-and-virtual-indexes.html" class='text-decoration-none text-dark'>MySQL: Generated Columns and virtual indexes</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 7, 2020
        </div>

        <div class='mt-3'><p>We have had a look at <a href="/2020/09/04/mysql-json-data-type.html">how MySQL 8 handles JSON</a>

 recently, but with all those JSON functions and expressions it is clear that many JSON accesses cannot be fast. To grab data from a JSON column, you will use a lot of <code>$-&gt;&gt;field</code> expressions and similar, and without indexes nothing of this will be fast.</p>
<p>JSON cannot be indexed.</p>
<p>But MySQL 8 offers another feature that comes in handy: Generated columns and indexes on those. Let&rsquo;s look at the parts, step by step, and how to make them work, because they are useful even outside the context of JSON.</p></div>

    </div>
  </div>
  <div class='row justify-content-center mb-4 py-4 border-bottom mx-0'>
    <div class='col-lg-8'>
        <h1 style='font-weight: 700'><a href="https://blog.koehntopp.info/2020/09/04/mysql-json-data-type.html" class='text-decoration-none text-dark'>MySQL: Basic usage of the JSON data type</a></h1>
        <div class='text-uppercase text-secondary' style='letter-spacing: 0.1rem;'>
          <img src='/assets/img/avatars/isotopp.jpg' alt="Avatar of @isotopp@infosec.exchange" class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
          <a href="https://infosec.exchange/@isotopp" class='text-secondary text-decoration-none'>Kristian Köhntopp</a>
          -
          September 4, 2020
        </div>

        <div class='mt-3'><p>MySQL 8 provides solid support for the JSON data type. The manual has <a href="https://dev.mysql.com/doc/refman/8.0/en/json.html" target="_blank" rel="noopener">an overview of the data type</a>

, a <a href="https://dev.mysql.com/doc/refman/8.0/en/json-functions.html" target="_blank" rel="noopener">JSON function reference</a>

, an <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table-secondary-indexes.html#json-column-indirect-index" target="_blank" rel="noopener">an overview on generated column indexes</a>

, and <a href="https://dev.mysql.com/doc/refman/8.0/en/create-index.html#create-index-multi-valued" target="_blank" rel="noopener">explains multi-values indexes</a>

.</p>
<h2 id="creating-json-columns">
    <a href="#creating-json-columns">
	Creating JSON columns
    </a>
</h2>
<p>Creating JSON columns is easy: Make the column of the JSON data type, fill in valid JSON data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">auto_increment</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="n">json</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">11</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;&#34;keks&#34;&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;[&#34;eins&#34;, &#34;zwei&#34;]&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&#34;eins&#34;: &#34;one&#34;, &#34;zwei&#34;: &#34;two&#34;}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">json_type</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">json_valid</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">valid</span><span class="p">,</span><span class="w"> </span><span class="k">isnull</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sqlnull</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+-------+---------+--------------------------------+----+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">valid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sqlnull</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                              </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+-------+---------+--------------------------------+----+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">                           </span><span class="o">|</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">null</span><span class="w">                           </span><span class="o">|</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">true</span><span class="w">                           </span><span class="o">|</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">false</span><span class="w">                          </span><span class="o">|</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                              </span><span class="o">|</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">STRING</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&#34;keks&#34;</span><span class="w">                         </span><span class="o">|</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="nb">ARRAY</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;eins&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;zwei&#34;</span><span class="p">]</span><span class="w">               </span><span class="o">|</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="k">OBJECT</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;eins&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;one&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;zwei&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;two&#34;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+-------+---------+--------------------------------+----+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">8</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;[&#34;incomplete&#34;, &#34;array&#34;, &#34;closing bracket&#34;&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ERROR</span><span class="w"> </span><span class="mi">3140</span><span class="w"> </span><span class="p">(</span><span class="mi">22032</span><span class="p">):</span><span class="w"> </span><span class="n">Invalid</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="nb">text</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Missing a comma or &#39;]&#39; after an array element.&#34;</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="s1">&#39;t.j&#39;</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></div><p>We learn several things from this experiment:</p></div>

    </div>
  </div>

  <div class='row mb-4 py-4 mx-0 justify-content-center'>
    <div class='col-lg-8 fs-5'>
    
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/24.html" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/23.html" aria-label="Page 23" class="page-link" role="button">23</a>
      </li>
      <li class="page-item">
        <a href="/page/24.html" aria-label="Page 24" class="page-link" role="button">24</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 25" class="page-link" role="button">25</a>
      </li>
      <li class="page-item">
        <a href="/page/26.html" aria-label="Page 26" class="page-link" role="button">26</a>
      </li>
      <li class="page-item">
        <a href="/page/27.html" aria-label="Page 27" class="page-link" role="button">27</a>
      </li>
      <li class="page-item">
        <a href="/page/26.html" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/page/110.html" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul>
    </div>
  </div>


    
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
