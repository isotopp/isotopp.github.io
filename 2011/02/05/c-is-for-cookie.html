<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>C is for Cookie | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="canonical" href="https://blog.koehntopp.info/2011/02/05/c-is-for-cookie.html">


<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">




<meta name="generator" content="Hugo 0.110.0">
<meta property="og:title" content='C is for Cookie' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />


<meta property="og:locale" content="de_DE" />


<meta name="description" content='' />
<meta property="og:description" content='' />

<meta property="og:url" content="https://blog.koehntopp.info" />


<meta property="og:type" content="article" />
<meta name="article:published_time" content='2011-02-05T18:52:45Z' />



<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content='@isotopp' />
<meta name="twitter:creator" content='@isotopp' />
<meta property="twitter:title" content='C is for Cookie' />
<meta property="twitter:description" content='' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />

<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebSite","description":null,"headline":"C is for Cookie","image":"/assets/img/background/rijksmuseum.jpg","name":"Die wunderbare Welt von Isotopp","url":"https://blog.koehntopp.info"}
</script>

    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.6b600fb66ca1591ba6dcc9b3bdfc59ebd5c0fdc49622889f839fc36f71dde892.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            




<div class="page">
  <article class="c-is-for-cookie-page">
    <div class='row  justify-content-center text-center my-4 mx-0'>
      <header>
        <div class='col'>
          <h1 class="title mb-lg-4 text-white">
            C is for Cookie
          </h1>
          <div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
            <img alt='isotopp image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
            <a href="https://chaos.social/@isotopp" class='text-light text-decoration-none'>
                Kristian Köhntopp
            </a>

            
              <span class='d-none d-lg-inline'>-</span>
              <div class='d-block d-lg-inline'>February 5, 2011</div>
            

          </div>
        </div>
        
          <img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
        
      </header>
    </div>

    <div class='row justify-content-center mx-0 mt-5 mb-5'>
      <div class='col-lg-8'>
        <p><a href="http://www.youtube.com/watch?v=Ye8mB6VsUHw" target="_blank" rel="noopener">Krümelmonster: C is for Cookie</a>

</p>
<p>Auf den vielfachen Wunsch einer einzelnen Dame hier der Erklärbar zum Thema Kekse für die Freunde besagter Dame.</p>
<p>Eines der Hauptprobleme, das man lösen muß, wenn man Webanwendungen schreibt, ist die Tatsache, daß man im wesentlichen <a href="http://www.imdb.com/title/tt0209144/" target="_blank" rel="noopener">Memento</a>

 dreht.</p>
<p>Jedesmal, wenn man im Browser eine Seite aufruft, sieht der Webserver einen Request, bearbeitet diesen und vergißt danach, was er getan hat.
Es gibt nichts an einem Request, das man verwenden kann, um den zweiten Requests sicher mit dem ersten Request zu verketten und sich an die Dinge zu erinnern, die man im ersten Request getan hat.</p>
<h1 id="cookies-und-sessions">
    <a href="#cookies-und-sessions">
	Cookies und Sessions
    </a>
</h1>
<p><p class="md__image">
  <img src="/uploads/stateless.png" alt=""  />
</p>


<em>Ein Browser (rechts) sendet einen Request <code>GET /</code> an einen Server <code>www.shop.com</code> (links). Der erste und der zweite Request sind unabhängig und nicht miteinander verkettbar.</em></p>
<p>Der erste und der zweite Request vom selben Browser sind nach Definition von HTTP für den Webserver nicht als zusammengehörig erkennbar.</p>
<p>Man kann nicht den User-Agent des Browsers verwenden, weil es viele verschiedene Browser mit demselben User-Agent geben kann.
Man kann auch nicht die IP-Adresse verwenden: zum einen kann es vorkommen, daß mehr als ein Benutzer dieselbe IP-Adresse verwendet, weil es Rechner gibt, die von mehreren Benutzern zeitgleich verwendet werden.</p>
<p>Zum anderen kann es vorkommen, daß Request 1 und Request 2 mit unterschiedlichen IP-Adresse gesendet werden.</p>
<p>Das ist oft der Fall, wenn ein Benutzer bei T-Online oder AOL ist oder wenn er <a href="http://de.wikipedia.org/wiki/Tor_%28Netzwerk%29" target="_blank" rel="noopener">Tor</a>

 verwendet.
Dort geschieht dies regelmäßig wegen der Struktur der Proxyserver, die dort verwendet werden.</p>
<p>Bei Mobilbenutzern kann sich die IP-Adresse spontan ändern, wenn sie ihren Standort verändern, auch wenn das Netz versucht, dies zu verbergen.</p>
<p>Und nach einer DSL-Zwangstrennung hat man natürlich auch eine neue IP-Adresse.
Erstrecken sich Browser-Tätigkeiten über solche Intervalle, sieht man aufeinanderfolgende Requests desselben Benutzers von verschiedenen IP-Adressen.</p>
<p>Bei Memento löst man das Problem mit Tätowierungen, in Browsern verwendet man stattdessen Cookies.</p>
<p><p class="md__image">
  <img src="/uploads/cookie-set.png" alt=""  />
</p>


<em>Cookie definieren: Der Webserver setzt mit dem Header <code>Set-Cookie</code> einen Cookie im Browser, hier <code>sessid=17</code>.</em></p>
<p>Greift ein Browser das erste Mal auf eine Webanwendung zu, sendet er einen <code>GET</code>-Request mit dem Namen der gewünschten Site im <code>Host</code>-Header und einigen weiteren Headerzeilen, die uns hier heute nicht interessieren sollen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">GET / HTTP/1.1
</span></span></span><span class="line"><span class="cl"><span class="go">Host: www.shop.com
</span></span></span><span class="line"><span class="cl"><span class="go">Connection: keep-alive
</span></span></span><span class="line"><span class="cl"><span class="go">Accept: application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
</span></span></span><span class="line"><span class="cl"><span class="go">User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.84 Safari/534.13
</span></span></span><span class="line"><span class="cl"><span class="go">Accept-Encoding: gzip,deflate,sdch
</span></span></span><span class="line"><span class="cl"><span class="go">Accept-Language: en-US,en;q=0.8
</span></span></span><span class="line"><span class="cl"><span class="go">Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
</span></span></span></code></pre></div><p>Die Webanwendung reagiert mit einer Antwort, die einen Content-Type definiert (zum Beispiel <code>text/html</code> für Webseiten) und die weitere Header enthalten kann.
Einer dieser Header ist <code>Set-Cookie</code>.
Das ist die Tätowierung, die unseren Browser von allen anderen Browsern unterscheidbar macht.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">Set-Cookie: &lt;name&gt;=&lt;value&gt;
</span></span></span><span class="line"><span class="cl"><span class="go">	[; expires=&lt;date&gt;]
</span></span></span><span class="line"><span class="cl"><span class="go">	[; domain=&lt;domain_name&gt;]
</span></span></span><span class="line"><span class="cl"><span class="go">	[; path=&lt;some_path&gt;]
</span></span></span><span class="line"><span class="cl"><span class="go">	[; secure]
</span></span></span><span class="line"><span class="cl"><span class="go">	[; httponly]
</span></span></span></code></pre></div><p><em>Die &ldquo;Syntaxdefinition&rdquo; von <code>Set-Cookie</code> beschreibt, welche Eigenschaften und Optionen ein Cookie haben kann.</em></p>
<p><code>Set-Cookie</code> definiert eine Variable mit dem Namen <code>Name</code> und dem Wert <code>value</code>.
Es gibt Limits im Browser für die Anzahl und Länge dieser Variablen
pro Site und insgesamt.</p>
<p>Mit der Definition eines Cookies können weitere Einschränkungen festgelegt werden, die sagen wo und wie lange der Cookie gelten soll:
Die Einschränkungen, die man festlegen kann, bestimmen an welche Domain der Cookie zurück übermittelt wird, wie lange er gelten soll, ob er für eine ganze Site oder nur einige Pfade auf der Site definiert sein soll, ob er nur mit SSL-Verschlüsselung übertragen werden soll und ob Javascript mit dem Cookie arbeiten darf.</p>
<p>Der Browser erhält diese Definition mit der Webseite, die ihm übermittelt wird.
Während er die Webseite darstellt, speichert er die Variable und den dazu gehörenden Wert ab.</p>
<p>Im Beispiel oben wird eine Variable mit dem Namen <code>sessid</code> definiert, die den Wert <code>17</code> bekommt.
Es ist eine zusätzliche Einschränkung definiert, die festlegt, daß diese Variable bei allen Zugriffen auf Domains mit der Endung <code>.shop.com</code> übermittelt werden soll.
Da kein <code>expires</code>-Wert gesetzt ist, gilt die Variable so lange wie der Browser läuft - andernfalls gälte sie so lange bis das gesetzte Datum verstrichen ist.</p>
<p>Mit jedem weiteren Zugriff (der die zusätzlichen Einschränkungen erfüllt)
setzt er jetzt eine zusätzliche Headerzeile <code>Cookie</code>, in der er die Variable
und ihren Wert zurück an den Server übermittelt.</p>
<p><p class="md__image">
  <img src="/uploads/cookie-get.png" alt=""  />
</p>


<em>Wegen eines vorhergehenden <code>Set-Cookie</code> ist jetzt ein Cookie <code>sessid</code> mit dem Wert <code>17</code> für <code>.shop.com</code> gesetzt. Weil <code>www.shop.com</code> unterhalb von <code>.shop.com</code> liegt, wird nun bis auf weiteres der <code>Cookie: sessid=17</code> mit jedem Request dort hin gesendet. Aber nur für diesen Browser - andere Browser senden keinen Cookie oder den Wert, der für sie gesetzt worden ist. Dadurch werden unterschiedliche Browser unterscheidbar.</em></p>
<p>Sobald ein Cookie gesetzt ist, übermittelt der Browser den Cookie bei jedem nachfolgenden Requests, der die Bedingungen der Definition erfüllt.
Hier wird also nun für jeden Request an einen Host in der Domain <code>.shop.com</code> die
<code>sessid=17</code> mitgesendet.
Der Browser ist nun eindeutig identifizierbar, solange die <code>sessid</code> eindeutig vergeben wird.</p>
<p>Unser Beispielcookie ist ein sogenannter Session-Cookie - er wird ohne ein <code>expires</code> definiert und daher nicht auf der Festplatte, sondern nur im Browser gespeichert.
Beendet man den Browser, ist er verloren.
Session-Cookies dienen dazu, aufeinanderfolgende Web-Requests ein und desselben Browsers miteinander zu verketten und erlauben es Webanwendungen, Zustand zu haben.</p>
<h1 id="zustand">
    <a href="#zustand">
	Zustand?
    </a>
</h1>
<p>Eine Anwendung ist ein Programm, das bestimmte Funktionen hat.
Entgegen den Darstellungen in <a href="http://www.imdb.com/title/tt0084827/" target="_blank" rel="noopener">gewissen Filmen</a>

 liegen Programme gewöhnlich auf der Platte rum und tun gar nichts.
Nur wenn sie gestartet werden, wird ihr Code um etwas ergänzt - Variablen.
Die Summe aller Variablen eines Programmes ist sein Zustand.</p>
<p><p class="md__image">
  <img src="/uploads/application-state.png" alt=""  />
</p>


<em>Zwei Dateien werden zur selben Zeit im selben Texteditor bearbeitet.
Text, Cursorposition, Schriftart und Dateiname unterscheiden sich zwischen beiden Dokumenten, d.h. diese Variablen haben in beiden Dokumenten unterschiedliche
Werte.</em></p>
<p>Ein Texteditor zum Beispiel hat viele Funktionen zum Bearbeiten von Texten.</p>
<p>Öffnet man ein neues Dokument, weiß der Textedit den Namen dieses Dokumentes (&ldquo;untitled.txt&rdquo;), die Cursorposition (links oben) und den Text, der in dem Dokument enthalten ist sowie die aktuelle Schriftart und -farbe und noch viele andere Dinge mehr.</p>
<p>Ein zweites Dokument (hier: &ldquo;Faust 3 - die Rückkehr.txt&rdquo;) enthält anderen Text, eine andere Cursorposition, eine andere Schriftart und so weiter.
Der Texteditor kann mehr als einen Text bearbeiten, weil er für jedes Dokument
seinen Zustand getrennt verwaltet.</p>
<p><p class="md__image">
  <img src="/uploads/web-state.png" alt=""  />
</p>


<em>Zwei Browser arbeiten mit demselben Webshop, einer hat die <code>sessid=17</code>, der andere die <code>sessid=18</code>. In zwei unterschiedlichen Datensätzen wird der Warenkorb für jeden Browser verwaltet.</em></p>
<p>Genau so verhält es sich etwa bei einem Webshop.
Auf dem Server liegt einmal der Code der Webanwendung, mit Funktionen wie &ldquo;Artikel anzeigen&rdquo;, &ldquo;Warenkorb verwalten&rdquo; und &ldquo;abkassieren&rdquo;.
Aber natürlich muß man für jeden Benutzer des Webservers - womöglich viele hundert Personen gleichzeitig - einen eigenen Warenkorb verwalten.</p>
<p>Man kann den Warenkorb selbst in den Cookie tun, aber das hat eine Reihe von Nachteilen.
Zum Beispiel ist die Größe und Lebensdauer des Warenkorbes dann von den Limits des Browsers eingeschränkt.
Zum anderen ist es dann so, daß die Daten des Warenkorbes bei jedem Request mit übermittelt werden müssen.
Das macht jeden Request größer.
Außerdem es macht auch bei jedem Request einen Übergang von Daten aus der Gefahrenzone &ldquo;nicht vertrauenswürdig&rdquo; (irgendein Browser im Internet) in die Gefahrenzone &ldquo;vertrauenswürdig&rdquo; (unsere Webanwendung) notwendig, und führt so zu vielen unnötigen Prüfungen der Datenintegrität.</p>
<p>Normalerweise setzt man in einem Session-Cookie nur eine eindeutige Kennummer, die Session-ID.
Die Daten des Warenkorbes selber speichert man in einem Datensatz auf dem Server in einem Eintrag mit genau dieser Kennung.</p>
<p>Bekommen wir also einen Request von einem Browser mit der <code>sessid=17</code>, laden
wir den Datensatz für die sessid <code>17</code> und zeigen dem Kunden seinen Warenkorb
an.
Bekommen wir stattdessen einen Request für die sessid <code>18</code>, laden wir diesen Warenkorb und zeigen diesen an.</p>
<p>Natürlich wird man nicht wirklich die Zahlen <code>17</code> und <code>18</code> verwenden, sondern sehr große, zufällig gewählte Zahlen wie etwa <code>a13bcf7a0b2fb6f9dfdebe2e0657c9e3</code> und <code>791c8d7234c56497fe23a593af3b1ab9</code>.</p>
<p>Sähe ein Hacker etwa eine sessid wie <code>17</code>, würde er sofort einmal nachsehen, ob es <code>16</code> und <code>18</code> gibt und welche Daten da drin stecken.
Bei <code>a13bcf7a0b2fb6f9dfdebe2e0657c9e3</code> sind nicht nur andere IDs schwer zu raten, sondern der gesamte Session-ID Raum ist dünn besetzt, d.h. die meisten anderen geratenen IDs gehören zu gar keiner Session.</p>
<h1 id="was-wäre-wenn-es-keine-cookies-gäbe">
    <a href="#was-w%c3%a4re-wenn-es-keine-cookies-g%c3%a4be">
	Was wäre, wenn es keine Cookies gäbe?
    </a>
</h1>
<p>Man könnte Session-IDs auch anders als mit Cookies übermitteln.
Statt des Requests</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">GET /shop.html
</span></span></span><span class="line"><span class="cl"><span class="go">Host: www.shop.com
</span></span></span><span class="line"><span class="cl"><span class="go">Cookie: sessid=17
</span></span></span></code></pre></div><p>könnte man zum Beispiel auch die ID in die URL tun.
Der Request wäre dann zu <code>http://www.shop.com/shop.html?sessid=17</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">GET /shop.html?sessid=17
</span></span></span><span class="line"><span class="cl"><span class="go">Host: www.shop.com
</span></span></span></code></pre></div><p>Oder man baut die ID in den Hostnamen ein:
<code>http://sessid17.shop.com/shop.html</code> wäre die URL und der Request ist dann</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">GET /shop.html
</span></span></span><span class="line"><span class="cl"><span class="go">Host: sessid17.shop.com
</span></span></span></code></pre></div><p>Das Problem bei diesen anderen Verfahren ist, daß die Session-ID auf die eine oder andere Weise Bestandteil der URL wird.</p>
<p>Dadurch gibt man die Session weiter, wenn man die URL an jemand anders per Cut &amp; Paste per Mail, Skype oder sonstwie übermittelt.
Ja, die URL wird sogar unter Umständen mit der Session-ID von Suchmaschinen archiviert - eine ganz schlechte Idee, denn so bekommt jeder Benutzer der Suchmaschine dieselbe Session-ID, wenn er über die Suchmaschine in unseren Shop kommt.</p>
<p>Es gibt Mechanismen, die mit diesen Problemen fertig werden und die eine URL auch dann sicher machen können, wenn sie die Session-ID in der URL enthält.
Es ist aber viel besser, einen Mechanismus zu verwenden, der das Problem schon im Ansatz vermeidet - und das ist genau die Intention, die hinter der Erfindung von Cookies stand.</p>
<h1 id="cookies-mit-datum-und-auto-login">
    <a href="#cookies-mit-datum-und-auto-login">
	Cookies mit Datum und Auto-Login
    </a>
</h1>
<p>Eine weitere Anwendungsmöglichkeit von Cookies ist die Speicherung von Präferenzen im Webbrowser, sodaß eine Website bei folgenden Besuchen gleich so aussieht, wie vom Benutzer voreingestellt.</p>
<p>Dazu wird ein Cookie mit einem Expires-Wert gesendet, der dann womöglich erst sehr weit in der Zukunft seinen Inhalt verliert.
Dadurch wird der Cookie nicht mehr im Browser gespeichert, sondern auf der Festplatte in der Browserkonfiguration verewigt.
Er steht auch nach einem Neustart noch zur Verfügung.</p>
<p>In dem Wert des Cookies werden die Benutzer-Voreinstellungen gespeichert.
Oder gar ein Login-Token, das den Benutzer eindeutig identifiziert, und das auf diese Weisen den Benutzer bei allen weiteren Besuchen auf der Site einloggt.
So ein Token muß natürlich schwer zu manipulieren sein, aber wie man so etwas bauen kann ist gut verstanden.</p>
<p>Ein Webserver kann so ein Cookie etwa wie folgt setzen:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">Set-Cookie: Login=kris-23b9404f78d90b881175bcfc5f57b61c;       
</span></span></span><span class="line"><span class="cl"><span class="go">	domain=.shop.com;
</span></span></span><span class="line"><span class="cl"><span class="go">	expires=Sat, 01-Jan-2030 00:00:00 GMT;
</span></span></span><span class="line"><span class="cl"><span class="go">	path=/;
</span></span></span></code></pre></div><p>Die Site hat nun Methoden, mit denen sie die behauptete Identität (<code>kris</code>) und den Authentizitätsbeweis (die Nummer da) zusammenführen kann.
Sie kann dann ableiten, daß <code>kris</code> wirklich mal irgendwann in diesen Browser sein Paßwort getippt hat.
Sie loggt <code>kris</code> nun automatisch ein - für die nächsten 20 Jahre.</p>
<h1 id="die-dunkle-seite-der-kekse---präferenzen-und-tracking">
    <a href="#die-dunkle-seite-der-kekse---pr%c3%a4ferenzen-und-tracking">
	Die dunkle Seite der Kekse - Präferenzen und Tracking
    </a>
</h1>
<p>Gesetzte Cookies werden bei jedem Request übermittelt, der die im <code>Set-Cookie</code> gestellten Bedingungen erfüllt.
Hat man also eine Webseite, die Bilder enthält, wird der Cookie auch bei allen Requests für Bilddateien mitgesendet.</p>
<p>Der Cookie-Mechanismus hat Einschränkungen, etwa bei der Domain-Bedingung.
So kann man als <code>www.shop.com</code> zwar einen Cookie für <code>domain=.shop.com</code> setzen (also auch für <code>img.shop.com</code>, <code>static.shop.com</code> und so weiter), aber nicht für <code>.com</code> oder gar <code>.</code> (alle Sites im Internet).
Dieser etwas unbeholfene Mechanismus soll verhindern, daß man Cookies als Tracking-Mechanismus mißbrauchen kann.</p>
<p>Denn wäre es legal, einen Cookie wie diesen für die &ldquo;Domain&rdquo; <code>.</code> (das ganze
Internet) zu senden:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">Set-Cookie: ID=ee487f1423d28992ee285760875e2cb8;
</span></span></span><span class="line"><span class="cl"><span class="go">	expires=Sat, 01-Jan-2030 00:00:00 GMT;
</span></span></span><span class="line"><span class="cl"><span class="go">	domain=.;
</span></span></span></code></pre></div><p>dann hätte man dem Browser des Benutzers für die nächsten beiden Dekaden internet-weit eine eindeutige Kennung verpaßt und könnte diesen Benutzer bequem tracken.</p>
<p>Leider ist die Regel &ldquo;zwei Punkte im Domainnamen&rdquo; für viele Domains kaputt.
Ein Beispiel: <code>www.shop.co.uk</code> - mit der Zwei-Punkte-Regel kann man Cookies für ganz <code>.co.uk</code> setzen.
Deswegen haben Browser in der Regel eine sehr lange und komplizierte Liste von Ausnahmefällen, die versucht, diesen defekten Cookie-Sicherheitsmechanismus zu reparieren.</p>
<h1 id="tracking-mit-cookies---und-mit-javascript-am-beispiel-ivw">
    <a href="#tracking-mit-cookies---und-mit-javascript-am-beispiel-ivw">
	Tracking mit Cookies - und mit Javascript am Beispiel IVW
    </a>
</h1>
<p>Werbebanner-Generierer und Auflagenzähler umgehen das Problem sowieso auf
anderen Wegen.
In den Seiten von <a href="http://www.web.de" target="_blank" rel="noopener">web.de</a>

 und bei vielen anderen Websites findet man zum Beispiel Code wie diesen hier:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://webdessl.ivwbox.de/cgi-bin/ivw/CP/264_PH;sc%3Dwebde/homepage&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">width</span><span class="o">=</span><span class="s">&#34;1&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;1&#34;</span><span class="p">/&gt;</span>
</span></span></code></pre></div><p>Dieser Code lädt ein 1x1 Pixel großes Bild - das Bild ist ein transparentes GIF, also unsichtbar.
Das Bild wird aber nicht von der Domain <code>web.de</code> geladen, sondern von der Domain <code>ivwbox.de</code>.</p>
<p>Von dort bekommt man dann eine Antwort wie diese hier:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:~ kris$ curl -D x &#39;http://webdessl.ivwbox.de/cgi-bin/ivw/CP/264_PH;sc%3Dwebde/homepage&#39;
</span></span></span><span class="line"><span class="cl"><span class="go">KK:~ kris$ cat x
</span></span></span><span class="line"><span class="cl"><span class="go">HTTP/1.0 302 FOUND
</span></span></span><span class="line"><span class="cl"><span class="go">Date: Sat, 05 Feb 2011 18:20:49 GMT
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">Set-Cookie: i00=01914d4d94fc5da00006; path=/; domain=.ivwbox.de; expires=Sunday, 05-Feb-2012 18:20:44 GMT
</span></span></span></code></pre></div><p>Es wird also der Cookie <code>i00</code> mit dem Wert <code>01914d4d94fc5da00006</code> definiert.
Der Cookie hält ein Jahr lang und wird für die Domain <code>.ivwbox.de</code> gesetzt.</p>
<p>Diese Domain ist von der HTML-Webseiten-Domain <code>web.de</code> verschieden.
Man spricht von einem Third-Party Cookie.</p>
<p>Immer wenn ich Seiten von <code>web.de</code> lade, wird das unsichtbare Zählpixel von <code>webdessl.ivwbox.de</code> mit geladen und ich werde als Benutzer <code>01914d4d94fc5da00006</code> identifiziert.
Die <a href="http://www.ivw.de/" target="_blank" rel="noopener">IVW</a>

 kann so die eindeutig unterscheidbaren Benutzer auf <code>web.de</code> zählen und so eine Werbe-Auflagenstärke für <code>web.de</code> angeben, nach der sich der Werbepreis für Banner berechnet.</p>
<p>Das Pixel ist in jeder Seite von <code>web.de</code>, und bei einem geladenen Bild wird im HTTP-Header <code>Referer</code> übermittelt, in welcher Seite das Bild enthalten war.
Dadurch kann man also leicht ermitteln, welche Klickpfade der Benutzer <code>01914d4d94fc5da00006</code> auf <code>web.de</code> so typischerweise hat und was seine Verweildauer auf der Site ist.
Verweildauern sind neben eindeutigen Benutzern wichtig, weil Sites mit langer Verweildauer bessere Werbepreise bekommen (oder was glaubt Ihr, warum es auf Facebook Spiele und Chat gibt?  Genau!).</p>
<p>Schließlich kann auch noch weitere Spielchen spielen, falls Javascript aktiviert ist.
So findet man etwa bei web.de vor dem Counterpixel den Code</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://uim.tifbs.net/js/4423.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>der wiederum auf Umwegen die Datei
<a href="http://uim.tifbs.net/js/global_4423_38.js" target="_blank" rel="noopener">http://uim.tifbs.net/js/global_4423_38.js</a>


nachlädt.</p>
<p>Dort wird an geeigneter Stelle ein Aufruf wie folgt gemacht:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="k">this</span><span class="p">.</span><span class="nx">_loadPixel</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">_replaceVariables</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;//pixelbox.uimserv.net/cgi-bin/webde/__TYPE__/__CODE__;sc%3D__SC__%26jsv%3D__JSV__%26scr%3D__SCR__%26flv%3D__FLV__%26vid%3D__VID__%26vct%3D__VCT__%26res%3D__RES__%26smv%3D__SMV__%26cona%3D__CONA__%26cost%3D__COST__?d%3D__D__%26r=__R__&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></div><p>Aus dem ganzen Drumherum geht hervor, dass die Texte der Form __NAME__ Platzhalter sind, die Werten ersetzt werden, die zuvor von Javascript
eingesammelt werden. FLV ist zum Beispiel die installierte Version von Flash, RES die Bildschirmauflösung und so weiter.</p>
<p>Die komplette Liste findet man in der Funktion <code>_replaceVariables()</code> in der Javascript-Datei.
Auf diese Weise bekommt <code>pixelbox.uimserv.net</code>, ein weiterer Zählservice, den <code>web.de</code> verwendet, nicht nur die Benutzeridentät per Cookie geliefert, sondern über den Pfad der URL und Javascript auch noch einen Haufen weitere Information über den Rechner und seinen Benutzer.</p>
<p>Das Tracking der IVW ist jedoch ein wenig umfassender als man zunächt vermuten mag:
Es wird ja nicht ohne Grund die Domain <code>ivwbox.de</code> statt <code>web.de</code> verwendet.
Durch den Namen wird es möglich, den Cookie für <code>.ivwbox.de</code> zu setzen, also für alle Hosts in der Domain <code>ivwbox.de</code>.</p>
<p>Wenn ich also <a href="http://www.zeit.de" target="_blank" rel="noopener">zeit.de</a>

 aufrufe, wird ein Zählpixel von <code>zeitonl.ivwbox.de</code> geladen, wie man dort im HTML-Quelltext der Seite nachlesen kann.
Dabei wird meine Identität <code>01914d4d94fc5da00006</code> von <code>web.de</code> ebenfalls wieder an <code>.ivwbox.de</code> übermittelt.
Auf diese Weise wird dem Betreiber von <code>ivwbox.de</code> über <code>zeitonl.ivwbox.de bekannt, daß der Benutzer </code>01914d4d94fc5da00006<code>neben</code>web.de<code>auch</code>zeit.de` nutzt.
Dieses Wissen kann man natürlich gut gebrauchen, wenn man Werbebanner verkaufen will.</p>
<p>Über eine Verkettung von Daten könnte man das <code>01914d4d94fc5da00006</code>-Pseudonym sogar aufdecken - wenn ich mich bei <code>web.de</code> einlogge, könnte man das Login <code>kris@web.de</code> mit der Kennung <code>01914d4d94fc5da00006</code> zusammenführen und weiß so, daß <code>kris@web.de</code> die Zeit online liest.</p>
<h1 id="das-datenschutz-nichtproblem---oder-doch">
    <a href="#das-datenschutz-nichtproblem---oder-doch">
	Das Datenschutz-Nichtproblem - oder doch?
    </a>
</h1>
<p>web.de, zeit.de und ivwbox.de sind alles deutsche Rechner, die von deutschen Firmen betrieben werden und man sagt mir, daß das IVW-Tracking mit dem deutschen und europäischen Datenschutzrecht konform ist.</p>
<p>Google Anaytics macht dasselbe, aber deren Server stehen nicht in Deutschland und es ist keine deutsche Firma, und daher <a href="http://www.golem.de/1101/80990.html" target="_blank" rel="noopener">steht deutschen Datenschützern</a>

 gerade Schaum vor dem Mund.
Also wohlgemerkt, nicht wegen des Trackings, sondern weil es außerhalb ihres Hoheitsgebietes stattfindet.
Wenn es in Deutschland passierte wäre alles gut:</p>
<blockquote>
<p>Websites dürfen IP-Adressen nicht ohne Erlaubnis des Nutzers <strong>in die USA</strong>
<strong>übermitteln</strong>. Daher sei der Einsatz von Google Analytics in der jetzigen
Form in aller Regel nach deutschem Recht nicht erlaubt, argumentiert Dix
beim Treffen der Google Technology User Group Berlin.</p>
</blockquote>
<p>(Hervorherbung von mir)</p>
<h1 id="zusammenfassung">
    <a href="#zusammenfassung">
	Zusammenfassung
    </a>
</h1>
<p>Cookies sind eine gute Sache und sie zu blockieren verhindert sichere Sessions - und damit Funktionen wie Warenkörbe oder Logins.
Cookies können auch verwendet werden, um Benutzer zu tracken oder andere fragwürdige Dinge zu tun.
Es ist jedoch nicht der Mechanismus Cookie böse, sondern die jeweilige Anwendung ist zu untersuchen.</p>
<p>Wenn man eine Sicherheitseinstellung im Browser treffen möchte, dann sollte man sogenannte Third Party Cookies unterdrücken.
Session-Cookies (jene ohne Expires-Datum) muß man erlauben, dennn sonst funktionieren viele Websites nicht korrekt.
Cookies mit Verfallsdatum kann man erlauben, wenn man sich das Leben erleichtern möchte, oder auf &ldquo;Nachfragen&rdquo; stellen.</p>
<p>In jedem Fall sollte ein Adblocker zum Einsatz kommen.
<a href="https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm" target="_blank" rel="noopener">uBlock origin</a>

 ist ein Adblocker, der von einer Person ohne kommerzille Interessen entwickelt wird.
Er ist auch <a href="https://addons.mozilla.org/en-US/firefox/addon/ublock-origin/" target="_blank" rel="noopener">für Firefox</a>

 erhältlich.</p>

      </div>
    </div>

    
    
    <div class='row justify-content-center mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Share</span>
        <a href='https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.koehntopp.info%2f2011%2f02%2f05%2fc-is-for-cookie.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#facebook'/></svg>
        </a>

        <a href='http://www.reddit.com/submit?url=https%3a%2f%2fblog.koehntopp.info%2f2011%2f02%2f05%2fc-is-for-cookie.html&title=C%20is%20for%20Cookie' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>
        <a href='mailto:?subject=C%20is%20for%20Cookie&body=https%3a%2f%2fblog.koehntopp.info%2f2011%2f02%2f05%2fc-is-for-cookie.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope-fill'/></svg>
        </a>
      </div>
    </div>

    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
        
          <a href="/tags/#cookie" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            cookie
          </a>
        
          <a href="/tags/#privacy" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            privacy
          </a>
        
          <a href="/tags/#erklaerbaer" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            erklaerbaer
          </a>
        
          <a href="/tags/#internet" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            internet
          </a>
        
          <a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            lang_de
          </a>
        
      </div>
    </div>

    
    
    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2011-02-05-c-is-for-cookie.md" rel="noopener noreferrer" target="_blank">
            <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
        </a>
      </div>
    </div>
    

    <div class='row justify-content-center mb-5 pt-5 border-top mx-0'>
      <div class='col-lg-4 text-center text-lg-start'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Next Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2011/02/10/die-kosten-von-ssl.html">Die Kosten von SSL</a>
          </div>
        
      </div>

      <div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Previous Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2011/01/18/vergeben-vergessen-und-vernichten.html">Vergeben, vergessen und vernichten</a>
          </div>
        
      </div>
    </div>

    
    </article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff. 
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#rss-fill'/></svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope'/></svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#github'/></svg>
        </a>

	<a rel="me" href="https://chaos.social/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#mastodon'/></svg>
	</a>

        <a href='https://www.reddit.com/user/isotopp' title='Follow on Reddit' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>

        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#steam'/></svg>
        </a>



        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#youtube'/></svg>
        </a>

      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
