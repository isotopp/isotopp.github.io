<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>User und Gruppen, Prozesse und Dateien | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2005/11/01/user-und-gruppen-prozesse-und-dateien.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='User und Gruppen, Prozesse und Dateien | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="de_DE" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2005/11/01/user-und-gruppen-prozesse-und-dateien.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2005-11-01T18:41:28Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='User und Gruppen, Prozesse und Dateien' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="user-und-gruppen-prozesse-und-dateien-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						User und Gruppen, Prozesse und Dateien
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>November 1, 2005</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/10/28/in-with-the-out-old-with-the-new.html">In with the out, old with the new...</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/11/01/legal-illegal-scheissegal.html">Legal, Illegal, Scheißegal...</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>Heute im Irc stellte eine Teilnehmerin den folgenden Fragenschwall:</p>
<blockquote>
<p>Wie finde ich eigentlich heraus, was für Gruppen es auf einem
Linuxsystem gibt? Wie füge ich da jemanden hinzu? Lege ich den
zuerst als User an, ganz normal? Und: Wenn ich einen Ordner
anlege, der nur für eine bestimmte Gruppe zugänglich sein
soll, mache ich das doch über File Permissions, oder habe ich
falsch gedacht?</p></blockquote>
<p>Die offensichtliche Antwort, das Nachsehen in <code>/etc/group</code>,
funktioniert bei modernen Unixen nicht mehr zwingend, denn
Gruppendefinitionen können nicht nur in lokalen Dateien stehen,
sondern auch aus dem NIS, dem NIS+, einem LDAP oder einem Active
Directory kommen.</p>
<p>Die folgenden Dinge wurden mit Suse Linux 10.0 getestet, sollten
so aber auch auf Solaris funktionieren.</p>
<h2 id="name-service-switch">
    <a href="#name-service-switch">
	Name Service Switch
    </a>
</h2>
<p>Genauer gesagt haben moderne Unixe ein Subsystem namens Name
Service Switch. Der Name Service Switch erlaubt es dem System,
für Benutzer, Gruppen, Hostnamen, Protokolle, Service und noch
ein paar Dinge beliebige Datenquellen zu verwenden, für die
vorgefertige Module existieren.</p>
<p>Der Name Service Switch wird durch die Datei
<code>/etc/nsswitch.conf</code> gesteuert. Dort findet man für jede
Datenbasis (passwd, group, hosts, &hellip;) einen einzeiligen
Eintrag. Nach dem Namen der Datenbasis werden durch Leerzeichen
getrennt die Namen der Datenquellen aufgelistet, und zwar in der
Reihenfolge, in der sie durchsucht werden sollen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">passwd: files nis
</span></span></span><span class="line"><span class="cl"><span class="go">shadow: files nis
</span></span></span><span class="line"><span class="cl"><span class="go">group: files nis
</span></span></span><span class="line"><span class="cl"><span class="go">hosts: files dns
</span></span></span></code></pre></div><p>Diese Beispielkonfiguration holt ihre Benutzerdaten für Passwd-
und Shadow-Datei sowie die Gruppen aus den lokalen Dateien und
danach aus dem NIS, und sie ermittelt Hostnamen aus der lokalen
<code>/etc/hosts</code> und danach aus dem DNS.</p>
<p>Die Syntax für die <code>/etc/nsswitch.conf</code> ist noch ein wenig
komplizierter. Zwischen den Einträgen für Datenquellen können in
eckigen Klammern nämlich noch Anweisungen für das Verhalten in
Fehlerfällen stehen. Auf diese Weise sind Setups möglich, die
ihre Daten normalerweise NUR aus dem NIS ziehen, aber aus den
lokalen Dateien, falls das NIS einmal nicht erreichbar sein
sollte.</p>
<p>Die Datenbasen des Name Service Switch lassen sich mit dem
Kommando <code>getent</code> testen. <code>getent group</code> listet zum Beispiel die
gesamte <code>group</code>-Datenbasis auf, <code>getent group disk</code> listet nur
den Eintrag für die Gruppe <code>disk</code> auf.</p>
<p>Wir merken uns:</p>
<blockquote>
<p>In einem modernen Unix mit Name Service Switch ist es also
falsch, eine Liste der Gruppen des Systems durch Auslesen von
<code>/etc/group</code> zu erzeugen. Stattdessen muß die Liste mit
<code>getent group</code> erzeugt werden.</p></blockquote>
<p>Das Interface des Name Service Switch ist read-only. Es erlaubt
nicht die virtualisierte Erzeugung von Gruppen. Schreibzugriffe
müssen also weiterhin manuell in die richtige Datenbank geroutet
werden, also in eine lokale Datei oder in ein LDAP geschrieben
werden.</p>
<h2 id="prozesse-und-dateien">
    <a href="#prozesse-und-dateien">
	Prozesse und Dateien
    </a>
</h2>
<p>User und Gruppen sind nur dann von Bedeutung, wenn sie auch vom
Systemteilen verwendet werden. Systemteile sind Subjekte, also
Prozesse, und Objekte, also Dateien.</p>
<p>Ein Prozeß in Unix hat eine effektive User-ID und eine effektive
primäre Gruppen-ID. Er kann außerdem eine Reihe von weiteren
sekundären Gruppen-IDs enthalten.</p>
<p>Das Kommando &ldquo;id&rdquo; listet die User- und Gruppen-IDs eines Benutzers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; id -a
</span></span></span><span class="line"><span class="cl"><span class="go">uid=1000(kris) gid=100(users) Gruppen=16(dialout),33(video),100(users)
</span></span></span></code></pre></div><p>Der Benutzer kris hat also die User-ID 1000 und die primäre
Gruppen-ID 100. Er gehört außerdem den Gruppen 16 (dialout) und
33 (video) an.</p>
<p>Wenn dieser Prozeß eine Datei erzeugt, dann gehört diese Datei
ebenfalls dem Benutzer 1000 (kris) und sie wird standardmäßig
(&ldquo;System V Semantik&rdquo;) der Gruppe 100 (users) angehören, denn
dies sind die primäre User- und Gruppen-ID dieses Prozesses.</p>
<p>Es gibt eine andere Betriebsart für Dateisysteme (&ldquo;BSD Semantik&rdquo;), bei der neu angelegte Dateien nicht die primäre Gruppe des anlegenden Prozesses erben, sondern die Gruppe des unmittelbar übergeordneten Verzeichnisses. Man kann das ext2-Dateisystem komplett auf BSD-Semantik umstellen, indem man es mit der Option &ldquo;grpid&rdquo; (alternativ &ldquo;bsdgroups&rdquo;) mounted - der Default ist &ldquo;nogrpid&rdquo; (alternativ &ldquo;sysvgroups&rdquo;). In der Betriebsart &ldquo;nogrpid&rdquo; kann man für ein einzelnes Verzeichnis BSD Semantik wählen, indem man das SGID-Bit an dem Verzeichnis setzt. Hier ein Beispiel:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">dhcp-179:~ # lvcreate -l 10 -n test system
</span></span></span><span class="line"><span class="cl"><span class="go">Logical volume &#34;test&#34; created
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:~ # mke2fs -q /dev/system/test
</span></span></span><span class="line"><span class="cl"><span class="go">dhcp-179:~ # mount -o nogrpid /dev/mapper/system-test /export/test
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:~ # mkdir /export/test/bla /export/test/fasel
</span></span></span><span class="line"><span class="cl"><span class="go">dhcp-179:~ # chown kris:video /export/test/bla /export/test/fasel
</span></span></span><span class="line"><span class="cl"><span class="go">dhcp-179:~ # chmod g+s /export/test/fasel
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:~ # su - kris
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; cd /export/test
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kris@dhcp-179:/export/test&gt; touch bla/eins fasel/zwei
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:/export/test&gt; ls -l bla/eins fasel/zwei
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-r--r-- 1 kris users 0 2005-11-01 18:59 bla/eins
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-r--r-- 1 kris video 0 2005-11-01 18:59 fasel/zwei
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kris@dhcp-179:/export/test&gt; ls -ld bla fasel
</span></span></span><span class="line"><span class="cl"><span class="go">drwxr-xr-x 2 kris video 1024 2005-11-01 18:59 bla
</span></span></span><span class="line"><span class="cl"><span class="go">drwxr-sr-x 2 kris video 1024 2005-11-01 18:59 fasel
</span></span></span></code></pre></div><p>In diesem Beispiel wird das logical Volume <code>test</code> in der Volume
Group <code>system</code> angelegt und mit dem ext2-Dateisystem formatiert.
Das Dateisystem wird mit der Option <code>nogrpid</code> als /export/test
gemountet, was der Default für ext2 ist (und bei reiserfs
unveränderlich immer der Fall ist).</p>
<p>In <code>/export/test</code> werden die Verzeichnisse <code>bla</code> und <code>fasel</code> anlegt
und beide auf <code>kris:video</code> gesetzt. An <code>fasel</code> wird zusätzlich noch
das SGID-Bit gesetzt.</p>
<p>Legt der User <code>kris:users</code> nun in <code>bla</code> und <code>fasel</code> jeweils eine Datei
an, wird die Datei in <code>bla</code> (System V Semantik, bzw. nogrpid) der
Gruppe users angehören. Die Datei in <code>fasel</code> (BSD Semantik, durch
+s umgeschaltet) erbt ihre Gruppenzugehörigkeit jedoch vom
übergeordneten Verzeichnis, gehört also <code>kris:video</code>.</p>
<p>Dasselbe Beispiel wie oben für ein Dateisystem, das mit <code>grpid</code>
gemountet wurde, ergibt dann das folgende Bild:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">kris@dhcp-179:/export/test&gt; touch bla/eins fasel/zwei
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:/export/test&gt; ls -ld bla fasel
</span></span></span><span class="line"><span class="cl"><span class="go">drwxr-xr-x 2 kris video 1024 2005-11-01 19:04 bla
</span></span></span><span class="line"><span class="cl"><span class="go">drwxr-sr-x 2 kris video 1024 2005-11-01 19:04 fasel
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kris@dhcp-179:/export/test&gt; ls -l bla/eins fasel/zwei
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-r--r-- 1 kris video 0 2005-11-01 19:04 bla/eins
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-r--r-- 1 kris video 0 2005-11-01 19:04 fasel/zwei
</span></span></span></code></pre></div><p>Das SGID-Bit am Verzeichnis hat dann also keine Wirkung mehr,
weil das Dateisystem an sich hier schon BSD-Semantik hat.</p>
<p>Reiserfs kennt die Optionen <code>grpid</code> und <code>nogrpid</code> nicht und
verhält sich immer wie ein ext2-Dateissystem mit <code>nogrpid</code>.</p>
<p>Wie kann man nun ein Verzeichnis einer Gruppe schenken? Nun, das
geht einfach mit chgrp:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; mkdir keks
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; chgrp video keks
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kris@dhcp-179:~&gt; chgrp disk keks
</span></span></span><span class="line"><span class="cl"><span class="go">chgrp: Ändern der Gruppe für „keks“: Die Operation ist nicht erlaubt
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kris@dhcp-179:~&gt; chgrp users keks
</span></span></span></code></pre></div><p>Offenbar kann man ein Verzeichnis nur Gruppen schenken, denen
man selbst angehört. Das ist deswegen so, weil Unix die
Zuordnung von Quotas zu Benutzern und zu Gruppen erlaubt. Indem
man eine Datei einer Gruppe schenkt, belastet die Datei die
Quota der Gruppe und natürlich darf man nur die Quota einer
Gruppe belasten, der man auch angehört.</p>
<p>Wenn man eine Datei in einem Verzeichnis mit BSD-Semantik
anlegt, dann erbt diese Datei jedoch immer die Gruppe des
Verzeichnisses, selbst dann, wenn der Benutzer, der die Datei
anlegt, nicht dieser Gruppe angehört - hier kann dann ein
fremder Benutzer die Quota einer Gruppe belasten, der er nicht
angehört. Es ist also Aufgabe einer Gruppe, die Zugriffsrechte
an ihren Verzeichnissen so zu setzen, daß dort nicht fremde
Leute Daten ablegen können und so die Quota der Gruppe belasten.</p>
<p>Es ist außerdem möglich (wenn auch unwahrscheinlich), daß ein
Benutzer so eine Datei anlegen kann, die er später nicht mehr
lesen darf.</p>
<p>Das Szenario ist konstruiert, aber technisch möglich:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">#</span><span class="c1"># Kris legt ein Verzeichnis an</span>
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kris@dhcp-179:~&gt; mkdir keks
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; chmod a+rwx,g+s keks
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; chgrp video keks
</span></span></span><span class="line"><span class="cl"><span class="go">kris@dhcp-179:~&gt; ls -ld keks
</span></span></span><span class="line"><span class="cl"><span class="go">drwxrwsrwx 2 kris video 48 2005-11-01 19:17 keks
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span><span class="c1"># kdebuild legt dort eine Datei an</span>
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">kdebuild@dhcp-179:/home/kris/keks&gt; umask 0727
</span></span></span><span class="line"><span class="cl"><span class="go">kdebuild@dhcp-179:/home/kris/keks&gt; touch bla
</span></span></span><span class="line"><span class="cl"><span class="go">kdebuild@dhcp-179:/home/kris/keks&gt; ls -l bla
</span></span></span><span class="line"><span class="cl"><span class="go">----r----- 1 kdebuild video 0 2005-11-01 19:18 bla
</span></span></span><span class="line"><span class="cl"><span class="go">kdebuild@dhcp-179:/home/kris/keks&gt; cat bla
</span></span></span><span class="line"><span class="cl"><span class="go">cat: bla: Keine Berechtigung
</span></span></span></code></pre></div><p>Das ist für ein Rechtesystem eine unschöne Situation. Fällt
jemandem ein sinnvoller Anwendungszweck für diese Eigenschaft
des Unix-Rechtesystems ein?</p>
<p>Wir merken uns:</p>
<blockquote>
<p>Um ein Verzeichnis zu erzeugen, auf das nur eine bestimmte
Gruppe Zugriff hat, legen wir das Verzeichnis an und schenken
es der Gruppe mit <code>chgrp</code>, dann setzen wir die Zugriffsrechte
auf <code>rwxrwx---</code> oder ähnlich.</p>
<p>Wenn wir außerdem das SGID-Bit am Verzeichnis mit <code>chmod g+s …</code> setzen, werden auch alle Dateien im Verzeichnis der
Gruppe gehören. Um ein Verzeichnis einer Gruppe schenken zu
können, muß man selbst Mitglied der Gruppe sein.</p></blockquote>
<h2 id="zugriffsrechte-an-dateien">
    <a href="#zugriffsrechte-an-dateien">
	Zugriffsrechte an Dateien
    </a>
</h2>
<p>In den letzten 30 Jahren war es in Unix immer so, daß eine Datei
einen Eigentümer und eine Eigentümer-Gruppe hatte. Rechte wurden
für den Eigentümer und die Eigentümer-Gruppe vergeben. Prozesse
hatten ebenfalls einen Eigentümer und eine Gruppe, und Unix hat
stur den folgenden simplen Test durchgeführt, um zu bestimmen,
welche Rechte für eine Datei gelten:</p>
<ol>
<li>Stimmen der Datei-Eigentümer und der Prozeß-Eigentümer
überein? Wenn ja, dann gelten die User-Rechte, also das erste
rwx-Tripel. Das ist selbst dann der Fall, wenn in einem anderen
Tripel bessere Rechte definiert sind.</li>
<li>Stimmen die Datei-Eigentümergruppe und eine der primären oder
sekundären Gruppen eines Prozesses überein? Wenn ja, dann gelten
die Gruppen-Rechte, also das zweite rwx-Tripel. Das ist selbst
dann der Fall, wenn im 3. Tripel bessere Rechte definiert
sind.</li>
<li>In allen anderen Fällen gelten die Rechte aus dem 3. Tripel.</li>
</ol>
<h2 id="access-control-lists-acls">
    <a href="#access-control-lists-acls">
	Access Control Lists (ACLs)
    </a>
</h2>
<p>Mit modernen Unixen ist es jedoch alles viel komplizierter
geworden, denn nun können im Prinzip an einer Datei selber auch
viele Benutzer- und Gruppenrechte kleben.</p>
<p>Zum Glück nicht per Default.</p>
<p>Damit die Lage kompliziert wird, muß man das betreffende
Dateisystem mit der Option <code>acl</code> mounten. Im Beispiel erzeugen
wir zur Abwechslung mal ein reiserfs und mounten dies mit der
passenden Option. Mit den Kommandos <code>getfacl</code> und <code>setfacl</code> (&ldquo;get
and set a file access control list&rdquo;) können wir dann lustig
individuelle Zugriffsrechte vergeben.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">dhcp-179:~ # lvcreate -l 10 -n test system
</span></span></span><span class="line"><span class="cl"><span class="go">Logical volume &#34;test&#34; created
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:~ # mkreiserfs -q /dev/system/test
</span></span></span><span class="line"><span class="cl"><span class="go">mkreiserfs 3.6.18 (2003 www.namesys.com)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:~ # mount -o acl /dev/mapper/system-test /export/test
</span></span></span><span class="line"><span class="cl"><span class="go">dhcp-179:~ # cd /export/test
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:/export/test # touch keks
</span></span></span><span class="line"><span class="cl"><span class="go">dhcp-179:/export/test # chmod 000 keks
</span></span></span><span class="line"><span class="cl"><span class="go">dhcp-179:/export/test # setfacl -m u:kris:rwx,mask::rwx,g:video:rwx,u:kdebuild:rx keks
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:/export/test # ls -l keks
</span></span></span><span class="line"><span class="cl"><span class="go">----rwx---+ 1 root root 0 Nov 1 19:26 keks
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">dhcp-179:/export/test # getfacl keks
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">#</span> file: keks
</span></span><span class="line"><span class="cl"><span class="gp">#</span> owner: root
</span></span><span class="line"><span class="cl"><span class="gp">#</span> group: root
</span></span><span class="line"><span class="cl"><span class="go">user::---
</span></span></span><span class="line"><span class="cl"><span class="go">user:kris:rwx
</span></span></span><span class="line"><span class="cl"><span class="go">user:kdebuild:r-x
</span></span></span><span class="line"><span class="cl"><span class="go">group::---
</span></span></span><span class="line"><span class="cl"><span class="go">group:video:rwx
</span></span></span><span class="line"><span class="cl"><span class="go">mask::rwx
</span></span></span><span class="line"><span class="cl"><span class="go">other::---
</span></span></span></code></pre></div><p>Eine Datei mit einer ACL wird von ls mit einem &ldquo;+&quot;-Zeichen
markiert. Statt den Rechten der Gruppe werden dann im  zweiten
Tripel die Rechte der Mask angezeigt.</p>
<p>Die Mask limitiert alle anderen Zugriffsrechte an der Datei
ausgenommen den Eigentümer und Others. Sie legt also quasi die
maximalen Rechte fest, die irgendjemand außer dem Eigentümer an
der Datei haben kann, wenn er nicht die Defaultrechte bekommt.</p>
<p>Dies ist ein Kompatibilitätsmechanismus, der meistens das
korrekte Verhalten von Programmen bewirken soll, die nichts von
Zugriffsrechten wissen - sie bekommen durch Auslesen des zweiten
Rechtetripels einen etwas optimistischen View auf die Rechte,
die sie wahrscheinlich haben werden. :)</p>
<p>Das Kommando <code>setfacl</code> kann jetzt die Rechte an einer Datei
modifizieren. Die Option <code>-m</code> (modify) bewirkt das.</p>
<p>Im Beispiel werden Rechte für Benutzer (&ldquo;u:&rdquo;) und Gruppen (&ldquo;g:&rdquo;)
sowie eine Mask (&ldquo;m:&rdquo;) definiert.</p>
<p>Liest man die ACL mit getfacl aus, wird recht schnell deutlich,
was hier geschieht:</p>
<p>Der Eigentümer der Datei hat an ihr keine Rechte, der User kris
hat die Rechte rwx, der User kdebuild hat die Rechte rx, die
Defaultgruppe hat keine Rechte, die Gruppe video hat die Rechte
rwx, und die Maske schränkt die Rechte von kris, kdebuild, video
und der Defaultgruppe nicht ein.</p>
<p>Der Rest der Welt hat keine Rechte an dieser Datei.</p>
<p>Wir merken uns:</p>
<blockquote>
<p>Dateisysteme, die mit der Option &ldquo;acl&rdquo; gemounted wurden,
können beliebig komplizierte Rechteregeln pro Datei haben. Es
ist mit einem &ldquo;+&rdquo; an der Datei zu erkennen, ob dies der Fall
ist. Diese ACLs können mit setfacl editiert und mit getfacl
gelesen werden.</p></blockquote>
<h2 id="acls-an-verzeichnissen">
    <a href="#acls-an-verzeichnissen">
	ACLs an Verzeichnissen
    </a>
</h2>
<p>Um die Sache noch komplizierter zu machen, haben Verzeichnisse
<em>zwei</em> ACLs:</p>
<ul>
<li>Eine normale wie wir sie schon kennen, die für das Verzeichnis
selber gilt,</li>
<li>eine <em>default</em> ACL, die für alle Verzeichnisse
und Dateien gilt, die in dem Verzeichnis erzeugt werden.</li>
</ul>
<p>Werte für die Default-ACL werden festgelegt, indem man sie beim
&ldquo;setfacl&rdquo; mit &ldquo;d:&rdquo; prefixed, also &ldquo;d:u:kris:rwx&rdquo;,
&ldquo;d:g:video:rwx&rdquo; und &ldquo;d:m::rwx&rdquo;.</p>
<h2 id="tldr">
    <a href="#tldr">
	TL;DR
    </a>
</h2>
<p>Wir merken uns:</p>
<blockquote>
<p>In den allermeisten Fällen tut das Unix-Rechtesystem mit den
drei Tripeln &ldquo;ugo&rdquo; und den drei Rechten &ldquo;rwx&rdquo; genau das, was
man von ihm will.</p>
<p>Sehr selten braucht man was komplizierteres, und dann steht es
zur Verfügung.</p>
<p>Selbst dann ist das Rechtesystem von Unix noch einfacher und
übersichtlicher zu warten als das von Windows, getreu dem
Motto &ldquo;Simple things should be simple, and complex things
should be possible.&rdquo;</p></blockquote>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#computer" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				computer
				</a>
				
				<a href="/tags/#erklaerbaer" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				erklaerbaer
				</a>
				
				<a href="/tags/#unix" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				unix
				</a>
				
				<a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_de
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2005-11-01-user-und-gruppen-prozesse-und-dateien.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/10/28/in-with-the-out-old-with-the-new.html">In with the out, old with the new...</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/11/01/legal-illegal-scheissegal.html">Legal, Illegal, Scheißegal...</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
