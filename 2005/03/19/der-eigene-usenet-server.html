<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Der eigene USENET Server | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2005/03/19/der-eigene-usenet-server.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Der eigene USENET Server | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="de_DE" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2005/03/19/der-eigene-usenet-server.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2005-03-19T20:08:30Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Der eigene USENET Server' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="der-eigene-usenet-server-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Der eigene USENET Server
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>March 19, 2005</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/02/15/abschied-aus-dem-usenet.html">Abschied aus dem USENET</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/05/10/materialsammlung-mittlerfreie-kommunikation.html">Materialsammlung &#34;Mittlerfreie Kommunikation&#34;</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
				<header class="toc bg-light">
					<nav id="TableOfContents">
  <ul>
    <li><a href="#ressourcenplanung">Ressourcenplanung</a>
      <ul>
        <li><a href="#traffic">Traffic</a></li>
        <li><a href="#ram--und-festplattenbedarf">RAM- und Festplattenbedarf</a></li>
        <li><a href="#weitere-anforderungen">Weitere Anforderungen</a></li>
      </ul>
    </li>
    <li><a href="#installation">Installation</a></li>
    <li><a href="#inbetriebnahme">Inbetriebnahme</a>
      <ul>
        <li><a href="#artikelspeicher-bereit-stellen">Artikelspeicher bereit stellen</a></li>
        <li><a href="#grundkonfiguration-inn">Grundkonfiguration inn</a></li>
        <li><a href="#crontab-aufsetzen">Crontab aufsetzen</a></li>
        <li><a href="#server-hochfahren">Server hochfahren</a></li>
      </ul>
    </li>
    <li><a href="#gruppen-anlegen">Gruppen anlegen</a>
      <ul>
        <li><a href="#testgruppe-einrichten">Testgruppe einrichten</a></li>
        <li><a href="#andere-gruppen-einrichten">Andere Gruppen einrichten</a></li>
      </ul>
    </li>
    <li><a href="#zugangskontrolle-konfigurieren">Zugangskontrolle konfigurieren</a></li>
    <li><a href="#verbindungen-feeds-konfigurieren">Verbindungen (Feeds) konfigurieren</a></li>
  </ul>
</nav>
				</header>
				
			</div>
			<div class='col-lg-8'>
				<p>Der Wegfall von &ldquo;news.individual.net&rdquo; als kostenloser Server für USENET News mag den einen oder anderen Benutzer des Servers motiviert haben,
sich selber mit News zu versorgen.
Dieser Text soll dabei helfen,
etwa auf einem der üblichen Dedicated Server bei einem Hoster oder an einer anderen geeigneten Stelle im Netz einen eigenen INN als News-Server aufzusetzen,
und so zu konfigurieren, dass er ein nützlicher Teil der USENET-Infrastruktur in Deutschland ist,
und dass einige Benutzer dort News lesen können.</p>
<h1 id="ressourcenplanung">
    <a href="#ressourcenplanung">
	Ressourcenplanung
    </a>
</h1>
<h2 id="traffic">
    <a href="#traffic">
	Traffic
    </a>
</h2>
<p>Die Gruppen im deutschsprachigen Teil des USENET haben das Prefix <code>de.*</code>.
Lediglich im Teil <code>de.alt.dateien.*</code> dürfen Bild- und Programmdateien veröffentlicht werden,
und so kommt es, dass sich das Verkehrsaufkommen im Restteil <code>de.*,!de.alt.dateien.*</code> in recht engen Grenzen hält:
Pro Tag sind etwa 20 MB Traffic einzuplanen.
Internationale Gruppen können ein Verkehrsaufkommen zwischen 150 und 200 MB am Tag erzeugen.</p>
<p>Die Maschine, auf der inn-Server laufen soll, sollte eine feste IP-Nummer haben, die unterbrechungsfrei verfügbar ist.
Es sind Setups denkbar, in denen einer der beiden am Austausch beteiligten Partner eine wechselnde oder nur mit Unterbrechungen verfügbare Adresse hat,
aber diese sind nicht Gegenstand dieser Dokumentation.</p>
<h2 id="ram--und-festplattenbedarf">
    <a href="#ram--und-festplattenbedarf">
	RAM- und Festplattenbedarf
    </a>
</h2>
<p>Ein laufender <code>innd</code> auf einem Intel-basierenden Suse-Linux-System verbraucht 12 MB RAM für den <code>innd</code>, den eigentlichen Newsserver.
Außerdem werden noch ein <code>innfeed</code>-Prozess (2 MB RAM) zur Artikelweitergabe und einige Hilfsprozesse für statistische Zwecke
und zur Ausführung von Wartungsarbeiten gestartet.
Alles in allem werden 25-30 MB RAM verbraucht.</p>
<p>Die Speicherung der Artikel erfolgt am günstigsten in sogenannten &ldquo;CNFS Cyclebuffs&rdquo;.
Dabei handelt es sich um Ringpuffer-Dateien fester Größe, sodass der Speicherbedarf für Artikel auf der Festplatte konstant ist.
Die Installation des Autors hat jeweils ein halbes Gigabyte für <code>de.*,!de.alt.dateien.*</code> und für regionale deutschsprachige Hierarchien reserviert.
Drei Gigabyte sind für internationale Artikel aus den Big8-Hierarchien bereitgestellt.</p>
<p>INN muss für lesenden Zugriff auf die Artikel eine Overview-Datenbank pflegen.
Diese belegt etwa 10% des Speichers zusätzlich, der für Artikel belegt wird.</p>
<h2 id="weitere-anforderungen">
    <a href="#weitere-anforderungen">
	Weitere Anforderungen
    </a>
</h2>
<p>Der CPU-Aufwand und die IO-Last auf dem Server des Autors sind vernachlässigbar.
Dazu trägt die Verwendung von CNFS ganz erheblich bei.</p>
<p>NNTP und NNRP, die Protokolle zum Übertragen von News und zum Lesen von News, verwenden standardmäßig den Port 119/TCP.</p>
<p>Der Autor verwendet Suse Linux 9.1 als Grundlage für diese Installation.
Sie ist jedoch auf allen Linux-Distributionen grundsätzlich ähnlich.</p>
<h1 id="installation">
    <a href="#installation">
	Installation
    </a>
</h1>
<p>Suse Linux 9.1 liefert im Paket <code>inn</code> einen INN in der Version 2.4.1.
Dies ist relativ aktuell.
Nach der Installation befinden sich die Konfigurationsdateien in <code>/etc/news</code>,
die öffentlichen Programme in <code>/usr/bin</code>,
die nicht öffentlichen Programme in <code>/usr/lib/news/bin</code>,
einige wichtige Arbeitsdateien in <code>/var/lib/news</code>
und der Artikelspeicher wird in <code>/var/spool/news</code> angelegt.
INN wird nach <code>/var/log/news</code> loggen.</p>
<p>Andere Distributionen verwenden möglicherweise leicht unterschiedliche Speicherorte, die Anleitung ist dann passend abzuwandeln.</p>
<p>Alle Konfiguration am INN ist immer als User <code>news</code> durchzuführen und niemals als User <code>root</code>,
außer dies wird ausdrücklich gesagt.
Sobald durch Änderungen als <code>root</code> Konfigurations-, Log- oder andere Dateien einem anderen Benutzer als <code>news</code> gehören,
wird INN möglicherweise nicht mehr sauber funktionieren.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">news@h3118:-/bin&gt; cat /etc/SusE-release
</span></span></span><span class="line"><span class="cl"><span class="go">SusE Linux 9.1 (1586)
</span></span></span><span class="line"><span class="cl"><span class="go">VERSION = 9.1
</span></span></span><span class="line"><span class="cl"><span class="go">news@h3118:~/bin&gt; rpm -q inn
</span></span></span><span class="line"><span class="cl"><span class="go">inn-2.4.1-33
</span></span></span></code></pre></div><p>Man muss also als <code>root</code> das Kommando <code>su – news</code> eingeben,
um auf den Useraccount von <code>news</code> zu wechseln und auch das Environment des <code>news</code>-Users zu bekommen.
Man befindet sich dann auch gleich im Home-Verzeichnis des News-Users.
In SuSE Linux ist das <code>/etc/news</code>, wo sich auch die im Folgenden beschriebenen Konfigurationsdateien befinden.</p>
<h1 id="inbetriebnahme">
    <a href="#inbetriebnahme">
	Inbetriebnahme
    </a>
</h1>
<h2 id="artikelspeicher-bereit-stellen">
    <a href="#artikelspeicher-bereit-stellen">
	Artikelspeicher bereit stellen
    </a>
</h2>
<p>In unserer Beispielinstallation soll der INN mit einem Artikelspeicher in CNFS (&ldquo;Cyclic News File System&rdquo;) betrieben werden,
weil dies die ressourcensparendste und wartungsärmste Art der Artikelspeicherung ist.
Die CNFS-Puffer müssen konfiguriert und angelegt werden.</p>
<p>Versäumt man das, verwendet INN den in der Default-Konfiguration definierten Traditional Spool.
Dieser erzeugt jedoch mehr I/O-Last auf dem System und ist in der Größe variabel.
Dafür steht sein Inhalt Scripten leichter zu Verfügung:
Artikel werden als Dateien unterhalb von <code>/var/spool/news/articles/</code> in Verzeichnissen abgelegt,
die aus dem Namen der Newsgroup abgeleitet sind und müssen durch einen Aufräumjob (<code>expire</code>) von dort gelöscht werden.
Die Verwendung von Traditional Spool ist nicht empfohlen, insbesondere nicht für INN Neueinsteiger.</p>
<p>Die Puffer werden in der Datei <code>cycbuff.conf</code> definiert.
Eine Pufferdefinition besteht aus einer oder mehr Zeilen, von denen jede einen <code>cycbuff</code> definiert.
Diese Puffer müssen dann zu einem <code>metacycbuff</code> zusammengeklebt werden, damit sie durch den INN benutzbar werden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">news@h3118:-/peerdata&gt; cat ~/cycbuff.conf
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">#</span> 512MB Puffer fuer de.*
</span></span><span class="line"><span class="cl"><span class="go">cycbuff: DE1: /var/spool/news/cycbuffs/file_de.1:524288
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> Sechs <span class="m">512</span> MB Puffer fuer den Rest
</span></span><span class="line"><span class="cl"><span class="go">cycbuff: INTL1:/var/spool/news/cycbuffs/file_intl.1:524288
</span></span></span><span class="line"><span class="cl"><span class="go">cycbuff: INTL2:/var/spool/news/cycbuffs/file_intl.2:524288
</span></span></span><span class="line"><span class="cl"><span class="go">cycbuff: INTL3:/var/spool/news/cycbuffs/file_intl.3:524288 
</span></span></span><span class="line"><span class="cl"><span class="go">cycbuff: INTL4:/var/spool/news/cycbuffs/file_intl.4:524288
</span></span></span><span class="line"><span class="cl"><span class="go">cycbuff: INTL5:/var/spool/news/cycbuffs/file_intl.5:524288
</span></span></span><span class="line"><span class="cl"><span class="go">cycbuff: INTL6:/var/spool/news/cycbuffs/file_intl.6:524288
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> Puffer zusammenkleben zu Metapuffern
</span></span><span class="line"><span class="cl"><span class="go">metacycbuff: DE: DE1
</span></span></span><span class="line"><span class="cl"><span class="go">metacycbuff: INTL: INTL1, INTL2, INTL3, INTL4, INTL5, INTL6
</span></span></span></code></pre></div><p>Leider ist INN bei der Benennung der &ldquo;cycbuff&rdquo; und &ldquo;metacycbuff&rdquo; sehr eingeschränkt:
Namen müssen kurz sein und dürfen nur aus Zahlen und Buchstaben bestehen.</p>
<p>Im Beispiel wird ein &ldquo;cycbuff&rdquo; mit dem Namen &ldquo;DE1&rdquo; definiert, der 524288 KB (512 MB) groß sein soll.
Die Location im Dateisystem für diesen Puffer ist <code>/var/spool/news/cycbuffs/file_de.1</code>.
Dort muss diese Datei auch angelegt werden.
Dies erfolgt mit dem Kommando <code>dd</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/var/spool/news/cycbuffs/file_de.1 <span class="nv">bs</span><span class="o">=</span>1024k <span class="nv">count</span><span class="o">=</span><span class="m">512</span>
</span></span></code></pre></div><p>INN selber arbeitet immer nur mit &ldquo;metacycbuffs&rdquo;.
Ein &ldquo;metacycbuff&rdquo; faßt dabei einen oder mehrere einzelne &ldquo;cycbuff&rdquo; zu einer für den INN benutzbaren Einheit zusammen.
Der &ldquo;metacycbuff&rdquo; DE besteht dabei ausschließlich aus dem einzelnen cycbuff &ldquo;DE1&rdquo;.</p>
<p>Das Beispiel definiert außerdem noch sechs jeweils 512 MB umfassende cycbuffs INTL1 bis INTL6.
Auch diese müssen mit entsprechenden <code>dd</code>-Kommandos angelegt werden
und können dann alle zusammen zu einem &ldquo;metacycbuff&rdquo; INTL mit 3 GB Gesamtgröße zusammengefasst werden.</p>
<p>Damit INN weiß, welche Artikel in welchem Puffer abgelegt werden sollen,
müssen in der <code>storage.conf</code> entsprechende Einträge gemacht werden.</p>
<p>Die Zeile <code>newsgroups</code> legt dabei fest, welche Gruppen in welchem Puffer abgelegt werden.
Die Zeile <code>class</code> ist eine eindeutige Nummer für jeden Eintrag, damit man an anderer Stelle auf den Eintrag Bezug nehmen kann.</p>
<p>Die Zeile <code>options</code> legt für CNFS-Einträge fest, welcher <code>metacycbuff</code> Speicher für den entsprechenden Eintrag bereitstellen soll.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">news@h3118:-/peerdata&gt; cat ~/storage.conf
</span></span></span><span class="line"><span class="cl"><span class="go">method cnfs {
</span></span></span><span class="line"><span class="cl"><span class="go">    newsgroups: de.*
</span></span></span><span class="line"><span class="cl"><span class="go">    class: 3
</span></span></span><span class="line"><span class="cl"><span class="go">    options: DE
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span><span class="line"><span class="cl"><span class="go">method cnfs {
</span></span></span><span class="line"><span class="cl"><span class="go">    newsgroups: *
</span></span></span><span class="line"><span class="cl"><span class="go">    class: 2
</span></span></span><span class="line"><span class="cl"><span class="go">    options: INTL
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> Traditional Spool Klappert leer und wird dann gelöscht...
</span></span><span class="line"><span class="cl"><span class="go">method tradspool {
</span></span></span><span class="line"><span class="cl"><span class="go">    newsgroups: *
</span></span></span><span class="line"><span class="cl"><span class="go">    class: 1
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span></code></pre></div><p>Im Beispiel wandern Artikel für die Newsgroups <code>de.*</code> immer in den CNFS-Speicher <code>DE</code> mit der eindeutigen Nummer 3.
Alle anderen Artikel wandern in den CNFS-Speicher <code>INTL</code> mit der Nummer 2.</p>
<p>Der Eintrag 1 definiert einen Speicher im Format <code>tradspool</code>.
Er wird niemals verwendet, weil der Eintrag 2 vorher alle Artikel abfängt.
Der Eintrag 1 ist der (nicht empfohlene, aber rückwärts kompatible) Default-Eintrag in der <code>storage.conf</code> von INN.</p>
<p>Sobald INN erst einmal gestartet ist (siehe unten), werden die Puffer initialisiert.
Zu einem späteren Zeitpunkt kann man dann mit dem Kommando <code>cnfsstat -a</code> ansehen, wie ausgelastet die Puffer sind.</p>
<h2 id="grundkonfiguration-inn">
    <a href="#grundkonfiguration-inn">
	Grundkonfiguration inn
    </a>
</h2>
<p>Vor dem ersten Start des Servers ist die <code>/etc/news/inn.conf</code> anzupassen.
Zu ändern sind:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">-organization: &#34;A pooly-installed InterNetNews site&#34;
</span></span></span><span class="line"><span class="cl"><span class="go">+organization: &#34;Deine Organisations-Zeile
</span></span></span></code></pre></div><p>Definiert den Inhalt der Zeile <code>Organization</code>, die Bestandteil eines jeden Artikels ist.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">-#pathhost: localhost
</span></span></span><span class="line"><span class="cl"><span class="go">+pathhost: news.example.com
</span></span></span></code></pre></div><p>Definiert, was Deine Site in den Path-Header einträgt.
Dies ist ein sehr wichtiges Datum für das Peering mit anderen Sites.
Es sollte Dein Domainname sein, oder ein vom Domainnamen abgeleiteter Name wie <code>news.koehntopp.de</code> für <code>koehntopp.de</code>.</p>
<p>Mit Hilfe des <code>pathhost</code> erkennt ein entfernter Server,
ob ein bestimmter Artikel schon einmal Dein System passiert hat.
Wenn ja, wird Dir der Artikel kein zweites Mal angeboten.
Dies kann sehr viel Traffic einsparen, wenn man mehrere Feeds für eine Hierarchie hat.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">+complaints: abuse@example.com
</span></span></span><span class="line"><span class="cl"><span class="go">+fromhost: example.com
</span></span></span></code></pre></div><p>Definiert den Inhalt der Headerzeile <code>X-Complaints-To</code> und die Domain,
mit deren Hilfe Usernamen zu Mailadressen komplettiert werden, wenn dies notwendig ist.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">-docnfsstat: false
</span></span></span><span class="line"><span class="cl"><span class="go">+docnfsstat: true
</span></span></span></code></pre></div><p>Dieser Eintrag ist optional.
Wenn man jedoch später statistische Auswertungen auf dem System für den Betrieb plant,
sollten laufende Meßdaten für die Auslastung der CNFS-Puffer vorliegen.
Dazu muss dieser Eintrag aktiv geschaltet sein.</p>
<h2 id="crontab-aufsetzen">
    <a href="#crontab-aufsetzen">
	Crontab aufsetzen
    </a>
</h2>
<p>INN muss in regelmäßigen Abständen einige Wartungsaufgaben erledigen.
Daher sollte für den User <code>news</code> eine Crontab wie die folgende definiert sein:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">news@h3118:~&gt; cat crontab.current
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">#</span> to expire old news-articles
</span></span><span class="line"><span class="cl"><span class="go">15 4 * * * /usr/lib/news/bin/news.daily expireover delayrm lowmark
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> dump path databases
</span></span><span class="line"><span class="cl"><span class="gp">#</span><span class="m">0</span> <span class="m">0</span> * * * /usr/lib/news/bin/ctlinnd flush <span class="err">&#39;</span>inpaths! &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="gp">#</span> <span class="m">5</span> <span class="m">0</span> 1,15 * * /us/lib/news/bin/sendinaths
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> inews stores news-articles in /var/spool/news/in.coming, <span class="k">if</span> INN ist
</span></span><span class="line"><span class="cl"><span class="gp">#</span> not running. the next <span class="s2">&#34;rnews -U&#34;</span> will feed those news-articles into
</span></span><span class="line"><span class="cl"><span class="gp">#</span> inn.
</span></span><span class="line"><span class="cl"><span class="go">10 * * * * /usr/bin/rnews-U
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">#</span><span class="m">33</span> * * * * /usr/lib/news/bin/scanlogs norotate 2&gt;/dev/null &gt;/dev/null
</span></span><span class="line"><span class="cl"><span class="go">news@h3118:~&gt; crontab crontab.current 
</span></span></span><span class="line"><span class="cl"><span class="go">news@h3113:~&gt;
</span></span></span></code></pre></div><p>Die Crontab enthält nur die für den Betrieb unmittelbar notwendigen Einträge in aktivierter Form.
Die auskommentierten Einträge sind für spätere Erweiterungen notwendig oder nützlich.</p>
<p>Der Eintrag <code>news.daily</code> führt die zum Betrieb von INN notwendigen Wartungsaufgaben durch.
Er muss einmal pro Tag ausgeführt werden.</p>
<p>Der Eintrag <code>rnews- U</code> kann einmal pro Stunde ausgeführt werden.
Er dient dazu, während Betriebspausen aufgelaufene Artikel nachträglich ins System einzuspeisen.</p>
<p>Die beiden Einträge &ldquo;inpaths!&rdquo; und &ldquo;sendinpaths&rdquo; sind nur notwendig,
wenn das System Statistikdaten in die &ldquo;Top 1000 der Newsserver&rdquo; einspielen will.
Damit das funktioniert sind jedoch noch weitere Konfigurationen notwendig (siehe unten).</p>
<p>Der Eintrag <code>scanlogs norotate</code> dient dazu,
stündlich den Statistikreport für das laufende System zu aktualisieren.
Damit das funktioniert sind jedoch noch weitere Konfigurationen notwendig (siehe unten).</p>
<h2 id="server-hochfahren">
    <a href="#server-hochfahren">
	Server hochfahren
    </a>
</h2>
<p>Mit der angegebenen Konfiguration sollte der INN durch den Systemadministrator startbar sein.</p>
<p>Das Kommando <code>chkconfig inn on</code> sorgt dafür, dass beim Systemstart automatisch auch der INN mit hochgefahren wird.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">Als User root:
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">#</span> chkconfig inn on
</span></span><span class="line"><span class="cl"><span class="gp">#</span> rcinn start
</span></span></code></pre></div><p>Das Kommando <code>rcinn start</code> fährt den Server manuell hoch.
Der Server sollte Startmeldungen in <code>/var/log/news/news.notice</code> hinterlassen
und in der Prozessliste sollte ein Prozess <code>innd</code> erkennbar sein,
der mit den Rechten des Users <code>news</code> ausgeführt wird.
Mit <code>lsof -i -n -P</code> sollte dieser Prozess auf Port 119 lauschen.
Von localhost aus kann man jetzt einen Testconnect gegen den NNTP-Port machen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">news@h3118:~&gt; telnet localhost 119
</span></span></span><span class="line"><span class="cl"><span class="go">Trying 127.0.0.1...
</span></span></span><span class="line"><span class="cl"><span class="go">Connected to localhost.
</span></span></span><span class="line"><span class="cl"><span class="go">Escape character is &#39;^]&#39;.
</span></span></span><span class="line"><span class="cl"><span class="go">200 koehntopp.de InterNetNews server INN 2.4.1 ready
</span></span></span><span class="line"><span class="cl"><span class="go"> mode reader
</span></span></span><span class="line"><span class="cl"><span class="go">200 koehntopp.de InterNetNews NNRP server INN 2.4.1 ready (posting ok).
</span></span></span><span class="line"><span class="cl"><span class="go">list
</span></span></span><span class="line"><span class="cl"><span class="go">215
</span></span></span><span class="line"><span class="cl"><span class="go">control 0000000000 0000000001 n 
</span></span></span><span class="line"><span class="cl"><span class="go">control.cancel 0000000000 0000000001 n
</span></span></span><span class="line"><span class="cl"><span class="go">contrel.checkgroups 0000000000 0000000001 n
</span></span></span><span class="line"><span class="cl"><span class="go">contrel.newgroup 0000000000 0000000001 n 
</span></span></span><span class="line"><span class="cl"><span class="go">control.rmgroup 0000000000 0000000001 n
</span></span></span><span class="line"><span class="cl"><span class="go">junk 0000000000 0000000001 n
</span></span></span><span class="line"><span class="cl"><span class="go">quit
</span></span></span><span class="line"><span class="cl"><span class="go">205
</span></span></span><span class="line"><span class="cl"><span class="go">Connection closed by foreign host.
</span></span></span></code></pre></div><p>Wenn das funktioniert, ist der Server erfolgreich grundkonfiguriert und hochgefahren.</p>
<h1 id="gruppen-anlegen">
    <a href="#gruppen-anlegen">
	Gruppen anlegen
    </a>
</h1>
<h2 id="testgruppe-einrichten">
    <a href="#testgruppe-einrichten">
	Testgruppe einrichten
    </a>
</h2>
<p>Der Server läuft nun und hat einige Standard-Newsgroups, die für die interne Verwaltung des Servers notwendig sind.
Um die weitere Funktion des Servers zu testen, ist es notwendig, mindestens eine lokale Testgruppe anzulegen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ctlinnd newgroup local.test y news@localhost
</span></span></code></pre></div><h2 id="andere-gruppen-einrichten">
    <a href="#andere-gruppen-einrichten">
	Andere Gruppen einrichten
    </a>
</h2>
<p>Die anderen benötigten Gruppen kann man leicht anlegen,
indem man sich eine Liste der Gruppen beim zukünftigen Upstream-Server abholt und sie in Kommandos zur Gruppeneinrichtung umwandelt.</p>
<p>Das Kommando <code>getlist</code> holt die Liste der aktiven Gruppen vom Server <code>news.koehntopp.de</code> ab
und legt sie in der Datei <code>active.news.koehntopp.de</code> ab.
Durch das <code>grep</code>-Kommando werden aus dieser Datei alle Gruppen der Hierarchie <code>de.*</code> extrahiert.
Für die Einrichtung der Gruppen sind nur das erste und vierte Feld einer jeden Zeile notwendig.
Mit dem <code>awk</code>-Kommando ziehen wir also diese Felder aus der Datei heraus und wandeln sie in <code>ctlinnd</code>-Kommandos um.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> getlist -h news.koehntopp.de &gt; active.news.koehntopp.de
</span></span><span class="line"><span class="cl"><span class="gp">$</span> grep <span class="s2">&#34;^de\.&#34;</span> active.news.koehntopp.de &gt; de-groups
</span></span><span class="line"><span class="cl"><span class="gp">$</span> awk <span class="s1">&#39;{ printf &#34;ctlinnd newgroup %s %s news@localhost\n&#34;, $1, $4 }&#39;</span> de-groups &gt; einrichten.sh 
</span></span><span class="line"><span class="cl"><span class="gp">$</span> ctlinnd throttle now
</span></span><span class="line"><span class="cl"><span class="gp">$</span> sh einrichten.sh
</span></span><span class="line"><span class="cl"><span class="gp">$</span> ctlinnd go now
</span></span></code></pre></div><p>Die Datei <code>einrichten.sh</code> enthält nun die benötigten Kommandos zur Gruppeneinrichtung.
Die Ausführung der Datei ist sehr viel schneller,
wenn man den Server vor der Ausführung der Kommandos in einen Standby-Modus schaltet und danach wieder in Produktivmodus versetzt.</p>
<h1 id="zugangskontrolle-konfigurieren">
    <a href="#zugangskontrolle-konfigurieren">
	Zugangskontrolle konfigurieren
    </a>
</h1>
<p>Mit den Default-Einstellungen kann man jetzt schon lokal (von localhost aus) gegen den Server connecten.
Um Connects von außen zu erlauben, ist es notwendig, einen Anmeldemechanismus und eine Passwortquelle zu konfigurieren.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">auth all {
</span></span></span><span class="line"><span class="cl"><span class="go">    auth: &#34;chkpasswd -f /etc/news/passwd.nnrp&#34;
</span></span></span><span class="line"><span class="cl"><span class="go">    default-domain: example.com
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">access full {
</span></span></span><span class="line"><span class="cl"><span class="go">    users: *
</span></span></span><span class="line"><span class="cl"><span class="go">    newsgroups: *
</span></span></span><span class="line"><span class="cl"><span class="go">    access: RPA
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span></code></pre></div><p>INN verwendet intern ein Programm namens <code>ckpasswd</code> für die Zugangskontrolle.
Dieses Programm kann entweder auf eine lokale Passwortdatei zugreifen,
in der INN-spezifische Passwörter konfiguriert werden,
oder man kann es mit Priviliegien austatten,
die ihm erlauben, auf die Systempasswortdatei zuzugreifen.
Letzteres ist nicht empfohlen, da NNTP ohne weitere Maßnahmen Passwörter im Klartext überträgt.</p>
<p>Welche Authentisierungsmechanismen in welcher Reihenfolge von INN verwendet werden,
wird in der readers.conf festgelegt.
Die folgenden Einträge legen fest, dass INN die Datei <code>/etc/news/passwd.nnrp</code> verwenden soll,
um Logins zu gestatten.
Die Datei hat dasselbe Format wie eine htpasswd-Datei von Apache und kann mit dem Apache-Programm htpasswd angelegt und verwaltet werden.</p>
<p>Der Abschnitt <code>auth</code> legt fest, mit welchem Kommando die Anmeldeinformationen geprüft werden sollen,
der Abschnitt access legt dann fest, welche Zugriffsrechte diese Benutzer erhalten sollen.</p>
<p>Wenn alles funktioniert, ist nun eine Anmeldung mit Benutzername und Passwort von entfernten Systemen möglich.</p>
<h1 id="verbindungen-feeds-konfigurieren">
    <a href="#verbindungen-feeds-konfigurieren">
	Verbindungen (Feeds) konfigurieren
    </a>
</h1>
<p>Ein Feed ist eine Verbindung zwischen zwei Newsservern,
über die gegenseitig Artikel in bestimmten Newsgroups austauschen.
Der Feed besteht aus einer eingehenden Verbindung, die in der <code>incoming.conf</code> konfiguriert wird
und einer ausgehenden Verbindung, die in der <code>innfeed.conf</code> definiert wird,
und für die in der <code>newsfeeds</code> festgelegt wird, welche Dateien gesendet werden sollen.</p>
<p>In der <code>incoming.conf</code> wird festgelegt, welche entfernten Server dem eigenen Server Daten senden dürfen
und welche Gruppen diese Server beschicken dürfen:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">peer koehntopp.de {
</span></span></span><span class="line"><span class="cl"><span class="go">    hostname: &#34;news.koehntopp.de&#34;
</span></span></span><span class="line"><span class="cl"><span class="go">    patterns: &#34;de.*,!de.alt.dateien.*&#34;
</span></span></span><span class="line"><span class="cl"><span class="go">    max-connections: 5
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span></code></pre></div><p>Ein solcher Eintrag gestattet dem entfernten Rechner <code>koehntopp.de</code> bis zu 5 parallele Verbindungen
zu dem eigenen Server aufzubauen, über die er Artikel ausschließlich in die genannten Gruppen einliefern darf.</p>
<p>Ausgehende Verbindungen werden in die <code>innfeed.conf</code> eingetragen.
Analog zur <code>incoming.conf</code> muss dort ein Link für eine ausgehende Verbindung konfiguriert werden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">peer koehntopp-all {
</span></span></span><span class="line"><span class="cl"><span class="go">    ip-name: news.koehntopp.de
</span></span></span><span class="line"><span class="cl"><span class="go">    max-connections: 5
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span></code></pre></div><p>Schließlich wird in der Datei <code>newsfeeds</code> festgelegt, welche Daten über die ausgehende Verbindung gesendet werden sollen.</p>
<pre tabindex="0"><code class="language-conole" data-lang="conole"># koehntopp.de Kristian Koehntopp &lt;kris@koehntopp.de&gt;
koehntopp-all/koehntopp.de\
    :!*,@*,de.*,!de.alt.dateien.*/!local\
    :Ap,Tm:innfeed!
</code></pre><p>Die Bestellung für den Channel <code>koehntopp-all</code> aus dem Beispiel liest sich
&ldquo;keine Artikel, die <code>koehntopp.de</code> im Path haben (<code>/koehntopp.de</code>).</p>
<p>Das Pattern legt fest, welche Newsgruppen über den Kanal gesendet werden sollen.
Es liest sich <code>!*</code> (&ldquo;nix, gar nix&rdquo;), <code>@*</code> (auch keine Crossposts, das ist doppelt gemoppelt),
<code>de.*,!de.alt.dateien.*</code> (alle de-Gruppen außer de.alt.dateien.*), jedoch keine Artikel mit der Distribution: <code>local</code>.</p>
<p>Die Flags und der Kanalname legen fest, dass die Daten über den Kanal <code>innfeed!</code> herausgesendet werden sollen.</p>
<p>Deswegen muss der vordefinierte <code>innfeed!</code>-Kanal in der Datei <code>newsfeeds</code> aktiviert werden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">innfeed!\
</span></span></span><span class="line"><span class="cl"><span class="go">    :!*\
</span></span></span><span class="line"><span class="cl"><span class="go">    :Tc,Wnm*:/usr/lib/news/bin/startinnfeed
</span></span></span></code></pre></div><p>Außerdem muss das System Steuernachrichten zur Einrichtung neuer Gruppen,
zum Löschen von Artikeln usw. verarbeiten können.
Dazu ist die Aktivierung des Controlchan notwendig.</p>
<p>Um die Änderungen wirksam werden zu lassen, muss dem INN-Server ein  &ldquo;reload&rdquo;-Kommando gesendet werden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">news@h3118:~&gt; lsof -i -n -P | grep koehntopp
</span></span></span><span class="line"><span class="cl"><span class="go">innd  28144 news   57u  IPv4 9342609
</span></span></span><span class="line"><span class="cl"><span class="go">      TCP example.com:199-&gt;koehntopp.de:2418 (ESTABLISHED)
</span></span></span><span class="line"><span class="cl"><span class="go">innd  32740 news   25u  IPv4 9342489
</span></span></span><span class="line"><span class="cl"><span class="go">      TCP example.com:42275-&gt;koehntopp.de:119 (ESTABLISHED)
</span></span></span></code></pre></div><p>Wenn alles funktioniert hat,
ist das Link jetzt sichtbar und kann mit <code>lsof</code>
oder <code>tail -f /var/log/news/news /var/log/news/news.notice</code> gesehen werden.</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#computer" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				computer
				</a>
				
				<a href="/tags/#usenet" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				usenet
				</a>
				
				<a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_de
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2005-03-19-der-eigene-usenet-server.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/02/15/abschied-aus-dem-usenet.html">Abschied aus dem USENET</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2005/05/10/materialsammlung-mittlerfreie-kommunikation.html">Materialsammlung &#34;Mittlerfreie Kommunikation&#34;</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
