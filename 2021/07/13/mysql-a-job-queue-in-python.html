<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>MySQL: A job queue in Python | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="canonical" href="https://blog.koehntopp.info">


<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">




<meta name="generator" content="Hugo 0.104.3" />
<meta property="og:title" content='MySQL: A job queue in Python' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />


<meta property="og:locale" content="en_US" />


<meta name="description" content='' />
<meta property="og:description" content='' />

<link rel="canonical" href="https://blog.koehntopp.info" />
<meta property="og:url" content="https://blog.koehntopp.info" />


<meta property="og:type" content="article" />
<meta name="article:published_time" content='2021-07-13T19:51:59Z' />



<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content='@isotopp' />
<meta name="twitter:creator" content='@isotopp' />
<meta property="twitter:title" content='MySQL: A job queue in Python' />
<meta property="twitter:description" content='' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />

<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebSite","description":null,"headline":"MySQL: A job queue in Python","image":"/assets/img/background/mysql.jpg","name":"Die wunderbare Welt von Isotopp","url":"https://blog.koehntopp.info"}
</script>

    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.731532d47a51fed497cc74301e50720b3c56d09404efc36b4fa1a4117a6aa10e.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            




<div class="page">
  <article class="mysql-a-job-queue-in-python-page">
    <div class='row  justify-content-center text-center my-4 mx-0'>
      <header>
        <div class='col'>
          <h1 class="title mb-lg-4 text-white">
            MySQL: A job queue in Python
          </h1>
          <div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
            <img alt='isotopp image' src='/assets/img/isotopp.jpg' class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
            <a href="https://twitter.com/isotopp" class='text-light text-decoration-none'>
                Kristian KÃ¶hntopp
            </a>

            
              <span class='d-none d-lg-inline'>-</span>
              <div class='d-block d-lg-inline'>July 13, 2021</div>
            

          </div>
        </div>
        
          <img alt='a featured image' src="/assets/img/background/mysql.jpg">
        
      </header>
    </div>

    <div class='row justify-content-center mx-0 mt-5 mb-5'>
      <div class='col-lg-8'>
        <p>Somebody needed a job queue in Python:
Multiple writers insert into it in random order, and the jobs are written into the MySQL table <code>jobs</code>.
From the <code>jobs</code> table, multiple consumers claim jobs in batches of <code>n</code> or smaller (n=100), and process them.
After processing, the consumers delete the jobs. We need concurrent job generation and consumption, with proper and efficient locking.</p>
<p>The full source for this example can be seen in <a href="https://github.com/isotopp/mysql-dev-examples" target="_blank" rel="noopener">mysql-dev-examples</a>

 in <a href="https://github.com/isotopp/mysql-dev-examples/blob/master/mysql-claim-jobs/mysql-claim-jobs.py" target="_blank" rel="noopener">mysql-claim-jobs.py</a>

.</p>
<h2 id="base-program">
    <a href="#base-program">
	Base Program
    </a>
</h2>
<p>Using our usual includes and setup,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">exit</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">click</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">MySQLdb</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">MySQLdb.cursors</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">db_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span><span class="o">=</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span><span class="o">=</span><span class="s2">&#34;kris&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">passwd</span><span class="o">=</span><span class="s2">&#34;geheim&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span><span class="o">=</span><span class="s2">&#34;kris&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursorclass</span><span class="o">=</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h2 id="table-jobs-and-setup">
    <a href="#table-jobs-and-setup">
	Table <code>jobs</code> and setup
    </a>
</h2>
<p>we create a MySQL table <code>jobs</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Generate and consume jobs concurrently&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sql</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Recreate jobs table&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">setup_tables</span><span class="p">():</span>
</span></span><span class="line"><span class="cl"><span class="n">sql_setup</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;drop table if exists jobs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;create table jobs (
</span></span></span><span class="line"><span class="cl"><span class="s2">        id integer not null primary key auto_increment,
</span></span></span><span class="line"><span class="cl"><span class="s2">        d varchar(64) not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">        e varchar(64) not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">        status enum(&#34;unclaimed&#34;, &#34;claimed&#34;, &#34;done&#34;) not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">        owner_id integer null,
</span></span></span><span class="line"><span class="cl"><span class="s2">        owner_date datetime null,
</span></span></span><span class="line"><span class="cl"><span class="s2">        index(d),
</span></span></span><span class="line"><span class="cl"><span class="s2">        index(status)
</span></span></span><span class="line"><span class="cl"><span class="s2">        )&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;commit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">db_config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">sql_setup</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;setup_tables: failed </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sql</span><span class="p">()</span>
</span></span></code></pre></div><p>In our table, the fields <code>d</code> and <code>e</code> represent the job payload.
We will later select jobs for processing based on the contents of the <code>d</code> field, so we create an index on that.</p>
<p>Each job has a <code>status</code> (<code>unclaimed</code> or <code>claimed</code>, and for debugging <code>done</code> instead of being deleted), an owner and an access date which we update when we change the claim status of the job.
As we access jobs by status, we also index on <code>status</code>.</p>
<h2 id="multiprocessing">
    <a href="#multiprocessing">
	Multiprocessing
    </a>
</h2>
<p>We generate a set of two generators that concurrently insert jobs into the <code>jobs</code> table, and a set of ten consumers that take jobs out of the <code>jobs</code> table.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Run job creation and consumer jobs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_processing</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">proc_generator</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">        <span class="n">proc_generator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">proc_consumer</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">        <span class="n">proc_consumer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span></code></pre></div><p>From <code>multiprocessing</code>, we are using <code>Process</code> to handle this.
Each of these processes is getting an identification number as a parameter using the <code>args=</code> named parameter to the constructor.
We will later use this in the <code>consumer()</code> to track the owner of a claimed job.</p>
<h2 id="the-generators">
    <a href="#the-generators">
	The Generators
    </a>
</h2>
<p>Our generator takes the <code>generator_id</code> as a parameter, but makes no use of it.</p>
<p>We generate random <code>d</code> and <code>e</code> fields, and use auto-incremented numbers to identify the individual jobs.
The new job has the status of <code>unclaimed</code> and the <code>owner_id</code> and <code>owner_date</code> are <code>NULL</code>.
For speed, we commit to the jobs table only every tenth job.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generator</span><span class="p">(</span><span class="n">generator_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;insert into jobs (id,d,e,status,owner_id,owner_date) values (NULL,</span><span class="si">%(d)s</span><span class="s2">,</span><span class="si">%(e)s</span><span class="s2">,&#39;unclaimed&#39;,NULL,NULL)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">db_config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;d&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">97</span> <span class="o">+</span> <span class="mi">25</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)]),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;e&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">97</span> <span class="o">+</span> <span class="mi">25</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)]),</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">counter</span> <span class="o">%</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="the-consumers">
    <a href="#the-consumers">
	The Consumers
    </a>
</h2>
<p>Our consumers need to claim unclaimed jobs that fulfill a condition from the <code>jobs</code> table.
For simplicity, we claim rows that start with a random character, for example &lsquo;a%&rsquo;.</p>
<h3 id="naive-approach-using-update">
    <a href="#naive-approach-using-update">
	Naive approach using <code>UPDATE</code>
    </a>
</h3>
<p>In SQL, this could be</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">UPDATE</span><span class="w"> </span><span class="n">jobs</span><span class="w"> </span><span class="k">SET</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;claimed&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">owner_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">owner_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;unclaimed&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">d</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;a%&#39;</span><span class="w">
</span></span></span></code></pre></div><p>But if we did it like this, we would run into two problems:</p>
<ul>
<li>We do not get the claimed records for processing.
We would need to select them after claiming them (<code>SELECT id, d, e FROM jobs WHERE status = 'claimed' AND owner_id = ?</code>).</li>
<li>The <code>UPDATE</code> statement produces X-locks, and these persist until we commit.
Other processes trying to claim jobs run the risk of running into our X-locks while scanning the table.
These processes would hang.</li>
</ul>
<p>We need another approach to handle this to make it efficient.</p>
<h3 id="smart-approach-using-select--for-update-skip-locked">
    <a href="#smart-approach-using-select--for-update-skip-locked">
	Smart approach using <code>SELECT ... FOR UPDATE SKIP LOCKED</code>
    </a>
</h3>
<p>Starting with MySQL 8, we get the option <code>SKIP LOCKED</code> when running select.
This is documented in <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locking-reads.html" target="_blank" rel="noopener">the manual</a>

 as follows:</p>
<blockquote>
<p>A locking read that uses SKIP LOCKED never waits to acquire a row lock.
The query executes immediately, removing locked rows from the result set.</p>
</blockquote>
<p>Using <code>FOR UPDATE</code> we could read the rows we want and mark them for a later <code>UPDATE</code> with X-locks.
At the same time we ignore the records already marked for later updates by other processes without stopping.</p>
<p>This is precisely what we need.
In order to mark only the rows we are intending to claim as locked, we need to access the rows in our <code>SELECT .. .FOR UPDATE SKIP LOCKED</code> statement by primary key.
That is, our statement needs to have the form <code>SELECT ... FROM jobs WHERE id IN ( 1, 2, 3 ) FOR UPDATE SKIP LOCKED</code>.
We need another <code>SELECT</code> statement before the locking <code>SELECT</code> in order to translate our condition into a set of primary keys.</p>
<p>So this is the plan:</p>
<ol>
<li>Run a query to find a set of candidate primary keys (100 or fewer).
This query can run outside our transaction and could use a replica to find a set of candidate primary keys.</li>
<li>Start a transaction.
This happens all the time and automatically in Python.
<ul>
<li>In our transaction, run the <code>SELECT ... FROM josb WHERE id IN (...) FOR UPDATE SKIP LOCKED</code> as discussed.</li>
<li>Using the result of the previous <code>SELECT</code> statement, run the <code>UPDATE</code> to claim the jobs.</li>
<li>Run <code>COMMIT</code> to drop the X-locks, and make the change visible to other processes.</li>
</ul>
</li>
</ol>
<p>Note that the set of candidate primary keys can be up to 100 ids in size, but can also be empty:
We are searching for unclaimed jobs that start with a randomly selected letter, and it may be there are none.</p>
<p>Note that the set of claimed primary keys can be identical to the candidate primary key set, or smaller.
It may be empty, even if the candidate set was not:
In this case all candidates have been snatched up by other consumers before we could.
We may want to count and log that, in order to detect if our concurrency in consumers is too high.</p>
<h4 id="finding-candidates">
    <a href="#finding-candidates">
	Finding candidates
    </a>
</h4>
<p>In code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">find_candidates</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">wanted</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">candidate_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;select id from jobs where d like %(search_string)s and status = %(wanted)s limit 100&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">search_string</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">97</span> <span class="o">+</span> <span class="mi">25</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">candidate_cmd</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;search_string&#34;</span><span class="p">:</span> <span class="n">search_string</span><span class="p">,</span> <span class="s2">&#34;wanted&#34;</span><span class="p">:</span> <span class="n">wanted</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;find_candidates: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">candidate_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidate_ids</span><span class="p">]</span>
</span></span></code></pre></div><p>We are using some arbitrary SQL condition to find records.
In our example, we are using <code>WHERE d LIKE 'a%' AND status = 'unclaimed'</code>, for variable initial letters and for variable status values.
We are only interested into the primary keys, so we return only these, in a <code>list</code>.</p>
<h4 id="consuming-jobs">
    <a href="#consuming-jobs">
	Consuming jobs
    </a>
</h4>
<p>The actual <code>consumer()</code> then looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">db_config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># find potential records to process with the status &#39;unclaimed&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">candidates</span> <span class="o">=</span> <span class="n">find_candidates</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&#34;unclaimed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># we did not find any</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># this is important, it will drop the persistent read view.</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># not doing this means we will never see newly inserted records from the generator</span>
</span></span><span class="line"><span class="cl">            <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># with the list of candidate ids, we select them for update, skipping locked records</span>
</span></span><span class="line"><span class="cl">        <span class="n">lock_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;select id, d, e from jobs where status = &#39;unclaimed&#39; and id in %(candidates)s for update skip locked&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">lock_cmd</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;candidates&#34;</span><span class="p">:</span> <span class="n">candidates</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">claimed_records</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>  <span class="c1"># these are the records we want to claim for processing</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># make us a list of ids of the claimed records</span>
</span></span><span class="line"><span class="cl">        <span class="n">claimed_ids</span> <span class="o">=</span> <span class="p">[</span> <span class="n">r</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">claimed_records</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">claimed_ids_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">claimed_ids</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">claimed_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># we claim the records, updating their status and owner</span>
</span></span><span class="line"><span class="cl">        <span class="n">claim_cmd</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;update jobs 
</span></span></span><span class="line"><span class="cl"><span class="s2">           set status = &#39;claimed&#39;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">           owner_date = now(), 
</span></span></span><span class="line"><span class="cl"><span class="s2">           owner_id = </span><span class="si">%(consumer_id)s</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        where id in </span><span class="si">%(claimed_ids)s</span><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">claim_cmd</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;claimed_ids&#34;</span><span class="p">:</span> <span class="n">claimed_ids</span><span class="p">,</span> <span class="s2">&#34;consumer_id&#34;</span><span class="p">:</span> <span class="n">consumer_id</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># doit(claimed_records) -- process the records, that takes some time</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;consumer </span><span class="si">{</span><span class="n">consumer_id</span><span class="si">:</span><span class="s2"> </span><span class="si">}</span><span class="s2"> #records = </span><span class="si">{</span><span class="n">claimed_ids_count</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">claimed_ids</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># after processing we delete them</span>
</span></span><span class="line"><span class="cl">        <span class="n">done_cmd</span> <span class="o">=</span> <span class="s2">&#34;delete from jobs where id in </span><span class="si">%(claimed_ids)s</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">done_cmd</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;claimed_ids&#34;</span><span class="p">:</span> <span class="n">claimed_ids</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span></code></pre></div><p>That is, we call <code>find_candidates()</code> to generate a list of candidate ids.
If we did not find any, we run a <code>db.commit()</code> before we <code>continue</code>.
This is rather important: We are in a transaction here, and in <code>REPEATABLE READ</code> isolation that means we get a consistent read view.
If we simply tried again, using only <code>continue</code>, we would stay in the same transaction and would never see the <code>jobs</code> table update.</p>
<p>Using the set of candidate ids, we then run the locking <code>SELECT</code> as discussed above.
This does two things:</p>
<ul>
<li>it returns the data, which we pick up using <code>claimed_records = c.fetchall()</code></li>
<li>it also X-locks the rows for claiming them permanently</li>
</ul>
<p>We generate a list of <code>claimed_ids</code> from the <code>claimed_records</code>, and check that this list is non-empty.
If it was empty, we did have a list of candidate ids, but none of them came through.
That means another concurrent process snatched the candidates from us - all of them.
We should be recording this, but are not in this example program.</p>
<p>We then run the actual <code>UPDATE</code> that marks the jobs as claimed, and updates the owner and the datetime of taking possession.
We need to <code>db.commit()</code> here to write this status change to disk.
This will now also be visible to other processes.</p>
<p>We can now proceed to actually process these records at our leisure.
This may take time, which we simulate with a tiny wait.</p>
<p>After processing has finished, we delete the jobs from the <code>jobs</code> table, and commit again to make the deletion visible.</p>
<h2 id="run-log">
    <a href="#run-log">
	Run log
    </a>
</h2>
<p>Here is a short test run protocol:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">(venv) mysql-dev-examples/mysql-claim-jobs$ ./mysql-claim-jobs.py --help
</span></span></span><span class="line"><span class="cl"><span class="go">Usage: mysql-claim-jobs.py [OPTIONS] COMMAND [ARGS]...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Generate and consume jobs concurrently
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Options:
</span></span></span><span class="line"><span class="cl"><span class="go">--help  Show this message and exit.
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Commands:
</span></span></span><span class="line"><span class="cl"><span class="go">setup-tables      Recreate jobs table
</span></span></span><span class="line"><span class="cl"><span class="go">start-processing  Run job creation and consumer jobs
</span></span></span><span class="line"><span class="cl"><span class="go">(venv) mysql-dev-examples/mysql-claim-jobs$ ./mysql-claim-jobs.py setup-tables
</span></span></span><span class="line"><span class="cl"><span class="go">(venv) mysql-dev-examples/mysql-claim-jobs$ ./mysql-claim-jobs.py start-processing
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  4 #records = 1 - [1]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  3 #records = 1 - [5]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  8 #records = 1 - [17]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  6 #records = 1 - [13]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  7 #records = 1 - [15]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  10 #records = 1 - [11]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  2 #records = 1 - [12]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  1 #records = 1 - [9]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  9 #records = 1 - [3]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  5 #records = 1 - [7]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  7 #records = 4 - [36, 59, 62, 109]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  9 #records = 5 - [44, 85, 113, 119, 127]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  8 #records = 3 - [72, 79, 126]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  5 #records = 5 - [45, 63, 80, 94, 95]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  10 #records = 1 - [51]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  3 #records = 7 - [2, 14, 22, 53, 68, 120, 140]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  1 #records = 4 - [23, 97, 115, 122]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  2 #records = 6 - [4, 47, 65, 99, 103, 105]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  6 #records = 6 - [26, 32, 43, 77, 83, 86]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  4 #records = 3 - [48, 84, 130]
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  9 #records = 1 - [12413]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  3 #records = 2 - [12407, 12445]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  7 #records = 2 - [12450, 12459]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  5 #records = 2 - [12446, 12470]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  1 #records = 3 - [12397, 12426, 12441]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  8 #records = 1 - [12458]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  2 #records = 15 - [12282, 12313, 12327, 12350, 12365, 12369, 12385, 12399, 12401,\
</span></span></span><span class="line"><span class="cl"><span class="go">  12425, 12435, 12443, 12452, 12453, 12462]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  4 #records = 3 - [12421, 12440, 12466]
</span></span></span><span class="line"><span class="cl"><span class="go">^S
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  1 #records = 1 - [12515]
</span></span></span><span class="line"><span class="cl"><span class="go">counter = 6000                                                                                      
</span></span></span><span class="line"><span class="cl"><span class="go">counter = 6000                                                                                      
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  5 #records = 30 - [12525, 12532, 12575, 12592, 12673, 12676, 12680, 12714, 12719, 
</span></span></span><span class="line"><span class="cl"><span class="go">  12732, 12771, 12804, 12882, 12961, 12977, 13010, 13024, 13060, 13068, 13156, 13204, 13214, 
</span></span></span><span class="line"><span class="cl"><span class="go">  13249, 13279, 13280, 13284, 13299, 13307, 13358, 13396]
</span></span></span><span class="line"><span class="cl"><span class="go">consumer  10 #records = 31 - [12516, 12531, 12537, 12541, 12623, 12630, 12638, 12742, 12777,
</span></span></span><span class="line"><span class="cl"><span class="go">  12791, 12792, 12800, 12810, 12819, 12821, 12981, 12990, 13117, 13119, 13131, 13138, 13161, 
</span></span></span><span class="line"><span class="cl"><span class="go">  13180, 13192, 13202, 13259, 13283, 13352, 13367, 13383, 13414]          
</span></span></span></code></pre></div><p>We can see how each consumer grabs a variable number of jobs for processing, sometimes single jobs, sometimes many more.
If we let the thing run for some time, we see that the ids increment.
When we stop the output with Ctrl-S, we also block the consumers.
On resume, very many jobs are lingering in the queue, and initially the consumers claim a large list of ids on each grab.
This quickly goes back to normal levels after the number of jobs in the queue goes down to normal levels, too.</p>
<p>We can check queue length and status in the database:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">kris</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="p">[</span><span class="n">kris</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">jobs</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+---------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">status</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+---------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">unclaimed</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">47</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">claimed</span><span class="w">   </span><span class="o">|</span><span class="w">            </span><span class="mi">23</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+---------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h2 id="summary">
    <a href="#summary">
	Summary
    </a>
</h2>
<p>We created a job queue in the database, using a concurrent Python program.
To select jobs efficiently, we reduce an arbitrary query to a set of candidate primary keys.
We then use a <code>SELECT ... FROM jobs WHERE id IN ( ... ) FOR UPDATE SKIP LOCKED</code> to create a set of X-locks on the candidate records using <code>FOR UPDATE</code>.
At the same time, we avoid waiting on other threads&rsquo; X-locks using the <code>SKIP LOCKED</code> functionality new in MySQL 8.
We then use the data fetched by the <code>SELECT FOR UPDATE</code> to commit permanent ownership for these records, and also use this data for processing.
After processing we clean up by deleting the jobs from the table.</p>
<p>The approach can be scaled further by partitioning the <code>jobs</code> table, if needed.</p>

      </div>
    </div>

    
    
    <div class='row justify-content-center mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Share</span>
        <a href='https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.koehntopp.info%2f2021%2f07%2f13%2fmysql-a-job-queue-in-python.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#facebook'/></svg>
        </a>
        <a href='https://twitter.com/intent/tweet?source=https%3a%2f%2fblog.koehntopp.info%2f2021%2f07%2f13%2fmysql-a-job-queue-in-python.html&text=MySQL%3a%20A%20job%20queue%20in%20Python%20%7C%20Die+wunderbare+Welt+von+Isotopp:%20https%3a%2f%2fblog.koehntopp.info%2f2021%2f07%2f13%2fmysql-a-job-queue-in-python.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#twitter'/></svg>
        </a>
        <a href='http://www.reddit.com/submit?url=https%3a%2f%2fblog.koehntopp.info%2f2021%2f07%2f13%2fmysql-a-job-queue-in-python.html&title=MySQL%3a%20A%20job%20queue%20in%20Python' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>
        <a href='mailto:?subject=MySQL%3a%20A%20job%20queue%20in%20Python&body=https%3a%2f%2fblog.koehntopp.info%2f2021%2f07%2f13%2fmysql-a-job-queue-in-python.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope-fill'/></svg>
        </a>
      </div>
    </div>

    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
        
          <a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            lang_en
          </a>
        
          <a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            mysql
          </a>
        
          <a href="/tags/#mysqldev" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            mysqldev
          </a>
        
      </div>
    </div>

    <div class='row justify-content-center mb-5 pt-5 border-top mx-0'>
      <div class='col-lg-4 text-center text-lg-start'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Next Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2021/07/23/fertig-gelesen-outland.html">Fertig gelesen: Outland</a>
          </div>
        
      </div>

      <div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Previous Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2021/06/05/fertig-gelesen-montecrypto.html">Fertig gelesen: Montecrypto</a>
          </div>
        
      </div>
    </div>

    
    </article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff. 
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#rss-fill'/></svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope'/></svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#github'/></svg>
        </a>

        <a href='https://www.reddit.com/user/isotopp' title='Follow on Reddit' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>

        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#steam'/></svg>
        </a>

        <a href='https://twitter.com/isotopp' title='Follow on Twitter' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#twitter'/></svg>
        </a>

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#youtube'/></svg>
        </a>

      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
