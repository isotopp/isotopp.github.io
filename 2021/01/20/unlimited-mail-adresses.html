<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Unlimited Mail Addresses | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2021/01/20/unlimited-mail-adresses.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Unlimited Mail Addresses | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2021/01/20/unlimited-mail-adresses.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2021-01-20T08:02:20Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Unlimited Mail Addresses' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="unlimited-mail-addresses-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Unlimited Mail Addresses
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>January 20, 2021</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/01/12/600000-user-in-baden-wurttemberg.html">940.000 User in Baden-Württemberg</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/01/28/database-as-a-queue.html">Database as a Queue</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>When people ask for my mail address, they usually get a personalized address from me. That is particularly true for all commercial email. So you don&rsquo;t get to send mail to my main account, but to <a href="mailto:kris-yourbusiness@koehntopp.de">kris-yourbusiness@koehntopp.de</a>

, and that will end up going into <code>INBOX.special.yourbusiness</code>. At least until it leaks, receives spam or is otherwise burned. In which case I will short it out and route all incoming mail on that address to <code>/dev/null</code>. Here is how it is done.</p>
<h2 id="mailer-setup">
    <a href="#mailer-setup">
	Mailer setup
    </a>
</h2>
<p>I run <code>exim</code> and in my <code>exim.conf</code> I have</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">kris_virtuserfile:
</span></span></span><span class="line"><span class="cl"><span class="go">  driver = redirect
</span></span></span><span class="line"><span class="cl"><span class="go">  domains = +kris_domains
</span></span></span><span class="line"><span class="cl"><span class="go">  local_part_suffix = +* : -*
</span></span></span><span class="line"><span class="cl"><span class="go">  local_part_suffix_optional
</span></span></span><span class="line"><span class="cl"><span class="go">  headers_remove = X-local-part-suffix
</span></span></span><span class="line"><span class="cl"><span class="go">  headers_add = X-local-part-suffix: ${original_local_part}
</span></span></span><span class="line"><span class="cl"><span class="go">  owners = kris
</span></span></span><span class="line"><span class="cl"><span class="go">  allow_fail
</span></span></span><span class="line"><span class="cl"><span class="go">  allow_defer
</span></span></span><span class="line"><span class="cl"><span class="go">  data= ${lookup{$local_part@$domain}dbm*@{/home/kris/Exim/virtusertable.dbm}}
</span></span></span></code></pre></div><p>The important part here is the <code>local_part_suffix = +* : -*</code>. This enables amending the local part of a mail address with an extension. So if <code>kris</code> is a valid local user for delivery, <code>kris-yourbusiness</code> and <code>kris+yourbusiness</code> become valid addresses, too, and will be delivered to the local user <code>kris</code>.</p>
<p>I define <code>local_part_suffix_optional</code>, because unfortunately for legacy reasons the actual local user must remain reachable for legacy reasons.</p>
<p>I also define <code>header_remove = X-local-part-suffix</code> to remove this particular X-header from all incoming mail, and then add it back with <code>X-local-part-suffix: ${original_local_part}</code>. This will prevent external mail with a hand-crafted fake <code>X-local-part-suffix</code> header from coming through, and then preserve the original local part for sorting, in exactly this X-header line.</p>
<p>From this config we get the following behavior: <code>kris-yourbusiness@koehntopp.de</code> is being delivered to the local user <code>kris</code>, and with an <code>X-local-part-suffix: kris-yourbusiness</code> header line added to the mail. Note that we get <code>kris-yourbusiness</code>, and not <code>yourbusiness</code> in this header line.</p>
<h2 id="local-delivery">
    <a href="#local-delivery">
	Local delivery
    </a>
</h2>
<p>Local delivery is controlled by the local user, <code>kris</code>. Kris happens to have defined a <code>.forward</code> such as</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">kris:~ $ cat .forward
</span></span></span><span class="line"><span class="cl"><span class="go">|/usr/bin/procmail
</span></span></span></code></pre></div><p>This will invoke <code>procmail</code> for local delivery. <code>procmail</code> is a rule based local delivery agent with a horrible Syntax.</p>
<p>You can define variables, and later refer to them using <code>$</code> as a prefix. Rules start with a <code>:0</code>, and consist of a Regex for header lines, plus a delivery action (usually a folder name for Maildir format, so make sure it ends in a slash).</p>
<p>The other important but obscure piece of information is that the exit code of <code>procmail</code> defines the delivery success, and controls the mailer behavior. So checking in the obvious place (<code>/usr/include/sysexits.h</code>, of course!) you learn:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nl">kris</span><span class="p">:</span><span class="o">~</span> <span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">sysexits</span><span class="p">.</span><span class="n">h</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define EX_NOINPUT      66      </span><span class="cm">/* cannot open input */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define EX_NOUSER       67      </span><span class="cm">/* addressee unknown */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define EX_NOHOST       68      </span><span class="cm">/* host name unknown */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="p">...</span>
</span></span></code></pre></div><p>We remember that the magical number <code>67</code> as an exit code makes <code>exim</code> bounce mail with <code>user unknown</code>.</p>
<p>The end result:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">kris:~ $ cat .procmailrc
</span></span></span><span class="line"><span class="cl"><span class="go">PATH=/bin:/usr/bin:/usr/local/bin
</span></span></span><span class="line"><span class="cl"><span class="go">MAILDIR=$HOME/Maildir
</span></span></span><span class="line"><span class="cl"><span class="go">LOGFILE=$HOME/Procmail/procmail.log
</span></span></span><span class="line"><span class="cl"><span class="go">DEFAULT=$HOME/Maildir/
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">BOUNCE=/dev/null
</span></span></span><span class="line"><span class="cl"><span class="go">SPAM=$MAILDIR/.spam
</span></span></span><span class="line"><span class="cl"><span class="go">TRASH=$MAILDIR/.system.trash
</span></span></span><span class="line"><span class="cl"><span class="go">BOUNCELOG=$MAILDIR/.system.bounces
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> Subrule to define a <span class="s2">&#34;user unknown&#34;</span> bounce, as an example.
</span></span><span class="line"><span class="cl"><span class="gp">#</span> Subrule, because we also record the bounce in the bouncelog folder.
</span></span><span class="line"><span class="cl"><span class="go">:0
</span></span></span><span class="line"><span class="cl"><span class="go">* ^X-local-part-suffix: kris-macheist
</span></span></span><span class="line"><span class="cl"><span class="go">{
</span></span></span><span class="line"><span class="cl"><span class="go">    EXITCODE=67
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">    :0 i
</span></span></span><span class="line"><span class="cl"><span class="go">    $BOUNCELOG/
</span></span></span><span class="line"><span class="cl"><span class="go">}
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> Rule to route mail to the trash folder
</span></span><span class="line"><span class="cl"><span class="go">:0
</span></span></span><span class="line"><span class="cl"><span class="go">* ^X-local-part-suffix: kris-bitly
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span>TRASH/
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> all mail to kris-yourbusiness goes to INBOX/.special.yourbusiness,
</span></span><span class="line"><span class="cl"><span class="gp">#</span> which becomes the INBOX.special.yourbusiness folder.
</span></span><span class="line"><span class="cl"><span class="gp">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># We use sed and tr, this could be more efficient. Basically, we clean</span>
</span></span><span class="line"><span class="cl"><span class="gp">#</span> up unwanted characters and transform to lower <span class="k">case</span>.
</span></span><span class="line"><span class="cl"><span class="go">:0
</span></span></span><span class="line"><span class="cl"><span class="go">* ^X-local-part-suffix:.*kris-\/[^@]+
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span>MAILDIR/.special.<span class="sb">`</span><span class="nb">echo</span> <span class="nv">$MATCH</span> <span class="p">|</span> sed -e <span class="s1">&#39;s!([^)]*)!!g&#39;</span> -e <span class="s1">&#39;s![^a-zA-Z0-9_-]!_!g&#39;</span> <span class="p">|</span> tr A-Z a-z<span class="sb">`</span>/
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> Filter through spamc
</span></span><span class="line"><span class="cl"><span class="go">:0fw
</span></span></span><span class="line"><span class="cl"><span class="go">| /usr/bin/spamc
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> If spam detected, deliver to different folders depending on score
</span></span><span class="line"><span class="cl"><span class="go">:0
</span></span></span><span class="line"><span class="cl"><span class="go">* ^X-Spam-Level:.*\*\*\*\*\*\*\*\*\*\*
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span>SPAM.sure/
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">:0
</span></span></span><span class="line"><span class="cl"><span class="go">* ^X-Spam-Level:.*\*\*\*\*\*
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span>SPAM/
</span></span></code></pre></div><p>Note how we detect the <code>X-local-part-suffic</code> before we run spam detection and sorting. This allows mail to subaddresses to always go through and bypass all spam filtering, so in exchange for having a personally identifiable mail address you get guarantee delivery. Conversely, if you abuse the privilege you are routed to <code>$TRASH/</code>.</p>
<h2 id="mail-user-agent">
    <a href="#mail-user-agent">
	Mail User Agent
    </a>
</h2>
<p>I used to run Apple Mail.app with this setup, and now on Windows am using <a href="https://www.emclient.com/" target="_blank" rel="noopener">eM Client</a>

. eM Client is a commercial email client, and is available for Windows and Mac, and is easily the best email client I have ever used, with Mail.app being a close second for my workflow.</p>
<p>In my case, I define a smart folder search which will find all unread mail in all folders (except $list of exceptions), and show it in a single folder. I want the search to automatically discover newly generated folders automatically, and I need the folder name shown in the overview.</p>
<p><p class="md__image">
  <img src="/uploads/2021/01/emclient.png" alt=""  />
</p>

</p>
<p><em>A smart folder, finding all unread mail anywhere, and showing it by folder. I made a few mails unread for demonstration.</em></p>
<p>That way, I can see if I get a mail claiming to be from YourBusiness: If it is not in the <code>yourbusiness</code> folder, I am deleting it without reading. Phishers will have to send phishing mail to the correct folder for your personalized business mail address in order to be even considered.</p>
<p>I also can <code>$TRASH/</code> rule burned addresses rather quickly, and that keeps my inbox clean.</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_en
				</a>
				
				<a href="/tags/#mail" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mail
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2021-01-20-unlimited-mail-adresses.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/01/12/600000-user-in-baden-wurttemberg.html">940.000 User in Baden-Württemberg</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/01/28/database-as-a-queue.html">Database as a Queue</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
