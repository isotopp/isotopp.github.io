<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Using Python to bash | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="canonical" href="https://blog.koehntopp.info/2021/01/05/using-python-to-bash.html">


<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">




<meta name="generator" content="Hugo 0.110.0">
<meta property="og:title" content='Using Python to bash' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />


<meta property="og:locale" content="en_US" />


<meta name="description" content='' />
<meta property="og:description" content='' />

<meta property="og:url" content="https://blog.koehntopp.info" />


<meta property="og:type" content="article" />
<meta name="article:published_time" content='2021-01-05T17:11:57Z' />



<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content='@isotopp' />
<meta name="twitter:creator" content='@isotopp' />
<meta property="twitter:title" content='Using Python to bash' />
<meta property="twitter:description" content='' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />

<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebSite","description":null,"headline":"Using Python to bash","image":"/assets/img/background/rijksmuseum.jpg","name":"Die wunderbare Welt von Isotopp","url":"https://blog.koehntopp.info"}
</script>

    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.6b600fb66ca1591ba6dcc9b3bdfc59ebd5c0fdc49622889f839fc36f71dde892.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            




<div class="page">
  <article class="using-python-to-bash-page">
    <div class='row  justify-content-center text-center my-4 mx-0'>
      <header>
        <div class='col'>
          <h1 class="title mb-lg-4 text-white">
            Using Python to bash
          </h1>
          <div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
            <img alt='isotopp image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
            <a href="https://chaos.social/@isotopp" class='text-light text-decoration-none'>
                Kristian Köhntopp
            </a>

            
              <span class='d-none d-lg-inline'>-</span>
              <div class='d-block d-lg-inline'>January 5, 2021</div>
            

          </div>
        </div>
        
          <img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
        
      </header>
    </div>

    <div class='row justify-content-center mx-0 mt-5 mb-5'>
      <div class='col-lg-8'>
        <p>Heise writes <a href="https://www.heise.de/hintergrund/Einfuehrung-in-die-Bash-Programmierung-Minesweeper-in-der-Linux-Shell-entwickeln-5002358.html" target="_blank" rel="noopener">an introduction to bash programming (in german)</a>

:</p>
<blockquote>
<p>Bash ist eine vollwertige Programmiersprache, mit der Sie alltägliche Aufgaben leicht automatisieren.</p>
<p>Bash is a fully featured programming language that you can use to automate everyday tasks.</p>
</blockquote>
<p>Bash is not a fully featured programming language at all, and nothing in bash is ever easy. You are advised to use a proper programming language early on in development, and if possible never put bash commands into a file.</p>
<p>A few early warning signs to look out for:</p>
<ul>
<li>Bash is somewhat okay to handle files. If you find yourself handling lines, words or characters instead of entire files, you are using the wrong tool. The script you are working on should have been written in something else.</li>
<li>Bash is really bad at math. If you are doing math, especially if it is not small positive integers, you should have been using something else.</li>
<li>Bash is really bad at handling any kind of UI. If you start thinking about curses, Tk or Qt, you should have been using something else.</li>
</ul>
<p>Bash is also bad at  safely handling filenames with weird characters in them, bad at  handling Unicode, bad at handling Errors and bad at many other elementary things.</p>
<p>Basically, it is better to start in something else right away if the things move away from an interactive command line and end up in a file. Use whatever you like as an interactive command line, but do not write bash or shell scripts.</p>
<p>Shell is a thing you want to understand and then not use, because you learned to understand it. (<a href="https://groups.google.com/g/de.comp.os.unix.shell/c/VkJ0T4P2ZVA/m/3G5MF3oLNYcJ" target="_blank" rel="noopener">in German, from 1998</a>

)</p>
<p>For the rest of this discussion, we assume &ldquo;Python 3&rdquo; as an instance of &ldquo;something else&rdquo;, but if you are older than 50, feel free to use &ldquo;Perl&rdquo; instead.</p>
<p>If you are already doing Python, the rest of this is not for you. You already know these things.</p>
<h2 id="do-not-modify-the-system-python">
    <a href="#do-not-modify-the-system-python">
	Do not modify the system python
    </a>
</h2>
<p>Use the system Python, if possible, but do not try to modify the system Python installation. Use a virtual environment for packages, instead.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> mkdir myscript
</span></span><span class="line"><span class="cl"><span class="gp">$</span> <span class="nb">cd</span> !$
</span></span><span class="line"><span class="cl"><span class="gp">$</span> python3 -mvenv venv
</span></span><span class="line"><span class="cl"><span class="gp">$</span> <span class="nb">source</span> venv/bin/activate
</span></span></code></pre></div><p>This will create a local (symlinked) copy of the system python, and activate it as the interpreter environment to modify if you install dependencies. You will want to update <code>pip</code>, install <code>wheel</code> and then maintain a file named <code>requirements.txt</code> at the top level of the <code>myscript</code> directory. It will contain the names of the packages (optionally with version pins) you depend on. You can install the dependencies using <code>pip install -r requirements.txt</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> cat revenv.sh
</span></span><span class="line"><span class="cl"><span class="gp">#</span>! /bin/bash
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">deactivate
</span></span></span><span class="line"><span class="cl"><span class="go">rm -rf venv
</span></span></span><span class="line"><span class="cl"><span class="go">python3 -mvenv venv
</span></span></span><span class="line"><span class="cl"><span class="go">source venv/bin/activate
</span></span></span><span class="line"><span class="cl"><span class="go">pip install --upgrade pip
</span></span></span><span class="line"><span class="cl"><span class="go">pip install wheel
</span></span></span><span class="line"><span class="cl"><span class="go">pip install -r requirements.txt
</span></span></span><span class="line"><span class="cl"><span class="go">pip freeze -r requirements.txt &gt; requirements-frozen.txt
</span></span></span></code></pre></div><p>It deactivates the venv, throws away the installed venv, and then re-makes it from the requirements.</p>
<p>Yes, that is a shell script. There are ways to do the same things natively and better.</p>
<p>It is extensively documented in <a href="https://packaging.python.org/overview/" target="_blank" rel="noopener">An Overview of Packaging for Python</a>

, for example <a href="https://packaging.python.org/tutorials/managing-dependencies/" target="_blank" rel="noopener">Managing Application Dependencies</a>

 and <a href="https://packaging.python.org/tutorials/packaging-projects/" target="_blank" rel="noopener">Packaging Python Projects</a>

.</p>
<p>Running a local Python package registry is as simple as exposing a directory with a specific file structure using a web server, see <a href="https://docs.python-guide.org/shipping/packaging/" target="_blank" rel="noopener">here</a>

, and a step-by-step walkthrough for a kind of minimal setup can be found <a href="https://python-packaging.readthedocs.io/en/latest/minimal.html#minimal-structure" target="_blank" rel="noopener">here</a>

.</p>
<h2 id="do-not-try-to-write-bash-in-python">
    <a href="#do-not-try-to-write-bash-in-python">
	Do not try to write Bash in Python
    </a>
</h2>
<p>In an online discussion, <a href="https://twitter.com/netzverweigerer/status/1346450864853159941" target="_blank" rel="noopener">somebody remarked</a>

:</p>
<blockquote>
<p>I do not think that</p>
<p><code>subprocesss.run([&quot;ls&quot;, &quot;-l&quot;, &quot;/dev/null&quot;], capture_output=True)</code></p>
<p>is more intuitive or less error prone, but different people have different opinions.</p>
</blockquote>
<p>That is correct.</p>
<p>The point here is that this is not useful at all, in a Python program. That line will then produce output such as</p>
<blockquote>
<p><code>crw-rw-rw- 1 root root 1, 3 Dec  7 12:15 /dev/null</code></p>
</blockquote>
<p>and that needs parsing to be useful for anything. You&rsquo;d not do that at all in Python, ever.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&#34;/dev/null&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">stat_result</span><span class="p">(</span><span class="n">st_mode</span><span class="o">=</span><span class="mi">8630</span><span class="p">,</span> <span class="n">st_ino</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">st_dev</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">st_nlink</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">st_uid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">st_gid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">st_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">st_atime</span><span class="o">=</span><span class="mi">1607339753</span><span class="p">,</span> <span class="n">st_mtime</span><span class="o">=</span><span class="mi">1607339753</span><span class="p">,</span> <span class="n">st_ctime</span><span class="o">=</span><span class="mi">1607339753</span><span class="p">)</span>
</span></span></code></pre></div><p>Now we can talk. In Bash, everything always is a string.</p>
<p>In a proper programming language, we have a wealth of basic data types, and can use them in containers to construct aggregate types or even objects, and we can make use of this.</p>
<p>Using <code>Path().stat()</code> we get access to the same information in useful form that combines nicely with any number of powerful language and library features.</p>
<h2 id="if-you-need-to-run-commands-consume-json">
    <a href="#if-you-need-to-run-commands-consume-json">
	If you need to run commands, consume JSON
    </a>
</h2>
<p>So what if you have to run an external command to do things?</p>
<p>Hopefully the external commands produce something structured such as JSON:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">lvs</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;lvs&#34;</span><span class="p">,</span> <span class="s2">&#34;--reportformat=json&#34;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">lvs_output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">lvs</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lvs_output</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lv&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s1">&#39;lv_name&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;lv_size&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">blogbackup</span> <span class="mf">20.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">dedibackup</span> <span class="mf">100.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">disk_images</span> <span class="mf">40.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">gitlab</span> <span class="mf">10.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">halde</span> <span class="mf">350.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">iot</span> <span class="mf">30.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">kvm</span> <span class="mf">60.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">unifi</span> <span class="mf">10.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">backup</span> <span class="mf">4.00</span><span class="n">t</span>
</span></span><span class="line"><span class="cl"><span class="n">tm_aircat</span> <span class="mf">1.00</span><span class="n">t</span>
</span></span><span class="line"><span class="cl"><span class="n">tm_joram</span> <span class="mf">1.50</span><span class="n">t</span>
</span></span><span class="line"><span class="cl"><span class="n">tm_mini</span> <span class="mf">512.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">win_kk</span> <span class="mf">2.08</span><span class="n">t</span>
</span></span><span class="line"><span class="cl"><span class="n">home</span> <span class="mf">60.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">swap</span> <span class="mf">32.00</span><span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">ubuntu</span> <span class="mf">80.00</span><span class="n">g</span>
</span></span></code></pre></div><p>This imports the modules <a href="https://docs.python.org/3/library/subprocess.html" target="_blank" rel="noopener"><code>subprocess</code></a>

 and <a href="https://docs.python.org/3/library/json.html" target="_blank" rel="noopener"><code>json</code></a>

 for use.</p>
<p>It then uses the command <code>lvs --reportformat=json</code> to list all LVM2 logical volumes in the system. The command is specificed as an argument list, so no interim bash is spawned, instead the command is run directly from Python, using <a href="https://docs.python.org/3/library/subprocess.html#using-the-subprocess-module" target="_blank" rel="noopener"><code>subprocess.run()</code></a>

, capturing the output.</p>
<p>The output, being JSON formatted, is turned into Python native data structures, using <a href="https://docs.python.org/3/library/json.html#json.loads" target="_blank" rel="noopener"><code>json.loads()</code></a>

. We then iterate the data we collected, printing a system report from Python.</p>
<p>There are <a href="https://github.com/xzased/lvm2py" target="_blank" rel="noopener">other ways to do the same</a>

: LVM2 offers liblvm2app and an API, and a binding of that API to Python exists (but seems to be rather unmaintained, so I&rsquo;d rather use the JSON approach).</p>
<h2 id="useful-modules-that-come-with-the-system">
    <a href="#useful-modules-that-come-with-the-system">
	Useful modules that come with the system
    </a>
</h2>
<h3 id="sys-os-pathlib">
    <a href="#sys-os-pathlib">
	sys, os, pathlib
    </a>
</h3>
<p>So you already know about <a href="https://docs.python.org/3/library/sys.html" target="_blank" rel="noopener"><code>sys</code></a>

, and <a href="https://docs.python.org/3/library/os.html" target="_blank" rel="noopener"><code>os</code></a>

. Maybe you use <a href="https://docs.python.org/3/library/pathlib.html" target="_blank" rel="noopener"><code>pathlib</code></a>

 instead of <a href="https://docs.python.org/3/library/os.path.html" target="_blank" rel="noopener"><code>os.path</code></a>

.</p>
<p><code>sys</code> is the meta about your Python environment. It offers you detailed introspection about the version, the base operating system platform, and many other things that relate to your runtime environment.</p>
<p><code>os</code> is the access to the operating system, allowing you to manipulate files and many other base operating system abstractions</p>
<p><code>pathlib</code> is a higher level convenience interface built on top of that, which overloads the <code>/</code> operator and allows you to manipulate operating system path names in a portable way. It offers functions to parse pathnames, is <code>os.stat()</code> aware and has <code>basename()</code> and <code>dirname()</code> functionality, plus globbing.</p>
<p>Path can completely replace os-like file access, and there is a handy table at the end of the manpage.</p>
<h3 id="shutil">
    <a href="#shutil">
	shutil
    </a>
</h3>
<p>Basic shell file operations can be handled with <a href="https://docs.python.org/3/library/shutil.html" target="_blank" rel="noopener"><code>shutil</code></a>

.</p>
<p>This module has a number of file copy operations available, which are aware of operating system specifics and modern metadata presence. There are also copytree and rmtree operations. Since Python 3.8 there are operating system specific high-efficiency implementations available which are network drive aware and are automatically used (MacOS fcopyfile, os.sendfile(), and others).</p>
<p>The module also offers a set of functions that deal with common archive formats such as <code>zip</code>, <code>tar</code>, and other compressors. There is a framework to register additional compressors and archive formats.</p>
<p>Note that the <a href="https://docs.python.org/3/library/stat.html" target="_blank" rel="noopener"><code>walk()</code></a>

 function is part of the <code>os</code> module, not the <code>shutil</code> module. It can be used to iterate over a filesystem subtree in a number of ways, offering <code>find(1)</code> like functionality.</p>
<h3 id="argparse-click-docopt">
    <a href="#argparse-click-docopt">
	argparse, click, docopt
    </a>
</h3>
<p>Python delivers <a href="https://docs.python.org/3/library/argparse.html" target="_blank" rel="noopener"><code>argparse</code></a>

 with the standard libary, and has <a href="https://docs.python.org/3/howto/argparse.html" target="_blank" rel="noopener">extensive tutorials</a>

 for it. It works pretty much as one would expect</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--size&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;file size&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
</span></span></code></pre></div><p>and</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ./keks.py --help
</span></span><span class="line"><span class="cl"><span class="go">usage: keks.py [-h] [--size SIZE]
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">optional arguments:
</span></span></span><span class="line"><span class="cl"><span class="go">  -h, --help   show this help message and exit
</span></span></span><span class="line"><span class="cl"><span class="go">  --size SIZE  file size
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span> ./keks.py --size <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="go">10 &lt;class &#39;int&#39;&gt;
</span></span></span></code></pre></div><p>There are a number of more refined options that allow for positional, keyword and more restricted optional arguments (the type we have been using here), with typechecking and choices.</p>
<p><a href="https://click.palletsprojects.com/" target="_blank" rel="noopener"><code>click</code></a>

 and <a href="https://github.com/docopt/docopt" target="_blank" rel="noopener"><code>docopt</code></a>

 are not part of the standard libary, so it means picking up an external dependency.</p>
<p><code>docopt</code> is built around the concept of docstrings, so option parsers are configured from the program documentation at the start of the program.</p>
<p><code>click</code> is built around the concept of <a href="https://realpython.com/primer-on-python-decorators/" target="_blank" rel="noopener">Python decorators</a>

, and allows things such as</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">click</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@click.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--size&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;file size&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">size</span><span class="p">()</span>
</span></span></code></pre></div><p>and</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ./probe.py  --help
</span></span><span class="line"><span class="cl"><span class="go">Usage: probe.py [OPTIONS]
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Options:
</span></span></span><span class="line"><span class="cl"><span class="go">  --size INTEGER  file size  [required]
</span></span></span><span class="line"><span class="cl"><span class="go">  --help          Show this message and exit.
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span> ./probe.py --size <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="go">10 &lt;class &#39;int&#39;&gt;
</span></span></span></code></pre></div><p>Click is very complete, extensible and specifically the tool of choice for large commands that require the implementation of subcommands (<code>git log</code>, <code>git add</code>, <code>git commit</code> type interfaces).</p>
<h3 id="fileinput">
    <a href="#fileinput">
	fileinput
    </a>
</h3>
<p>In this context also useful is <a href="https://docs.python.org/3/library/fileinput.html" target="_blank" rel="noopener"><code>fileinput</code></a>

, a helper that consumes pathnames from the command arguments and offers you the lines from the files named, in one single stream or separated.</p>
<p>There is a number of support options for writing filters, in-place file changes and similar programs.</p>
<p>It is possible to install decompressor/compressor hooks, as well as data encodoers/decoders.</p>
<h3 id="stat">
    <a href="#stat">
	stat
    </a>
</h3>
<p>The <code>os.stat()</code> example from the very beginning of this text is easier expanded on with the <a href="https://docs.python.org/3/library/stat.html" target="_blank" rel="noopener"><code>stat</code></a>

 module, which has a number of constants and helpers that make more sense out of the data delivered by the operating system.</p>
<h3 id="glob-fnmatch">
    <a href="#glob-fnmatch">
	glob, fnmatch
    </a>
</h3>
<p>Python has a <a href="https://docs.python.org/3/library/glob.html" target="_blank" rel="noopener"><code>glob</code></a>

 and <a href="https://docs.python.org/3/library/fnmatch.html" target="_blank" rel="noopener"><code>fnmatch</code></a>

 modules, but you are probably better off using <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.glob" target="_blank" rel="noopener"><code>Path.glob</code></a>

 from the more modern and portable <code>pathlib</code> instead.</p>
<h3 id="tempfile">
    <a href="#tempfile">
	tempfile
    </a>
</h3>
<p>Temporary filenames, files and file handles can be made safely with <a href="https://docs.python.org/3/library/tempfile.html" target="_blank" rel="noopener"><code>tempfile</code></a>

, another standard libary.</p>
<h3 id="difflib-filecmp">
    <a href="#difflib-filecmp">
	difflib, filecmp
    </a>
</h3>
<p>There are a number of modules that deal in comparisons of files, <a href="https://docs.python.org/3/library/difflib.html#differ-example" target="_blank" rel="noopener"><code>difflib</code></a>

 computes diff-like output with a nice programming interface, and <a href="https://docs.python.org/3/library/filecmp.html" target="_blank" rel="noopener"><code>filecmp</code></a>

 compares files and directory trees, finding files with different content or attributes.</p>
<h3 id="ini-files-yaml-and-json">
    <a href="#ini-files-yaml-and-json">
	ini files, yaml and json
    </a>
</h3>
<p>The python standard libary offers readers and writers for <a href="https://docs.python.org/3/library/configparser.html" target="_blank" rel="noopener"><code>ini files</code></a>

 and <a href="https://docs.python.org/3/library/json.html" target="_blank" rel="noopener"><code>json</code></a>

. Handling <a href="https://pyyaml.org/wiki/PyYAMLDocumentation" target="_blank" rel="noopener"><code>yaml</code></a>

 is an external dependency.</p>
<h3 id="sched-daemon-pidfile-and-pystemd">
    <a href="#sched-daemon-pidfile-and-pystemd">
	sched, daemon, pidfile, and pystemd
    </a>
</h3>
<p>A simple-cronlike timer facility, <a href="https://docs.python.org/3/library/sched.html" target="_blank" rel="noopener"><code>sched</code></a>

 comes with the system libraries.</p>
<p>Actually becoming a background process with <a href="https://pagure.io/python-daemon/" target="_blank" rel="noopener"><code>python-daemon</code></a>

 picks up an external dependency. So does handling PIDfiles with <a href="https://github.com/mosquito/python-pidfile" target="_blank" rel="noopener"><code>python-pidfile</code></a>

.</p>
<p>The external dependency <a href="https://github.com/facebookincubator/pystemd" target="_blank" rel="noopener"><code>pystemd</code></a>

 allows you to speak dbus to talk to systemd, but you would not notice that from the usage: you can deal with systemd units as native Python objects and query and control them.</p>
<h3 id="subprocess">
    <a href="#subprocess">
	subprocess
    </a>
</h3>
<p>And of course, we already mentioned <a href="https://docs.python.org/3/library/subprocess.html#using-the-subprocess-module" target="_blank" rel="noopener"><code>subprocess.run()</code></a>

, the swiss army knife of bad old shell interfacing. Make sure you prefer commands that can produce JSON, that will hurt a lot less.</p>

      </div>
    </div>

    
    
    <div class='row justify-content-center mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Share</span>
        <a href='https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.koehntopp.info%2f2021%2f01%2f05%2fusing-python-to-bash.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#facebook'/></svg>
        </a>

        <a href='http://www.reddit.com/submit?url=https%3a%2f%2fblog.koehntopp.info%2f2021%2f01%2f05%2fusing-python-to-bash.html&title=Using%20Python%20to%20bash' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>
        <a href='mailto:?subject=Using%20Python%20to%20bash&body=https%3a%2f%2fblog.koehntopp.info%2f2021%2f01%2f05%2fusing-python-to-bash.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope-fill'/></svg>
        </a>
      </div>
    </div>

    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
        
          <a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            lang_en
          </a>
        
          <a href="/tags/#python" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            python
          </a>
        
          <a href="/tags/#bash" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            bash
          </a>
        
          <a href="/tags/#devops" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            devops
          </a>
        
      </div>
    </div>

    
    
    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2021-01-05-using-python-to-bash.md" rel="noopener noreferrer" target="_blank">
            <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
        </a>
      </div>
    </div>
    

    <div class='row justify-content-center mb-5 pt-5 border-top mx-0'>
      <div class='col-lg-4 text-center text-lg-start'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Next Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2021/01/10/labyrinths-in-python.html">Labyrinths (in Python)</a>
          </div>
        
      </div>

      <div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Previous Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2020/12/28/fork-exec-wait-and-exit.html">fork, exec, wait and exit</a>
          </div>
        
      </div>
    </div>

    
    </article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff. 
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#rss-fill'/></svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope'/></svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#github'/></svg>
        </a>

	<a rel="me" href="https://chaos.social/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#mastodon'/></svg>
	</a>

        <a href='https://www.reddit.com/user/isotopp' title='Follow on Reddit' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>

        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#steam'/></svg>
        </a>



        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#youtube'/></svg>
        </a>

      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
