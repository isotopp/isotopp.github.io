<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>MySQL: CREATE IF NOT EXISTS TABLE, but CREATE OR REPLACE VIEW | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2021/09/10/create-if-not-exists.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='MySQL: CREATE IF NOT EXISTS TABLE, but CREATE OR REPLACE VIEW | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2021/09/10/create-if-not-exists.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2021-09-10T20:01:06Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='MySQL: CREATE IF NOT EXISTS TABLE, but CREATE OR REPLACE VIEW' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="mysql-create-if-not-exists-table-but-create-or-replace-view-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						MySQL: CREATE IF NOT EXISTS TABLE, but CREATE OR REPLACE VIEW
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>September 10, 2021</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/mysql.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/10/mysql-million-challenge.html">MySQL: The Million Challenge</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/14/mysql-page-compression-revisited.html">MySQL: Page compression revisited</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>For the MySQL Million Challenge, I was going through the server syntax in order to understand what things can be created in the server.
And now my OCD triggered.
DDL is a mess.</p>
<h1 id="creation">
    <a href="#creation">
	Creation
    </a>
</h1>
<blockquote>
<p>As a database developer, I want to be able to create server objects using the <code>CREATE thing</code> syntax.</p></blockquote>
<p>The server gives you that for the following things:</p>
<ul>
<li>DATABASE</li>
<li>EVENT</li>
<li>FUNCTION (and FUNCTION SONAME)</li>
<li>INDEX</li>
<li>LOGFILE GROUP (NDB only, not going to look at this)</li>
<li>PROCEDURE</li>
<li>RESOURCE GROUP</li>
<li>ROLE</li>
<li>SERVER</li>
<li>SPATIAL REFERENCE SYSTEM</li>
<li>TABLE</li>
<li>TABLESPACE</li>
<li>TRIGGER</li>
<li>USER</li>
<li>VIEW</li>
</ul>
<h1 id="safe-creation">
    <a href="#safe-creation">
	Safe creation
    </a>
</h1>
<blockquote>
<p>As a database developer I want to be able to script things safely, so I need <code>IF NOT EXISTS</code> clauses in my <code>CREATE</code> syntax.</p></blockquote>
<p>Statements that create things often allow you to specify <code>IF NOT EXISTS</code> for conditional creation of the thing:
Creation of the thing will fail if it already exists.
Using the <code>IF NOT EXISTS</code> clause the creation is conditional, so if the thing already exists this is not an error.</p>
<p>This is important for scripting: If the thing already exists, the script will throw an error and depending on settings will stop.
It is even more important in replication, because if you replicate the creation statement to a replica, the replication will stop with an error unless it is conditional.</p>
<p>Some <code>CREATE</code> statements replicate, but do not offer conditional syntax.
They cannot be used safely in replication, and they are cumbersome in scripting.</p>
<p>Two <code>CREATE</code> statements offer deviant safe creation: Instead of <code>CREATE ... IF NOT EXISTS</code> they offer <code>CREATE OR REPLACE ...</code>.</p>
<h1 id="multiple-object-syntax">
    <a href="#multiple-object-syntax">
	Multiple object syntax
    </a>
</h1>
<blockquote>
<p>As a database developer I want to be able to chain multiple <code>CREATE</code> or <code>DROP</code> actions together in a single statement, so that the things are created (or dropped) together, atomically.</p></blockquote>
<p>Alternatively, DDL could be made transactional.
This makes sense even if a rollback is not possible, if they are being executed in a kind of DDL transaction under a lock, so that they appear to happen atomically.</p>
<p>Multiple <code>CREATE</code> syntax does not exist.
For few objects, a multiple drop syntax does exist, but support is thin.</p>
<h1 id="safe-drop">
    <a href="#safe-drop">
	Safe DROP
    </a>
</h1>
<blockquote>
<p>As a database developer, I want to be able to <code>DROP</code> the things that I created.</p></blockquote>
<p>Obviously.</p>
<blockquote>
<p>As a database developer, I want to be able to make the <code>DROP</code> conditional using an <code>IF EXISTS</code> clause, to be able to script and replicate this operation safely.</p></blockquote>
<p>Obviously.</p>
<p>The support for this is better than for creation, for some reason, and there is no deviant syntax.
Still, some things cannot be dropped safely.</p>
<h1 id="enumeration-and-definition-display">
    <a href="#enumeration-and-definition-display">
	Enumeration and Definition display
    </a>
</h1>
<blockquote>
<p>As a developer, I want to be able to enumerate all the things of a category.</p></blockquote>
<p>Logically, an API is incomplete without enumeration.
I need to be able to see what exists.</p>
<p>In MySQL, a lot of things can be listed with <code>SHOW</code> commands, and all things can be listed by looking into the appropriate system tables.</p>
<p>Apparently, a lot of things can not be listed using the <code>SHOW plural</code> syntax (<code>SHOW TABLES</code>, <code>SHOW DATABASES</code>).
For a few things, a deviant syntax is supported (<code>SHOW PROCEDURE STATUS</code>) that also shows the definition of the thing.</p>
<p>For other things you have to access system tables.
These system tables seem to be spread around, some are in I_S (Tablespace), others in mysql.* (servers).</p>
<p>Generally, MySQL seems to favor the syntax <code>SHOW CREATE thing</code> to show an SQL statement that would recreate the thing if I dropped it.
But for some things, this is not implemented, despite the fact that the information for this is available in various system tables.</p>
<h1 id="altering-and-renaming-things">
    <a href="#altering-and-renaming-things">
	Altering and renaming things
    </a>
</h1>
<blockquote>
<p>As a database developer, I want to be able to change the definition of a thing after creation.</p></blockquote>
<p>Most things can be altered after creation.
For some things, some attributes cannot be altered even if an <code>ALTER</code> statement exists. Notably, it is impossible to rename a database.</p>
<p>Only two things can be renamed, tables and users.
For other things, renaming is possible using <code>ALTER TABLE RENAME</code> syntax, but a pure <code>RENAME</code> does not exist despite the fact that renaming is supported.</p>
<p>For roles and users, <code>ALTER thing IF EXISTS</code> conditional syntax is supported, but for all other things it is not.</p>
<h1 id="replication">
    <a href="#replication">
	Replication
    </a>
</h1>
<p>All thing creations are replicated, except resource groups and servers.
That even makes sense, which is unusual, given all the other illogical anomalies.</p>
<h1 id="a-table-because-this-is-about-databases">
    <a href="#a-table-because-this-is-about-databases">
	A table, because this is about databases
    </a>
</h1>
<table>
  <thead>
      <tr>
          <th>Command</th>
          <th>replicates</th>
          <th>enumerate SHOW</th>
          <th>CREATE</th>
          <th>IF   T EXISTS</th>
          <th>OR REPLACE</th>
          <th>DROP</th>
          <th>IF EXISTS</th>
          <th>MULTI</th>
          <th>SHOW CREATE</th>
          <th>ALTER</th>
          <th>IF EXISTS</th>
          <th>RENAME</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>DATABASE</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>EVENT</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>*4</td>
      </tr>
      <tr>
          <td>FUNCTION</td>
          <td>YES</td>
          <td>*1</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>INDEX</td>
          <td>YES</td>
          <td>*2</td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>*2</td>
          <td></td>
          <td></td>
          <td>*4</td>
      </tr>
      <tr>
          <td>PROCEDURE</td>
          <td>YES</td>
          <td>*3</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>*4</td>
      </tr>
      <tr>
          <td>RES GROUP</td>
          <td>*  *</td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>ROLE</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
      </tr>
      <tr>
          <td>SERVER</td>
          <td>*  *</td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>SRS</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>TABLE</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
      </tr>
      <tr>
          <td>TABLESPACE</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td>*4</td>
      </tr>
      <tr>
          <td>TRIGGER</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>USER</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
      </tr>
      <tr>
          <td>VIEW</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td>YES</td>
          <td></td>
          <td>YES</td>
      </tr>
  </tbody>
</table>
<ul>
<li>*1: <code>SHOW FUNCTION STATUS</code> deviant syntax enumerates the function names and definitions.</li>
<li>*2: Indexes are not first class citizens, they are part of table definitions.</li>
<li>*3: <code>SHOW PROCEDURE STATUS</code> deviant syntax enumerates the procedure names and definitions.</li>
<li>*4: <code>ALTER thing RENAME</code> syntax exists, but no <code>RENAME</code> command.</li>
</ul>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_en
				</a>
				
				<a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysql
				</a>
				
				<a href="/tags/#mysqldev" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysqldev
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2021-09-10-create-if-not-exists.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/10/mysql-million-challenge.html">MySQL: The Million Challenge</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/14/mysql-page-compression-revisited.html">MySQL: Page compression revisited</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
