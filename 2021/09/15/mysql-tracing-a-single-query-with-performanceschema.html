<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>MySQL: Tracing a single query with PERFORMANCE_SCHEMA | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2021/09/15/mysql-tracing-a-single-query-with-performanceschema.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='MySQL: Tracing a single query with PERFORMANCE_SCHEMA | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2021/09/15/mysql-tracing-a-single-query-with-performanceschema.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2021-09-15T18:06:51Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='MySQL: Tracing a single query with PERFORMANCE_SCHEMA' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="mysql-tracing-a-single-query-with-performance_schema-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						MySQL: Tracing a single query with PERFORMANCE_SCHEMA
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>September 15, 2021</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/mysql.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/14/mysql-page-compression-revisited.html">MySQL: Page compression revisited</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/17/binding-the-orm.html">MySQL: Binding the ORM</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>My task is to collect performance data about a single query, using <code>PERFORMANCE_SCHEMA</code> (P_S for short) in MySQL, to ship it elsewhere for integration with other data.</p>
<p>In a grander scheme of things, I will need to define what performance data from a query I am actually interested in.
I will also need to find a way to attribute the query (as seen on the server) to a point in the codebase of the client, which is not always easy when an ORM or other SQL generator is being used.
And finally I will need to find a way to view the query execution in the context of the client code execution, because the data access is only a part of the system performance.</p>
<p>But this is about query execution in the server, and the instrumentation available to me in MySQL 8, at least to get things started.
So we take the tour of performance schema, and then run one example query (a simple join) and see what we can find out about this query.</p>
<h1 id="performance-schema-the-10000m-view">
    <a href="#performance-schema-the-10000m-view">
	Performance Schema, the 10.000 m view
    </a>
</h1>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html" target="_blank" rel="noopener">The Manual</a>

 has a major chapter that covers P_S in details.
The original idea of P_S is to have a bunch of preallocated memory areas without locks, presented to the database itself as tables.</p>
<p>P_S is unusual in the way that P_S &ldquo;tables&rdquo; are never locked while you work with them.
That means the values in a &ldquo;table&rdquo; can change while you read them.
That is important - if you for example calculate percentages, they may not add up to 100%.
If you <code>ORDER BY</code>, the sort may or may not be stable.</p>
<p>These are good properties: P_S will not freeze the server, and you won&rsquo;t kill the server by working with P_S tables.</p>
<p>It is a good idea to make a copy of P_S tables while you work with them, by turning off subquery merging with <code>select /*+ NO_MERGE(t) */ </code>, and then materializing P_S tables in subqueries.</p>
<p>Originally, P_S also had no secondary indexes, so joining P_S tables against other P_S tables did not work efficiently.
That was probably a good idea, because joining against a table that is changing while you execute the join is probably generating random results anyway.
But because it is so common, and because MySQL itself does this now internally in <code>sys.*</code>, secondary indexes to join efficiently now exist.
That does not make the joins more correct, but at least you get the result faster.</p>
<p>I wrote about all this <a href="/2020/12/01/not-joining-on-performance-schema.html">in an earlier article</a>

.</p>
<h2 id="instruments-objects-actors-threads-and-consumers">
    <a href="#instruments-objects-actors-threads-and-consumers">
	Instruments, Objects, Actors, Threads and Consumers
    </a>
</h2>
<p>The data P_S collects is centered around three major things:</p>
<ul>
<li>Time consumed. In database servers, that is mostly wait time - waiting on I/O or locks.</li>
<li>Data transferred. In database servers, that is mostly pages read or written. In a way, this related to I/O wait.</li>
<li>Memory used. In database servers, that is buffers allocated - how large, and how often, and peak usage.</li>
</ul>
<p>P_S collects this in the form of &ldquo;events&rdquo; (and takes care to note that P_S events are not binlog events or other any events).
The collection points are in the database server code, which is instrumented, so the collectors are <em>instruments</em>.</p>
<p>The thing that the server code works on may be of a certain kind, for example a table or another <em>object</em> in the server, but have a variable identity (that would be different tables, with different names).
Instruments can be filtered by using object names.</p>
<p>The activity done in the server is done on behalf of a database user, in the form of <em>user@host</em> or, new in MySQL 8, using roles.
The entity on which behalf the server is working on is called the <em>actor</em>.</p>
<p>The activity done in the server is also done in the context of a <em>thread</em>, some of which are background threads, while the majority in a busy server are usually connection threads.</p>
<p>And finally, the data collected is put into the in-memory tables of P_S.
These come in various groups, and are called <em>consumers</em>.</p>
<p><p class="md__image">
  <img src="/uploads/2021/09/performance_schema_filtering.png" alt=""  />
</p>

</p>
<p><em>Data is collected from objects using instruments. Instruments can be turned on and off. Their collected data is then filtered by Objects, Actors and Threads, and finally dropped into consumers. Many consumers are aggregates, some collect information specific to one query execution.</em></p>
<p>For each of these things there is a <code>setup_...</code> table that controls how event data is collected by the instrumentation, filtered and the consumed in result tables.
In parallel, object identities are collected in <code>..._instances</code> tables, which are needed to resolve object identities.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s2">&#34;setup_%&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Tables_in_performance_schema</span><span class="w"> </span><span class="p">(</span><span class="n">setup_</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">setup_actors</span><span class="w">                           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">setup_consumers</span><span class="w">                        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">setup_instruments</span><span class="w">                      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">setup_objects</span><span class="w">                          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">setup_threads</span><span class="w">                          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s2">&#34;%_instances&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Tables_in_performance_schema</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="n">_instances</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">cond_instances</span><span class="w">                             </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">file_instances</span><span class="w">                             </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">mutex_instances</span><span class="w">                            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">prepared_statements_instances</span><span class="w">              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">rwlock_instances</span><span class="w">                           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">socket_instances</span><span class="w">                           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">--------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">6</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">socket_instances</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------------------------------+-----------------------+-----------+-----------+-----------+-------+--------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">EVENT_NAME</span><span class="w">                             </span><span class="o">|</span><span class="w"> </span><span class="n">OBJECT_INSTANCE_BEGIN</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">THREAD_ID</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">SOCKET_ID</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IP</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">PORT</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">STATE</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------------------------------+-----------------------+-----------+-----------+-----------+-------+--------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="n">mysqlx</span><span class="o">/</span><span class="n">tcpip_socket</span><span class="w">     </span><span class="o">|</span><span class="w">             </span><span class="mi">106328376</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">44</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">::</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">18025</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="n">mysqlx</span><span class="o">/</span><span class="n">unix_socket</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="mi">106328688</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">44</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">server_tcpip_socket</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="mi">106329000</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">26</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">8025</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">server_unix_socket</span><span class="w">  </span><span class="o">|</span><span class="w">             </span><span class="mi">106329312</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">28</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">client_connection</span><span class="w">   </span><span class="o">|</span><span class="w">             </span><span class="mi">106330560</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">41</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----------------------------------------+-----------------------+-----------+-----------+-----------+-------+--------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h2 id="current-history-and-history-long-tables-vs-summaries">
    <a href="#current-history-and-history-long-tables-vs-summaries">
	Current, History and History Long Tables vs. Summaries
    </a>
</h2>
<p>P_S collects data in a lot of summary table, which should not interest us that much here.
Our task is to look at the performance data of a single, individual query to better understand what happened when it ran.</p>
<p>These unaggregated tables are <code>events_transactions</code>, <code>events_statements</code>, <code>events_stages</code> and <code>events_waits</code>.
For each of them, we have  <code>_current</code>, <code>_history</code> or <code>_history_long</code> tables.</p>
<p>The <code>_current</code> tables contain one entry for the currently running thread.
The <code>_history</code> tables contain a configurable number of entries for each thread, for example 10 per thread.
And the <code>_history_long</code> tables contain a configurable number of entries, shared across all threads, for example 10.000 in total.
As the server continues to execute statements and produce events, old entries are discarded and new entries are added, automatically.
Additionally, each query execution is aggregated along several dimensions in summary tables.
Summary tables state these dimension(s) using <code>by_&lt;dimensionname&gt;</code>, for example <code>_by_user_by_eventname</code> or similar.</p>
<p>In current MySQL, P_S is enabled by default.
But not all instruments and consumers are enabled, because some instrumentation slows query execution down, and some consumers can use a lot of memory.
To be fast and safe, all memory is statically allocated at config change so the memory resource usage of P_S is constant and no allocations are made during execution.</p>
<p>We can enable all instrumentation completely with this SQL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">setup_instruments</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">ENABLED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YES&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">TIMED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YES&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">494</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Rows</span><span class="w"> </span><span class="n">matched</span><span class="p">:</span><span class="w"> </span><span class="mi">1216</span><span class="w">  </span><span class="n">Changed</span><span class="p">:</span><span class="w"> </span><span class="mi">494</span><span class="w">  </span><span class="n">Warnings</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">setup_consumers</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">ENABLED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YES&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Rows</span><span class="w"> </span><span class="n">matched</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">  </span><span class="n">Changed</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="n">Warnings</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span></code></pre></div><p>When we look at one of these tables, for example <code>events_statements_current</code>, we see a structure like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">events_statements_current</span><span class="err">\</span><span class="k">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">Table</span><span class="p">:</span><span class="w"> </span><span class="n">events_statements_current</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Create</span><span class="w"> </span><span class="k">Table</span><span class="p">:</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">events_statements_current</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">THREAD_ID</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">EVENT_ID</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">END_EVENT_ID</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">EVENT_NAME</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="k">SOURCE</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">TIMER_START</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">TIMER_END</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">TIMER_WAIT</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">NESTING_EVENT_ID</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">NESTING_EVENT_TYPE</span><span class="o">`</span><span class="w"> </span><span class="n">enum</span><span class="p">(</span><span class="s1">&#39;TRANSACTION&#39;</span><span class="p">,</span><span class="s1">&#39;STATEMENT&#39;</span><span class="p">,</span><span class="s1">&#39;STAGE&#39;</span><span class="p">,</span><span class="s1">&#39;WAIT&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">NESTING_EVENT_LEVEL</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">STATEMENT_ID</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">THREAD_ID</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">EVENT_ID</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">PERFORMANCE_SCHEMA</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8mb4_0900_ai_ci</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>That is, events are tagged with a <code>THREAD_ID</code> (which is not a CONNECTION_ID() as seen in processlist), an <code>EVENT_ID/END_EVENT_ID</code> bracket, various source and timer values and for further dissection, a <code>NESTING_EVENT_ID</code> and <code>_TYPE</code>.</p>
<p>We can translate processlist ids into thread ids using the <code>P_S.THREADS</code> table, and then use this to limit our view on the <code>events_statements_current</code> table:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">threads</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">processlist_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection_id</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">        </span><span class="mi">50</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">timer_wait</span><span class="p">),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sql_text</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_statements_current</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="err">\</span><span class="k">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="n">thread_id</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="n">event_id</span><span class="p">:</span><span class="w"> </span><span class="mi">88463</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="n">event_name</span><span class="p">:</span><span class="w"> </span><span class="k">statement</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="k">source</span><span class="p">:</span><span class="w"> </span><span class="n">init_net_server_extension</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">94</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">timer_wait</span><span class="p">):</span><span class="w"> </span><span class="mi">341</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">us</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="n">sql_text</span><span class="p">:</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_name</span><span class="p">,</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">timer_wait</span><span class="p">),</span><span class="w"> </span><span class="n">sql_text</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_statements_current</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>So running this query took 341 Microseconds, or 0.341 ms.
And sources are named after their location in the server sourcecode, <a href="https://github.com/mysql/mysql-server/blob/8.0/sql/conn_handler/init_net_server_extension.cc#L94-L96" target="_blank" rel="noopener">filename and line number</a>

.</p>
<p>Events exist in a hierarchy: wait events nest within stage events, which nest within statement events, which nest within transaction events.
Some nested events refer to their own type, for example, statement events can point to other statement events they are nested in.
Other events refer to their enclosing context in the hierarchy.
Nesting Event ID, Type and Level make this clear.</p>
<h2 id="instrument-names">
    <a href="#instrument-names">
	Instrument names
    </a>
</h2>
<p>The manual explains <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-instrument-naming.html" target="_blank" rel="noopener">Instrument Names</a>

.
They have path-like names that group instruments hierarchically, for example <code>wait/io/file/innodb/innodb_data_file</code>.
This is a <code>wait</code> event, <code>io</code> related, specifically <code>file</code> I/O, more specific <code>innodb</code> and even more specific <code>innodb_data_file</code>.
Looking at other fields in the <code>events_waits_history</code> table, we would see the file name as part of the <code>OBJECT_SCHEMA.OBJECT_NAME</code> designator for this event.
That means, we can see how long we waited for I/O coming from this specific file or going to the file.</p>
<p>Further up in the nesting we would see, at the statement level, the actual <code>SQL_TEXT</code>, and also the number of rows scanned.
That means we can get a rough estimate why this particular statement instance was slow - for example, the plan was good, the number of rows was low, but we see a lot of actual file IO waits, so probably the buffer pool was cold.</p>
<p>The manual page above discusses the instrument names at length, and it is important to get an overview of what exists and what is measured.
Specifically, for statement level entries the instruments vary during query execution and become more detailed, as they reflect the progress in understanding of the server about the nature of the statement as it is executed.</p>
<h1 id="an-example-run">
    <a href="#an-example-run">
	An example run
    </a>
</h1>
<p>In a freshly restarted idle server, we log in to a shell and <code>use world</code> for the world sample database.
This is a tiny database, but because the server has been just restarted, nothing of it is cached.
We run a simple query:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">continent</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">copop</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">capital</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cipop</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">co</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ci</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">-&gt;</span><span class="w">   </span><span class="k">on</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">capital</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">id</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Europe&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-------------------------------+-----------+------------------------------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">continent</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">copop</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">capital</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">cipop</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-------------------------------+-----------+------------------------------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Europe</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Albania</span><span class="w">                       </span><span class="o">|</span><span class="w">   </span><span class="mi">3401200</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Tirana</span><span class="w">                             </span><span class="o">|</span><span class="w">  </span><span class="mi">270000</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">Europe</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Yugoslavia</span><span class="w">                    </span><span class="o">|</span><span class="w">  </span><span class="mi">10640000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Beograd</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="mi">1204000</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-------------------------------+-----------+------------------------------------+---------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">46</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>Now let&rsquo;s check what we can find out, using a second session:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">threads</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">processlist_db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="err">\</span><span class="k">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">THREAD_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">48</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">NAME</span><span class="p">:</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">one_connection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">TYPE</span><span class="p">:</span><span class="w"> </span><span class="n">FOREGROUND</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">PROCESSLIST_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">PROCESSLIST_USER</span><span class="p">:</span><span class="w"> </span><span class="n">msandbox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">PROCESSLIST_HOST</span><span class="p">:</span><span class="w"> </span><span class="n">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">PROCESSLIST_DB</span><span class="p">:</span><span class="w"> </span><span class="n">world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PROCESSLIST_COMMAND</span><span class="p">:</span><span class="w"> </span><span class="n">Sleep</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">PROCESSLIST_TIME</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">PROCESSLIST_STATE</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">PROCESSLIST_INFO</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">PARENT_THREAD_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">ROLE</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">INSTRUMENTED</span><span class="p">:</span><span class="w"> </span><span class="n">YES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">HISTORY</span><span class="p">:</span><span class="w"> </span><span class="n">YES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CONNECTION_TYPE</span><span class="p">:</span><span class="w"> </span><span class="n">Socket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">THREAD_OS_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">346752</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">RESOURCE_GROUP</span><span class="p">:</span><span class="w"> </span><span class="n">USR_default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>In our case we are only interested in the fact that our <code>thread/sql/one_connection</code> in the processlist is shown as connection <code>9</code>, but internally has a thread_id of <code>48</code>.
The Linux Operating System PID is <code>346752</code>.</p>
<p>We can use this to check <code>events_transactions_wait</code>, and find</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">state</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">timer_wait</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">timer</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nesting_event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nesting_event_type</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_transactions_history</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+-----------+-----------------+-----------+------------------+--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">source</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">timer</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">nesting_event_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">nesting_event_type</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+-----------+-----------------+-----------+------------------+--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">179</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">COMMITTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">handler</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">1328</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">496</span><span class="p">.</span><span class="mi">05</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">85</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">STATEMENT</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">401</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">COMMITTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">handler</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">1328</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">559</span><span class="p">.</span><span class="mi">99</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">278</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">STATEMENT</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5606</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">COMMITTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">handler</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">1328</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">03</span><span class="w"> </span><span class="n">ms</span><span class="w">   </span><span class="o">|</span><span class="w">             </span><span class="mi">5574</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">STATEMENT</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+-----------+-----------------+-----------+------------------+--------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>Why are there three statement events? We can check:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sql_text</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_statements_history</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="mi">278</span><span class="p">,</span><span class="w"> </span><span class="mi">5574</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sql_text</span><span class="w">                                                                                                                                                                                        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">85</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">databases</span><span class="w">                                                                                                                                                                                  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">278</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="w">                                                                                                                                                                                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5574</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">copop</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">capital</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cipop</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">co</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ci</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">capital</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Europe&#39;</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>The mysql command line client is running from the sandbox with <code>/home/kris/opt/mysql/8.0.25/bin/mysql --defaults-file=/home/kris/sandboxes/msb_8_0_25/my.sandbox.cnf world</code>.
Autocompletion for names is not disabled.
So on client startup, the client invisibly runs <code>show databases</code> to learn the names of all databases for autocompletion.
It then enters the <code>world</code> database as requested and runs <code>show tables</code> to learn the names of all tables in the <code>world</code> database.</p>
<p>Only then we come to the prompt and can paste our query.</p>
<p>We are only interested in <code>thread_id = 48 AND event_id = 5574</code>, our query.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_statements_history</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5574</span><span class="err">\</span><span class="k">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">THREAD_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">48</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">EVENT_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">5574</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="n">END_EVENT_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">6624</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">EVENT_NAME</span><span class="p">:</span><span class="w"> </span><span class="k">statement</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="k">SOURCE</span><span class="p">:</span><span class="w"> </span><span class="n">init_net_server_extension</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">94</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">TIMER_START</span><span class="p">:</span><span class="w"> </span><span class="mi">61628458852000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">TIMER_END</span><span class="p">:</span><span class="w"> </span><span class="mi">61631769329000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">TIMER_WAIT</span><span class="p">:</span><span class="w"> </span><span class="mi">3310477000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">LOCK_TIME</span><span class="p">:</span><span class="w"> </span><span class="mi">224000000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">SQL_TEXT</span><span class="p">:</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">copop</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">capital</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cipop</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">co</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ci</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">co</span><span class="p">.</span><span class="n">capital</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Europe&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="n">DIGEST</span><span class="p">:</span><span class="w"> </span><span class="mi">409</span><span class="n">c336982f0d3d45c4b29da77fe83aed12c6043e8ce9771c11ec82ff347e647</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">DIGEST_TEXT</span><span class="p">:</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">co</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">continent</span><span class="o">`</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">co</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">country</span><span class="o">`</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">co</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">population</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">copop</span><span class="o">`</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ci</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">capital</span><span class="o">`</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ci</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">population</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">cipop</span><span class="o">`</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">country</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">co</span><span class="o">`</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="o">`</span><span class="n">city</span><span class="o">`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">`</span><span class="n">ci</span><span class="o">`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="n">co</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">capital</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">ci</span><span class="o">`</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">continent</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">CURRENT_SCHEMA</span><span class="p">:</span><span class="w"> </span><span class="n">world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">OBJECT_TYPE</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">OBJECT_SCHEMA</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">OBJECT_NAME</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">OBJECT_INSTANCE_BEGIN</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">MYSQL_ERRNO</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">RETURNED_SQLSTATE</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">MESSAGE_TEXT</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="n">ERRORS</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">WARNINGS</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">ROWS_AFFECTED</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">ROWS_SENT</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">ROWS_EXAMINED</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CREATED_TMP_DISK_TABLES</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">CREATED_TMP_TABLES</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">SELECT_FULL_JOIN</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">SELECT_FULL_RANGE_JOIN</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="n">SELECT_RANGE</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">SELECT_RANGE_CHECK</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">SELECT_SCAN</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">SORT_MERGE_PASSES</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">SORT_RANGE</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">SORT_ROWS</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">SORT_SCAN</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">NO_INDEX_USED</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">NO_GOOD_INDEX_USED</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">NESTING_EVENT_ID</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">NESTING_EVENT_TYPE</span><span class="p">:</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NESTING_EVENT_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="n">STATEMENT_ID</span><span class="p">:</span><span class="w"> </span><span class="mi">125</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>The statement is <code>statement/sql/select</code>.
It took 3310477000 picoseconds (3.31ms) to run.
The <code>sql_text</code> is the full text of the statement (up to a cutoff point, in order to manage memory consumption).
The parsed statement is called <code>digest_text</code> - identifiers are quoted, whitespace is normalized, actual constants are replaced with placeholders, and (not shown here) variable length <code>WHERE ... IN (...)</code> clauses are shortened with ellipses.
This normalized digest is then hashed and produces an identifier for this group of identically formed statements, the <code>digest</code>.
We learn about the number of rows looked at, <code>92</code> and sent, <code>46</code>.
No special flags indicating specific execution modes were set.</p>
<p>We can use the <code>event_id</code> to look even deeper:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">timer_wait</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">timer</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_stages_history</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w">   </span><span class="k">and</span><span class="w"> </span><span class="n">nesting_event_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5574</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">event_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+--------------------------------------+----------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_name</span><span class="w">                           </span><span class="o">|</span><span class="w"> </span><span class="k">source</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">timer</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+--------------------------------------+----------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5610</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">optimizing</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">sql_optimizer</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">270</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">88</span><span class="w"> </span><span class="n">us</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5611</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="k">statistics</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">sql_optimizer</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">534</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">703</span><span class="p">.</span><span class="mi">58</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5710</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">preparing</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">sql_optimizer</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">618</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">31</span><span class="p">.</span><span class="mi">93</span><span class="w"> </span><span class="n">us</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">5712</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">executing</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">sql_union</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">1126</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">26</span><span class="w"> </span><span class="n">ms</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6593</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="k">end</span><span class="w">                        </span><span class="o">|</span><span class="w"> </span><span class="n">sql_select</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">586</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">86</span><span class="w"> </span><span class="n">us</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6594</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">query</span><span class="w"> </span><span class="k">end</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">sql_parse</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">4542</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">93</span><span class="w"> </span><span class="n">us</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6596</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">handler</span><span class="w"> </span><span class="k">commit</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">handler</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">1594</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">9</span><span class="p">.</span><span class="mi">05</span><span class="w"> </span><span class="n">us</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">closing</span><span class="w"> </span><span class="n">tables</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">sql_parse</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">4593</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">02</span><span class="w"> </span><span class="n">us</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6621</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">freeing</span><span class="w"> </span><span class="n">items</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">sql_parse</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">5042</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">29</span><span class="p">.</span><span class="mi">4</span><span class="w"> </span><span class="n">us</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6623</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">stage</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">cleaning</span><span class="w"> </span><span class="n">up</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">sql_parse</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">2252</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">17</span><span class="w"> </span><span class="n">us</span><span class="w">   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+--------------------------------------+----------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>These are the various execution stages of our statement - we select by <code>thread_id</code> and with the <code>event_id</code> of the statement, <code>5574</code> as a <code>nesting_id</code>, ordered by <code>event_id</code>.
Time was consumed by the <code>stage/sql/statistics</code> phase, looking up table stats for a good execution plan, and then by the actual query execution in <code>stage/sql/executing</code>.
The former took 0.7ms (703.58us), the latter 2.26ms.</p>
<p>We are interested in what took so long, specifically, so we look into waits for event_ids 5611 and 5712 - finding nothing, and also nothing particularly time-consuming:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">timer_wait</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">timer</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nesting_event_type</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nesting_event_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">operation</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">events_waits_history</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">event_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+------------------------------------------+-----------+--------------------+------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_name</span><span class="w">                               </span><span class="o">|</span><span class="w"> </span><span class="n">timer</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">nesting_event_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">nesting_event_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">operation</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+------------------------------------------+-----------+--------------------+------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6614</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">trx_mutex</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">56</span><span class="p">.</span><span class="mi">26</span><span class="w"> </span><span class="n">ns</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6615</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">trx_mutex</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">64</span><span class="w"> </span><span class="n">ns</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6616</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">trx_mutex</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">4</span><span class="w"> </span><span class="n">ns</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6617</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">trx_mutex</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">88</span><span class="w"> </span><span class="n">ns</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6618</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">trx_mutex</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">43</span><span class="p">.</span><span class="mi">36</span><span class="w"> </span><span class="n">ns</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6619</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">trx_mutex</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">45</span><span class="p">.</span><span class="mi">12</span><span class="w"> </span><span class="n">ns</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6620</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">LOCK_table_cache</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">66</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="n">ns</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6600</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6622</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">client_connection</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">18</span><span class="p">.</span><span class="mi">91</span><span class="w"> </span><span class="n">us</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6621</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">send</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6624</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">synch</span><span class="o">/</span><span class="n">mutex</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">THD</span><span class="p">::</span><span class="n">LOCK_thd_query</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">124</span><span class="p">.</span><span class="mi">23</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">              </span><span class="o">|</span><span class="w">             </span><span class="mi">6623</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">lock</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">6626</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wait</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">client_connection</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">WAIT</span><span class="w">               </span><span class="o">|</span><span class="w">             </span><span class="mi">6625</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">recv</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+----------+------------------------------------------+-----------+--------------------+------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>We can see I/O in a global summary, and the timings make sense in the context of the experiment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">object_type</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">object_schema</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">object_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">count_star</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">max_timer_read</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">read</span><span class="o">`</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">max_timer_write</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">write</span><span class="o">`</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">format_time</span><span class="p">(</span><span class="n">max_timer_fetch</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">fetch</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">table_io_waits_summary_by_table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">object_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="err">\</span><span class="k">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">object_type</span><span class="p">:</span><span class="w"> </span><span class="k">TABLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">object_schema</span><span class="p">:</span><span class="w"> </span><span class="n">world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">object_name</span><span class="p">:</span><span class="w"> </span><span class="n">city</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">count_star</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="k">read</span><span class="p">:</span><span class="w"> </span><span class="mi">569</span><span class="p">.</span><span class="mi">17</span><span class="w"> </span><span class="n">us</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">write</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">fetch</span><span class="p">:</span><span class="w"> </span><span class="mi">569</span><span class="p">.</span><span class="mi">17</span><span class="w"> </span><span class="n">us</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">***************************</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">object_type</span><span class="p">:</span><span class="w"> </span><span class="k">TABLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">object_schema</span><span class="p">:</span><span class="w"> </span><span class="n">world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">object_name</span><span class="p">:</span><span class="w"> </span><span class="n">country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">count_star</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="k">read</span><span class="p">:</span><span class="w"> </span><span class="mi">703</span><span class="p">.</span><span class="mi">4</span><span class="w"> </span><span class="n">us</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">write</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">fetch</span><span class="p">:</span><span class="w"> </span><span class="mi">703</span><span class="p">.</span><span class="mi">4</span><span class="w"> </span><span class="n">us</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span></code></pre></div><p>But why are the I/O times not visible to us?
That&rsquo;s a bit unclear.
My theory was that the reads happen asynchronously by some background thread.
But a quick query shows no time spend on reader threads.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">type</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">events_waits_summary_by_thread_by_event_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">e</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">thread_id</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">max_timer_wait</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;wait/io/file/innodb/innodb_data_file&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+---------------------------------------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">                                        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+---------------------------------------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">main</span><span class="w">                             </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">         </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">io_write_thread</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">io_write_thread</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">io_write_thread</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">12</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">io_write_thread</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">page_flush_coordinator_thread</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">33</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">clone_gtid_thread</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">BACKGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">47</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">one_connection</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="n">FOREGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">thread</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">one_connection</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="n">FOREGROUND</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+---------------------------------------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">9</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>We seem to be unable to attribute time spent loading data from disk to a specific thread, and we seem to be unable to account for the runtime of certain stages by looking at waits.
That&rsquo;s unexpected.</p>
<h1 id="memory-only-as-summary">
    <a href="#memory-only-as-summary">
	Memory only as summary
    </a>
</h1>
<p>Diverse <code>memory_%</code> tables exist to track memory usage in the server.
All of these tables are summary tables, there are no memory events tables that could trace memory usage per query.
That might be okay.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%memory%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">Tables_in_performance_schema</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="n">memory</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">memory_summary_by_account_by_event_name</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">memory_summary_by_host_by_event_name</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">memory_summary_by_thread_by_event_name</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">memory_summary_by_user_by_event_name</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">memory_summary_global_by_event_name</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>We can do interesting things with stuff such as <code>memory_summary_by_thread_by_event_name</code>, at least on our mostly idle server.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="w"> </span><span class="p">[</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8025</span><span class="p">]</span><span class="w"> </span><span class="err">{</span><span class="n">msandbox</span><span class="err">}</span><span class="w"> </span><span class="p">(</span><span class="n">performance_schema</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">event_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">count_alloc</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sum_number_of_bytes_alloc</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">high_number_of_bytes_used</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">memory_summary_by_thread_by_event_name</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w">   </span><span class="k">and</span><span class="w"> </span><span class="n">HIGH_NUMBER_OF_BYTES_USED</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">HIGH_NUMBER_OF_BYTES_USED</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-------------------------------+-------------+---------------------------+---------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">event_name</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">count_alloc</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sum_number_of_bytes_alloc</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">high_number_of_bytes_used</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-------------------------------+-------------+---------------------------+---------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">memory</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">THD</span><span class="p">::</span><span class="n">main_mem_root</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">1181008</span><span class="w"> </span><span class="o">|</span><span class="w">                    </span><span class="mi">613544</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">memory</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">memory</span><span class="w">          </span><span class="o">|</span><span class="w">         </span><span class="mi">226</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">1059368</span><span class="w"> </span><span class="o">|</span><span class="w">                    </span><span class="mi">250032</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">memory</span><span class="o">/</span><span class="k">sql</span><span class="o">/</span><span class="n">dd</span><span class="p">::</span><span class="n">objects</span><span class="w">        </span><span class="o">|</span><span class="w">         </span><span class="mi">205</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">47432</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">44648</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">memory</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">ha_innodb</span><span class="w">       </span><span class="o">|</span><span class="w">          </span><span class="mi">26</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">35784</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">35784</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">        </span><span class="mi">48</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">memory</span><span class="o">/</span><span class="n">innodb</span><span class="o">/</span><span class="n">fil0fil</span><span class="w">         </span><span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">65600</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="mi">32800</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">-----------+-------------------------------+-------------+---------------------------+---------------------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h1 id="no-explain">
    <a href="#no-explain">
	No EXPLAIN
    </a>
</h1>
<p>Another thing that would be useful to collect from P_S is the actual execution plan of a query.
But while we can explain a lot of statements by running <code>EXPLAIN &lt;stmt&gt;</code>, and while we can <code>EXPLAIN FOR CONNECT ...</code>, the former is not the recorded execution plan, and the latter only works while the query is running.
It&rsquo;s the actual execution plan while the query executes, but it is not recorded.</p>
<h1 id="summary">
    <a href="#summary">
	Summary
    </a>
</h1>
<p>A lot of information about query execution can be gathered from P_S.
The query execution can be broken down in statements, stages and waits.
Specifically, statements collect a lot of interesting quality flags.
Stages can collect percentages of completion for long-running queries and give a general feel about where in the query execution time is spent.
Waits should be able to attribute time to individual operations in the database server, but specifically for file I/O this seems to be more complicated, and I have not been able to solve it.</p>
<p>We can see waits for I/O summary tables, and we can see a lot of other statistical information in other summary tables.
We can also use additional tables not covered here for debugging (for example <code>DATA_LOCKS</code> for locking behavior).</p>
<p>Memory instrumentation is interesting, but at this stage it is unclear to me if it is sufficient.</p>
<p>It seems to be really hard to record execution plans together with statements.</p>
<p>More experimentation with more complicated queries is necessary to see if it is possible to see things like sorting, temp files and similar operations, and attribute time to these operations.</p>
<p>The number of queries on P_S necessary to extract information about a single query is staggering, a 10:1 ratio.
At least filters exist and are on by default, so that I do not have to hear my monitoring noise in my monitoring.
That is good.</p>
<p>I could really use a single large JSON blob containing the entire package with performance data for a query, at once - one query to trace one query.
That is, the information from transaction, statement, stages, waits, the execution plan and the memory consumption for a given transaction or statement, in one go.</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_en
				</a>
				
				<a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysql
				</a>
				
				<a href="/tags/#mysqldev" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysqldev
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2021-09-15-mysql-tracing-a-single-query-with-performanceschema.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/14/mysql-page-compression-revisited.html">MySQL: Page compression revisited</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2021/09/17/binding-the-orm.html">MySQL: Binding the ORM</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
