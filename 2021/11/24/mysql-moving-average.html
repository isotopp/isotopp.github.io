<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>MySQL: Moving Average | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="canonical" href="https://blog.koehntopp.info">


<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">




<meta name="generator" content="Hugo 0.104.3" />
<meta property="og:title" content='MySQL: Moving Average' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />


<meta property="og:locale" content="en_US" />


<meta name="description" content='' />
<meta property="og:description" content='' />

<link rel="canonical" href="https://blog.koehntopp.info" />
<meta property="og:url" content="https://blog.koehntopp.info" />


<meta property="og:type" content="article" />
<meta name="article:published_time" content='2021-11-24T22:28:27&#43;01:00' />



<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content='@isotopp' />
<meta name="twitter:creator" content='@isotopp' />
<meta property="twitter:title" content='MySQL: Moving Average' />
<meta property="twitter:description" content='' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />

<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebSite","description":null,"headline":"MySQL: Moving Average","image":"/assets/img/background/mysql.jpg","name":"Die wunderbare Welt von Isotopp","url":"https://blog.koehntopp.info"}
</script>

    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.731532d47a51fed497cc74301e50720b3c56d09404efc36b4fa1a4117a6aa10e.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            




<div class="page">
  <article class="mysql-moving-average-page">
    <div class='row  justify-content-center text-center my-4 mx-0'>
      <header>
        <div class='col'>
          <h1 class="title mb-lg-4 text-white">
            MySQL: Moving Average
          </h1>
          <div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
            <img alt='isotopp image' src='/assets/img/isotopp.jpg' class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
            <a href="https://twitter.com/isotopp" class='text-light text-decoration-none'>
                Kristian KÃ¶hntopp
            </a>

            
              <span class='d-none d-lg-inline'>-</span>
              <div class='d-block d-lg-inline'>November 24, 2021</div>
            

          </div>
        </div>
        
          <img alt='a featured image' src="/assets/img/background/mysql.jpg">
        
      </header>
    </div>

    <div class='row justify-content-center mx-0 mt-5 mb-5'>
      <div class='col-lg-8'>
        <p>MySQL window functions can be used to calculate daily averages or moving averages for a 24h time window relatively easily.
In an <a href="https://blog.koehntopp.info/2020/06/21/mysql-window-functions.html">earlier article</a>

 basic window functions were already discussed.
In this article, we want to see how we can get daily buckets and moving averages.</p>
<p>A sample program is available, as usual, <a href="https://github.com/isotopp/mysql-dev-examples/blob/master/mysql-rolling-window/rolling-window.py" target="_blank" rel="noopener">on GitHub</a>

.</p>
<h1 id="getting-sample-data">
    <a href="#getting-sample-data">
	Getting sample data
    </a>
</h1>
<p>We will be working with a data table named <code>data</code>, with three columns: a sensor <code>id</code>, a measurement datetime <code>d</code> and a metric value <code>m</code> that was sampled at that time.
The table definition looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Create a data table&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">setup_tables</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql_setup</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;drop table if exists data&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34; create table data (
</span></span></span><span class="line"><span class="cl"><span class="s2">                id integer not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">                d datetime not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">                m integer not null,
</span></span></span><span class="line"><span class="cl"><span class="s2">                primary key (id, d)
</span></span></span><span class="line"><span class="cl"><span class="s2">        )&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">sql_setup</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;setup_tables: failed </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>For one year, each day and for each of our 11 (0-10) sensors, 1001 values will be collected.
We insert a random time within the day, and a random measured value, an integer between 0 and 1000.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Fill data table with test data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&#34;--start&#34;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&#34;2020-01-01 00:00:00&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;Start date and time yyyy-mm-dd hh:mm:ss&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&#34;--end&#34;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&#34;2020-12-31 23:59:59&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;End date and time yyyy-mm-dd hh:mm:ss&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&#34;--count&#34;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;Number of values per day&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fill_table</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&#34;2020-01-01 00:00:00&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;2020-12-31 23:59:59&#34;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Get rid of the old data</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;truncate table data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">one_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># For one year, for each day:</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">today</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Date = </span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># For each measurement time:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># a random sensor id, a random second in the day, and a random metric</span>
</span></span><span class="line"><span class="cl">            <span class="nb">id</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">d</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">86399</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">m</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># are written to the database.</span>
</span></span><span class="line"><span class="cl">            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;insert into data (id, d, m) values (</span><span class="si">%(id)s</span><span class="s2">, </span><span class="si">%(d)s</span><span class="s2">, </span><span class="si">%(m)s</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># If the (id, time) combination is not unique, we get an error that we pass</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="s2">&#34;d&#34;</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&#34;m&#34;</span><span class="p">:</span> <span class="n">m</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># The Birthday Paradox in Action</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># print(e)</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># next day.</span>
</span></span><span class="line"><span class="cl">        <span class="n">today</span> <span class="o">+=</span> <span class="n">one_day</span>
</span></span></code></pre></div><h1 id="daily-buckets-with-group-by">
    <a href="#daily-buckets-with-group-by">
	Daily Buckets with GROUP BY
    </a>
</h1>
<p>Window Queries are somewhat related to aggregations with GROUP BY:
With GROUP BY we make look at each row under the lens of the GROUP BY statement.
All rows that have equal values as listed in the GROUP BY clause land on the same pile.
We can then apply aggregation functions to measure the pile.</p>
<p>In our example, we could use <code>GROUP BY date(d)</code>.
That is, our <code>datetime</code> is turned into a <code>date</code>, the time component is cut off.
Two values with the same date, but different times, are considered identical and would land on the same pile.
Different <code>id</code> values or different metric values <code>m</code> are also not used to select different piles.</p>
<p>What we do is <code>GROUP BY id, date(d)</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Group by day&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">daily_groups</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    select id
</span></span></span><span class="line"><span class="cl"><span class="s2">         , date(d) as d
</span></span></span><span class="line"><span class="cl"><span class="s2">         , count(m) as cnt
</span></span></span><span class="line"><span class="cl"><span class="s2">         , sum(m) as total
</span></span></span><span class="line"><span class="cl"><span class="s2">         , sum(m)/count(m) as av 
</span></span></span><span class="line"><span class="cl"><span class="s2">      from data 
</span></span></span><span class="line"><span class="cl"><span class="s2">    group by id, date(d)
</span></span></span><span class="line"><span class="cl"><span class="s2">    order by id, d
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;id: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">2d</span><span class="si">}</span><span class="s1"> date: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">  -  cnt: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;cnt&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">6d</span><span class="si">}</span><span class="s1"> sum: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> average: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;av&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>So two measurements from the same sensor-id and taken on the same date are put onto the same pile.</p>
<p>MySQL offers us a number of functions to measure the pile: <a href="https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html" target="_blank" rel="noopener">Aggregate Functions</a>

.
We can <code>COUNT()</code> the number of rows, we can <code>SUM()</code> them up, we can ask for their <code>AVG()</code>, <code>MIN()</code> or <code>MAX()</code>.
But we can also ask for the values themselves as a comma separated list, using <code>GROUP_CONCAT()</code>.
We can also ask for the values to be turned into JSON using <code>JSON_ARRAYAGG()</code> or <code>JSON_OBJECTAGG()</code>.</p>
<p>In our example above, we ask for the sum and the count and calculate the average ourselves.
The output looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ./rolling-window.py daily-groups <span class="p">|</span> head -5
</span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01  -  cnt:     80 sum: 418888 average: 5236.1000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-02  -  cnt:     92 sum: 419129 average: 4555.7500
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-03  -  cnt:     94 sum: 417583 average: 4442.3723
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-04  -  cnt:     94 sum: 422754 average: 4497.3830
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-05  -  cnt:    101 sum: 515639 average: 5105.3366
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">$</span> ./rolling-window.py daily-groups <span class="p">|</span> head -369 <span class="p">|</span> tail -5
</span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-30  -  cnt:     95 sum: 513361 average: 5403.8000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31  -  cnt:     94 sum: 480321 average: 5109.7979
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-01  -  cnt:     86 sum: 415058 average: 4826.2558
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-02  -  cnt:     93 sum: 443509 average: 4768.9140
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-03  -  cnt:     84 sum: 453897 average: 5403.5357
</span></span></span></code></pre></div><p>Since we aggregate and order by id first, we get all values from sensor 0 first, for an entire year.
Then the values for sensor id 1 follow, starting again at the beginning of the year.
Each row of output has values for one day, because we aggregated that way.</p>
<p>We can see how for each of the 10 sensors, approximately 90 values per day exist, but the actual value varies.
We can also see that the average is around 5000, but again, it varies each day.</p>
<h1 id="daily-partitions">
    <a href="#daily-partitions">
	Daily Partitions
    </a>
</h1>
<p>Window functions work just like aggregates, if we ask for that with a PARTITION BY clause.
But they will return all rows instead of making piles.
So when we define <code>WINDOW w AS ( partition by id, date(d) order by id, d)</code>, we will get our sensors by sensor and by date.
Each new sensor id, and each new date will restart &ldquo;data collection&rdquo;, that is, our sums or counts will be reset.</p>
<p>Our code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Partition by day&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">daily_partitions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    select id
</span></span></span><span class="line"><span class="cl"><span class="s2">         , d
</span></span></span><span class="line"><span class="cl"><span class="s2">         , count(m) over w as cnt
</span></span></span><span class="line"><span class="cl"><span class="s2">         , sum(m) over w as total
</span></span></span><span class="line"><span class="cl"><span class="s2">         , sum(m) over w/count(m) over w as av 
</span></span></span><span class="line"><span class="cl"><span class="s2">      from data
</span></span></span><span class="line"><span class="cl"><span class="s2">  window w as (
</span></span></span><span class="line"><span class="cl"><span class="s2">    partition by id, date(d)
</span></span></span><span class="line"><span class="cl"><span class="s2">    order by id, d)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;id: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">2d</span><span class="si">}</span><span class="s1"> date: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">  -  cnt: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;cnt&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">6d</span><span class="si">}</span><span class="s1"> sum: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> average: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;av&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>We can check the sums and counts, and see them be restarted:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ./rolling-window.py daily-partitions <span class="p">|</span> less
</span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 00:13:43  -  cnt:      1 sum: 6401 average: 6401.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 00:14:25  -  cnt:      2 sum: 15746 average: 7873.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 00:15:33  -  cnt:      3 sum: 19656 average: 6552.0000
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 23:09:13  -  cnt:     79 sum: 411728 average: 5211.7468
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 23:27:16  -  cnt:     80 sum: 418888 average: 5236.1000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-02 00:14:48  -  cnt:      1 sum: 5834 average: 5834.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-02 00:15:21  -  cnt:      2 sum: 10970 average: 5485.0000
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31 23:01:21  -  cnt:     92 sum: 475441 average: 5167.8370
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31 23:14:32  -  cnt:     93 sum: 475494 average: 5112.8387
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31 23:25:47  -  cnt:     94 sum: 480321 average: 5109.7979
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-01 00:24:46  -  cnt:      1 sum: 7079 average: 7079.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-01 00:32:22  -  cnt:      2 sum: 7989 average: 3994.5000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-01 01:01:40  -  cnt:      3 sum: 14551 average: 4850.3333
</span></span></span></code></pre></div><p>We can see how each time the day changes or the id changes the sum and count values start over.
Initially our count is 1, the sum is 6401 and the average is larger than 5000.
As we proceed through the day, we can see how the average converges against that expected value.</p>
<p>After <code>2020-01-01 23:27:16</code> at a count of <code>80</code> the new day starts and the counters reset.</p>
<p>The same happens at the end of the year, at <code>2020-01-01 23:27:16</code> when we start over at the first of January, but with id=1.</p>
<h1 id="moving-average">
    <a href="#moving-average">
	Moving average
    </a>
</h1>
<p>Instead of partitioning the data set by date boundaries we can also define a moving window instead.
This window is based on either values, or on date values.
In our case, we want the latter: for each metric date <code>d</code>, we want to do our math on the preceding 24 hours.</p>
<p>In code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@sql</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&#34;Sliding window query - 24h&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">daily_window</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    select id
</span></span></span><span class="line"><span class="cl"><span class="s2">         , d
</span></span></span><span class="line"><span class="cl"><span class="s2">         , count(m) over w as cnt
</span></span></span><span class="line"><span class="cl"><span class="s2">         , sum(m) over w as total
</span></span></span><span class="line"><span class="cl"><span class="s2">         , sum(m) over w/count(m) over w as av 
</span></span></span><span class="line"><span class="cl"><span class="s2">      from data
</span></span></span><span class="line"><span class="cl"><span class="s2">  window w as (order by d range between interval 1 day preceding and current row)
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;id: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">2d</span><span class="si">}</span><span class="s1"> date: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;d&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">  -  cnt: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;cnt&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">6d</span><span class="si">}</span><span class="s1"> sum: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> average: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;av&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>The Window clause is <code>WINDOW w AS (order by d range between interval 1 day preceding and current row)</code>.
As we can see, the <code>id</code> is out of the picture here:
We cannot nest window definitions, and that means in this example we count and sum over the previous 24h of <strong>all</strong> sensors, not sensors with the same id as ours.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">id:  6 date: 2020-01-01 00:03:44  -  cnt:      1 sum: 3420 average: 3420.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id: 10 date: 2020-01-01 00:07:50  -  cnt:      2 sum: 5359 average: 2679.5000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  5 date: 2020-01-01 00:08:35  -  cnt:      3 sum: 12441 average: 4147.0000
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-04 20:40:46  -  cnt:    998 sum: 4842406 average: 4852.1102
</span></span></span><span class="line"><span class="cl"><span class="go">id:  7 date: 2020-01-04 20:41:49  -  cnt:    998 sum: 4842673 average: 4852.3778
</span></span></span><span class="line"><span class="cl"><span class="go">id:  8 date: 2020-01-04 20:43:00  -  cnt:    997 sum: 4833426 average: 4847.9699
</span></span></span><span class="line"><span class="cl"><span class="go">id:  1 date: 2020-01-04 20:43:05  -  cnt:    998 sum: 4837433 average: 4847.1273
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">id:  7 date: 2020-12-31 23:54:52  -  cnt:   1003 sum: 5089623 average: 5074.3998
</span></span></span><span class="line"><span class="cl"><span class="go">id:  8 date: 2020-12-31 23:56:02  -  cnt:   1004 sum: 5092441 average: 5072.1524
</span></span></span><span class="line"><span class="cl"><span class="go">id:  8 date: 2020-12-31 23:59:56  -  cnt:   1000 sum: 5059683 average: 5059.6830````
</span></span></span></code></pre></div><p>From the changing <code>id</code> values we can see that all sensors are considered.
The count also shows that in the middle of the field around 1000 values are considered - the amount of values in one 24h range.</p>
<p>An expression such as <code>order by id, d range between interval 1 day preceding and current row</code> is not valid: we get</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">MySQLdb._exceptions.OperationalError: (3587, &#34;Window &#39;w&#39; with RANGE N PRECEDING/FOLLOWING frame requires exactly one ORDER BY expression, of numeric or temporal type&#34;)
</span></span></span></code></pre></div><p>We would have to ask for values from one sensor, specifically:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="o">/</span><span class="k">count</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">av</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">from</span><span class="w"> </span><span class="k">data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">day</span><span class="w"> </span><span class="n">preceding</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">row</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>and do that for each successive constant <code>id</code> value.
That is not fast nor elegant.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 00:13:43  -  cnt:      1 sum: 6401 average: 6401.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 00:14:25  -  cnt:      2 sum: 15746 average: 7873.0000
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-01-01 00:15:33  -  cnt:      3 sum: 19656 average: 6552.0000
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-04-01 02:48:29  -  cnt:     99 sum: 463956 average: 4686.4242
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-04-01 03:07:43  -  cnt:    100 sum: 472922 average: 4729.2200
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-04-01 03:15:23  -  cnt:    101 sum: 478127 average: 4733.9307
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31 23:01:21  -  cnt:     97 sum: 500889 average: 5163.8041
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31 23:14:32  -  cnt:     96 sum: 487287 average: 5075.9063
</span></span></span><span class="line"><span class="cl"><span class="go">id:  0 date: 2020-12-31 23:25:47  -  cnt:     97 sum: 492114 average: 5073.3402
</span></span></span></code></pre></div><p>We would have to wrap all that into a dependent subquery to loop.</p>

      </div>
    </div>

    
    
    <div class='row justify-content-center mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Share</span>
        <a href='https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.koehntopp.info%2f2021%2f11%2f24%2fmysql-moving-average.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#facebook'/></svg>
        </a>
        <a href='https://twitter.com/intent/tweet?source=https%3a%2f%2fblog.koehntopp.info%2f2021%2f11%2f24%2fmysql-moving-average.html&text=MySQL%3a%20Moving%20Average%20%7C%20Die+wunderbare+Welt+von+Isotopp:%20https%3a%2f%2fblog.koehntopp.info%2f2021%2f11%2f24%2fmysql-moving-average.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#twitter'/></svg>
        </a>
        <a href='http://www.reddit.com/submit?url=https%3a%2f%2fblog.koehntopp.info%2f2021%2f11%2f24%2fmysql-moving-average.html&title=MySQL%3a%20Moving%20Average' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>
        <a href='mailto:?subject=MySQL%3a%20Moving%20Average&body=https%3a%2f%2fblog.koehntopp.info%2f2021%2f11%2f24%2fmysql-moving-average.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope-fill'/></svg>
        </a>
      </div>
    </div>

    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
        
          <a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            lang_en
          </a>
        
          <a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            mysql
          </a>
        
          <a href="/tags/#mysqldev" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            mysqldev
          </a>
        
      </div>
    </div>

    <div class='row justify-content-center mb-5 pt-5 border-top mx-0'>
      <div class='col-lg-4 text-center text-lg-start'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Next Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2021/11/30/discord-nitro-spam-and-2fa.html">Discord Nitro Spam and 2FA</a>
          </div>
        
      </div>

      <div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Previous Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2021/11/22/arista-type-7-passwords.html">Arista Type 7 Passwords</a>
          </div>
        
      </div>
    </div>

    
    </article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff. 
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#rss-fill'/></svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope'/></svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#github'/></svg>
        </a>

        <a href='https://www.reddit.com/user/isotopp' title='Follow on Reddit' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>

        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#steam'/></svg>
        </a>

        <a href='https://twitter.com/isotopp' title='Follow on Twitter' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#twitter'/></svg>
        </a>

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#youtube'/></svg>
        </a>

      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
