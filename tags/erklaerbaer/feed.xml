<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Erklaerbaer on Die wunderbare Welt von Isotopp</title>
    <link>https://blog.koehntopp.info/tags/erklaerbaer.html</link>
    <description>Recent content in Erklaerbaer on Die wunderbare Welt von Isotopp</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 16 Jul 2024 14:27:18 +0000</lastBuildDate><atom:link href="https://blog.koehntopp.info/tags/erklaerbaer/feed.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Power (and Energy)</title>
      <link>https://blog.koehntopp.info/2024/07/16/energy.html</link>
      <pubDate>Tue, 16 Jul 2024 04:05:06 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/07/16/energy.html</guid>
      <description>&lt;p&gt;Let&amp;rsquo;s talk about power and household items.&lt;/p&gt;
&lt;p&gt;Power is measured in Watt (W).
1000 Watt make a Kilowatt (kW).&lt;/p&gt;
&lt;p&gt;Work (Energy) is power expended for an amount of time.
1000 Watt (a Kilowatt) used for one hour is a Kilowatt-hour (kWh).&lt;/p&gt;
&lt;p&gt;How much is a Watt?
In our graphics, a Watt is a single red pixel, right of the word cellphone
One Watt is what an iPhone uses when you are running Ice Cubes, scrolling social media.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Zoom into this image to see the pixel. It symbolizes 1 W.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;media-appliances&#34;&gt;
    &lt;a href=&#34;#media-appliances&#34;&gt;
	Media appliances
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;When you are using 5 W your cellphone gets hot.
It is the approximate maximum a device can use without having active cooling, a spinning fan.&lt;/p&gt;
&lt;p&gt;A device with an active cooler such as a Mac mini uses 5 W when used normally, and up to 25 W under load.
It can use up to 50 W.&lt;/p&gt;
&lt;p&gt;25 W is also what a typical cheap Intel laptop uses when idle.
For example, the Lenovo Yoga I once had.&lt;/p&gt;
&lt;p&gt;80 W is what a medium large TV uses in your living room. showing the news.&lt;/p&gt;
&lt;p&gt;80 W is also what my gaming machine uses, with a Ryzen CPU, an Nvidia 4070 and 64 GB of memory,
when idle showing steam and the Windows desktop.&lt;/p&gt;
&lt;p&gt;400 W is what my gaming machine uses when I play.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Typical household media consumption, Energy used. One pixel = one W.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;household-heat&#34;&gt;
    &lt;a href=&#34;#household-heat&#34;&gt;
	Household heat
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s walk over from the living room to the kitchen.
A lot of these household devices produce heat, for washing, drying or cooking.
At 10 Ampere, you get around 2300 W from 230 V. At 16 Ampere, 3680 W.&lt;/p&gt;
&lt;p&gt;Most of these heaters are very simple devices: They are fully on or completely off.
So we see a lot of devices that are using either full power or almost no power.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-09.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;A Wiesheu Minimat 43s, a professional baking oven of the kind that you find in gas stations or supermarkets.
It uses single phase normal power, 16A, so that still can fit into a normal household.
The device heats up, using 3000W, and then switches on and off to maintain temperature.
This pattern is typical for household appliances that produce process heat:
Ovens, cooking plates, washing machines, dryers.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Adding a 2000 W (10 A) and a 3000 W (16 A) household device.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;driving-and-charging-a-car&#34;&gt;
    &lt;a href=&#34;#driving-and-charging-a-car&#34;&gt;
	Driving and charging a car
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Many people now drive electrical cars.
Those that have the space often use a local charge-point that uses three-phase power at 16 A per phase to charge.
Three phases at 16 A and 230 V deliver 3 * 16 A * 230 V = 11000 W.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Adding the charge-point, 11000 W.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Over one hour, this uses 11 kWh of Energy.
A battery of 60 kWh that was at 10% is typically charged to 80%.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;scale&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; * &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.8-0.1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;42.0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; ./11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;3.8181
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Charging a car with a 60 kWh battery from 10% to 80% replaces 70% of the total battery capacity, 42 kWh.
At a charge rate of 11 kW, it takes 3.8 h to charge the car.
Since charging slows down as the battery fills up, it will take approximately 4 h to complete the charge.&lt;/p&gt;
&lt;p&gt;You could get a 3 phase, 32 A connection, for a 22 kW charge-point.
But the electricity company will charge you a lot more for that,
and it is kind of pointless.
Even a 100 kWh Tesla battery will charge from 10% to 80% in 6.5 h,
and you do not have to drive the battery to empty before you charge.&lt;/p&gt;
&lt;p&gt;In fact, if you charge every evening, just because you can, you are going to replace what you used up this day.
For 100 km, that is typically 20 kWh or less, so the car will be back at 80% after one or two hours.&lt;/p&gt;
&lt;p&gt;Don&amp;rsquo;t get a 22 kW charge-point, it is pointless.&lt;/p&gt;
&lt;p&gt;Many people want charge-points that can do surplus charging,
using only as much power as the solar array on their roof can provide.
Most charge-points can go from 3 phases to 1 phase, and from 16 A down to 6 A.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; * &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; * &lt;span class=&#34;m&#34;&gt;230&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;1380
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; * &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; * &lt;span class=&#34;m&#34;&gt;230&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;4140
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For a single phase, you can go down as low as 1380 W at 6 A.
For three-phase, you can go down as low as 4140 W at 6 A.
That is good for 5.5 kWh or 16.5 kWh on a sunny afternoon (4 h of time at 1.4 kW or 4.1 kW).&lt;/p&gt;
&lt;p&gt;With a proper charge controller, you could charge your electric car from the solar array of the house slowly,
but for free.
Even on somewhat cloudy days.&lt;/p&gt;
&lt;p&gt;When driving, that car (in my case, a Renault Megane e-Tech 60 kWh) straight on a flat Netherlands Autobahn,
the car consumes 15,000 W.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-05.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;If your car shows &amp;ldquo;15 kWh being used&amp;rdquo;,
it means that if you continued to drive this way for an hour, it would use 15 kWh of the battery.
It is actually using 15 kW, 15,000 W, right now.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Motors in electrical cars are not like motors in combustion engine cars.
They can use an almost infinite amount of energy for a short amount of time.
The current the battery can provide limits their output
(which is a function of the battery&amp;rsquo;s internal resistance).
Also limiting are the thickness of the wires,
and ultimately the amount of cooling we provide for the motor.&lt;/p&gt;
&lt;p&gt;So for a short time, the car can provide astronomical amounts of power.
The Renault Megane we used as an example further up can be
driven on the autobahn at 100 km/h with 15,000 W.
But it can consume 160,000 W (220 horsepower) for a short time to get away from the traffic light in a race.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-06.png&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-06.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Hitting a Megane on the head will use 160 kW, 220 hp. &lt;a href=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-06.png&#34;&gt;full size&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If you drove using that much energy for an hour, you&amp;rsquo;d use 160 kWh.
At 42 kWh of useful battery content from a 60 kWh battery,
with a discharge rate of 160 kW the 42 kWh will be drained in 16 minutes.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; 42/160
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;0.2625
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;42 kWh battery content, 160 kW used, so we will have that used up in 0.2625 h.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; 60*0.2625
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;15.75
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sixty minutes to the hour, so 0.2625 of an hour are 15.75 minutes.&lt;/p&gt;
&lt;p&gt;An electrical flow heater, dispensing water in a household, is using around 21 kW.&lt;/p&gt;
&lt;p&gt;A Tesla V4 fast charger will provide 250,000 W.&lt;/p&gt;
&lt;p&gt;A Porsche Taycan can provide 560 000 Watt (760 hp) for a short time.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-07.png&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-07.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Hitting a Porsche Taycan on the head will use 560 kW, 760 hp. &lt;a href=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-07.png&#34;&gt;full size&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;bonus-picture-being-dumb&#34;&gt;
    &lt;a href=&#34;#bonus-picture-being-dumb&#34;&gt;
	Bonus picture: Being dumb
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-08.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I am opening the deep freezer door to take out the chocolate ice cream, and I do not close the door properly.
The deep freezer goes into overdrive.
Since I am plotting the 1d average power, I can see how that affects the freezer:
Average goes up from 13 W to 19 W, peak from 35 W to 90 W.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;how-can-i-save-energy&#34;&gt;
    &lt;a href=&#34;#how-can-i-save-energy&#34;&gt;
	How can I save energy?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The numbers you see here are power, not energy.
They only become energy if you are using the power over longer amounts of time.&lt;/p&gt;
&lt;p&gt;Saving energy would mean to measure kWh, not kW, and then cut down on the kWh used.
Or even convert the household so that it generates kWh, i.e., by installing roof solar or balcony solar.&lt;/p&gt;
&lt;p&gt;Still, kW is often a good indicator:&lt;/p&gt;
&lt;p&gt;Driving 100 km in an electric car at 100 km/h uses 15 kWh.
Doing the same at 130 km/h uses 22 kWh.
Doing the same in a combustion engine car at 130 km/h uses 6l of diesel, 60 kWh of raw energy content.&lt;/p&gt;
&lt;p&gt;Washing machines, dryers, and dishwashers tend to use a lot of energy, but often only for an hour or so.
A modern washer uses around 1.3 kWh to wash 7 kg of clothing.&lt;/p&gt;
&lt;p&gt;Permanently running devices such as file-servers use a lot of energy because they are always on.
Multiply their power by 24 to get energy.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-10.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Running the washing machine used 1.3 kWh at 13:00.
But over the whole day, my desk and all the computers on it are using the most energy,
because the file server is running 24/7 at 100 W.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;All that energy use is completely dwarfed by driving.
Here is a day
that shows what happens when we charge the Megane e-Tech at the charge-point and the Carver S+ using a normal wall-plug.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-11.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Charging the Megane for 20 kWh and the Carver for 7 kWh. The rest of households power consumption is much smaller.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Is that bad?&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/energy-12.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;On that particular day, 2024-Jul-12, we produced 38.8 kWh of energy using the solar array on our roof.
We consumed 33.9 kWh.
Overall, we returned 4.92 kWh to the grid,
but we actually put 29.7 kWh into the grid and took 24.8 kWh out of the grid at other times.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This was a sunny day.
While we have been drawing almost 25 kWh from the grid (we use around 10 kWh on normal days),
we also fed almost 30 kWh into the grid, for a surplus of almost five kWh.
That is, despite the 2.5-fold higher power consumption than normal, we have provided a net power surplus to the grid.
We also pulled power from the grid around noon, when solar power is usually available in abundance,
and the hourly energy prices are lowest.&lt;/p&gt;
&lt;h1 id=&#34;tldr&#34;&gt;
    &lt;a href=&#34;#tldr&#34;&gt;
	TL;DR
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Find a way to
&lt;a href=&#34;https://www.amazon.de/dp/B0054PSIDW&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;measure power and energy consumption&lt;/a&gt;


so that you know and do not have to guess.
Collect and visualize that data using
&lt;a href=&#34;https://www.home-assistant.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Home Assistant&lt;/a&gt;


or similar.&lt;/p&gt;
&lt;p&gt;Media power consumption is meaningless in the grander scheme of things.&lt;/p&gt;
&lt;p&gt;Household heat matters.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Get rid of gas, get a heat pump.&lt;/li&gt;
&lt;li&gt;Cook electrically, not using gas.&lt;/li&gt;
&lt;li&gt;Make sure your household devices working with heat are state of the art:
&lt;ul&gt;
&lt;li&gt;Get a decent washing machine.&lt;/li&gt;
&lt;li&gt;Do not use a tumble dryer, dry on a clothes horse.&lt;/li&gt;
&lt;li&gt;Get a decent fridge/freezer combo. Make sure it is de-iced and efficient.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Watch out for always-on devices, but be sure to relate their energy use to the rest of the household&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Mobility matters even more than household heat: Driving uses way more energy than living in a place.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Work from home.&lt;/li&gt;
&lt;li&gt;When moving, do not use a car, use a bike. Or public transport.&lt;/li&gt;
&lt;li&gt;When using a car, use a small car. Weight matters.&lt;/li&gt;
&lt;li&gt;When using a car, drive energy efficiently: Going 130 km/h instead of 100 km/h uses 50% more energy.&lt;/li&gt;
&lt;li&gt;If you have to use a car, get rid of a combustion engine car, drive an electric car.
It uses 1/3 the energy of a combustion engine car.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Make energy.
Cover every surface in solar cells.&lt;/p&gt;
&lt;p&gt;Store energy.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Get a battery that can provide enough power for your household.
Power (Watt) is often a function of the cell count.
Cells also provide capacity, so larger batteries (more kWh) also provide more power (kW) up to a limit (11 kW).
When planning, check both numbers, kW and kWh.&lt;/li&gt;
&lt;li&gt;To get a household to self-sufficiency, surprisingly small batteries are needed.
The minimum of either half the daily power consumption
and the production in a day in March or October should be enough.
You may want more, but that is because of power, not energy content.&lt;/li&gt;
&lt;li&gt;In any case, ~10 kWh LFP should be fine for most households.
Having more than you can fill on an early spring/late autumn day is useless, and you won&amp;rsquo;t fill it Nov – Feb anyway.
Having giant capacities in summer is useless, because you won&amp;rsquo;t empty the battery.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Practice</title>
      <link>https://blog.koehntopp.info/2024/07/01/practice.html</link>
      <pubDate>Mon, 01 Jul 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/07/01/practice.html</guid>
      <description>&lt;p&gt;Some things come to me very slowly and painfully.
In this particular case, it’s because I’ve been immersed in an environment where a certain type of activity,
&lt;em&gt;Practice Building&lt;/em&gt;, was done implicitly by everyone around me.
The environment itself facilitated this implicitly as well.&lt;/p&gt;
&lt;p&gt;When I entered a new environment where this practice was not performed and the means to facilitate it were not present,
it became really hard to communicate what was missing.&lt;/p&gt;
&lt;h1 id=&#34;the-technology-radar&#34;&gt;
    &lt;a href=&#34;#the-technology-radar&#34;&gt;
	The Technology Radar
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;In an old work environment, a manager was tasked with or had the idea to implement a &amp;ldquo;Technology Radar.&amp;rdquo;
A
&amp;ldquo;&lt;a href=&#34;https://www.thoughtworks.com/insights/blog/technology-strategy/how-to-create-your-enterprise-technology-radar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Technology Radar&lt;/a&gt;

&amp;rdquo;
is a process where companies organize the &amp;ldquo;things they use&amp;rdquo; into arbitrary quadrants that make sense to them.
For IT, &amp;ldquo;techniques,&amp;rdquo; &amp;ldquo;tools,&amp;rdquo; &amp;ldquo;platforms,&amp;rdquo; and &amp;ldquo;languages and frameworks&amp;rdquo;
seem to be popular but somewhat useless for hierarchical searching.
On the other hand, it produces nicer graphics than a &amp;ldquo;Dewey Decimal System for Tech&amp;rdquo; graphed out,
even if the latter would be systematically more useful to build structure and visualize relationships and alternatives.&lt;/p&gt;
&lt;p&gt;To create a &amp;ldquo;radar-like&amp;rdquo; appearance, the &amp;ldquo;things we use&amp;rdquo; are then assigned one of four statuses,
from the inside out: &amp;ldquo;adopt,&amp;rdquo; &amp;ldquo;trial,&amp;rdquo; &amp;ldquo;assess,&amp;rdquo; and &amp;ldquo;hold.&amp;rdquo;
What these mean is usually not well understood and often contested.
Actually,
75% of the time in the panel discussions for a Tech Radar is wasted
because people don&amp;rsquo;t understand what these statuses are supposed
to mean or the consequence of assigning a status to a tech.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.thoughtworks.com/insights/blog/technology-strategy/how-to-create-your-enterprise-technology-radar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/07/practice-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;What a Tech Radar looks like.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The statuses could be &amp;ldquo;test this and tell us,&amp;rdquo; &amp;ldquo;immature but shiny,&amp;rdquo;
&amp;ldquo;tried and tested,&amp;rdquo; &amp;ldquo;actually no, but some of us need it,&amp;rdquo; and &amp;ldquo;hell no.&amp;rdquo;
But that is not what we got, hence the discussions.&lt;/p&gt;
&lt;p&gt;It matters not.
You could repair the Tech Radar,
but it would still not be the thing that is needed, but a weak simulation of what is actually required.&lt;/p&gt;
&lt;p&gt;Because the other thing that comes to light as part of the technology radar is that people want more:
To understand how a certain technology fits into the company, they do not only need a recommendation,
they also need context, recommendations, and best practices, and ultimately
&lt;a href=&#34;https://blog.koehntopp.info/2022/04/15/sql-engineering-guidelines.html&#34;&gt;an engineering guide&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;The question is,
what process builds such context, recommendations, and practices,
and what is needed as a precondition for such a process.&lt;/p&gt;
&lt;h1 id=&#34;a-catalog-of-skills-and-expertise&#34;&gt;
    &lt;a href=&#34;#a-catalog-of-skills-and-expertise&#34;&gt;
	A catalog of skills and expertise
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Another thing that happens in almost any company is
that somebody comes up with the brilliant idea
of asking people about the things they are good at and to assess themselves in these areas.
You know, like a LinkedIn résumé or skill catalog.&lt;/p&gt;
&lt;p&gt;And then you end up with a database of expertise that is not only incomplete for each individual
but also never updated and ultimately useless because people do not use it.
They do not trust it.
And they are right.&lt;/p&gt;
&lt;p&gt;Expertise is not cataloged and not stored in a database.
It is demonstrated.
Because that is what builds trust.
Someone demonstrating to all who care that they are actually right more often than others.
Or even better, when they are wrong, it is less painful than when others are wrong.
These are not the same thing, and in reality, the latter is more important than the former in most cases.&lt;/p&gt;
&lt;p&gt;So how do you demonstrate expertise publicly?
And what does this have to do with a process that builds practices and documents them?&lt;/p&gt;
&lt;h1 id=&#34;practice&#34;&gt;
    &lt;a href=&#34;#practice&#34;&gt;
	Practice
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Good companies have places.&lt;/p&gt;
&lt;p&gt;A place is a communications platform where people can talk to each other with two important properties:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It is findable with keywords or through an ontology.&lt;/li&gt;
&lt;li&gt;People can join it without being invited.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If it is private, unfindable, and you need to be invited, you have groups.
Groups suck; they isolate.
You want places.&lt;/p&gt;
&lt;p&gt;I have written about
&lt;a href=&#34;https://blog.koehntopp.info/2022/10/12/groups-and-places.html&#34;&gt;important properties of chats&lt;/a&gt;


elsewhere at length.&lt;/p&gt;
&lt;p&gt;If you have places,
people will make the places they need
and then self-organize there to talk about the things they do and how they are doing this.
At least if you give them the time to do this and if you ensure
&lt;a href=&#34;https://hbr.org/2023/02/what-is-psychological-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pychological safety&lt;/a&gt;

.
That is,
if you allow them to talk in this place in a way that allows face-saving and comfortable learning experiences,
compromise finding, and civilized disagreement.&lt;/p&gt;
&lt;p&gt;Places then also become locations where people give (tech) support as a public performance.
This is important for many reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;People realize that things they take as a given are actually a valid bug.&lt;/li&gt;
&lt;li&gt;It&amp;rsquo;s down for everyone, not just for me.&lt;/li&gt;
&lt;li&gt;These people have the problem I have solved, and I can tell them how.&lt;/li&gt;
&lt;li&gt;Other people see our discussion, and while our solution is valid, it is not actually the supported best practice.&lt;/li&gt;
&lt;li&gt;These guys are using our tool, but for a purpose we haven&amp;rsquo;t anticipated.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All of these things are visible only with support as a public performance.
If you pull these things into Jira tickets, none of this would happen, and the company would be left poorer.
I have written about
&lt;a href=&#34;https://blog.koehntopp.info/2024/04/17/support-as-a-public-performance.html&#34;&gt;support as a public performance&lt;/a&gt;


elsewhere at length.&lt;/p&gt;
&lt;p&gt;Of course, chat is not a good medium for support.&lt;/p&gt;
&lt;p&gt;If you do support in a chat, you would want a chat with good threads and encourage people to open a thread per problem.&lt;/p&gt;
&lt;p&gt;You would also need a bot that can turn a thread into a Jira ticket,
either after the fact in order to get tracing data out of the threads,
or if it turns out that the support case results in a work item that cannot be resolved immediately.&lt;/p&gt;
&lt;p&gt;You also want somebody whose job is technical
and whose job grade enables them to lift their gaze from the path to the horizon to go over the chat.
They would start interventions when they see questions that are unanswered or answered &amp;ldquo;wrongly.&amp;rdquo;
And by &amp;ldquo;wrong,&amp;rdquo;
I mostly mean cases where it is obvious to them
that the answer is either not efficient or not applicable to the problem.&lt;/p&gt;
&lt;p&gt;That person would also choose support cases of the week and by Friday morning produce a write-up.
It may be a blog article or a &amp;ldquo;medium.com&amp;rdquo; style write-up about anything that happened and is interesting.
If by Friday noon it is online,
all the people who spend Friday afternoon on their self-education will read it and possibly comment.
Using the articles and the comments,
that person can then take the output of all that discussion and update the engineering guide.&lt;/p&gt;
&lt;p&gt;And the Engineering Guide is the deliverable that picks up where the Technology Radar drops off,
telling people not only what a product is good for,
but also how to use it efficiently and what specific local practices our tribe has developed
in order to make it a supportable use case.&lt;/p&gt;
&lt;p&gt;So look at your company:
How does your organization build practice?
How do practitioners meet?&lt;/p&gt;
&lt;h1 id=&#34;see-also&#34;&gt;
    &lt;a href=&#34;#see-also&#34;&gt;
	See also
    &lt;/a&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2020/06/15/pizza-people-projects-and-processes.html&#34;&gt;Pizza, People, Projects and Processes (2018)&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2022/04/15/sql-engineering-guidelines.html&#34;&gt;Example: SQL Engineering Guidelines&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2022/10/12/groups-and-places.html&#34;&gt;Properties of Chat Systems: Groups and Places&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2024/04/17/support-as-a-public-performance.html&#34;&gt;Support as a public performance&lt;/a&gt;

&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>No LLM for you, come back one year</title>
      <link>https://blog.koehntopp.info/2024/06/22/no-llm-for-you-come-back-one-year.html</link>
      <pubDate>Sat, 22 Jun 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/22/no-llm-for-you-come-back-one-year.html</guid>
      <description>&lt;p&gt;Es war Samstag, ich las die Nachrichten und ich mußte dazu was im Fedi sagen.
Hier ist der Aufschrieb davon:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=RqlQYBcsq54&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;No Soup for you!&lt;/a&gt;

 ist, was Apple der EU sagt:
&lt;a href=&#34;https://www.heise.de/news/Apple-verweist-auf-neue-Regeln-vorerst-keine-Apple-Intelligence-fuer-EU-iPhones-9774039.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apple vs. EU: Apple Intelligence soll vorerst nicht nach Deutschland kommen&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Aufgrund &amp;ldquo;regulatorischer Unsicherheiten&amp;rdquo; durch den Digital Markets Act (DMA) gehe das Unternehmen davon aus,
bestimmte Funktionen in diesem Jahr nicht mehr für Kunden in Deutschland
und anderen EU-Mitgliedsstaaten einführen zu können,
wie Apple am Freitagabend überraschend in einer Stellungnahme mitteilte.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Dieser Seitenhieb auf den Marktregulator ist amüsant,
aber Apple könnte &amp;ldquo;Apple Intelligence&amp;rdquo; nicht weltweit zeitgleich einführen, selbst wenn Apple das wollte.&lt;/p&gt;
&lt;h1 id=&#34;keine-apple-intelligence-in-der-eu&#34;&gt;
    &lt;a href=&#34;#keine-apple-intelligence-in-der-eu&#34;&gt;
	Keine Apple Intelligence in der EU
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Der wahre Grund ist: Die Features sind unfertig.
Normalerweise liefern iOS Betaversionen relativ vollständige Blicke auf das Release,
alle Features sind vorhanden und funktionieren modulo noch existierende Fehler auf eine Weise,
wie man sie im Produkt-Release später erwarten können wird.
&lt;a href=&#34;https://www.lifewire.com/apple-betas-missing-cool-features-8662016&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;In der iOS 18 Beta ist das nicht der Fall.&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;But this year, there&amp;rsquo;s less incentive to hop on early because none of the AI tools are there,
and those are surely the features people most want to try out.
The Apple Intelligence features, like better Siri, won&amp;rsquo;t be arriving until later,
perhaps not until after the OS updates have actually launched in the fall.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Das ist einerseits so, weil diese Features nicht auf eine Weise funktionieren können,
dass sie Apples Ansprüchen an Qualität genügen.
&lt;a href=&#34;https://techinformed.com/mcdonalds-ditches-ai-order-system-after-bacon-ice-cream-mix-up/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;McDonalds hat das schon mal ausprobiert.&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In one TikTok video –
posted with the caption “Fighting with McDonald’s robot” –
a woman is seen struggling to order vanilla ice cream and a bottle of water,
and instead ends up with multiple sundaes, ketchup sachets, and two portions of butter.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nun war das keine Apple-KI, aber diese Sorte Problem ist systematisch die Sorte Fehler, die LLMs machen,
und es gibt keinen Grund, warum es bei Apple besser sein sollte.&lt;/p&gt;
&lt;p&gt;Und das ist nur die oberste Lage Probleme.
Ein wichtiger Werbepunkt von Apple ist, dass die KI-Features &amp;ldquo;on device&amp;rdquo; laufen, statt Daten in eine Cloud zu pumpen.
Das geht auch nicht, jedenfalls nicht so, wie der Kunde es erwartet.&lt;/p&gt;
&lt;p&gt;Der aktuelle KI-Hype basiert auf LLMs,
einer besonderen Art neuronaler Netze, die unter anderem Milliarden von &amp;ldquo;Parametern&amp;rdquo; brauchen.
Das sind Haufen von Zahlen, die als Vektoren mit tausenden Dimensionen angeordnet &amp;ldquo;Wissen codieren&amp;rdquo;
und in der Berechnung von Antworten auf Benutzeranfragen verwendet werden.&lt;/p&gt;
&lt;p&gt;Nun, jeder dieser Vektoren braucht eine gewisse Menge Speicherplatz und wenn man &amp;ldquo;Milliarden von Parametern&amp;rdquo; haben will,
dann braucht man schnell auch einmal zweistellige Mengen an Gigabyte RAM zum Ausrechnen der Antwort.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Auswahl von Größenangaben beliebter öffentlicher LLMs.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Standardversion von Metas llama3 mit 70 Milliarden Parametern und 40 GB Größe.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Ein Modell mit 8 Milliarden Parametern braucht ca. 5 GB RAM, ein Modell mit 14 Milliarden Parametern ca. 8 GB,
und ein Modell mit 70 Milliarden Parametern je nach Quantisierung zwischen 26 GB und 40 GB.&lt;/p&gt;
&lt;p&gt;Dazu kommt noch einmal Speicher für den Kontext,
der bei großen Kontext-Definitionen schnell noch einmal die Größenordnung des Modells erreicht.&lt;/p&gt;
&lt;p&gt;Apple selbst dokumentiert in
&lt;a href=&#34;https://machinelearning.apple.com/research/introducing-apple-foundation-models&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Introducing Apple’s On-Device and Server Foundation Models&lt;/a&gt;


wann sie Modelle lokal rechnen:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In the following overview, we will detail how two of these models — a ~3 billion parameter on-device language model,
and a larger server-based language model available with Private Cloud Compute and running on Apple Silicon servers —
have been built and adapted to perform specialized tasks efficiently, accurately, and responsibly.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ein Modell mit 3 Milliarden Parametern wie &lt;a href=&#34;https://ollama.com/library/phi3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Phi3&lt;/a&gt;

 belegt circa 2.5 GB Speicher und
das ist in der Tat eine Größe, die auf einem iPhone mit 6 GB RAM ausgeführt werden kann.
Größere Modelle passen schlicht nicht in den Speicher und werden daher in der Cloud berechnet.&lt;/p&gt;
&lt;p&gt;Die Qualität und Komplexität der Antworten eines LLM ist aber sehr stark von der Anzahl der Parameter des Modells abhängig.
Ein 3b-Modell kann schlicht nicht mit einem 70b- oder gar noch größeren Modellen mithalten.
Das ist aber das, was Benutzer von Online-GPTs wie ChatGPT gewohnt sind.&lt;/p&gt;
&lt;p&gt;Es ist also eher davon auszugehen,
dass wenig Inferenz (das Ausrechnen von Antworten mit einem austrainierten LLM) &amp;ldquo;on device&amp;rdquo; geht,
und viel in die Cloud ausgelagert wird.
Die Rechenzentren dazu gibt es noch nicht, und das Bauen von Rechenzentren dauert in der Regel einige Zeit.
Wir können davon ausgehen, dass die Vorlaufzeit circa 2 Jahre beträgt:
Das Rechenzentrum wird vermutlich sehr uniform bestückt sein, was die Planung vereinfacht.
Die Energiedichte wird sehr hoch sein, und die Hardware wird schwer zu beschaffen sein, was die Planung verkompliziert.&lt;/p&gt;
&lt;p&gt;Die Hardware, die in dieses Rechenzentrum herein kann, wird derzeit meist von Nvidia hergestellt.
Wer Apple kennt, der weiß, wie sehr es die Firma schmerzt, einer Firma wie Nvidia Geld zu geben.
Viel lieber würde Apple den Kram auf eigenen, selbst entworfenen, auf Inferenz spezialisierten Chip laufen lassen.
Auch diese existieren nicht und es würde jedermann überraschen,
wenn es solche Chips vor 2026 gäbe (oder nach 2028 noch nicht gäbe).&lt;/p&gt;
&lt;p&gt;Wir können an dieser Stelle vermutlich glaubhaft herleiten,
dass &amp;ldquo;Apple Intelligence&amp;rdquo; zu diesem Zeitpunkt lediglich lanciert wird, um den Kurs von AAPL zu stabilisieren.
Aber natürlich ist es billig, da noch einmal FOMO gegenüber Kunden in Europa zu pflegen und die EU zu dissen.&lt;/p&gt;
&lt;h1 id=&#34;warum-die-hardware-und-warum-so-viel-speicher&#34;&gt;
    &lt;a href=&#34;#warum-die-hardware-und-warum-so-viel-speicher&#34;&gt;
	Warum die Hardware und warum so viel Speicher?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Die lineare Algebra in Computerspielen und die Mathematik in LLMs sind zum Großteil Matrix-Multiplikationen.
Daher werden Grafikkarten, superschnelle Matrix-Multiplizierer, vielfach für LLMs &amp;ldquo;mißbraucht&amp;rdquo;.
Sie implementieren die benötigte Operation sehr flink, in Hardware und parallel ausführbar.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-P28LKWTzrI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-P28LKWTzrI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nvidia Werbevideo mit den Mythbusters&lt;/a&gt;

,
das die Parallelität von Grafikkarten korrekt veranschaulicht.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Mythbusters haben die Wirkmächtigkeit der parallelen Ausführung für ein Nvidia Werbevideo einmal korrekt visualisiert.&lt;/p&gt;
&lt;p&gt;Zur Geschichte und dem Aufbau von Grafikkarten habe ich vor sieben Jahren einen Link-Artikel geschrieben:
&lt;a href=&#34;https://blog.koehntopp.info/2017/11/25/d-abc-at-scale.html&#34;&gt;d = a*b+c at scale&lt;/a&gt;

,
der die Entwicklung von Grafik-Hardware in den 20 Jahren vor 2017 beschreibt,
weil ich beruflich Anlass hatte, das herauszufinden.
Es ist ein Link-Artikel, ihr müßt die blauen Dinger auch anklicken.&lt;/p&gt;
&lt;p&gt;Wikipedia erklärt
&lt;a href=&#34;https://de.wikipedia.org/wiki/Matrizenmultiplikation#Beispiel&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matrix-Multiplikation als superlange Summe von Produkten&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Relevanter Auszug aus der Wikipedia, der Matrix-Multiplikation erläutert.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wir berechnen die Position Zeile 1, Spalte 2 der Ergebnis-Matrix
also durch Multiplikation des Zeilenvektors 1 der Matrix A
mit dem Spaltenvektor 2 der Matrix B,
sodass sich im Beispiel&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(3, 2, 1) * (2, 1, 0) = (3*2 + 2*1 + 1*0) = 8
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ergibt. In &lt;code&gt;d = a*b + c&lt;/code&gt; ist die Zwischensumme &lt;code&gt;c&lt;/code&gt; zunächst 0, und es wird &lt;code&gt;3*2&lt;/code&gt; berechnet.
Das Ergebnis, &lt;code&gt;d = 6&lt;/code&gt; wird im nächsten Schritt als &lt;code&gt;c&lt;/code&gt; verwendet, sodass wir &lt;code&gt;d = 2*1 + 6&lt;/code&gt; erhalten.
Im letzten Schritt wird dies wieder als &lt;code&gt;c&lt;/code&gt; verwendet, sodass wir das Endergebnis &lt;code&gt;d = 1*0 + 8&lt;/code&gt; bekommen.&lt;/p&gt;
&lt;p&gt;Grafikkarten haben spezielle Hardware, die mit einer bestimmten Hardware-Darstellung von Zahlen solche Berechnungen
auf rechteckigen Zahlenfeldern beliebige Größe parallel durchführen können.
&amp;ldquo;NPUs&amp;rdquo;, Neuralprozessoren, tun genau dasselbe.&lt;/p&gt;
&lt;p&gt;In dem Unterrichtsabschnitt &amp;ldquo;Vektor- und Matrizenrechnung&amp;rdquo; in der Schule,
oder gar in &amp;ldquo;Lineare Algebra und Vektorräume&amp;rdquo; an der Uni aufgepasst zu haben zahlt sich also jetzt,
30 Jahre später, groß aus.
Aber keine Angst, es hat sich nichts getan, die Mathematik ist immer noch dieselbe wie damals in der Schule,
und es ist nichts Fieseres dabei als Summen von Produkten: Plus und Malnehmen, komplizierter wird&amp;rsquo;s nicht.&lt;/p&gt;
&lt;h1 id=&#34;ki-und-grafikkarten-laufen-auseinander&#34;&gt;
    &lt;a href=&#34;#ki-und-grafikkarten-laufen-auseinander&#34;&gt;
	KI und Grafikkarten laufen auseinander
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Aber die Matrix-Multiplikation in einer NPU und in einer Grafikkarte laufen langsam auseinander.
Das hat aber nichts mit der Mathematik zu tun, sondern mit der Darstellung von Zahlen.&lt;/p&gt;
&lt;p&gt;Wir können uns einmal Fließkommazahlen im Computer angucken:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://float.exposed/0x400921fb4d12d84a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;3.1415926 als Double (64 Bit)&lt;/a&gt;

:
Stellt man eine beliebte Näherung der Zahl Pi als &lt;code&gt;double&lt;/code&gt; dar, bekommt man dies:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Bit Vorzeichen&lt;/li&gt;
&lt;li&gt;10 Bit Exponenten&lt;/li&gt;
&lt;li&gt;53 Bit &amp;ldquo;Mantisse&amp;rdquo; oder &amp;ldquo;Significand&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;und die Zahl ist nicht der gewünschte Wert, sondern der dichteste Wert, der dargestellt werden kann:
3.14159260000000006841.&lt;/p&gt;
&lt;p&gt;Das ist einen Tick zu groß.
Klickt man den &amp;ldquo;Significand&amp;rdquo; jetzt ein Bit kleiner, bekommt man
&lt;a href=&#34;https://float.exposed/0x400921fb4d12d849&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;3.14159259999999962432&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Das ist das Kreuz mit &lt;em&gt;diskreter Mathematik&lt;/em&gt;: Zwischen den Zahlen,
die wir darstellen können liegen unendlich viele Zahlen, die existieren,
aber nicht diskret in der gewählten Auflösung darstellbar sind.&lt;/p&gt;
&lt;p&gt;In der diskreten Mathematik gibt es eine Schrittweite zwischen zwei darstellbaren Fließkommazahlen.
Diese nennt man &amp;ldquo;eps&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;epsilon&amp;rdquo; ist in der Analysis (eine Disziplin der Mathematik) ein unendlich kleiner Schritt.
In der diskreten Mathematik, also der Mathematik, die sich mit Zahlen in Computern befasst,
gibt es keine unendlich kleinen Schritte.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;eps&amp;rdquo; ist der Schritt, den ein Bit macht.
Bei Fließkommazahlen ist &amp;ldquo;eps&amp;rdquo; variabel, denn es wird mit dem anderen Teil der Fließkommazahl, dem Exponenten skaliert.
Zahlen um 0 herum können sehr genau dargestellt werden,
aber je weiter man von 0 weg kommt, umso größer wird der Exponent und umso größer wird eps.&lt;/p&gt;
&lt;p&gt;In KI-Mathematik normalisieren wir Zahlen oft auf das Intervall von 0 bis 1
oder von -1 bis 1.
Wir brauchen also nicht so große Exponenten und können mit weniger Bits auskommen.&lt;/p&gt;
&lt;p&gt;Das ist wichtig, denn wenn wir von &lt;code&gt;double&lt;/code&gt; auf &lt;code&gt;float&lt;/code&gt; heruntergehen,
dann gehen wir von 64 Bit pro Zahl auf 32 Bit runter – doppelt so viel Modell im selben Speicher!
Ein 32-Bit &lt;code&gt;float&lt;/code&gt; hat bei Werten um Zehntausend herum schon ein eps von 0.01 (bei 10k Euro ein eps von 1 cent).&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://float.exposed/0x461c400a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;10000.009765625&lt;/a&gt;

 als &lt;code&gt;float&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Aber für Werte zwischen 0 und 1 sieht es gut aus:
&lt;a href=&#34;https://float.exposed/0x3f000000&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;0.5&lt;/a&gt;

 und am Significand spielen.&lt;/p&gt;
&lt;p&gt;Wir können auch noch weiter heruntergehen:
&lt;a href=&#34;https://float.exposed/b0x3f00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;0.5&lt;/a&gt;

 als &lt;code&gt;bfloat16&lt;/code&gt;.
Das belegt noch einmal halb so viel Speicher, 16 Bit, verbrennt aber zu viele Bits auf den Exponenten:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Bit Vorzeichen&lt;/li&gt;
&lt;li&gt;8 Bit Exponent&lt;/li&gt;
&lt;li&gt;7 Bit auf die &amp;ldquo;Mantisse&amp;rdquo;, den &amp;ldquo;Significand&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wir können auch das 16-Bit &lt;code&gt;half&lt;/code&gt; nehmen:
&lt;a href=&#34;https://float.exposed/0x3800&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;0.5&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Hier werden&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Bit Vorzeichen&lt;/li&gt;
&lt;li&gt;5 Bit Exponent&lt;/li&gt;
&lt;li&gt;10 Bit Significand&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;verwendet. Je nach Anwendungsfall kann das vorteilhaft sein.&lt;/p&gt;
&lt;p&gt;Ist es schlimm, ein LLM mit weniger Auflösung zu trainieren oder zu benutzen?
Artikel über &amp;ldquo;Quantisierung&amp;rdquo; von LLMs diskutieren das, und auch &lt;em&gt;wann&lt;/em&gt; im Herstellungsprozeß das Modell eingekürzt wird.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@techresearchspace/what-is-quantization-in-llm-01ba61968a51&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is Quantization in LLM&lt;/a&gt;


diskutiert ganz allgemein was Quantisierung bei LLMs ist – also mit welchen Zahlen beim Training gerechnet wird
und wann auf Auslieferungs-Zahlenformat umgerechnet wird.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://symbl.ai/developers/blog/a-guide-to-quantization-in-llms/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A Guide to Quanitization in LLMs&lt;/a&gt;


erklärt dasselbe, aber mit mehr Details betreffend die Integer-Formate, also &lt;code&gt;Qx_y&lt;/code&gt;, die man oft sieht.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Quantisierung hat mitunter Auswirkungen auf die Qualität der Antworten, die das LLM generiert,
aber sie spart Speicher und ermöglicht oft erst die Ausführung von LLMs auf Rechnern,
die man im Haus oder gar in der Hand hat.&lt;/p&gt;
&lt;p&gt;Wenn man zig Milliarden Parameter in den verfügbaren Speicher einer Nvidia 4070 Ti quetschen will,
dann braucht man nun einmal kürzere Zahlendarstellungen.
Und wenn es im iPhone passieren soll, dann noch kürzer.&lt;/p&gt;
&lt;p&gt;Damit man von der Beschleunigung einer Nvidia profitiert kann man aber nur Darstellungen nehmen,
die die Nvidia kennt, also in Hardware beschleunigt parallel rechnen kann.
Sonst kann man auch &amp;ldquo;zu Fuß&amp;rdquo;, also mit der CPU, rechnen.&lt;/p&gt;
&lt;p&gt;Das ist das Problem mit dem M1 Apple Silicon, das &lt;code&gt;bfloat16&lt;/code&gt; nicht in Hardware kann, und das ab M2 korrigiert ist.
Ich würde erwarten, dass neuere Apple CPUs auch andere, noch härtere Quantisierungen parallel in Hardware rechnen können,
aber ich habe nicht nachgesehen, was ab wann das wie realisiert wird.&lt;/p&gt;
&lt;h1 id=&#34;qualität-von-kleinen-llms&#34;&gt;
    &lt;a href=&#34;#qualit%c3%a4t-von-kleinen-llms&#34;&gt;
	Qualität von kleinen LLMs
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Apple behauptet, dass ihre 3B Modelle in Benchmarks besser sind als die Konkurrenz:
&lt;a href=&#34;https://machinelearning.apple.com/research/introducing-apple-foundation-models&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Introducing Apple’s On-Device and Server Foundation Models&lt;/a&gt;

,
die Benchmarks am Ende.&lt;/p&gt;
&lt;p&gt;Aber 3 Milliarden Parameter sind sehr klein.
Das ist jedoch das, was Apple lokal rechnen kann.
Größere Modelle werden &amp;ldquo;in der Cloud&amp;rdquo; ausgeführt, wo mehr Speicher verfügbar ist.&lt;/p&gt;
&lt;p&gt;Benchmarks bei KI-Anwendungen sind jedoch wenig aussagekräftig, damit ein Endkunde Qualität beurteilen kann.
Sie vergleichen Antworten verschiedener Modelle miteinander, aber die Ergebnisse sind nicht so,
wie ein Mensch Qualität erfahren würde.
Das liegt daran, dass Menschen Antworten von Computern nehmen, um ihre eigenen Entscheidungen zu treffen,
oder um sie mit ihren eigenen Entscheidungen zu vergleichen.&lt;/p&gt;
&lt;p&gt;Menschen haben aber ein Weltmodell.&lt;/p&gt;
&lt;p&gt;Das heißt im Wesentlichen, dass an jeder Entscheidung eine Gewichtung für Fehlschlag und Erfolg hängt,
eine Risikobewertung.
Eine falsche Antwort und eine andere, ebenfalls falsche Antwort sind für einen Menschen also nicht gleich:
Bei einer würde er eine kleine Summe Geld verlieren, bei der anderen sterben.
Im Benchmark aber sind beide gleich &amp;ldquo;falsch&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Der Effekt ist, dass ein schlechtes Modell im Benchmark in der Realität eventuell als besser empfunden werden kann,
weil es nie mörderische Antworten liefert.&lt;/p&gt;
&lt;h1 id=&#34;apple-mit-mehr-ram&#34;&gt;
    &lt;a href=&#34;#apple-mit-mehr-ram&#34;&gt;
	Apple mit mehr RAM
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Wenig überraschend beginnt Apple nun Rechner mit mehr RAM zu bauen,
oder für LLM-Features Geräte mit mehr RAM zu verlangen:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.golem.de/news/apple-8-gbyte-ram-im-macbook-reichen-nicht-mehr-2406-186433.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Golem: 8 GByte RAM im Macbook reichen nicht mehr&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Das Unternehmen stellte die Beta der Entwicklungsumgebung XCode 16 vor.
In ihr enthalten ist ein neues Feature: Predictive Code Completion:
Diese nutzt KI, um Codeschnipsel zu analysieren und passende Vorschläge in Echtzeit auszugeben.
Allerdings wird dafür laut Apple ein Mac mit mindestens 16 GByte Arbeitsspeicher benötigt.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;apple-mit-ohne-intelligenz&#34;&gt;
    &lt;a href=&#34;#apple-mit-ohne-intelligenz&#34;&gt;
	Apple mit ohne Intelligenz
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Stellt sich raus, auch der Rest der Welt bekommt zunächst einmal keine Apple Intelligence:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.heise.de/news/Apple-Intelligence-Kommt-die-KI-Siri-erst-mit-iOS-18-4-9793852.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apple Intelligence: Kommt die KI-Siri erst mit iOS 18.4?&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Neuen Informationen zufolge soll etwa der mit Künstlicher Intelligenz runderneuerte Sprachassistent Siri
deshalb erst im nächsten Frühjahr in den USA sein Debüt feiern.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;nicht-nvidia-sondern-google&#34;&gt;
    &lt;a href=&#34;#nicht-nvidia-sondern-google&#34;&gt;
	Nicht Nvidia, sondern Google
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Sierk Bornemann weist mich darauf hin, daß Apple in der Tat nicht sehr an Nvidia interessiert ist,
aber augenscheinlich sehr eng mit Google verbandelt ist:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Business Insider: &lt;a href=&#34;https://www.businessinsider.com/apple-ai-google-data-centers-2024-6?international=true&amp;amp;r=US&amp;amp;IR=T&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apple&amp;rsquo;s new AI is made in Google data centers&lt;/a&gt;

.
Der Artikel behauptet, daß Apple Google&amp;rsquo;s Rechenzentrum-Hardware und TPUs nutzt, um Modelle zu trainieren.
Dabei scheint der Konsum von TPU-Kapazität Google vor einige technische Probleme gestellt zu haben.&lt;/li&gt;
&lt;li&gt;Ein &lt;a href=&#34;https://x.com/WholeMarsBlog/status/1800317499222921235&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tweet&lt;/a&gt;

 benennt dabei das &amp;ldquo;axlearn&amp;rdquo; Framework,
und zitiert dabei &lt;a href=&#34;https://machinelearning.apple.com/research/introducing-apple-foundation-models&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apple&amp;rsquo;s eigene Dokumentation&lt;/a&gt;

.&lt;/li&gt;
&lt;li&gt;Und &lt;a href=&#34;https://github.com/apple/axlearn/blob/main/docs/04-infrastructure.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;axlearn&lt;/a&gt;

 ist Open Source
und scheint sehr auf Google TPUs hin optimiert zu sein.&lt;/li&gt;
&lt;li&gt;Auch &lt;a href=&#34;https://blog.trailofbits.com/2024/06/14/understanding-apples-on-device-and-server-foundations-model-release/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Trail of Bits&lt;/a&gt;


stellt heraus, daß Apple ohne &amp;ldquo;Nvidia/CUDA Tax&amp;rdquo; käme, weil das Training mit axlearn auf Google TPUs liefe.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inferenz ist einfacher und verwendet Apple Silicon (also M1-M4).&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Die Welt Deiner Kindheit existiert nicht mehr</title>
      <link>https://blog.koehntopp.info/2024/06/10/die-welt-deiner-kindheit-existiert-nicht-mehr.html</link>
      <pubDate>Mon, 10 Jun 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/10/die-welt-deiner-kindheit-existiert-nicht-mehr.html</guid>
      <description>&lt;p&gt;Ich schrieb einige Dinge im Fedi, und wurde gebeten, die hier in einen Blogpost zu kippen.
Dies ist größtenteils eine unbearbeitete Kopie der Postings, und nicht die übliche Form Fließtext für das Blog.
Das tut mir leid.&lt;/p&gt;
&lt;p&gt;Veränderung nicht verstehen ist leicht.
Wenn man 16 Jahre Kohl, 7 Jahre Schröder und 16 Jahre Merkel gesehen hat, dann sind das fast 40 Jahre Stagnation,
die Abwesenheit von Veränderung in der Politik.&lt;/p&gt;
&lt;p&gt;Aber die Welt hat sich verändert. Sehr.&lt;/p&gt;
&lt;p&gt;Zum Beispiel:
Die Anzahl der PKW in Deutschland hat sich seit 1985 von 25 Millionen auf 50 Millionen verdoppelt.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://de.statista.com/statistik/daten/studie/12131/umfrage/pkw-bestand-in-deutschland/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;


&lt;em&gt;&lt;a href=&#34;https://de.statista.com/statistik/daten/studie/12131/umfrage/pkw-bestand-in-deutschland/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Und die Autos selbst haben sich auch verdoppelt.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;700 kg Mini vs. 1200 kg Mini,&lt;/li&gt;
&lt;li&gt;800 kg Golf vs. 1700 kg ID.3&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/volkswagen-golf-1983-5-door-hatchback-vs-volkswagen-id3-2019-5-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/volkswagen-golf-1983-5-door-hatchback-vs-volkswagen-id3-2019-5-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

 Golf vs. ID.3&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/mini-cooper-1990-3-door-hatchback-vs-mini-cooper-2013-3-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/mini-cooper-1990-3-door-hatchback-vs-mini-cooper-2013-3-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

 Mini vs. Mini&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;CO₂-Level haben sich von einer vorindustriellen Baseline von 285 ppm auf 420 ppm in 2024 erhöht.
Das ist eine Veränderung von 135 ppm, und eine Verdoppelung des menschlichen CO₂-Eintrages seit 1985,
von 352 ppm auf 420 ppm.&lt;/p&gt;
&lt;p&gt;Das mit der Klimakatastrophe waren wir, nicht unsere Eltern oder Großeltern.
Wir haben das menschengemachte CO₂ in der Atmosphäre seit 1985 verdoppelt.
Im vollen Wissen um die Folgen.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/co2-long-term-concentration?time=1800..latest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/co2-long-term-concentration?time=1800..latest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

 285 ppm vorindustriell,
352 ppm in 1965, 420 ppm jetzt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Bevölkerung der Welt hat sich von 1974 bis heute verdoppelt,
von 4 Milliarden auf 8 Milliarden Menschen.
Sie wächst nicht mehr und wird laut Modell in 2086 oder so einen Spitzenwert von 10 Milliarden erreichen,
aber das Modell berücksichtigt keine Klimakatastrophe oder andere Einwirkungen,
die Mortalität erhöhen oder die Geburtenrate senken.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/population?time=1800..latest&amp;amp;country=~OWID_WRL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-05.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/population?time=1800..latest&amp;amp;country=~OWID_WRL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

,
die Weltbevölkerung war 4 Milliarden in 1974, und liegt jetzt bei 8 Milliarden.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Welt, in der ihr groß geworden seid, bzw. die Welt mit der Struktur der Arbeit und den Methoden,
die mal funktioniert haben, existiert nicht mehr.
Die Politik, die ihr kennt, könnt Ihr nicht fortsetzen, weil ihre Methoden nicht mehr adäquat sind.
Wenn man sich hinstellt, mit dem Fuß aufstampft und &amp;ldquo;Ich will aber&amp;rdquo; wählt,
dann wird das nicht funktionieren, weil die Methode nicht mehr zum Problem paßt.&lt;/p&gt;
&lt;p&gt;Aber das werden wir jetzt im Detail ausprobieren.&lt;/p&gt;
&lt;h1 id=&#34;es-ist-nicht-alles-schlimm&#34;&gt;
    &lt;a href=&#34;#es-ist-nicht-alles-schlimm&#34;&gt;
	Es ist nicht alles schlimm
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Teile der Welt verändern sich übrigens noch schneller.&lt;/p&gt;
&lt;p&gt;So hat sich die installierte Solarleistung zwischen 2019 und 2022 einfach mal eben so verdoppelt
&lt;em&gt;und der Trend beschleunigt sich&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/installed-solar-pv-capacity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-06.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/installed-solar-pv-capacity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

. PV Installation in der Welt, Summe über Zeit.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Kosten haben sich seit 2012 geviertelt, und seit 2017 halbiert.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/solar-pv-prices&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-07.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/solar-pv-prices&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

.
Die PV Kosten sinken exponentiell (gerade Linie in einem Log-Y Graphen) seit 1975, und bisher ist das Ende noch nicht in Sicht.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Für Batterien sieht es genauso aus:
Die Kosten für LiIon Batterien sind in 30 Jahren um 97 % auf 3 % gefallen,
aber wir brauchen inzwischen kein Lithium mehr in Batterien, sondern können Natrium verwenden.
Das ist aber genau überhaupt kein kritischer Rohstoff, sondern in Massen verfügbar.&lt;/p&gt;
&lt;p&gt;Genau wird auch Kobalt nicht mehr gebraucht und viele andere seltene oder schwierige Rohstoffe sind ersetzbar geworden.
&lt;a href=&#34;https://www.weltderphysik.de/gebiet/technik/nachrichten/2023/energiespeicher-lithium-ionen-batterie-ohne-kobalt/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Entsprechend hat sich die Anzahl der installierten PV Batteriesysteme in einem Jahr, in 2023, mehr als verdoppelt,
&lt;em&gt;und der Trend beschleunigt sich.&lt;/em&gt; &lt;a href=&#34;https://renewablesnow.com/news/germanys-solar-battery-capacity-doubles-in-2023-846621/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Alles, was ihr über die Probleme und die Kosten einer Energietransition wißt oder an Artikeln lest,
das älter als 12 Monate ist, ist wahrscheinlich falsch und basiert auf veralteten Annahmen.
Der Wandel passiert schneller, ist einfacher und gefahrloser und sehr, sehr viel billiger als ihr denkt.&lt;/p&gt;
&lt;h1 id=&#34;das-ist-nicht-das-erste-mal-so&#34;&gt;
    &lt;a href=&#34;#das-ist-nicht-das-erste-mal-so&#34;&gt;
	Das ist nicht das erste Mal so
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das ist übrigens nicht spezifisch für unsere Zeit.&lt;/p&gt;
&lt;p&gt;Auch zur Zeit der industriellen Revolution kam es zu gravierenden Veränderungen, einer Landflucht und Verstädterung,
und damit einhergehenden echten und eingebildeten Problemen.&lt;/p&gt;
&lt;p&gt;Die Stadt Kiel, meine Heimatstadt, ist damals zum Beispiel in 30 Jahren um den Faktor 10 gewachsen.&lt;/p&gt;
&lt;p&gt;Berlin ebenso.
Ich habe in Berlin in einer Wohnung nahe der U6 Kaiserin-Augusta-Straße gewohnt.
Die Wohnung war von 1908, und man kann dort durch die Straßen gehen stadtauswärts bis Mariendorf,
und die Querstraßen sind wie Jahresringe:
Vom Tempelhofer Feld bis Mariendorf wird die Bausubstanz mit dem Ausbau der U6
bis zur Endstation wie Jahresringe Querstraße um Querstraße immer jünger.&lt;/p&gt;
&lt;p&gt;Auch damals hatte man eine Menge &amp;ldquo;Probleme&amp;rdquo;:&lt;/p&gt;
&lt;p&gt;Die Dienstbotenfrage zum Beispiel ist eine Folge dieser Landflucht–Haushaltsführung war weitgehend manuell,
und auf das Vorhandensein großer Mengen abhängiger und niedrig ausgebildeter Arbeitskräfte angewiesen.
Die waren dann aber schlagartig nicht zu kriegen.&lt;/p&gt;
&lt;p&gt;Während die Politik das Problem noch diskutierte,
hatte man den Haushalt automatisiert–Waschmaschinen und Staubsauger,
basierend auf dem Siemens-Elektromotor,
haben sehr große Teile der anfallenden Arbeiten mechanisiert.&lt;/p&gt;
&lt;p&gt;Genau dasselbe Problem hatte man in der Landwirtschaft:
Durch die Landflucht hatte man ein Personalproblem.
Aber auf einmal gab es Traktoren und eine mechanisierte Landwirtschaft.&lt;/p&gt;
&lt;p&gt;Um 1900 herum schien es,
als ob dieselbe Landwirtschaft auf der vorhandenen Fläche die wachsende Bevölkerung nicht ernähren würde können.
Aber auf einmal gab es chemische Düngemittel und das Haber-Bosch-Verfahren (1913), und etwa um dieselbe Zeit
entwickelte Bayer Pestizide und Herbizide (Dinitrol und andere),
sodass Ernteausfälle und Hungersnöte aus anderen Gründen als Krieg in Europa der Vergangenheit angehörten.&lt;/p&gt;
&lt;p&gt;Die Politik hat dennoch bis in den 2. Weltkrieg rein von notwendigem Lebensraum für das Volk geschwafelt.
Das ist auch ein Fall von Leuten,
die ihr Gehirn mit den Problemen ihrer Jugend belasten und ihr Weltbild nicht aktualisiert haben.&lt;/p&gt;
&lt;h1 id=&#34;wir-können-das-nicht&#34;&gt;
    &lt;a href=&#34;#wir-k%c3%b6nnen-das-nicht&#34;&gt;
	Wir können das nicht
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Vermutlich sind Menschen nicht gut gemacht für Veränderungen, die schneller als in 30 Jahren ablaufen.
Oder wir haben noch keine funktional wirksamen Kulturtechniken entwickelt und Prozesse etabliert,
mit denen wir solche Veränderungen zuverlässig kommunizieren und managen können.&lt;/p&gt;
&lt;p&gt;Wie gesagt, gegenwärtig sind wir bei 3 Jahren Zykluszeit mit Leuten,
deren Weltbild 30 Jahre und länger in Bernstein konserviert worden ist.
Das ist ein Problem.&lt;/p&gt;
&lt;p&gt;Man muss sich selbst da aktiv einbringen und aktualisieren.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ich hatte, wie viele Kinder meiner Generation,
in meinem Regal hier gut 50 Was-ist-Was-Bücher aus den 1980er Jahren stehen.
Hier sind die überlebenden Bände zu sehen.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Man kann sich diese Was-ist-Was Bände nehmen und mit einem großen orangen Textmarker durchgehen.
Markiert man veraltete, falsche oder überholte Informationen, kommt da schon eine ganze Menge zusammen.
Markiert man auch inzwischen gelöste Probleme, noch weitaus mehr.
Die Teile sind nicht falsch per se, aber sie sind 40 oder 50 Jahre alt, und wir haben seit damals viel gelernt.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=UwLjK9LFpeo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Reality has a well-known liberal bias&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Das Problem ist: Es handelt sich um lebendige Geschichte.
Die Leute, die mit diesen Informationen groß geworden sind, leben noch und sind heute in Entscheidungspositionen.
Und machen da gefährlichen Quatsch, der auf falschen oder veralteten Daten beruht.
Das ist schlecht.&lt;/p&gt;
&lt;p&gt;Wenn Stephen Colbert scherzhaft sagt &amp;ldquo;Reality has a well-known liberal bias&amp;rdquo;, dann bezeichnet das auch genau das:
Leute mit konservativem, veraltetem Weltbild scheitern an einer sich ändernden, progressiven Realität.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Beyond rwx: Linux permissions</title>
      <link>https://blog.koehntopp.info/2024/06/07/beyond-rwx.html</link>
      <pubDate>Fri, 31 May 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/07/beyond-rwx.html</guid>
      <description>&lt;p&gt;I wrote this article before, in 1996, in german:
&lt;a href=&#34;https://blog.koehntopp.info/1996/03/01/rwx-sonst-nix.html&#34;&gt;rwx–sonst nix?&lt;/a&gt;

,
and in 2005, in german:
&lt;a href=&#34;https://blog.koehntopp.info/2005/11/01/user-und-gruppen-prozesse-und-dateien.html&#34;&gt;User und Gruppen, Prozesse und Dateien&lt;/a&gt;

.
This is not a translation because some things changed.&lt;/p&gt;
&lt;p&gt;A file in Linux has three permissions, &lt;code&gt;rwx&lt;/code&gt;,
which are applied to three categories, the owner, their group and everyone else.
To read a file you need &lt;code&gt;r&lt;/code&gt; permission, to write it you need &lt;code&gt;w&lt;/code&gt;, and to run it &lt;code&gt;x&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s it, right?&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;A developer opening a file. (ChatGPT)&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;you-do-not-open-files&#34;&gt;
    &lt;a href=&#34;#you-do-not-open-files&#34;&gt;
	You do not open files
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Most people say &amp;ldquo;I&amp;rsquo;m reading this file&amp;rdquo; or &amp;ldquo;I&amp;rsquo;m opening this file for writing&amp;rdquo; without thinking much about it.
But in fact, nobody in the history of Unix has ever opened or deleted a file.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;You&amp;rdquo; as a person are being represented in Linux as a user.
You have a username, which is translated on login into a UID, a number.
In the language of identity and access management, this number is &amp;ldquo;a principal,&amp;rdquo;
a token that represents your identity in the system for permission management.&lt;/p&gt;
&lt;p&gt;This token is assigned to initially one single process that can perform actions on the system on your behalf.
The process can also create more processes with
&lt;a href=&#34;https://blog.koehntopp.info/2020/12/28/fork-exec-wait-and-exit.html&#34;&gt;fork and exec&lt;/a&gt;

, which inherit the UID.&lt;/p&gt;
&lt;p&gt;So, strictly speaking, you do not open files.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A Linux process with your UID tries to open files on your behalf,
and if it succeeds, gains access to a file descriptor (fd) that allows this process to perform actions on that file.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Access control, the checking if a process is allowed to do things, happens only on file open.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;File descriptors can also be passed along between processes.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As long as that fd is kept open, the file exists,
and any process having access to that fd can do the operations on that fd that it allows.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That has a lot of implications.&lt;/p&gt;
&lt;p&gt;For example, it is possible to delete all names of a file, and still use it – as long as any process has a fd open,
the file exists (even when it has no name).
Disk space is not freed.
The file descriptor can be used to give the file a name again (in Linux, with &lt;code&gt;linkat(2)&lt;/code&gt; and the &lt;code&gt;/proc&lt;/code&gt; file system).&lt;/p&gt;
&lt;p&gt;That is, for example,
while programs such as &lt;code&gt;logrotate&lt;/code&gt; have to send a &lt;code&gt;SIGHUP&lt;/code&gt; signal to syslog after rotating logfiles.
Syslog then closes and reopens all file descriptors, ensuring that the logs go into new, not deleted files.&lt;/p&gt;
&lt;p&gt;That is also why programs such as &lt;code&gt;lsof&lt;/code&gt; sometimes list files with no name, marked as &lt;code&gt;(DELETED)&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;how-do-you-get-a-file-descriptor&#34;&gt;
    &lt;a href=&#34;#how-do-you-get-a-file-descriptor&#34;&gt;
	How do you get a file descriptor?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The answer used to be &amp;ldquo;with the &lt;code&gt;open(2)&lt;/code&gt; syscall, of course.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;But running &lt;code&gt;strace&lt;/code&gt; on a modern Linux you will see that it is &lt;code&gt;openat(2)&lt;/code&gt; now.
This call is a generalization of &lt;code&gt;open()&lt;/code&gt;, and &lt;code&gt;open(3)&lt;/code&gt; could be a library function that calls &lt;code&gt;openat(2)&lt;/code&gt;,
but for compatibility and ABI stability, &lt;code&gt;open(2)&lt;/code&gt; still exists in parallel.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In old Unix, 40 years ago, the system manual had chapters.
Chapter 1 was user commands,
chapter 8 was sysadmin commands,
chapter 2 was syscalls (kernel functions),
and chapter 3 was library functions.
By looking at the chapter number to a manual page reference,
you could see if a thing was a native kernel call from chapter 2.
A library function from chapter 3 would internally use a different kernel function to perform its action.&lt;/p&gt;
&lt;p&gt;Kernel functions are wrapped in library functions for convenience,
which are then wrapped in command line programs to make them available from the shell.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;what-can-a-fd-do&#34;&gt;
    &lt;a href=&#34;#what-can-a-fd-do&#34;&gt;
	What can a &lt;code&gt;fd&lt;/code&gt; do?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The Linux manpage for the &lt;code&gt;openat(2)&lt;/code&gt; syscall lists a number of flags for the syscall, all starting with &lt;code&gt;O_&lt;/code&gt;.
Using these flags, a process declares what it intends to be able to do with the file.
On checking the intent against the permissions that a file has,
the kernel decides to grant access.
This is done by handing out a file descriptor.
If access is not granted, an error is returned instead.&lt;/p&gt;
&lt;p&gt;An error from insufficient permissions usually is an &lt;code&gt;EPERM&lt;/code&gt; (error code 13),
but Linux has become complicated.
&lt;code&gt;EPERM&lt;/code&gt; may also come from other subsystems (such as AppArmor or SELinux),
and there may be other error codes that ultimately have permissions as a root cause.&lt;/p&gt;
&lt;p&gt;In any case, here is what a process can declare that it wants to do with a file:&lt;/p&gt;
&lt;p&gt;In traditional Unix, there were three basic flags.&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt;O_RDONLY&lt;/dt&gt;
&lt;dd&gt;The fd is to be used read-only.&lt;/dd&gt;
&lt;dt&gt;O_WRONLY&lt;/dt&gt;
&lt;dd&gt;The fd is to be used write-only.&lt;/dd&gt;
&lt;dt&gt;O_RDWR&lt;/dt&gt;
&lt;dd&gt;The fd is to be used for reading and writing.&lt;/dd&gt;
&lt;dt&gt;O_PATH&lt;/dt&gt;
&lt;dd&gt;Since Linux 2.6.39, there is also &lt;code&gt;O_PATH&lt;/code&gt;:
the fd is to be used for reference only.
Reading or writing will fail with &lt;code&gt;EBADF&lt;/code&gt;, as will any operations that modify metadata such as &lt;code&gt;fchown(2)&lt;/code&gt;.
But you can use it as a base to open other files with &lt;code&gt;openat(2)&lt;/code&gt;,
as a base to try to execute a file (if you have &lt;code&gt;x&lt;/code&gt; on that file),
and for a few other operations documented in the &lt;code&gt;openat(2)&lt;/code&gt; manual page.&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;These basic flags can be &amp;ldquo;or&amp;quot;ed together with additional flags that modify the behavior of the file open operation.&lt;/p&gt;
&lt;p&gt;The most important ones are &lt;code&gt;O_CREAT&lt;/code&gt; (&amp;ldquo;make me a new file, if it does not exist when I try to open it&amp;rdquo;),
and &lt;code&gt;O_EXCL&lt;/code&gt; (&amp;ldquo;fail if that file already exists, when I try to open it with &lt;code&gt;O_WRONLY|O_CREAT&lt;/code&gt;,
to make sure it is actually a new file&amp;rdquo;).&lt;/p&gt;
&lt;h1 id=&#34;permission-checks&#34;&gt;
    &lt;a href=&#34;#permission-checks&#34;&gt;
	Permission checks
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&amp;ldquo;Authorization&amp;rdquo; schemes in computer systems take your principal (that UID)
and determine what you can do with it, by performing operations on other system objects.
This can be written as simple &amp;ldquo;three-word sentences&amp;rdquo; in subject-predicate-object form,
or &lt;a href=&#34;https://en.wikipedia.org/wiki/Semantic_triple&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RDF triples&lt;/a&gt;

:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;ldquo;Kris&amp;rdquo; &amp;ldquo;can read and write&amp;rdquo; &amp;ldquo;/home/kris/notes.txt&amp;rdquo;&lt;/li&gt;
&lt;li&gt;&amp;ldquo;Kris&amp;rdquo; &amp;ldquo;can read&amp;rdquo; &amp;ldquo;/etc/passwd&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For storage, we need to cut these triples along the subject axis or the object axis.
That is, we either store with each file which user can do things with the file,
or we store with each user what files that user can work on.&lt;/p&gt;
&lt;p&gt;Storing the data in the object yields a &lt;strong&gt;permission system&lt;/strong&gt; as we have in Unix:
Each file contains a record (the inode and the access control list records)
that lists which users can do what with this file.&lt;/p&gt;
&lt;p&gt;It is also possible to store this data with the user.
Storing authorizations with the user generates a &lt;strong&gt;capability system&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;AppArmor is an example for a capability-based system to limit what file accesses and system calls a process
is allowed to do.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Slicing RDF triples with authorizations by object,
creating a permission system, or by subject, creating a capability system.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Normal processes are subject to these access control checks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To be able to execute &lt;code&gt;open(&amp;quot;./somefile.txt&amp;quot;, O_RDONLY)&lt;/code&gt; on a file, a process needs &lt;code&gt;r&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;li&gt;To be able to execute &lt;code&gt;open(&amp;quot;./somefile.txt&amp;quot;, O_WRONLY)&lt;/code&gt; on a file, a process needs &lt;code&gt;w&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;li&gt;To be able to execute &lt;code&gt;open(&amp;quot;./somefile.txt&amp;quot;, O_RDWR)&lt;/code&gt; on a file, a process needs both &lt;code&gt;r&lt;/code&gt; and &lt;code&gt;w&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;li&gt;To be able to run a variant of the &lt;code&gt;exec(2)&lt;/code&gt; syscall on a file, a process needs &lt;code&gt;x&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;where-do-we-get-permissions-from&#34;&gt;
    &lt;a href=&#34;#where-do-we-get-permissions-from&#34;&gt;
	Where do we get permissions from?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Okay, what have we learned?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Users, the people, are being represented in the system as principals, UIDs.&lt;/li&gt;
&lt;li&gt;These UIDs are being held by processes, which execute system calls.&lt;/li&gt;
&lt;li&gt;Certain system calls normally perform permission checks, and if they succeed, they do work for us.&lt;/li&gt;
&lt;li&gt;If the UID is associated with certain capabilities, these permission checks are bypassed, and they &amp;ldquo;always work&amp;rdquo;
(They can still fail, but not for permission reasons).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Users without special capabilities are subject to permission checks.
Permissions are stored with the objects, the files being operated on.&lt;/p&gt;
&lt;p&gt;So where exactly are permissions stored, and how can we see them?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r--+ 1 kris kris 0 Jun  7 06:15 somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ln somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r--+ 1 1000 1000 0 Jun  7 06:15 somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;uid=1000(kris) gid=1000(kris) 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  groups=1000(kris),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),134(lxd),135(sambashare),143(docker)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The Linux command &lt;code&gt;ls -l&lt;/code&gt; shows us a file, and some file metadata in a concise single line form.
The first block, &lt;code&gt;-rw-rw-r--+&lt;/code&gt; shows us the file permissions, followed by the link count (the number of names the file has),
followed by the files owner (kris) and the files group (also kris).
Using the &lt;code&gt;-n&lt;/code&gt; flag, we get the UID and GID numbers unresolved, instead of the names of the user and group.&lt;/p&gt;
&lt;p&gt;The permission bits &lt;code&gt;rwx&lt;/code&gt; are shown three times, with the letter if set, and with a &lt;code&gt;-&lt;/code&gt; if not.
The first three permissions are the user permissions,
the next three are the group permissions, and the final three are the other permissions.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;id&lt;/code&gt; command shows us the UID and the GIDs of our process (one of the GIDs is a primary GID for that process).&lt;/p&gt;
&lt;h3 id=&#34;standard-unix-file-access-checks&#34;&gt;
    &lt;a href=&#34;#standard-unix-file-access-checks&#34;&gt;
	Standard Unix File Access Checks
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;In traditional Unix, the logic was as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Do the file UID and the process UID match? If yes, use the user permissions.
In our example, the UID 1000 on the file and the UID 1000 from &lt;code&gt;id&lt;/code&gt; match, so this is what is being used.&lt;/li&gt;
&lt;li&gt;Do the file GID and any of the GIDs from the process GID set match? If yes, use the group permissions.
In our example, the file GID is 1000, and the process GID set is 1000, 4, 24, 27, 30, 46, 122, 134, 135 and 143.
Any user being in any of these groups gets to use the second set of permission bits.&lt;/li&gt;
&lt;li&gt;All other users get to use the other permissions.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;A different example:&lt;/strong&gt; A process wants to open a file. The UID does not match, the GID does match. Group permissions are granted.&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;linux-file-access-checks-with-acls&#34;&gt;
    &lt;a href=&#34;#linux-file-access-checks-with-acls&#34;&gt;
	Linux File Access Checks with ACLs
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;In modern Linux, this is still the case, &lt;strong&gt;but&lt;/strong&gt; we get to define optional, additional permission sets.
If they are present, a trailing &lt;code&gt;+&lt;/code&gt; is shown, as is in our example file.&lt;/p&gt;
&lt;p&gt;We can read these additional permission with &lt;code&gt;getfacl&lt;/code&gt; and set them with &lt;code&gt;setfacl&lt;/code&gt;.
A &amp;ldquo;facl&amp;rdquo; is a &lt;em&gt;file access control list&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;We are reading the files facl with &lt;code&gt;getfacl&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ getfacl ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; file: somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; owner: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; group: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user:sammy:r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;group::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;mask::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;other::r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We get to see the standard three entries as &lt;code&gt;user&lt;/code&gt;, &lt;code&gt;group&lt;/code&gt; and &lt;code&gt;other&lt;/code&gt;.
We also get to see a mask, which we have not mentioned yet, and which can be used to set maximum allowed permissions.
And we get to see a named entry, for a &lt;code&gt;user&lt;/code&gt; named &lt;code&gt;sammy&lt;/code&gt; which has only &lt;code&gt;r&lt;/code&gt; permissions.&lt;/p&gt;
&lt;p&gt;The ACL check is done as step 1b.
It is performed after the UID check, and before the GID check.&lt;/p&gt;
&lt;p&gt;1b. For each named ACL entry:&lt;/p&gt;
&lt;p&gt;Is this a &lt;code&gt;user&lt;/code&gt; ACL?
If so, does the UID in the ACL match the UID from the process?
If so, use the permission &lt;code&gt;rwx&lt;/code&gt; triplet from this ACL entry.&lt;/p&gt;
&lt;p&gt;Is this a &lt;code&gt;group&lt;/code&gt; ACL?
If so, does the GID in the ACL match any GID from the processes HID set?
If so, use the permission &lt;code&gt;rwx&lt;/code&gt; triplet from this ACL entry.&lt;/p&gt;
&lt;p&gt;Because this is done as 1b, it happens before the GID check in step 2.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ getfacl ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; file: somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; owner: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; group: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user:sammy:r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;group::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;mask::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;other::r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;uid=1002(sammy) gid=1000(kris) groups=1000(kris)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ ls -l ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r--+ 1 kris kris 0 jun  7 06:33 ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ &amp;gt; ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-bash: ./somefile.txt: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With the &lt;code&gt;getfacl&lt;/code&gt; output we can see that a special named entry for &lt;code&gt;user:sammy&lt;/code&gt; exists.
This entry grants only &lt;code&gt;r&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Sammy is also member of the group &lt;code&gt;kris (1000)&lt;/code&gt;, so the file GID and the process GID match (both are 1000, kris).
Because of this group membership, the group permissions &lt;code&gt;rw-&lt;/code&gt; should be applied.&lt;/p&gt;
&lt;p&gt;But because the named entry for sammy is checked before the GID entry, and matches,
sammy is only granted &lt;code&gt;r--&lt;/code&gt; permission on this file.
Trying to write to the file with &lt;code&gt;&amp;gt; ./somefile.txt&lt;/code&gt; fails.&lt;/p&gt;
&lt;h1 id=&#34;pathnames&#34;&gt;
    &lt;a href=&#34;#pathnames&#34;&gt;
	Pathnames
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;In Unix, directories have permissions, too.&lt;/p&gt;
&lt;p&gt;For files, having &lt;code&gt;r&lt;/code&gt; means you can read the file, having &lt;code&gt;w&lt;/code&gt; means you can write to the file,
and having &lt;code&gt;x&lt;/code&gt; means you can execute the file.&lt;/p&gt;
&lt;p&gt;For directories, the same bits exist, but mean subtly different things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;r&lt;/code&gt; on a directory allows you to run &lt;code&gt;readdir&lt;/code&gt; on the directory. You can see the filenames in the directory.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt; on a directory allows you to modify directory names in the directory. You can remove or add filenames in the directory.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x&lt;/code&gt; on a directory means you can resolve names of files in this directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wait, what? Let&amp;rsquo;s have a more detailed look at that.&lt;/p&gt;
&lt;p&gt;But first:
Permissions are being checked according to the pathname.&lt;/p&gt;
&lt;p&gt;So if you write a pathname such as &lt;code&gt;./somefile.txt&lt;/code&gt; (or &lt;code&gt;somefile.txt&lt;/code&gt;, which is exactly the same), this is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the permission check of the current directory, &lt;code&gt;.&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;the permission check of the file &lt;code&gt;somefile.txt&lt;/code&gt; in that directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you write &lt;code&gt;../../bin/ls&lt;/code&gt;, this is&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ pwd
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/home/kris
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l ../../bin/ls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rwxr-xr-x 1 root root 138216 Feb  8 04:46 ../../bin/ls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;the permission check for &lt;code&gt;..&lt;/code&gt; (traversing &lt;code&gt;/home&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the permission check for &lt;code&gt;..&lt;/code&gt; (traversing &lt;code&gt;/&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the permission check for &lt;code&gt;bin&lt;/code&gt; (traversing &lt;code&gt;/bin&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the permission check for the file &lt;code&gt;ls&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Or, in other words,
a file&amp;rsquo;s effective permission is the sequence of permissions along the path plus the permission on the file,
individual permissions and file access control lists and all.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;But if you write &lt;code&gt;/bin/ls&lt;/code&gt;, this is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the permission check for &lt;code&gt;/&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;the permission check for &lt;code&gt;/bin&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;and the permission check for the file &lt;code&gt;ls&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;and that is a subtly different set of permissions,
because it is a different path to the same file, but we check along the path.&lt;/p&gt;
&lt;p&gt;Now, let&amp;rsquo;s look at directory permissions in detail:&lt;/p&gt;
&lt;h2 id=&#34;directory-r-permission-but-no-x&#34;&gt;
    &lt;a href=&#34;#directory-r-permission-but-no-x&#34;&gt;
	Directory &lt;code&gt;r&lt;/code&gt; permission (but no &lt;code&gt;x&lt;/code&gt;)
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s create a directory and a file in that directory:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo schokokeks &amp;gt;  cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwxrwxr-x 2 kris kris  3 Jun  7 06:57 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 Jun  7 06:58 cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let&amp;rsquo;s remove the &lt;code&gt;x&lt;/code&gt; permission from the directory.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod a-x cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I have no &lt;code&gt;x&lt;/code&gt;, and that means I cannot get to any of these files:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drw-rw-r-- 2 kris kris 3 Jun  7 06:57 cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot access &amp;#39;cookie/choc&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ cat cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cat: cookie/choc: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I still have &lt;code&gt;r&lt;/code&gt;, so I can list the names.
I would need access to the files to get more than the name, for example file length or permissions with &lt;code&gt;stat(2)&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo cookie/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot access &amp;#39;cookie/choc&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-????????? ? ? ? ?            ? choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Restoring &lt;code&gt;x&lt;/code&gt; permission fixes things.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Destructive Sysadmin Exercise:&lt;/strong&gt; Get yourself a throwaway virtual machine.
As root, run &lt;code&gt;chmod a-x /&lt;/code&gt;.
&lt;em&gt;Do not do this with a production machine.&lt;/em&gt;
Predict what will happen.
What actually happens?
Can you fix it?&lt;/p&gt;
&lt;h2 id=&#34;directory-x-permission-but-no-r&#34;&gt;
    &lt;a href=&#34;#directory-x-permission-but-no-r&#34;&gt;
	Directory &lt;code&gt;x&lt;/code&gt; permission (but no &lt;code&gt;r&lt;/code&gt;)
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s recreate the setup and then remove the &lt;code&gt;r&lt;/code&gt; permission, keeping &lt;code&gt;x&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod 111 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;d--x--x--x 2 kris kris  3 Jun  7 07:06 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 Jun  7 07:06 cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ cat cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;schokokeks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kris can still access the files in the directory and their contents.
But:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot open directory &amp;#39;cookie&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;While &lt;code&gt;ls -ld cookie cookie/choc&lt;/code&gt; tries to directly list files with known names,
&lt;code&gt;ls -l&lt;/code&gt; tries to open the directory for reading with &lt;code&gt;opendir&lt;/code&gt;
and then discover the content (the file names) using &lt;code&gt;readdir&lt;/code&gt;.
This fails.&lt;/p&gt;
&lt;p&gt;Running &lt;code&gt;stat&lt;/code&gt; system calls on files with known names traverses the directory
and requires &lt;code&gt;x&lt;/code&gt; permission on the directory containing the files.
Running &lt;code&gt;opendir&lt;/code&gt; and &lt;code&gt;readdir&lt;/code&gt; calls to discover filenames requires &lt;code&gt;r&lt;/code&gt; permission.
We have &lt;code&gt;x&lt;/code&gt;, but not &lt;code&gt;r&lt;/code&gt;, so one operation succeeds, the other does not.&lt;/p&gt;
&lt;h2 id=&#34;directory-w-permission&#34;&gt;
    &lt;a href=&#34;#directory-w-permission&#34;&gt;
	Directory &lt;code&gt;w&lt;/code&gt; permission
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s create a directory with &lt;code&gt;w&lt;/code&gt; permission for the group:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod 730 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwx-wx--- 2 kris kris 3 Jun  7 07:12 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, as a different user, let&amp;rsquo;s do things:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;uid=1002(sammy) gid=1000(kris) groups=1000(kris)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:~$ cd ~kris/cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot open directory &amp;#39;.&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ cat choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;schokokeks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 jun  7 07:12 choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ echo butter &amp;gt; butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 sammy kris 7 jun  7 07:15 butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ rm choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sammy, being member of the group kris, can enter the directory with &lt;code&gt;cd&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Sammy has no &lt;code&gt;r&lt;/code&gt; permission, so she cannot list the directory contents.&lt;/p&gt;
&lt;p&gt;Sammy has &lt;code&gt;x&lt;/code&gt; permission, so she can access files in the directory, if the file permission allows this.
She can also &lt;code&gt;stat(2)&lt;/code&gt; files with known names to learn the files&amp;rsquo; metadata.&lt;/p&gt;
&lt;p&gt;Having &lt;code&gt;w&lt;/code&gt; permission, sammy can create filenames in this directory, here &lt;code&gt;butter_cookie&lt;/code&gt;.
The new file has her UID and the parent directories GID (what?).&lt;/p&gt;
&lt;p&gt;Having &lt;code&gt;w&lt;/code&gt; permission, sammy can also remove filenames in this directory, here &lt;code&gt;choc&lt;/code&gt;, which she does not own (what?).&lt;/p&gt;
&lt;h1 id=&#34;deleting-files&#34;&gt;
    &lt;a href=&#34;#deleting-files&#34;&gt;
	Deleting files
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s address the second &amp;ldquo;What?&amp;rdquo; first: Nobody in Unix has ever deleted a file.&lt;/p&gt;
&lt;p&gt;Unix garbage collects files automatically when the number of their names is zero (their link count is zero),
and the number of open file descriptors is zero.&lt;/p&gt;
&lt;p&gt;You knew this: The syscall is called &lt;code&gt;unlink(2)&lt;/code&gt; and not &lt;code&gt;delete&lt;/code&gt;.
&lt;code&gt;unlink&lt;/code&gt; will remove one of potentially many names of a file.
Even the last one.&lt;/p&gt;
&lt;p&gt;Giving &lt;code&gt;w&lt;/code&gt;-permission allows people to create or remove filenames in a directory.
The file is never involved with this, hence permissions are not checked.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s bad.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s fix that.&lt;/p&gt;
&lt;p&gt;I lied. There are not nine permission bits to a file, there are 12. It&amp;rsquo;s not &lt;code&gt;rwxrwxrwx&lt;/code&gt;, it&amp;rsquo;s &lt;code&gt;sstrwxrwxrwx&lt;/code&gt;.
The &lt;code&gt;sst&lt;/code&gt; is rarely set, so it is not shown unless it is set.
When it is set, it is shown instead of the three &lt;code&gt;x&lt;/code&gt;, in lower case if the &lt;code&gt;x&lt;/code&gt; below is set, else in upper case.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;What are the &lt;code&gt;sst&lt;/code&gt; bits and why don&amp;rsquo;t we see them?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;t&lt;/code&gt;-bit is called &amp;ldquo;sticky bit&amp;rdquo; because of an obscure function (for files) for a computer type that no longer exists.
You can interpret is as &amp;ldquo;this thing needs special treatment&amp;rdquo; in modern Unix.
If you set it on directories, it will prevent a user from deleting files they do not own.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod 1730 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwx-wx--T 2 kris kris 3 Jun  7 07:25 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have set the permissions &lt;code&gt;1730&lt;/code&gt; aka &lt;code&gt;--trwx-wx--T&lt;/code&gt; on this directory.
The &lt;code&gt;T&lt;/code&gt; is shown instead of the last &lt;code&gt;x&lt;/code&gt; and it is uppercase because the &lt;code&gt;x&lt;/code&gt; beneath it is not there.&lt;/p&gt;
&lt;p&gt;And now&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:~$ cd ~kris/cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 jun  7 07:25 choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ rm choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;rm: cannot remove &amp;#39;choc&amp;#39;: Operation not permitted
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;but&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ echo butter &amp;gt; butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 sammy kris 7 jun  7 07:28 butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ rm butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;So sammy can still create files, which she then owns, and which she can delete.&lt;/p&gt;
&lt;p&gt;But sammy can no longer delete files that she does not own.&lt;/p&gt;
&lt;p&gt;Remember to set &lt;code&gt;t&lt;/code&gt; on a directory that is also writeable by other persons.&lt;/p&gt;
&lt;h1 id=&#34;who-owns-new-files&#34;&gt;
    &lt;a href=&#34;#who-owns-new-files&#34;&gt;
	Who owns new files?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;When creating new files, the new file gets an owner UID, a file GID and a default ACL.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s try this:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-conosle&#34; data-lang=&#34;conosle&#34;&gt;kris@server:~$ id
uid=1000(kris) gid=1000(kris) 
  groups=1000(kris),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),134(lxd),135(sambashare),143(docker)

kris@server:~$ mkdir cookie
kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc

kris@server:~$ ls -l cookie/choc
-rw-rw-r-- 1 kris kris  11 Jun  7 07:31 cookie/choc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I can try to give the file to a different group.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp doesnotexist cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;chgrp: invalid group: ‘doesnotexist’
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp scanner cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;chgrp: changing group of &amp;#39;cookie/choc&amp;#39;: Operation not permitted
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp sambashare cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris sambashare 11 Jun  7 07:31 cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I can&amp;rsquo;t give the file to a group that does not exist.&lt;/p&gt;
&lt;p&gt;I can&amp;rsquo;t give the file to a group that I am not a member of.
That is, because that file will count against that groups&amp;rsquo; quota,
and I am not allowed to book this file on a foreign groups&amp;rsquo; quota.&lt;/p&gt;
&lt;p&gt;I can give the file to any group that I am a member of.
That is how the GID set of a process matters.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp sambashare cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwxrwxr-x 2 kris sambashare 2 Jun  7 07:37 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo butter &amp;gt; cookie/butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris sambashare 7 Jun  7 07:38 butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When I create files in a directory, the file will inherit the group of the directory.
That makes it easier for a group of people working together in a group,
because shared group directories will now automatically behave properly.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Normal users are being created with a group after them, and ideally with the name GID and UID.
Effectively, they do no longer need to care about groups because they are the only members of their own group.&lt;/li&gt;
&lt;li&gt;Additional groups can be created for cooperation.
A sysadmin adds members to these groups effectively.&lt;/li&gt;
&lt;li&gt;Directories that belong to a group will contain newly created files, which are created with a GID of that share group.&lt;/li&gt;
&lt;li&gt;That is what you want:
If you put files into a share directory for a group, they should be UID you, GID the share group.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This happens, because the file system is mounted with the option &lt;code&gt;bsdgroups&lt;/code&gt;.
For file systems that are mounted without this option, the primary GID of the user is chosen.
All file systems should always be mounted with &lt;code&gt;bsdgroups&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If you need the opposite behavior for a single directory, &lt;code&gt;chmod g+s my_directory&lt;/code&gt; on it.
For a filesystem without &lt;code&gt;bsdgroups&lt;/code&gt;, this one directory will have &lt;code&gt;bsdgroups&lt;/code&gt; semantics.
For a filesystem with &lt;code&gt;bsdgroups&lt;/code&gt;, this one directory will have no &lt;code&gt;bsdgroups&lt;/code&gt; semantics.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>LLMs daheim mit Ollama</title>
      <link>https://blog.koehntopp.info/2024/05/31/llms-daheim-mit-ollama.html</link>
      <pubDate>Fri, 31 May 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/05/31/llms-daheim-mit-ollama.html</guid>
      <description>&lt;p&gt;Dieser Text ist eine Art Follow-up für &lt;a href=&#34;https://blog.koehntopp.info/2024/02/06/wie-chatgpt-funktioniert.html&#34;&gt;Wie ChatGPT funktioniert&lt;/a&gt;

.
Es geht darum, ein LLM lokal auszuführen und damit zu experimentieren.&lt;/p&gt;
&lt;p&gt;Wer mit LLMs daheim experimentieren möchte, der steht vor dem Problem,
einen Haufen furchtbar empfindlicher und schlecht zu aktualisierender Abhängigkeiten in Python zu installieren,
monströse Downloads zu verwalten und die Ausführung für die eigene Maschine zu optimieren.
Das wird ein bisschen verbessert mit &lt;a href=&#34;https://github.com/ggerganov/llama.cpp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;llama.cpp&lt;/a&gt;

,
einer C++/C Bibliothek, die einem einen Teil der Arbeit abnimmt,
aber man hat immer noch kein Paket, mit dem man einfach Ergebnisse bekommt.&lt;/p&gt;
&lt;p&gt;Abhilfe schafft hier &lt;a href=&#34;https://github.com/ollama/ollama&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ollama&lt;/a&gt;

,
eine in Golang geschriebene Anwendung,
die llama.cpp integriert und den Download, die Verwaltung und die Ausführung von LLMs automatisiert.
Die &lt;a href=&#34;https://ollama.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Website&lt;/a&gt;

 verweist auf das Blog,
den Discord und das Github von Ollama, und hat eine Suche,
mit der man auf Ollama angepasste LLms finden und herunterladen kann.&lt;/p&gt;
&lt;h1 id=&#34;installation&#34;&gt;
    &lt;a href=&#34;#installation&#34;&gt;
	Installation
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;LLMs sind rechenintensive Monster, die eine große Maschine zur Ausführung brauchen.
Aber eingedampfte Spezialversionen kann man schon auf einem großen Raspi ausführen.
Größe ist jedoch ein qualitativer Unterschied:
Ein LLM mit 0.3 Mrd. Parameters verhält sich ganz anders als eines mit 8 Mrd. Parametern,
und dieses wiederum wird von einem LLM mit 70 Mrd. Parameters vollkommen deklassiert.
Ersteres kann man auf einem Raspi ausführen,
die 8 Mrd. Parameter-Modelle oft auf einem Mac oder Windows-Rechner mit 32 GB RAM oder 12 GB VRAM in der Grafikkarte,
und die 70 Mrd. Parameter-Modelle brauchen in der Regel Spezialrechner mit 128 GB RAM und zwei 24 GB Nvidia-Karten kombiniert.&lt;/p&gt;
&lt;p&gt;In meinem Fall steht mir&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ein Mac mini M2pro mit 32 GB RAM und 8+4 Cores&lt;/li&gt;
&lt;li&gt;ein Windows 11 Rechner mit 64 GB RAM und Nvidia 4070Ti (12 GB VRAM)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;zur Verfügung. Beide Maschinen haben ausreichend Plattenplatz auf NVME.&lt;/p&gt;
&lt;p&gt;Man kann sich Ollama von der Website herunterladen und installieren,
oder das Golang Projekt selbst clonen und compilieren,
aber die einfachste Weise der Installation sind Paketmanager für MacOS und Windows.&lt;/p&gt;
&lt;p&gt;Auf dem Mac habe ich Homebrew, und &lt;code&gt;brew install ollama&lt;/code&gt; ist die schnellste und einfachste Methode,
Ollama zu installieren und aktuell zu halten.
Auf Windows geht dasselbe mit &lt;a href=&#34;https://scoop.sh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Scoop&lt;/a&gt;

, &lt;code&gt;scoop install ollama&lt;/code&gt; regelt die Details.&lt;/p&gt;
&lt;h1 id=&#34;ollama-serve-ausführen&#34;&gt;
    &lt;a href=&#34;#ollama-serve-ausf%c3%bchren&#34;&gt;
	&lt;code&gt;ollama serve&lt;/code&gt; ausführen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Ollama wird als Server ausgeführt.
Dazu muss man &lt;code&gt;ollama serve&lt;/code&gt; starten.&lt;/p&gt;
&lt;p&gt;Alle weiteren Operationen setzen voraus, daß in einem Fenster irgendwo &lt;code&gt;ollama serve&lt;/code&gt; aktiv ist,
denn alle weiteren Operationen tun nichts anderes als REST-Requests an &lt;code&gt;ollama serve&lt;/code&gt; zu senden.
Dies kann mit der &lt;code&gt;ollama&lt;/code&gt;-Kommandozeile passieren, oder man schreibt sich eigene Python-Programme, die das tun&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; ollama serve
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama serve
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;2024/05/31 09:52:25 routes.go:1008: INFO server config 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  env=&amp;#34;map[OLLAMA_DEBUG:false OLLAMA_LLM_LIBRARY: OLLAMA_MAX_LOADED_MODELS:1 OLLAMA_MAX_QUEUE:512
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   OLLAMA_MAX_VRAM:0 OLLAMA_NOPRUNE:false OLLAMA_NUM_PARALLEL:1 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   OLLAMA_ORIGINS:[http://localhost ... https://0.0.0.0:*] 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   OLLAMA_RUNNERS_DIR: OLLAMA_TMPDIR:]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T09:52:25.124+02:00 level=INFO source=images.go:704 msg=&amp;#34;total blobs: 28&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T09:52:25.131+02:00 level=INFO source=images.go:711 msg=&amp;#34;total unused blobs removed: 0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T10:02:15.032+02:00 level=INFO source=payload.go:44 msg=&amp;#34;Dynamic LLM libraries [metal]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T10:02:15.090+02:00 level=INFO source=types.go:71 msg=&amp;#34;inference compute&amp;#34; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  id=0 library=metal compute=&amp;#34;&amp;#34; driver=0.0 name=&amp;#34;&amp;#34; total=&amp;#34;21.3 GiB&amp;#34; available=&amp;#34;21.3 GiB&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ollama lädt später Parameterdaten für die LLMs herunter. Diese nehmen einige Gigabyte Plattenplatz ein.
Per Default legt das MacOS Ollama dies im Home des Benutzers ab, in &lt;code&gt;$HOME/.ollama/models&lt;/code&gt;.
Man kann dies mit einer Umgebungsvariable umstellen.&lt;/p&gt;
&lt;p&gt;In diesem Fall muss man &lt;code&gt;OLLAMA_MODELS&lt;/code&gt; setzen:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama serve --help
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Start ollama
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Usage:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  ollama serve [flags]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Aliases:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  serve, start
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Flags:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  -h, --help   help for serve
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Environment Variables:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_HOST         The host:port to bind to (default &amp;#34;127.0.0.1:11434&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_ORIGINS      A comma separated list of allowed origins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_MODELS       The path to the models directory (default &amp;#34;~/.ollama/models&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_KEEP_ALIVE   The duration that models stay loaded in memory (default &amp;#34;5m&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_DEBUG        Set to 1 to enable additional debug logging
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; kk:~ kris$ mkdir /Volumes/Ablage/Torch/ollama-models/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;OLLAMA_MODELS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/Volumes/Ablage/Torch/ollama-models/ ollama serve
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Der Speicher dort sollte schnell sein und ausreichend Raum bereitstellen:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ df -h /Volumes/Ablage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Filesystem      Size    Used   Avail Capacity iused ifree %iused  Mounted on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/dev/disk9s1   3.6Ti   804Gi   2.9Ti    22%    360k   31G    0%   /Volumes/Ablage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ du -sh /Volumes/Ablage/Torch/ollama-models
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 54G	/Volumes/Ablage/Torch/ollama-models
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama list
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;NAME                    	ID          	SIZE  	MODIFIED
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3:70b-instruct-q2_K	693db6efd8f9	26 GB 	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3:instruct         	365c0bd3c000	4.7 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;mistral:instruct        	2ae6f6dd7a3d	4.1 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;gemma:instruct          	a72c7f4d0a15	5.0 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3-gradient:instruct	5d1398df5b8b	4.7 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;phi3:14b                	1e67dff39209	7.9 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llava-llama3:latest     	44c161b1f465	5.5 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3-gradient:latest  	5d1398df5b8b	4.7 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;phi3:14b-instruct       	1e67dff39209	7.9 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Der Ollama-Server bindet sich an localhost, Port 11434 und lauscht nun auf eingehende REST-Requests.
Diese können dazu führen, daß ein Model geladen und ausgeführt wird.
Das kann beim ersten Mal einige Zeit dauern, da viele Gigabyte Daten geladen werden müssen.&lt;/p&gt;
&lt;p&gt;Der Server hält das Model einige Zeit im Speicher, &lt;code&gt;OLLAMA_KEEP_ALIVE&lt;/code&gt; viele Minuten.
Der Default ist 5 m.
Danach wird der Speicher wieder freigegeben.&lt;/p&gt;
&lt;h1 id=&#34;modelle-aus-dem-internet-laden&#34;&gt;
    &lt;a href=&#34;#modelle-aus-dem-internet-laden&#34;&gt;
	Modelle aus dem Internet laden
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;LLMs sind recht komplizierte Konstrukte mit der eigentlichen Parameter-Datei, die den Großteil der Daten aus macht,
einem Systemprompt und weiteren Layers, die meist eher nicht so groß sind.
Auf einem handelsüblichen Desktop-Rechner kann man erwarten, ein &amp;ldquo;7B&amp;rdquo; oder &amp;ldquo;8B&amp;rdquo;-Modell auszuführen.
Dies belegt zwischen 5 GB und 9 GB an Speicher, im RAM oder auf der Grafikkarte.&lt;/p&gt;
&lt;p&gt;Richtig große Modelle, 70B-Modelle, brauchen wesentlich mehr Speicher und eine Hardware,
die für die Ausführung von LLMs auf mehreren Grafikkarten vorbereitet ist.&lt;/p&gt;
&lt;p&gt;Ein guter Startpunkt ist das Mistral AI-Model &lt;a href=&#34;https://ollama.com/library/mistral&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mistral&lt;/a&gt;

.
Man lädt es mit &lt;code&gt;ollama pull mistral:instruct&lt;/code&gt; herunter.
Das wird Zeit lang dauern und das Model-Directory entsprechend voll machen.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HINWEIS:&lt;/strong&gt; Noch einmal die Erklärung, daß alle Arbeit von &lt;code&gt;ollama serve&lt;/code&gt; erledigt wird.
Wenn dieses Kommando nicht aktiv ist, funktioniert keines der anderen Kommandos.
&lt;code&gt;ollama pull&lt;/code&gt;, &lt;code&gt;ollama run&lt;/code&gt; und auch &lt;code&gt;ollama rm&lt;/code&gt; senden lediglich REST-Requests an den Server,
der dann die Arbeit macht.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama pull mistral:instruct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling manifest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling ff82381e2bea... 100% ▕████████████████▏ 4.1 GB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling 43070e2d4e53... 100% ▕████████████████▏  11 KB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling c43332387573... 100% ▕████████████████▏   67 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling ed11eda7790d... 100% ▕████████████████▏   30 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling 42347cd80dc8... 100% ▕████████████████▏  485 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;verifying sha256 digest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;writing manifest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;removing any unused layers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;success
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;modelle-ausführen&#34;&gt;
    &lt;a href=&#34;#modelle-ausf%c3%bchren&#34;&gt;
	Modelle ausführen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das Modell kann man mit &lt;code&gt;ollama run mistral:instruct&lt;/code&gt; testen.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; /set verbose
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Set &amp;#39;verbose&amp;#39; mode.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; Explain in a single sentence &lt;span class=&#34;s2&#34;&gt;&amp;#34;Why is the sky blue?&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; The sky appears blue because molecules in the Earth&amp;#39;s atmosphere scatter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sunlight in all directions, and blue light is scattered more because it
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;travels in shorter, smaller waves.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;total duration:       1.559908875s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;load duration:        2.719417ms
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval count:    23 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval duration: 303.421ms
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval rate:     75.80 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval count:           41 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval duration:        1.245361s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval rate:            32.92 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir sehen hier, daß mein M2 pro mini 32 GB 1.56 Sekunden gebraucht hat, um diese Antwort zu generieren.
Die Frage hat &amp;ldquo;23 Token&amp;rdquo; belegt, die mit 75 Token/s analysiert worden sind.&lt;/p&gt;
&lt;p&gt;Die Generierung der Ausgabe hat 41 Token erzeugt, 1.25s gedauert und ist mit 33 Token/s gelaufen.
Der Rechner hat dabei ca. 50 Watt gezogen. Normal verbraucht er circa 7 Watt, also werden 43 Watt mehr verbraucht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/05/ollama-3.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ausgabe der MacOS App Stats (&lt;code&gt;brew install stats&lt;/code&gt;), der Rechner verbraucht normal ca. 7 Watt, mit dem LLM aktiv 50 Watt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/05/ollama-1.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ausgabe der MacOS App Stats, hier: GPU Auslastung. Dies ist die einzige Anwendung, die die Mac mini GPU an den Anschlag bringt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Nvidia 4070Ti kommt auf mehr als 70 Token/s, zieht aber über 400 W.&lt;/p&gt;
&lt;p&gt;Der &lt;code&gt;ollama run&lt;/code&gt;-Prompt kann mit &lt;code&gt;/bye&lt;/code&gt; verlassen werden.&lt;/p&gt;
&lt;p&gt;Die vorhandenen Modelle können mit &lt;code&gt;ollama list&lt;/code&gt; aufgelistet werden.
Mit &lt;code&gt;ollama rm&lt;/code&gt; löscht man ein lokales Modell und gibt den Plattenplatz frei.
Es muss dann neu heruntergeladen werden.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama rm llama3:instruct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;deleted &amp;#39;llama3:instruct&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;arbeiten-mit-ollama-run-texte-zusammenfassen&#34;&gt;
    &lt;a href=&#34;#arbeiten-mit-ollama-run-texte-zusammenfassen&#34;&gt;
	Arbeiten mit &lt;code&gt;ollama run&lt;/code&gt;: Texte zusammenfassen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Für das folgende Beispiel ist ein laufender Server &lt;code&gt;ollama serve&lt;/code&gt; erforderlich,
das Modell &lt;code&gt;mistral:instruct&lt;/code&gt; muss bereitstehen (d.h. &lt;code&gt;ollama list&lt;/code&gt; zeigt es an),
und wir verwenden den Text &lt;a href=&#34;https://www.gutenberg.org/files/61213/61213.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The 64-Square Madhouse&lt;/a&gt;

 von Fritz Leiber.&lt;/p&gt;
&lt;p&gt;Das Ziel ist es, Ollama diesen Text mithilfe von Llama 3 zusammenfassen zu lassen.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Den Text von Fritz Leiber vom Projekt Gutenberg herunterladen.
Es ist hilfreich, allen Copyright-Text am Anfang und am Ende wegzuschneiden,
um dem Modell nur die Story selbst zu füttern.&lt;/li&gt;
&lt;li&gt;Server starten: &lt;code&gt;ollama serve&lt;/code&gt;.
Dabei sind ggf. die notwendigen Parameter als Umgebungsvariablen zu setzen, damit die Modelle gefunden werden.&lt;/li&gt;
&lt;li&gt;Modell prüfen: &lt;code&gt;ollama list&lt;/code&gt; zeigt das Modell &lt;code&gt;mistral:instruct&lt;/code&gt; als vorhanden an.
Ansonsten muss es mit &lt;code&gt;ollama pull mistral:instruct&lt;/code&gt; heruntergeladen werden.&lt;/li&gt;
&lt;li&gt;Den Prompt mit &lt;code&gt;ollama run mistral:instruct&lt;/code&gt; starten.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Wir verwenden hier das Modell &lt;code&gt;mistral:instruct&lt;/code&gt; von &lt;a href=&#34;https://en.wikipedia.org/wiki/Mistral_AI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mistral AI&lt;/a&gt;

.
Das ist eine Firma von ehemaligen Google und Meta/Facebook Mitarbeitern, die vor einem Jahr in Paris gegründet wurde.&lt;/p&gt;
&lt;p&gt;Auf dem Prompt erfolgt die Kommunikation mit dem Modell in Englisch.
Manche Modelle sind ausdrücklich mehrsprachig trainiert (zum Beispiel &lt;a href=&#34;https://ollama.com/library/mixtral&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixtral&lt;/a&gt;

),
aber wenn dies in der Anleitung zum Modell nicht angegeben ist, ist Englisch zu verwenden.&lt;/p&gt;
&lt;p&gt;Wir können dem Modell eine Anfrage in einer Zeile stellen.
Mehrzeilige Anweisungen werden mit &lt;code&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/code&gt; eingeleitet und genau so beendet.&lt;/p&gt;
&lt;p&gt;Es ist ein &lt;code&gt;instruct&lt;/code&gt;-Modell, es wird also keine Annahmen machen, sondern wir müssen Arbeitsanwendungen geben.&lt;/p&gt;
&lt;p&gt;Wir können dem Client Parameter setzen.
Dies erfolgt mit &lt;code&gt;/&lt;/code&gt;-Kommandos, &lt;code&gt;/help&lt;/code&gt; für eine Übersicht.&lt;/p&gt;
&lt;p&gt;Modelle haben Parameter.
Ein wichtiger Parameter ist &lt;code&gt;num_ctx&lt;/code&gt; (manchmal auch n_ctx).
Er bestimmt die Anzahl der Token, die das Modell als Kontextspeicher für die Antwortgenerierung verwendet.&lt;/p&gt;
&lt;p&gt;Ein Embedding ist ein vieldimensionaler Vektor, der Bedeutung von Worten codiert.
Es belegt etwa 1 Kilobyte an Speicher.
Ein Token ist ein Zeiger auf ein Embedding, aber im Kontext der Antwortgenerierung wird das Token kopiert.
Ein Kontext von 65536 belegt also in etwa 64 MB Speicher.
In englischer Sprache entspricht ein Wort in etwa 1.3 Tokens.&lt;/p&gt;
&lt;p&gt;Unser Beispieltext hat, nachdem wir vorne und hinten alles das wegschneiden,
was Projekt Gutenberg als Disclaimer hinzugefügt hat,
eine Größe von circa 14.000 Worten:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ wc leiber-64-square.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    1824   13853   84236 leiber-64-square.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wenn wir dem Modell einen Kontext von 65536 Token geben, dann sollte es mit der Geschichte gut zurechtkommen.
&lt;strong&gt;HINWEIS:&lt;/strong&gt;* Es heißt &lt;code&gt;/set parameter num_ctx 65536&lt;/code&gt;, nicht &lt;code&gt;/set num_ctx 65536&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama run mistral:instruct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; /set verbose
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Set &amp;#39;verbose&amp;#39; mode.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; /set parameter num_ctx &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Set parameter &amp;#39;num_ctx&amp;#39; to &amp;#39;65536&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;... You are an english teacher.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... Summarize the following story,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... providing an overview over the main characters of the story,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... and a paragraph for each scene or major event that happens in the course of
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... the story.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... As a conclusion, provide context: What is the story about?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... The story:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir setzen also &lt;code&gt;/set verbose&lt;/code&gt;, um Statistiken zu bekommen.
Wir setzen dann den Parameter &lt;code&gt;/set parameter num_ctx 65536&lt;/code&gt;, um dem Modell genug Arbeitskontext zu geben.
Danach leiten wir mit &lt;code&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/code&gt; einen mehrzeiligen Input ein.
Dieser wird durch &lt;code&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/code&gt; auf einer neuen Zeile genau so abgeschlossen.&lt;/p&gt;
&lt;p&gt;In einem anderen Fenster laden wir nun die Story in den Paste-Buffer:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) kk:keks kris$ cat leiber-64-square.txt | pbcopy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) kk:keks kris$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Diese kann nun in den Ollama-Prompt gepasted werden.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... Sandra said, &amp;#34;Well, there&amp;#39;s something you can&amp;#39;t build into a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... machine--ego.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... &amp;#34;Oh, I don&amp;#39;t know about that,&amp;#34; said Simon Great.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... &amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Die generierte Antwort des Modells lautet:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This story is about a chess tournament featuring an electronic computing
machine named the Machine. The Machine is entering its first international
grandmaster chess tournament, and the large hall where the event takes
place is filled with energetic dark-suited men who are either playing
chess or discussing it. There are signs featuring various combinations of
letters such as FIDE, WBM, USCF, USSF, USSR, and UNESCO, and many clocks
bedside table size with red flags and wheels on their faces are present to
keep track of each player&amp;rsquo;s moves. The Machine is programmed by a
psychologist named Simon Great, who has been out of tournament chess for
twenty years but is now making a comeback.&lt;/p&gt;
&lt;p&gt;The main characters in the story are Sandra Lea Grayling, a journalist for
the &lt;em&gt;Chicago Space Mirror&lt;/em&gt;, and Dr. Krakatower, a former grandmaster of
chess who is also a special correspondent for the London Times. The
Machine is also a character, as it plays against various human opponents
throughout the tournament.&lt;/p&gt;
&lt;p&gt;The story unfolds over the course of several days, with each scene or
major event taking place during one of the nine rounds of the tournament.
In the first round, the Machine plays against Bela Grabo and wins the
game. This causes a stir among the players and spectators, as many believe
that the Machine is too good to be true. In the second round, the Machine
faces off against Votbinnik and again emerges victorious. This pattern
continues throughout the tournament, with the Machine consistently
outplaying its human opponents.&lt;/p&gt;
&lt;p&gt;Dr. Krakatower struggles throughout the tournament, losing several games
and finding himself in last place. However, he manages to draw his game
against Sherevsky in the next to last round, which gives him a small
glimmer of hope. In the final round, the Machine plays against Willie
Angler, who has been consistently strong throughout the tournament. The
outcome of this match will determine the winner of the tournament.&lt;/p&gt;
&lt;p&gt;As the story reaches its conclusion, it is revealed that Angler had
intentionally played a flawed move in his game against the Machine, as he
had discovered an error in the programming of the Machine&amp;rsquo;s opening moves.
This tactic pays off, and Angler wins the game and the tournament. The
final standing shows that Angler and Votbinnik are tied for first place,
with the Machine in second.&lt;/p&gt;
&lt;p&gt;The story concludes with a discussion between Simon Great, Willie Angler,
and Dr. Krakatower about the future of chess and computer programming. It
is suggested that grandmaster chess without computers will become less
popular, as players will increasingly rely on computers to aid them in
their games. The story also touches on the idea of man-machine symbiosis,
with the implication that future grandmasters may be a combination of
human and machine. The story serves as a commentary on the changing nature
of chess and the role of technology in society.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;und&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total duration:       3m33.240299458s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;load duration:        20.467748958s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval count:    22580 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval duration: 1m58.450477s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval rate:     190.63 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval count:           634 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval duration:        1m14.263155s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval rate:            8.54 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir haben eine recht gute Evaluation Rate: 190 Token/s.
Die Generierung der Antwort ist langsamer, auch wegen des großen Kontexts, den wir gesetzt haben: 8.5 Token/s.&lt;/p&gt;
&lt;p&gt;Eine Laufzeit von 3 Minuten bei einem Mehrverbrauch von 43 Watt entspricht einem Energieaufwand von 2.15 Wh.
Bei einem Preis von 32 Cent pro 1000 Wh (1 kWh) sind das 2.15/1000 * 32 = .0672 Cent zur Generierung der Ausgabe.&lt;/p&gt;
&lt;h1 id=&#34;selbst-coden&#34;&gt;
    &lt;a href=&#34;#selbst-coden&#34;&gt;
	Selbst coden
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Es gibt eine Ollama Python Bibliothek.
Diese tut nicht mehr, als Requests an &lt;code&gt;ollama serve&lt;/code&gt; zu senden:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ollama/ollama-python&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ollama-python&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ollama/ollama/tree/main/docs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ollama API Dokumentation&lt;/a&gt;

, api.md&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.mistral.ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mistral Model Documentation&lt;/a&gt;

, die Code-Beispiele dort gehen davon aus,
daß man deren Server verwendet. Das tun wir nicht, wir verwenden Ollama und eine lokale Instanz.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Die REST API ist in &lt;code&gt;api.md&lt;/code&gt; im Ollama Quelltext-Tree auf Github dokumentiert.&lt;/p&gt;
&lt;p&gt;Die &lt;code&gt;ollama.chat()&lt;/code&gt;-Funktion (und auch die gleichnamige Funktion der Mistral API, die gegen deren Instanz arbeitet),
hat einen Parameter &lt;code&gt;messages&lt;/code&gt; (Plural, eine Liste).
Das LLM ist stateless.
Es kann sich nicht an vorhergehende Nachrichten erinnern.
Daher muss man dem Modell bei jedem Request alle vorhergehenden Fragen und Antworten und auch den Systemprompt mitsenden.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ollama&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;mistral:instruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;messages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;instructions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_message&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_answer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Genauso muss man &lt;code&gt;options={}&lt;/code&gt; mitsenden, wenn man zum Beispiel mehr Kontext braucht.&lt;/p&gt;
&lt;p&gt;Die Anleitung zu Mistral gibt bessere
&lt;a href=&#34;https://docs.mistral.ai/guides/prompting_capabilities/#summarization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Summarization Prompts&lt;/a&gt;


als Beispiel und erklärt im hinteren Teil mehr zu Tokens, Tokenization und zum direkten Umgang mit dem LLM.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Operations Review Meeting (deutsch)</title>
      <link>https://blog.koehntopp.info/2024/04/18/operations-review-meeting-deutsch.html</link>
      <pubDate>Thu, 18 Apr 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/04/18/operations-review-meeting-deutsch.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://blog.koehntopp.info/2024/04/18/operations-review-meeting.html&#34;&gt;In English&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Montagnachmittag, &amp;ldquo;Operations Review Meeting&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Der perfekte Zeitpunkt, um sich während des Zoom Meetings ein Nickerchen zu gönnen,
während eine Gruppe von Management-Personen ohne technischen Hintergrund
sich für 90 Minuten einschläfernde PowerPoint-Folien vorführen wird.&lt;/p&gt;
&lt;p&gt;Fred Irgendwas, zuständig für den Wasauchimmer-Service,
berichtet stolz, dass die Anzahl der Prio 1-Vorfälle in diesem Quartal zwar um 17 Prozent gestiegen ist,
aber die TTR deutlich gesunken ist.
Das ist doch was Gutes, oder?&lt;/p&gt;
&lt;p&gt;Wie bitte?
Ein Blick ins Unternehmens-Jargon-Lexikon: TTR (Time To Resolution) ist die Zeit bis zur Lösungn des Incidents.&lt;/p&gt;
&lt;p&gt;Okay, Fred.
Zeit für eine Intervention.&lt;/p&gt;
&lt;p&gt;Siebzehn Prozent ist eine vertraute Zahl. Also hattet ihr im Q4 sechs P1s und jetzt habt ihr sieben?&lt;/p&gt;
&lt;p&gt;Fred bestätigt das.&lt;/p&gt;
&lt;p&gt;Gut. Wenn es 100 im Q4 und 117 im Q1 gewesen wären, dann würdest du jetzt Burger braten.&lt;/p&gt;
&lt;p&gt;Also Fred, das ist eine kleine, ganze Zahl.
Warum schaltest du nicht mal das Screen-Sharing aus,
und erzählst uns, was diese sieben Mal im Detail passiert ist,
als wir einen Produktionsausfall wegen des Wasauchimmer-Dienstes hatten?&lt;/p&gt;
&lt;p&gt;Fred weiß es nicht.
Er ist nicht technisch.
Er holt Jane in die Konferenz.&lt;/p&gt;
&lt;p&gt;Jane weiß Bescheid.
Jane ist ebenfalls nicht technisch, sie hat denselben MBA wie Fred,
aber der entscheidende Unterschied ist, dass Jane einen Pager trägt, weil Jane sich kümmert.&lt;/p&gt;
&lt;p&gt;Wenn ihr Team aufwacht, wacht sie auch auf, und so weiß sie wie es ist.
Sie &lt;strong&gt;versteht&lt;/strong&gt; es auf eine sehr greifbare und persönlich schmerzhafte Weise.
(Ich habe Joe zu Jane geändert, weil es zu 80 % eine Jane ist, die sich kümmert.)&lt;/p&gt;
&lt;p&gt;Jane berichtet,
dass drei der Q4-Vorfälle und vier der Q1-Vorfälle auf ein Problem mit der Passwortbereitstellung
zwischen Vault und den Datenbanken zurückzuführen sind.
Es kommt regelmäßig vor, dass einige Authentifizierungstoken nach einem Redeploy ablaufen,
obwohl der Redeploy diese mit aktualisieren sollte.&lt;/p&gt;
&lt;p&gt;Das ist interessant, viel interessanter als das Zahlen-Hokuspokus von Fred.&lt;/p&gt;
&lt;p&gt;Jane berichtet weiter,
dass die TTR gesunken ist, weil sie das Problem jetzt kennen
und es Teil der Deployment-Checkliste und der Incident-Resolution-Dokumentation ist.&lt;/p&gt;
&lt;p&gt;Auf die Frage, warum das Problem nicht an der Wurzel behoben wird,
erklärt Jane, dass dies ein Operations-Problem ist und nicht Teil des Feature-Entwicklungs-Backlogs,
und daher eine niedrige Priorität hat.
Backlog-Items mit niedriger Priorität schaffen es nie in den eigentlichen Sprint.&lt;/p&gt;
&lt;p&gt;Also, Jane,
was du uns damit sagen willst, ist,
dass wir Ausfallzeiten haben, die uns Geld durch verlorene Umsätze kosten,
weil wir Operations unterpriorisieren und nicht ernst nehmen.
Und weil wir das Feedback von Operations nicht in den Backlog-Priorisierungsprozess einfließen lassen?&lt;/p&gt;
&lt;p&gt;Jane stimmt dem zu, in diesem nervigen, unverbindlichen Unternehmenssprech, das wir alle hassen.
Sie erwähnt auch, dass die Operations unterbesetzt sind,
weil drei von den zusätzlichen benötigten Stellen abgelehnt wurden,
und die anderen beiden von Senior auf einen Regular und einen Junior herabgestuft wurden.
Operations wird das Problem also auch nicht selbst lösen können,
sondern ist auf eine Lösung aus dem Sprint des Feature-Teams angewiesen.&lt;/p&gt;
&lt;p&gt;Das Unternehmen zieht es vor, Geld für Entwickler auszugeben, denn Operations sind nur ein Kostenfaktor.&lt;/p&gt;
&lt;p&gt;Das Unternehmen erwägt den Umzug zu AWS, weil Operations ein schwieriges Thema ist,
und sie sich auf das Geschäft konzentrieren wollen.&lt;/p&gt;
&lt;p&gt;Die Wahrheit ist, dass sie keine Ahnung haben, wie ihre Geschäftsprozesse tatsächlich vor Ort ablaufen.
Und es ihnen im Grunde egal ist.
Und bald werden sie noch weniger davon verstehen, weil es von hier aus genau so weitergeht.
Die ganze Zeit.&lt;/p&gt;
&lt;p&gt;Das passiert in Unternehmen auf der ganzen Welt, und so häuft sich der Schlamassel an.
So, oder auf eine von einer Milliarde andere Arten, die tatsächlich isomorph zu dieser sind.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Operations Review Meeting (english)</title>
      <link>https://blog.koehntopp.info/2024/04/18/operations-review-meeting.html</link>
      <pubDate>Thu, 18 Apr 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/04/18/operations-review-meeting.html</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://blog.koehntopp.info/2024/04/18/operations-review-meeting-deutsch.html&#34;&gt;In Deutsch&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Monday Afternoon, &amp;ldquo;Operations Review Meeting&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Time to nap in front of the Zoom,
because a bunch of management persons with a non-technical background
will show each other snore-inducing powerpoint slides over a vidconf for 90 minutes.&lt;/p&gt;
&lt;p&gt;Fred Whatshisname, in charge of Dunnowhatchatmacallit,
relates that the number of P1 incidents for this quarter is up by 17 percent, but the TTR is down a lot,
so this is good, right?&lt;/p&gt;
&lt;p&gt;The what? Bringing up the corporatese abbreviation lexicon: TTR is the the Time To Resolution.&lt;/p&gt;
&lt;p&gt;Okay, Fred.
Time to stage an intervention.&lt;/p&gt;
&lt;p&gt;Seventeen percent is a familiar number. So in Q4 you had six P1&amp;rsquo;s and now you have seven?&lt;/p&gt;
&lt;p&gt;Fred acknowledges that.&lt;/p&gt;
&lt;p&gt;Good. If it was 100 in Q4 and 117 in Q1, you&amp;rsquo;d be flipping burgers now.&lt;/p&gt;
&lt;p&gt;So Fred, this is a tiny integer.
Why don&amp;rsquo;t you turn off the screen sharing,
and tell us what actually happened these seven times
that we had a loss of prod because of the Dunnowhatchatmacallit service being down?&lt;/p&gt;
&lt;p&gt;Fred does not know.
He is not technical.
He joins Jane into the conf.&lt;/p&gt;
&lt;p&gt;Jane knows.
Jane is also not technical, she has the same type of MBA that Fred has,
but the critical difference is that Jane carries a pager, because Jane cares.&lt;/p&gt;
&lt;p&gt;When her team wakes up, she wakes up and that is how she knows.
She actually &lt;strong&gt;understands&lt;/strong&gt; in a very visceral and personally painful way.
(I edited Joe to Jane, because 80% of the time it&amp;rsquo;s a Jane that cares.)&lt;/p&gt;
&lt;p&gt;Jane relates
that three of the Q4 incidents and four of the Q1&amp;rsquo;s are related to a problem with password provisioning
between vault and the databases.
It happens that some authentication token expires after a re-deploy,
and is not refreshed as part of the re-deploy.&lt;/p&gt;
&lt;p&gt;Now, this is interesting, way more interesting than the number hocus-pocus by Fred.&lt;/p&gt;
&lt;p&gt;Jane further relates
that the TTR is down because they now know about the problem
and have it as part of the deploy checklist, and the incident resolution documentation.&lt;/p&gt;
&lt;p&gt;When asked why the problem it not fixed at the source,
Jane relates that this is an operations problem and not part of the feature development backlog,
and hence has a low priority.
Low priority feature requests never make it into the actual sprint, ever, though.&lt;/p&gt;
&lt;p&gt;So, Jane,
what you are telling us is
that we have downtime that costs us money in lost business,
because we underprioritise operations by not taking them seriously.
And by not putting operations feedback into the backlog prioritization process?&lt;/p&gt;
&lt;p&gt;Jane agrees in this annoying noncommittal corpspeak lingo we all hate.
She also mentions that operations is understaffed,
because the three more people needed have been denied
and the other two have been downgraded from Senior to one Regular and one Junior.&lt;/p&gt;
&lt;p&gt;The company prefers to spend money on developers, operations is just a cost center.&lt;/p&gt;
&lt;p&gt;The company considers moving to AWS, because operations is hard,
and they want to focus on the business.&lt;/p&gt;
&lt;p&gt;The truth is that they have no idea how their business processes actually work on the ground,
and do not care, and soon they will understand even less of that,
because that is how things go from here.
All the time.&lt;/p&gt;
&lt;p&gt;This happens in enterprises all around the world, and that is how the suck accumulates.
This way or one of a gazillion ways that are actually isomorphic to this experience.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Support as a public performance</title>
      <link>https://blog.koehntopp.info/2024/04/17/support-as-a-public-performance.html</link>
      <pubDate>Wed, 17 Apr 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/04/17/support-as-a-public-performance.html</guid>
      <description>&lt;p&gt;Support has been working in Slack for years.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s a &lt;code&gt;#java&lt;/code&gt; channel where people can join and ask, a &lt;code&gt;#dba&lt;/code&gt; channel and a &lt;code&gt;#k8s&lt;/code&gt; channel, and there is of course &lt;code&gt;#live&lt;/code&gt;.
Each has a small four digit number of people attending, with &lt;code&gt;#live&lt;/code&gt; not quite reaching five digits.&lt;/p&gt;
&lt;p&gt;Some pretty old and clueful people sit in these channels.
Often they just watch the questions scroll by.
But sometimes one of the Great Old Ones stirs in their slumber and raises to the surface,
stretching tentacles and grabbing a question or a support case that looks interesting or weird.&lt;/p&gt;
&lt;p&gt;The Great Old Ones love their shinies.&lt;/p&gt;
&lt;p&gt;Management is annoyed by this arrangement.
They love their Jira, because Jira actually quantifies support, you know.
It makes tracking KPIs so much easier,
and then we can see if we managed to fulfill our critical TTR OKR for Q423 or not, instantly.&lt;/p&gt;
&lt;p&gt;Unfortunately, the company does not earn money with bringing down the TTR OKR for support in any quarter at all.&lt;/p&gt;
&lt;p&gt;Moving the support from Slack to Jira
has turned a public interactive performance and discussion of operations and operational problems
into a set of highly permissioned 1:1 interactions and carefully tracked escalations.
They have carefully assigned priorities and have tracked resolution times.&lt;/p&gt;
&lt;p&gt;The Great Old Ones are blindsided now, because no one,
not even they with their unnatural ancient power beyond what is allowed for mere mortals,
can read Jira horizontally across all tickets.
And if they did, and rose and grabbed a ticket, maybe that ticket is resolved.
But all the others would not have seen this spectacle of noneuclidic debugging
and knowledge about systems from before the dawn of time,
nor would they have been able to learn from this.&lt;/p&gt;
&lt;p&gt;Probably for good,
because people have been known to go insane from just reading the deploy scripts that drive these systems.
And let&amp;rsquo;s not even speak about the abominations that these C++ JNI methods actually hold.
As a mere Java coder you will never know,
and you should be thankful for that and every second of your life that you do not know about this.&lt;/p&gt;
&lt;p&gt;Anyway.&lt;/p&gt;
&lt;p&gt;In Slack questions often triggered +1&amp;rsquo;s. Somebody asks about a problem,
and others would chime in &amp;ldquo;That was me!&amp;rdquo;, &amp;ldquo;I am having the same problem,
it&amp;rsquo;s company wide&amp;rdquo; or &amp;ldquo;We know this, and for us this workaround is helpful&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Moving support from Slack to Jira cut that off.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Capability_Maturity_Model_Integration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/support-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Is that bad?
No, this was not a mature process, it was individual heroics, a 0 or 1 on the
&lt;a href=&#34;https://en.wikipedia.org/wiki/Capability_Maturity_Model_Integration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;process maturity scale&lt;/a&gt;

.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;These days, the ticket correlation process corp set up would find the same correlations,
reliably and with a maturity of 5
(quantifiably tracked and continuously improved).
Often, it takes only 4-8 weeks to get the same information as before with the immature process.
And on top,
it is now orderly documented and traceable as a KPI instead of happening coincidentally when the problem was current.&lt;/p&gt;
&lt;p&gt;Also, the company now has architecture review boards,
and a tech radar that manages these kinds of things pretty successfully.&lt;/p&gt;
&lt;p&gt;A bunch of MBAs has been promoted on this.&lt;/p&gt;
&lt;p&gt;This is how process and civilization work.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Snake Oil</title>
      <link>https://blog.koehntopp.info/2024/02/10/snake-oil.html</link>
      <pubDate>Sat, 10 Feb 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/10/snake-oil.html</guid>
      <description>&lt;p&gt;Dieser Text ist auch in
&lt;a href=&#34;https://blog.koehntopp.info/2024/02/09/schlangenoel.html&#34;&gt;deutscher Sprache&lt;/a&gt;

 vorhanden.&lt;/p&gt;
&lt;p&gt;This week was &amp;ldquo;Broken Security Software Advertising Week.&amp;rdquo;&lt;/p&gt;
&lt;h1 id=&#34;fortigate-and-ivanti&#34;&gt;
    &lt;a href=&#34;#fortigate-and-ivanti&#34;&gt;
	Fortigate and Ivanti
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;First off, &lt;strong&gt;today&lt;/strong&gt; was Fortigate patch day:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-23113, CVSSV3 Score 9.8, Unauthorized Code Execution, &amp;ldquo;Format String Bug&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A use of &lt;a href=&#34;https://cwe.mitre.org/data/definitions/134.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;externally-controlled format string&lt;/a&gt;

 vulnerability
in FortiOS &lt;code&gt;fgfmd&lt;/code&gt; daemon may allow a remote unauthenticated attacker to execute arbitrary code or
commands via specially crafted requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;This is a case where a C function accepts a format string like &lt;code&gt;&amp;quot;Blah %s Nonsense&amp;quot;&lt;/code&gt;,
to assemble a log message or a command for a &lt;code&gt;system()&lt;/code&gt; call.
However, the developer did not statically set the format parameter of the command to a format string
(&lt;code&gt;snprintf(buffer, length, &amp;quot;Blah %s Nonsense&amp;quot;, user_input)&lt;/code&gt;),
but instead took the user input as the format
(&lt;code&gt;snprintf(buffer, length, user_input))&lt;/code&gt;.
The user input can thus be used to do all sorts of things.&lt;/p&gt;
&lt;p&gt;This is a mistake automatically detected by the usual source code scanners.
If you try to commit or merge something like this in a modern development environment,
the scanner will thoroughly humiliate you,
the commit will be rejected, and you will be assigned a security training.&lt;/p&gt;
&lt;p&gt;This means this type of error does not occur in a contemporary development environment anymore.&lt;/p&gt;
&lt;p&gt;Also, &lt;strong&gt;yesterday&lt;/strong&gt; was Fortigate patch day:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-21762, CVSSV3 Score 9.6, Unauthorized Code Execution, &amp;ldquo;Out of Bounds Write&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A &lt;a href=&#34;https://cwe.mitre.org/data/definitions/787.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;out-of-bounds write&lt;/a&gt;

 vulnerability
in FortiOS may allow a remote unauthenticated attacker to execute arbitrary code or command via specially crafted HTTP requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;This is a mistake easily made in C or other languages without index checking when accessing arrays.
In C, for example, one can access memory before the array using negative indices,
and if an error code is -1, but the error code is not checked after a function call, then everything goes up in flames.&lt;/p&gt;
&lt;p&gt;This type of error is not always found by source code scanners with a static analyzer,
but most cases should be flagged by the scanner as a code smell.&lt;/p&gt;
&lt;p&gt;Well, unfortunately, &lt;strong&gt;the day before yesterday&lt;/strong&gt; was also a Fortigate patch day.
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/fortinet-warns-of-new-fortisiem-rce-bugs-in-confusing-disclosure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BleepingComputer reports&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In this instance, due to an issue with the API which we are currently investigating,
rather than an edit, this resulted in two new CVEs being created, duplicates of the original CVE-2023-34992,
FortiNet told BleepingComputer.&lt;/p&gt;
&lt;p&gt;However, it turns out that CVE-2024-23108 and CVE-2024-23109 are actually patch bypasses for the CVE-2023-34992
flaw discovered by Horizon3 vulnerability expert Zach Hanley.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So, this was a patch for a patch because the mitigation didn&amp;rsquo;t work,
and Fortinet got confused with the CVE numbers due to the sheer volume of them currently open.&lt;/p&gt;
&lt;p&gt;Meanwhile, the US CISA (Cybersecurity and Infrastructure Security Agency)
is demanding all US institutions to shut down Ivanti VPN (formerly Juniper Pulse Secure):&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&amp;ldquo;CISA is requiring all Federal agencies to disconnect Ivanti products by Friday at midnight
(Ivanti Connect Secure &amp;amp; Ivanti Policy Secure).
This is roughly 48-hours notice, to not patch, but rip it out!
Ivanti is an American company.
This is unprecedented.&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;While the
&lt;a href=&#34;https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;original directive&lt;/a&gt;


could initially be interpreted as an update, re-installation, and reconfiguration, this hope has now been dashed.&lt;/p&gt;
&lt;p&gt;The patches mentioned are not suitable for fixing the error.
&lt;a href=&#34;https://infosec.exchange/@briankrebs/111863433959430768&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Brian Krebs has summarized this issue&lt;/a&gt;

:&lt;/p&gt;
&lt;p&gt;Meanwhile, someone opened up the Ivanti image and took a look inside.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Versions of software that have been routinely outdated for more than a decade in the current image.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;As curl developer Stefan Eissing phrases it, these are &amp;ldquo;corpse parts and zombie software.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;And, as expected, a few days after the CISA-mandated patch frenzy,
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/ivanti-patch-new-connect-secure-auth-bypass-bug-immediately/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BleepingComputer headlines again&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ivanti: Patch new Connect Secure auth bypass bug immediately&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The flaw (CVE-2024-22024) is due to an XXE
(&lt;a href=&#34;https://cwe.mitre.org/data/definitions/611.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;XML eXternal Entities&lt;/a&gt;

) weakness in the gateways&amp;rsquo; SAML component
that lets remote attackers gain access to restricted resources on unpatched appliances in low-complexity
attacks without requiring user interaction or authentication.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SAML, Security Assertion Markup Language, is an XML notation for access rights in Single Sign-On systems.
Because it&amp;rsquo;s an XML notation, it can have these &lt;code&gt;&amp;amp;blablub;&lt;/code&gt; things – Entities – that are replaced by other text.
With External Entities, the replacement text is not locally fixed but is downloaded from the net.&lt;/p&gt;
&lt;p&gt;What does this mean in the context of SAML?
It means that the access rights in the document are not necessarily fixed;
an attacker can load Entity definitions from the net.
Depending on where the Entity is used, it can partially or completely rewrite the SAML file and grant different rights.&lt;/p&gt;
&lt;p&gt;XML parsers are well understood,
and XXE is something that can be reliably scanned for automatically with a source code scanner.
This type of error is easily avoidable in modern development environments.&lt;/p&gt;
&lt;h1 id=&#34;antivirus-and-endpoint-security&#34;&gt;
    &lt;a href=&#34;#antivirus-and-endpoint-security&#34;&gt;
	Antivirus and Endpoint Security
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;This is not an exception and is not limited to VPN gateways,
but rather manufacturers of security software happily rely on
&amp;ldquo;security-relevant software with privileges, and programming methods from the 90s of the last millennium.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Examples from this blog:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2017/10/20/aslr.html&#34;&gt;ASLR&lt;/a&gt;

: macOS Trend Micro Binary without ASLR, every exploit (yes, there are some)
automatically stable across the entire fleet.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2018/06/18/websense-dlp-gives-instant-root.html&#34;&gt;Websense DLP gives instant root&lt;/a&gt;

:
WebSense DLP ships outdated software versions and an exploitable kernel module, probably missing QA and defective shipping process.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is so widespread in endpoint security that, for example,
&lt;a href=&#34;https://mastodon.social/@joxean&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@joxean&lt;/a&gt;


has written an entire book about it:
&lt;a href=&#34;https://www.amazon.de/Antivirus-Hackers-Handbook-English-ebook/dp/B014MJ6AKS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Antivirus Hacker&amp;rsquo;s Handbook&lt;/a&gt;

.
It describes how to find vulnerabilities of this kind in every – literally every – AV software.&lt;/p&gt;
&lt;p&gt;This is systematic: It is due to the way this software is designed and developed, and it cannot be fixed with patches.&lt;/p&gt;
&lt;p&gt;I know this because I played this game for a few years with a company Mac:
I used the so-called &amp;ldquo;security tools&amp;rdquo; that Corp installed on my Mac to gain privileges on my Mac.&lt;/p&gt;
&lt;p&gt;The whole process is reliably repeatable, and I never had to invest more than a slow Friday afternoon in any case.
And I am not even a &amp;ldquo;security researcher,&amp;rdquo; just an amateur with reverse engineering experience from the C64 era.&lt;/p&gt;
&lt;p&gt;It is this software, which is supposed to protect, ending up making the computer vulnerable.
When someone like Fefe talks about &lt;a href=&#34;https://blog.fefe.de/?q=Schlangen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;snake oil&lt;/a&gt;

, it is to be taken literally.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Snake_oil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Snake-Oil&lt;/a&gt;

 is a term used to describe deceptive marketing,
health care fraud, or a scam.
Similarly, snake oil salesman is a common label used to describe someone who sells, promotes,
or is a general proponent of some valueless or fraudulent cure, remedy, or solution.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;a-list-of-problems-and-outdated-processes&#34;&gt;
    &lt;a href=&#34;#a-list-of-problems-and-outdated-processes&#34;&gt;
	A List of Problems and Outdated Processes
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;We are talking about critically security-relevant software here,
which is supposed to prevent the intrusion of malware and attackers on computers,
or is supposed to detect such attacks, or has authentication or some other form of security-relevant function.&lt;/p&gt;
&lt;p&gt;It runs at critical points, often with privileges, and when it fails, it is not just one machine,
but often an entire company that is critically exposed.&lt;/p&gt;
&lt;p&gt;Such software should be developed with tools and methods that are state-of-the-art
and undergo critical inspection with regard to correctness, freedom from errors, and currency of dependencies.&lt;/p&gt;
&lt;p&gt;However, we see errors that suggest deficiencies in the development process at all points.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We are seeing critical errors that would not have to have major problematic impact
if the software had been written with minimal rights from the outset.
But running parsers for complex, unknown data formats that may contain potentially malicious payloads with privileges?
And then turning off elementary security mechanisms such as ASLR?
That means setting up for maximum damage.
It is not a winnable position.&lt;/li&gt;
&lt;li&gt;Doing all this in 2024 in C, when Go or Rust could have been used? Not particularly smart either.&lt;/li&gt;
&lt;li&gt;Packing your deliverables with software that, in the case of Ivanti, has been without patches for up to two decades?
Correct would be to have an automated release process that assembles a new release from the latest versions of everything
and tests it automatically.
What Ivanti delivers is not just &amp;ldquo;not state-of-the-art,&amp;rdquo; it is grossly negligent.&lt;/li&gt;
&lt;li&gt;Delivering all this in an encrypted image, instead of with a &amp;ldquo;SBOM of Shame&amp;rdquo;
is soon to be a federal crime in the USA, and the EU is on the same path. Good.
(An SBOM is a Software Bill Of Materials, a list of the dependencies used and their versions.)&lt;/li&gt;
&lt;li&gt;A &amp;ldquo;Format String Bug&amp;rdquo; or an &amp;ldquo;XML External Entities Vulnerability&amp;rdquo; are trivial errors that source code scanners can detect.
Such source scanners are being advertised by these security firms themselves or even developed in-house.
But these tools are not in use internally, because otherwise, such code could never have made it into a product.
This does not require AI; in part, these are better regular expressions, sometimes a bit of static analysis.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As external observers, based on the demonstrated error patterns,
we are witnessing a failure along the entire software development chain:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;At the architecture level (not minimizing rights),&lt;/li&gt;
&lt;li&gt;at the tool level (no scanners for trivial errors, outdated dependencies, no automation in build and release),&lt;/li&gt;
&lt;li&gt;at the packaging level (the defective permissions in Websense, for example),&lt;/li&gt;
&lt;li&gt;and at every other point where one can infer the process from the errors observed from the outside.
&lt;ul&gt;
&lt;li&gt;For example, &amp;ldquo;no functioning code review and audit&amp;rdquo;
(&amp;ldquo;statically compiled-in backdoor passwords,&amp;rdquo; as are a persistent problem at Cisco, fall under this).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These are thus management errors in the leadership of software companies that produce security-critical software.
It is the responsibility of management to establish and control processes that ensure a minimum level of quality.&lt;/p&gt;
&lt;p&gt;The notion &amp;ldquo;software errors, nothing can be done about it&amp;rdquo; is incorrect –
there are entire classes of errors that can be definitively avoided through architecture,
automatic scanning,
education,
review,
and testing.
It is the responsibility of management to establish and control such processes.&lt;/p&gt;
&lt;p&gt;All in all, one can only conclude that irresponsible hack shops without fundamental software development processes
are masquerading as &amp;ldquo;security&amp;rdquo; companies.
They are packaging radioactive toxic waste in glossy packages,
thereby building a highway for nation-state actors into the heart of critical infrastructures.&lt;/p&gt;
&lt;p&gt;In some cases, the nature of the error borders on deliberate sabotage, or,
to put it another way, it could hardly be worse with deliberate sabotage.&lt;/p&gt;
&lt;h1 id=&#34;1010-no-notes&#34;&gt;
    &lt;a href=&#34;#1010-no-notes&#34;&gt;
	10/10, no notes
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;On IRC, my friends joke:
&amp;ldquo;Are you a 10/10 company?&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Security vulnerabilities are not only assigned a unique number, the CVE number,
but they also receive a severity grade,
the &lt;a href=&#34;https://en.wikipedia.org/wiki/Common_Vulnerability_Scoring_System&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CVSS-Score&lt;/a&gt;

.
A 10/10 is the maximum grade, but basically, anything above 8 is considered
&lt;a href=&#34;https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a total loss and complete process failure&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;There is now a historical CVE database that can be
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/cvssscoremin-9/cvssscoremax-10/vulnerabilities.html?page=1&amp;amp;cvssscoremin=9&amp;amp;cvssscoremax=10&amp;amp;order=3&amp;amp;trc=40515&amp;amp;sha=2721cbf47ba1e57d8b65ae1c3cf8883295fd04d7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sorted by CVSS score&lt;/a&gt;

,
and also narrowed down to companies like
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/vendor_id-3080/Fortinet.html?page=1&amp;amp;cvssscoremin=9&amp;amp;order=3&amp;amp;trc=103&amp;amp;sha=0ba96ce0b5ea0195196988ef1d381bdd33622c49&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fortinet&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;We then see for Fortinet a series of 12 errors with a 10/10 rating,
specifically 2x in 2024, 1x in 2021, 1x in 2019, 3x in 2017, 4x in 2016, and once in 2005.
This can also be summarized as &amp;ldquo;no improvement is observable.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Security is a process,&amp;rdquo; it is often said.
For Business Continuity Management, I once wrote down what that means:
&lt;a href=&#34;https://blog.koehntopp.info/2023/02/18/this-is-not-a-drill.html&#34;&gt;This is not a Drill. This is just Tuesday&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Similar considerations can be made for secure software development processes,
and there are even ready-made process blueprints available for this purpose.
Furthermore, as I have shown, the patterns of errors can reveal the weaknesses in the internal development process
with regard to security best practices.
The numbers of CVEs and CVSS scores can indicate whether a company has improved its posture.&lt;/p&gt;
&lt;p&gt;If it is apparent that this has not been the case over the years, how can a purchasing decision be made positively?
Something to think about.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/meerschweinchen-anne.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Some things can only be made bearable with cute guinea pig photos.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Schlangenöl</title>
      <link>https://blog.koehntopp.info/2024/02/09/schlangenoel.html</link>
      <pubDate>Fri, 09 Feb 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/09/schlangenoel.html</guid>
      <description>&lt;p&gt;This text also has a version in
&lt;a href=&#34;https://blog.koehntopp.info/2024/02/10/snake-oil.html&#34;&gt;english language&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Diese Woche war &amp;ldquo;Kaputte Security Software Werbewoche&amp;rdquo;.&lt;/p&gt;
&lt;h1 id=&#34;fortigate-und-ivanti&#34;&gt;
    &lt;a href=&#34;#fortigate-und-ivanti&#34;&gt;
	Fortigate und Ivanti
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Zunächst einmal war &lt;strong&gt;heute&lt;/strong&gt; Fortigate Patchday:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-23113, CVSSV3 Score 9.8, Unauthorized Code Execution, &amp;ldquo;Format String Bug&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A use of &lt;a href=&#34;https://cwe.mitre.org/data/definitions/134.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;externally-controlled format string&lt;/a&gt;

 vulnerability
in FortiOS &lt;code&gt;fgfmd&lt;/code&gt; daemon may allow a remote unauthenticated attacker to execute arbitrary code or
commands via specially crafted requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Das ist ein Fall, wo eine C-Funktion einen Formatstring mit &lt;code&gt;&amp;quot;Bla %s Fasel&amp;quot;&lt;/code&gt; annimmt,
um etwa eine Log-Nachricht oder ein Kommando für einen &lt;code&gt;system()&lt;/code&gt; Aufruf zusammenzubauen.
Der Entwickler hat jedoch den Format-Parameter des Kommandos nicht statisch auf einen Formatstring gesetzt
(&lt;code&gt;snprintf(buffer, length, &amp;quot;Bla %s Fasel&amp;quot;, benutzereingabe)&lt;/code&gt;),
sondern stattdessen die Benutzereingabe als Format genommen
(&lt;code&gt;snprintf(buffer, length, benutzereingabe)&lt;/code&gt;).
Die Benutzereingabe kann so verwendet werden, um alles Mögliche zu tun.&lt;/p&gt;
&lt;p&gt;Das ist ein Fehler, der von den üblichen Sourcecodescannern automatisch erkannt wird,
und wenn man in einer modernen Entwicklungsumgebung versucht, so etwas zu comitten oder zu mergen,
dann wird man vom Scanner ganz furchtbar erniedrigt, der Commit zurückgewiesen und man bekommt ein Security-Training zugewiesen.&lt;/p&gt;
&lt;p&gt;Will sagen, dieser Fehler tritt in einer zeitgemäßen Development-Umgebung nicht mehr auf.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Auch gestern&lt;/strong&gt; war Fortigate Patchday:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-21762, CVSSV3 Score 9.6, Unauthorized Code Execution, &amp;ldquo;Out of Bounds Write&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A &lt;a href=&#34;https://cwe.mitre.org/data/definitions/787.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;out-of-bounds write&lt;/a&gt;

 vulnerability
in FortiOS may allow a remote unauthenticated attacker to execute arbitrary code or command via specially crafted HTTP requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Das ist ein Fehler, der in C oder anderen Sprachen ohne Indexprüfung beim Zugriff auf Arrays gerne gemacht wird.
In C kann man zum Beispiel mit negativen Indices auf Speicher vor dem Array zugreifen, und
wenn ein Error-Code &lt;code&gt;-1&lt;/code&gt; ist, aber nach einem Funktionsaufruf der Error-Code nicht geprüft wird,
dann brennt alles nieder.&lt;/p&gt;
&lt;p&gt;Diese Sorte Fehler wird von Source Code Scannern mit statischem Analyzer nicht immer gefunden,
aber meistens und alle Fälle, wo das nicht passiert, sollten von dem Ding eigentlich als Code Smell angemerkt werden.&lt;/p&gt;
&lt;p&gt;Nun. Leider war &lt;strong&gt;auch vorgestern&lt;/strong&gt; Fortigate Patchday.
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/fortinet-warns-of-new-fortisiem-rce-bugs-in-confusing-disclosure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BleepingComputer schreibt&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In this instance, due to an issue with the API which we are currently investigating,
rather than an edit, this resulted in two new CVEs being created, duplicates of the original CVE-2023-34992,
FortiNet told BleepingComputer.&lt;/p&gt;
&lt;p&gt;However, it turns out that CVE-2024-23108 and CVE-2024-23109 are actually patch bypasses for the CVE-2023-34992
flaw discovered by Horizon3 vulnerability expert Zach Hanley.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Das war also ein Patch für einen Patch, weil die Mitigation nicht funktioniert hat und
Fortinet kam mit den CVE-Nummern durcheinander, weil gerade so viele davon offen sind.&lt;/p&gt;
&lt;p&gt;Unterdessen fordert die US CISA (Cybersecurity and Infrastructure Security Agency) von allen US-Institutionen das
Abschalten von Ivanti VPN (vormals Juniper Pulse Secure):&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&amp;ldquo;CISA is requiring all Federal agencies to disconnect Ivanti products by Friday at midnight
(Ivanti Connect Secure &amp;amp; Ivanti Policy Secure).
This is roughly 48-hours notice, to not patch, but rip it out!
Ivanti is an American company.
This is unprecedented.&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Während man
&lt;a href=&#34;https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;die Originaldirektive&lt;/a&gt;


ursprünglich noch als Update und Reinstallation sowie Neukonfiguration lesen konnte
hat sich diese Hoffnung mittlerweile zerschlagen.&lt;/p&gt;
&lt;p&gt;Die Patches, von denen dort die Rede ist, sind nicht geeignet, den Fehler zu beheben.
&lt;a href=&#34;https://infosec.exchange/@briankrebs/111863433959430768&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Brian Krebs hat das zusammengefasst&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Unterdessen hat jemand das Ivanti Image mal aufgemacht und reingesehen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Versionen von Software, die routinemäßig seit mehr als einer Dekade veraltet sind in einem aktuellen Image.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Das sind, wie curl-Entwickler Stefan Eissing formuliert &amp;ldquo;Leichenteile und Zombie Software&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Und, es kommt, wie es kommen muss:
Einige Tage nach der von CISA vorgeschriebenen Patchorgie
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/ivanti-patch-new-connect-secure-auth-bypass-bug-immediately/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;titelt BleepingComputer erneut&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ivanti: Patch new Connect Secure auth bypass bug immediately&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The flaw (CVE-2024-22024) is due to an XXE
(&lt;a href=&#34;https://cwe.mitre.org/data/definitions/611.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;XML eXternal Entities&lt;/a&gt;

) weakness in the gateways&amp;rsquo; SAML component
that lets remote attackers gain access to restricted resources on unpatched appliances in low-complexity
attacks without requiring user interaction or authentication.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SAML, Security Assertion Markup Language, ist eine XML-Notation für Zugriffsrechte in Single-Sign-On Systemen.
Weil es eine XML-Notation ist, kann es dort diese &lt;code&gt;&amp;amp;blablub;&lt;/code&gt;-Dinger geben – Entities – die durch anderen Text ersetzt werden.
Bei External Entities liegt der Ersetzungstext nicht lokal fest, sondern wird aus dem Netz nachgeladen.&lt;/p&gt;
&lt;p&gt;Was heißt das im Kontext von SAML? Es bedeutet, die Zugriffsrechte sind im Dokument also nicht zwingend festgenagelt,
sondern ein Angreifer kann Entity Definitionen aus dem Netz nachladen.
Je nachdem, wo die Entity verwendet wird, kann man damit die SAML-Datei in Teilen oder ganz umschreiben und sich andere Rechte geben.&lt;/p&gt;
&lt;p&gt;XML-Parser sind gut verstanden und XEE sind ein Ding, auf das man mit einem Sourcecode-Scanner zuverlässig automatisch scannen kann.
Diese Sorte Fehler ist in modernen Entwicklungsumgebungen gut auszuschließen.&lt;/p&gt;
&lt;h1 id=&#34;antivirus-und-endpoint-security&#34;&gt;
    &lt;a href=&#34;#antivirus-und-endpoint-security&#34;&gt;
	Antivirus und Endpoint Security
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das ist alles keine Ausnahme und auch nicht auf VPN-Gateways beschränkt,
sondern Hersteller von Security Software setzen fröhlich auf
&amp;ldquo;Security-Relevante Software mit Privilegien, und Programmiermethoden aus den 90er Jahren des letzten Jahrtausends&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Beispiele aus diesem Blog:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2017/10/20/aslr.html&#34;&gt;ASLR&lt;/a&gt;

: MacOS Trend Micro Binary mit ohne ASLR, jeder Exploit
(ja, es gibt welche) ist automatisch stabil über die ganze Flotte.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2018/06/18/websense-dlp-gives-instant-root.html&#34;&gt;Websense DLP gives instant root&lt;/a&gt;

:
WebSense DLP veraltete Softwareversionen und exploitbares Kernelmodul, vermutlich fehlende QA und defekter Shipping Prozess.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Das ist bei Endpoint Security so verbreitet, daß zum Beispiel
&lt;a href=&#34;https://mastodon.social/@joxean&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@joxean&lt;/a&gt;

 ein ganzes Buch darüber geschrieben hat:
&lt;a href=&#34;https://www.amazon.de/Antivirus-Hackers-Handbook-English-ebook/dp/B014MJ6AKS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Antivirus Hacker&amp;rsquo;s Handbook&lt;/a&gt;

.
beschreibt, wie man Sicherheitslücken dieser Art in jeder, wirklich jeder AV Software findet.&lt;/p&gt;
&lt;p&gt;Das ist systematisch:
Es liegt an der der Art und Weise, wie diese Software designt und entwickelt wird,
und es ist auch mit Patchs nicht zu beheben.&lt;/p&gt;
&lt;p&gt;Ich weiß das, weil ich dieses Spiel einige Jahre mit einem Firmen-Mac gespielt habe:
Ich habe die sogenannten &amp;ldquo;Security Tools&amp;rdquo; verwendet, die Corp auf meinem Mac installiert, um auf meinem Mac Privilegien zu bekommen.&lt;/p&gt;
&lt;p&gt;Der ganze Prozess ist zuverlässig wiederholbar,
und ich habe in keinem Fall mehr als einen langsamen Freitagnachmittag dafür investieren müssen.
Dabei bin ich noch nicht einmal &amp;ldquo;Security-Researcher&amp;rdquo;,
sondern nur ein Amateur mit Reverse-Engineering Erfahrung aus dem C64-Zeitalter.&lt;/p&gt;
&lt;p&gt;Es ist diese Software, die angeblich schützen soll, die am Ende dazu führt, daß der Rechner angreifbar wird.
Wenn jemand wie Fefe von &lt;a href=&#34;https://blog.fefe.de/?q=Schlangen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Schlangenöl&lt;/a&gt;

 redet, dann ist das wortwörtlich zu verstehen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Snake_oil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Snake-Oil&lt;/a&gt;

 is a term used to describe deceptive marketing,
health care fraud, or a scam.
Similarly, snake oil salesman is a common label used to describe someone who sells, promotes,
or is a general proponent of some valueless or fraudulent cure, remedy, or solution.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;eine-problemliste-und-veraltete-prozesse&#34;&gt;
    &lt;a href=&#34;#eine-problemliste-und-veraltete-prozesse&#34;&gt;
	Eine Problemliste und veraltete Prozesse
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Wir reden hier von kritisch security-relevanter Software,
die das Eindringen von Schadsoftware und Angreifern auf Rechnern verhindern soll,
oder die solche Angriffe erkennen soll,
oder die Authentisierung oder sonst eine Form von sicherheitsrelevanter Funktion hat.&lt;/p&gt;
&lt;p&gt;Sie läuft an kritischer Stelle, oft mit Privilegien und wenn sie versagt, ist meist nicht nur eine Maschine,
sondern eine ganze Firma kritisch exponiert.&lt;/p&gt;
&lt;p&gt;Solche Software sollte eigentlich mit Werkzeugen und Methoden, die Stand der Technik sind, entwickelt werden
und besonderer Beobachtung hinsichtlich Korrektheit, Fehlerfreiheit und Aktualität von Dependencies unterliegen.&lt;/p&gt;
&lt;p&gt;Wir sehen jedoch Fehler, die auf Defizite im Entwicklungsprozeß an allen Stellen schließen lassen.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wir sehen kritische Fehler, die keine groß problematischen Auswirkungen haben müßten,
wenn die Software von vorher herein rechteminimal geschrieben worden wäre.
Aber Parser für komplexe, unbekannte Datenformate, die potenziell bösartige Payloads enthalten,
mit Privilegien laufen zu lassen?
Und dann noch elementare Sicherheitsmechanismen des Betriebssystems abschalten?
Das bedeutet, sich für Maximalschaden aufzustellen.
Es ist keine gewinnbare Position.&lt;/li&gt;
&lt;li&gt;Das alles in 2024 in C zu tun, wenn man Go oder Rust zur Verfügung hätte?
Auch nicht sonderlich schlau.&lt;/li&gt;
&lt;li&gt;Seine Deliverables mit Software vollzupacken, die im Fall von Ivanti bis zu zwei Dekaden
ohne Patches auf dem Buckel hat, anstatt einen automatisierten Release-Prozess zu haben, der ein neues
Release aus den neusten Versionen von allem zusammenschraubt und automatisch testet?
Das ist nicht nur &amp;ldquo;nicht Stand der Technik&amp;rdquo;, sondern es ist grob fahrlässig.&lt;/li&gt;
&lt;li&gt;Das alles dann in einem verschlüsselten Image auszuliefern, statt mit einer &amp;ldquo;SBOM of Shame&amp;rdquo;
(Software Bill Of Materials, eine Liste der verwendeten Dependencies und ihrer Versionen)
ist bald schon ein Federal Crime in den USA, und auch die EU ist auf diesem Weg.
Gut so.&lt;/li&gt;
&lt;li&gt;Ein &amp;ldquo;Format String Bug&amp;rdquo; oder eine &amp;ldquo;XML External Entities Vulnerability&amp;rdquo; sind triviale Fehler,
die Source Code Scanner erkennen können, wie sie von diesen Securityfirmen selbst beworben
oder gar im eigenen Haus entwickelt werden.
Aber offensichtlich sind diese Werkzeuge im Hause nicht im Einsatz, denn sonst hätte solcher Code niemals in
ein Produkt gelangen können.
Dazu braucht es keine KI, teilweise sind das bessere Regular Expressions, manchmal ein bisschen statische Analyse.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wir beobachten hier als Außenstehende auf der Grundlage der gezeigten Fehlerbilder ein
Versagen entlang der gesamten Software Development Chain:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Auf der Architektur-Ebene (nicht rechteminimal),&lt;/li&gt;
&lt;li&gt;auf der Tool-Ebene (keine Scanner für triviale Fehler, veraltete Dependencies, keine Automation beim Build und Release)&lt;/li&gt;
&lt;li&gt;auf der Packaging-Ebene (die defekten Permissions bei Websense zum Beispiel)&lt;/li&gt;
&lt;li&gt;und an jeder anderen Stelle, bei der man von außen durch die Fehler auf den Prozess rückschließen kann.
&lt;ul&gt;
&lt;li&gt;Zum Beispiel &amp;ldquo;kein funktionierender Code-Review und Audit&amp;rdquo;
(&amp;ldquo;statisch einkompilierte Backdoor-Passworte&amp;rdquo;, wie sie bei Cisco das Dauer-Fehlerbild sind, fallen darunter).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Es sind mithin Managementfehler bei der Führung von Software-Häusern, die sicherheitskritische Software herstellen.
Es ist Aufgabe des Managements Prozesse einzurichten und zu steuern, die ein Mindestmaß an Qualität sicherstellen.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Softwarefehler, kann man nichts machen&amp;rdquo; stimmt so nicht – es gibt ganze Klassen von Fehlern,
die man durch Architektur,
durch automatisches Scannen,
durch Ausbildung,
durch Review,
und durch Testen sicher ausschließen kann,
und es ist die Aufgabe des Managements, solche Prozesse einzurichten und zu steuern.&lt;/p&gt;
&lt;p&gt;Alles in allem kann man nur zu dem Ergebnis kommen,
daß hier verantwortungslose Hackerbuden ohne elementare Software-Entwicklungsprozesse als &amp;ldquo;Security&amp;rdquo;-Firmen auftreten
und radioaktiven Giftmüll in Hochglanzpackungen abfüllen,
um so eine Autobahn für Nation State Actors ins Herz von kritischen Infrastrukturen zu bauen.&lt;/p&gt;
&lt;p&gt;Teilweise grenzt die Art der Fehler an mutwillige Sabotage,
beziehungsweise könnte man es auch mit mutwilliger Sabotage kaum schlimmer machen.&lt;/p&gt;
&lt;h1 id=&#34;1010-no-notes&#34;&gt;
    &lt;a href=&#34;#1010-no-notes&#34;&gt;
	10/10, no notes
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Im Chat witzeln Freunde von mir:
&amp;ldquo;Are you a 10/10 company?&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Security-Lücken wird nicht nur eine eindeutige Nummer zugewiesen, die CVE-Nummer, sondern
sie bekommen auch einen Schweregrad, den &lt;a href=&#34;https://en.wikipedia.org/wiki/Common_Vulnerability_Scoring_System&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CVSS-Score&lt;/a&gt;

.
Eine 10/10 ist der Maximalgrad, aber im Grunde ist alles über 8
ein &lt;a href=&#34;https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Totalschaden und komplettes Prozessversagen&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Es gibt nun eine historische CVE-Datenbank, die man
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/cvssscoremin-9/cvssscoremax-10/vulnerabilities.html?page=1&amp;amp;cvssscoremin=9&amp;amp;cvssscoremax=10&amp;amp;order=3&amp;amp;trc=40515&amp;amp;sha=2721cbf47ba1e57d8b65ae1c3cf8883295fd04d7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nach CVSS sortieren kann&lt;/a&gt;

,
und auch auf Firmen wie
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/vendor_id-3080/Fortinet.html?page=1&amp;amp;cvssscoremin=9&amp;amp;order=3&amp;amp;trc=103&amp;amp;sha=0ba96ce0b5ea0195196988ef1d381bdd33622c49&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fortinet einschränken&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Wir sehen dann für Fortinet eine Reihe von 12 Fehlern mit 10/10, und zwar
2x in 2024, 1x in 2021, 1x in 2019, 3x in 2017, 4x in 2016 und einmal in 2005.
Das kann man auch mit &amp;ldquo;Besserung ist nicht erkennbar&amp;rdquo; zusammenfassen.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Security ist ein Prozess&amp;rdquo; heißt es.
Für Business Continuity Management habe ich einmal aufgeschrieben, was das bedeutet:
&lt;a href=&#34;https://blog.koehntopp.info/2023/02/18/this-is-not-a-drill.html&#34;&gt;This is not a Drill. This is just Tuesday&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Analoge Überlegungen kann man auch für sichere Software-Entwicklungsprozesse anstellen,
und es gibt sogar fertige Prozess-Blueprints dafür.
Weiterhin kann man, wie ich gezeigt habe, an den Fehlerbildern erkennen, welche Schwächen der interne Entwicklungsprozess
hinsichtlich Security Best-Practices hat,
und an den CVE-Anzahlen und CVSS-Scores erkennen, ob eine Firma ihre Posture verbessert hat.&lt;/p&gt;
&lt;p&gt;Wenn das erkennbar über Jahre nicht der Fall ist, wie kann dann eine Kaufentscheidung positiv beschieden werden?
Denkt mal darüber nach.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/meerschweinchen-anne.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Manche Dinge sind nur durch niedliche Meerschweinchenfotos erträglich zu machen.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Wie ChatGPT funktioniert</title>
      <link>https://blog.koehntopp.info/2024/02/06/wie-chatgpt-funktioniert.html</link>
      <pubDate>Tue, 06 Feb 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/06/wie-chatgpt-funktioniert.html</guid>
      <description>&lt;p&gt;Es gibt einen wunderbaren Artikel von Stephen Wolfram,
&lt;a href=&#34;https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What Is ChatGPT Doing … and Why Does It Work?&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Dies ist ein etwa ein Jahr alter und langer Text, und man muss dran bleiben, wenn man ihn verstehen möchte.
Er erklärt wie ChatGPT intern funktioniert, warum das so viel Ressourcen kostet,
und er erklärt auch, daß wir keine Ahnung haben, wieso das &amp;ldquo;funktioniert&amp;rdquo;.
Er zeigt aber auch, was ChatGPT alles prinzipbedingt niemals erreichen kann, und auch nicht lernen wird.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is ChatGPT doing…&lt;/a&gt;


von Stephen Wolfram vom 14. Februar 2023.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Stephen Wolfram ist ein Informatiker und Physiker,
der einen recht guten Prolog-Interpreter mit Regeln zur Termumformung und Fakten gefüttert hat,
und dies unter dem Namen Mathematica vertreibt.&lt;/p&gt;
&lt;p&gt;Prolog ist eine deklarative Sprache, die vor 30 Jahren die Grundlage regelbasierter künstlicher Intelligenz-Forschung war.
Deklarative Sprachen wie SQL oder Prolog schreiben keine Programme, die dem Computer sagen, was zu tun ist,
sondern sie beschreiben das gewünschte Ergebnis.
Ein Programmgenerator, der Planer, versucht dann einen Ausführungspfad zu finden,
der das beschriebene Ergebnis auf eine effiziente Weise findet.&lt;/p&gt;
&lt;p&gt;Die Idee hinter diesem Ansatz in der KI-Forschung war, daß man die Welt regelbasiert beschreiben könnte,
ein Welt-Wissensmodell bauen und daß so &amp;ldquo;Intelligenz&amp;rdquo; entsteht.
Das war ein Fehlschlag, aber Mathematica ist eines der beeindruckendsten Arbeitssysteme für Mathematik,
Physik-Visualisierung und Modellierung und alle verwandten Arbeiten.
Eine private Lizenz ist teuer, aber ich gönne mir die,
weil es so einen Heidenspaß macht mit dem Ding zu arbeiten und Sachen auszuprobieren.
Rein optisch und von der Arbeitsweise ist Jupyter ein gnadenloser Mathematica-Clone,
aber in Mathematica steckt eine komplett andere Sprache (etwas, das mal ein Prolog war) und eine viel, viel größere Bibliothek.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ein Mathematica Arbeitsblatt, das die Approximation von Rechteckwellen durch Fouriersynthese zeigt,
indem es eine Formelschar generiert und plotted.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Wir generieren daraus Audio, stellen das Audio dar, und spielen es ab.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wolfram geht in seinem Text auf einen der simpelsten Textgeneratoren ein (und zeigt, wie man ihn in Mathematica realisiert) –
ein Zeichenfrequenz-Zähler, der Wikipedia-Seiten konsumiert und zeigt,
wie oft (normiert, also in %) jeder Buchstabe in der Seite auftaucht.&lt;/p&gt;
&lt;p&gt;Er vergleicht die Seiten von &amp;ldquo;Cat&amp;rdquo; und &amp;ldquo;Dog&amp;rdquo; und zeigt, daß in der &amp;ldquo;Dog&amp;rdquo;-Seite natürlich die o-Wahrscheinlichkeit höher ist,
aber daß beide für Englisch charakteristische Buchstabenhäufigkeiten haben.
Er greift sich dann die Häufigkeiten von Buchstabenpaaren (Bi-Grammen) und zeigt an der Spalte für den Buchstaben &amp;ldquo;q&amp;rdquo;,
daß &amp;ldquo;q&amp;rdquo; quasi immer von &amp;ldquo;u&amp;rdquo; gefolgt wird, und man kann das sehen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Entlang der X-Achse die ersten Buchstaben von Paaren,
entlang der Y-Achse die zweiten Buchstaben.
Je roter und dunkler das Feld, umso häufiger die Kombination.
Die Spalte &amp;ldquo;q&amp;rdquo; ist ganz weiß, mit Ausnahme der &amp;ldquo;qu&amp;rdquo;-Kombination.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Nimmt man mehr Kontext, also statt Paaren Dreiergruppen (Tri-Gramme) oder noch längere Gruppen,
dann bekommt man irgendwann fast aussprechbare oder reale englische Worte.
Schon 4-Gramme produzieren gute Worte.
Englisch hat also einen Buchstabenkontext von circa 4-5.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Reihe von Worten, die aus Nachfolgewahrscheinlichkeiten von Bi-, Tri- und n-Grammen erzeugt worden ist.
Ab einer Länge von etwa 4 entstehen oft gültige Worte der englischen Sprache.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Würde man das mit chinesischen Schriftzeichen machen,
bekäme man aus einem Grundwortschatz von einigen tausend Worten auf diese Weise Sätze.
Viele chinesische Begriffe haben ein Schriftzeichen, manche zur Klärung der Bedeutung zwei.
ChatGPT macht das genau so.&lt;/p&gt;
&lt;p&gt;Dort sind es keine Schriftzeichen, sondern Token.
Aber ein Token entspricht ziemlich genau der Funktion, die ein Schriftzeichen in Chinesisch hat.
Und es sind fast genau so viele – in der Größenordnung von Zehntausenden.
Davon sind viele Begriffe Ein-Token und einige Mehr-Token.&lt;/p&gt;
&lt;p&gt;Bigramme auf Token produzieren Dinge wie dies hier: Wortsalat.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-06.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Reihe von Wortfolgen, die alle zufällig generiert wurden, auf der Basis von Wortfolgewahrscheinlichkeiten,
die über Bi-Grammen, also Wortpaaren, errechnet worden sind.
Alle Beispiel starten mit dem Wort &amp;ldquo;cat&amp;rdquo;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Stellt man mehr Kontext, arbeitet man also mit n-Grammen für n=3, 4, …,
dann bekommt man eher Dinge, die wie korrekte Sätze aussehen.&lt;/p&gt;
&lt;p&gt;Man bekommt auch eine kombinatorische Explosion:
Statt 26, 26*26, 26*26*26, &amp;hellip; Wahrscheinlichkeiten zum Abspeichern hat man jetzt zum Beispiel 40.000 als Basis.
Und bei einem großen Kontext – statt 4 oder 5 eher was bei 100 – hat man dann mit 40.000 hoch 100 zu tun.&lt;/p&gt;
&lt;p&gt;Also, nicht – weil man das so nicht verarbeiten kann,
und ein wenig Arbeit in die Speicherung von dünn besetzten Matrizen und große Datenmengen stecken muss.
Aber das ist ein lösbares Problem, auch wenn es Aufwand erfordert, der auf der Mathematik nicht sichtbar ist.&lt;/p&gt;
&lt;p&gt;Wolfram erklärt dann &amp;ldquo;Modellierung durch Interpolation&amp;rdquo;.
Er hat Messwerte, die den Weg eines geworfenen Balls durch den Raum beschreiben,
und will dann nacheinander eine Gerade, eine Parabel oder &amp;ldquo;was Kompliziertes&amp;rdquo; da hindurchlegen.&lt;/p&gt;
&lt;p&gt;Er nutzt dieses Beispiel, um viele Dinge um den Modellbegriff zu erklären:
Einmal gibt es verschiedene Wege, um den Fehler zu messen,
also die Abweichung der interpolierten Linie von den Messwerten zu beschreiben.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-07.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die Messwerte eines Ballwurfes, und die verschiedenen hindurch interpolierten Kurven.
Eine Gerade, eine Parabel und &amp;ldquo;was Kompliziertes&amp;rdquo;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Dann setzt die &amp;ldquo;Beweglichkeit&amp;rdquo; der Funktion, die zur Interpolation genutzt wird, dem Modell Grenzen.
Egal, welche Koeffizienten man findet – die &amp;ldquo;komplizierte&amp;rdquo; Funktion aus dem letzten Beispiel hat immer große Fehler.
Sie kann keinen Fit ergeben.&lt;/p&gt;
&lt;p&gt;Die zweite Funktion, die Parabel, ist immer ein guter Fit.
Das ist so, weil das real-weltliche Phänomen sich aus Gründen tatsächlich parabolisch verhält,
bis es durch Luftwiderstand gestört wird.
In jedem Modell stecken Annahmen – und die können, wenn sie falsch sind, – das Modell unmöglich machen.&lt;/p&gt;
&lt;p&gt;Er geht dann zu neuronalen Netzen über und diskutiert, wie diese aufgebaut sind,
und welche Mathematik da drin steckt und wofür man sie einsetzen kann.
Es sind Geradengleichungen, mx+b, und Summen, aber sehr, sehr viele.
Sein Beispiel ist die Schrifterkennung.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ein Datentyp in Mathematica sind zweidimensionale Bitmaps – Bilder.
Hier sind es handgeschriebene Ziffern.
Man kann diese in eine Menge (einen weiteren Datentyp) tun, und dann einem NetModel (dem Datentyp für ein Neurales Netz) vorwerfen.
Dieses spezielle NetModel gibt dann als Ausgabe die erkannten Ziffern.
Dies ist eine Anwendung eines NN als Classifier, also als ein Ding, das erkennen und gruppieren kann.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-09.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Auf ein Bitmuster einer gut lesbaren 2 wird sukzessive ein immer stärkerer Gaussian Blur angewendet.
Die resultierende Eingabemenge wird in das NetModel-Objekt verfüttert und man bekommt &amp;ldquo;2, 2, 2, 1, 1, 1, 1, 1, 1&amp;rdquo; als Ausgabe.
Das Modell bricht bei schlechten Daten irgendwann zusammen.
Als Mensch erkennt man mehr Ziffern korrekt als 2, aber am Ende wird es wirklich sehr unlesbar.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wolfram macht dann weiter und diskutiert das Konzept der Nähe oder Ähnlichkeit, indem er mit Voronoi-Maps herumexperimentiert.
Er stellt sich jetzt die Aufgabe, eine bestimmte Funktion mit zwei Parametern x und y, die die Werte -1, 0 und +1 liefert,
zu &amp;ldquo;lernen&amp;rdquo; und durch ein neuronales Netz zu produzieren.
Er benutzt das, um zu zeigen, wie man Koeffizienten einer Näherungsfunktion findet,
indem man simple Geradengleichungsrechner (Neuronen) verknüpft.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-10.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Von einem NN erkannte handgeschriebene Ziffern nach Ähnlichkeit sortiert und angeordnet.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-11.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Reihe von zufällig auf einer Ebene verteilte Punkte und die von ihnen &amp;ldquo;beherrschten&amp;rdquo; Gebiete:
Jeder Punkt der Ebene wird dem orangen Punkt zugeordnet, der ihm nach irgendeiner Distanzmetrik am nächsten ist.
Es entsteht eine Partition, eine Aufteilung, der Karte in Zonen um die Punkte.
Es sieht aus wie Seifenblasen, die aneinander kleben und gerade Schnittflächen bilden.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-12.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die Aufgabe: Ein simples Voronoi, das drei Punkte mit den Werten +1, 0 und -1 auf einer Ebene verteilt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-13.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die 3D-Darstellung desselben Diagramms.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Er nimmt dann die vorherigen Gedanken zur Interpolation wieder auf.
Dazu erfindet er ohne weitere Erläuterung eine Aneinanderreihung von &amp;ldquo;Neuronen&amp;rdquo;, schreibt Koeffizienten dran,
und diskutiert verschiedene mögliche Abstandsberechnungsfunktionen (Fehler-Meßfunktionen).
Wenn man die Mathematik und den Prozess der Suche nach den passenden Koeffizienten mal wegläßt,
kommt man am Ende bei einer Näherung des Wunsch-Graphen an, die so aussieht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-14.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Das von Wolfram gewählte neuronale Netz.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Das Resultat weicht vom Wunschergebnis ab, ist aber eine gute Näherung.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Er diskutiert und demonstriert dann durch Simulation, daß man bestimmte Dinge nicht darstellen kann,
wenn man nicht genügend Neuronen hat.
Das zu modellierende Subjekt ist zu kompliziert, sodaß der mögliche Parameterraum nicht groß genug ist:
Eine Gerade kann keine Parabel annähern.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Verschiedene NN und die resultierenden Näherungen.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Es geht dann in einen längeren Exkurs, in dem er die Anatomie der Netze zu erklären, die da verwendet werden.
Man erkennt, daß die Modelle Schichten haben und daß sie keine Rückflüsse haben:
Daten fließen immer von der oberen Schicht in die unmittelbar darunter liegende – es gibt keine Rückflüsse und auch kein Überspringen.&lt;/p&gt;
&lt;p&gt;Man erkennt auch, daß generell größere Modelle bessere Ergebnisse liefern.
Wolfram gibt zu, daß wir nicht wissen, wie groß ein NN für ein bestimmtes Problem sein muss.
Wir wissen auch nicht, wie die konkrete Verschaltung der Schichten aussehen sollte,
oder muss, um gute Ergebnisse zu liefern.&lt;/p&gt;
&lt;p&gt;Er versucht immerhin, die Inhalte der Schichten zu verstehen und ihnen Bedeutung zuzuweisen,
aber auch das ist nicht wirklich Wissenschaft und teilweise Kaffeesatzlesen.
Fast alles am Bau von NN ist &amp;ldquo;Erfahrung&amp;rdquo; und &amp;ldquo;Empirik&amp;rdquo; ohne viel Theorie dahinter.&lt;/p&gt;
&lt;p&gt;Wir können Daten aus Schichten von NN herausziehen und sie nach einer Abstandsfunktion sortieren lassen,
und die Anordnung ergibt für unsere menschlichen Hirne irgendwie Sinn.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-18.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Hunde und Katzenbilder nach einer Abstandsfunktion eines NN sortiert.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wir können auch die Neuronen einiger Schichten nehmen, die Koeffizienten in einer Bildmatrix anordnen,
und bekommen vereinfachte Bilder von den Dingen, die da gespeichert oder erkannt werden sollen.&lt;/p&gt;
&lt;p&gt;Aber wir haben keine Funktionstheorie oder Mathematik von NN und Kognition.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-19.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Aus einer Schicht aus dem NN eines Katzen-Hunde-Sortierers herausgezogene Daten ergeben Katzenbilder.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wolfram beschäftigt sich weiter mit dem Training von NN, der Datenbeschaffung und der Auszeichnung von Daten.
Das Korpus von Trainingsdaten muss groß und zuverlässig ausgezeichnet sein.
Wir brauchen also viele Katzenbilder (Dafür gibt es das Internet!) und Hundebilder,
und diese müssen von Menschen korrekt mit Tags versehen worden sein, damit ein NN das lernen kann.&lt;/p&gt;
&lt;p&gt;Er zeigt dann Verbesserungen der Koeffizienten und der Resultate über Iterationen des Lernprozesses.
&amp;ldquo;Lernen&amp;rdquo; bedeutet für ein NN, die Koeffizienten der verschiedenen Neuronen zu verändern.
Dazu nimmt man die Eingabe-Koeffizienten als &amp;ldquo;Ebene&amp;rdquo; und den Fehler als &amp;ldquo;Höhe&amp;rdquo;
und wandert dann in der so entstehenden Fehlerlandschaft auf einem zufälligen Pfad in die Täler.&lt;/p&gt;
&lt;p&gt;Das findet lokale Minima und man hofft, aus &amp;ldquo;lokalen Löchern&amp;rdquo; zu entkommen, indem man zufällige Schritte zufälliger Größen macht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-20.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die Berg- und Tallandschaft des Fehlergraphen und der Weg des Modells zum lokalen Minimum.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wieder diskutiert Wolfram mögliche Layouts von NN –
nicht immer kann man jedes Neuron mit allen Neuronen der nächsten Lage verschalten und in der Tat ist das bei großen NN nie machbar.
Bestimmte Formen haben sich als besser lernfähig erwiesen:
Ein schmaler Layer der zwischen zwei breite Layers eingefügt wird scheint Ergebnisse stark zu verbessern.
Niemand weiß, warum das so ist oder hat ein Modell, das dies erklärt.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-21.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Verschiedene Formen von NN und die Ergebnisse, die sie produzieren.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Etwa in der Mitte des Textes wendet sich Wolfram generativen Modellen und LLMs zu.
Training von LLMs ist sehr, sehr einfach, weil sie einfach Text essen:
Man nimmt beliebigen Text, lässt das Modell das folgende Wort generieren und vergleicht es mit dem Wort, das hätte kommen müssen.
Daraus kann man Trainingsfeedback erzeugen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-22.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Karte, auf der englische Worte nach Ähnlichkeit angeordnet sind.
Säugetiere sind links oben, links unten sind &amp;ldquo;alligator&amp;rdquo; und &amp;ldquo;crocodile&amp;rdquo; dicht beieinander, &amp;ldquo;ant&amp;rdquo; und &amp;ldquo;bee&amp;rdquo; sind es auch.
Rechts unten Früchte.
Tiere und Früchte sind klar durch einen Graben getrennt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Es entsteht dadurch sogar so etwas wie eine Wissens-Karte nach Ähnlichkeits-Metriken.
Das ist nicht so, weil das LLM ein Weltmodell hat.
Sondern es ist so, weil Menschen ein Weltmodell haben und wenn sie Worte gebrauchen,
bestimmte Worte &amp;ldquo;nach beieinander&amp;rdquo; in Sätzen angeordnet sind.
Ein Weltverständnis entsteht so nicht, ein gewisses Sprachverständnis wohl schon.&lt;/p&gt;
&lt;p&gt;Wieder und wieder und wieder versucht Wolfram zu einem Verständnis der Koeffizienten von LLMs oder NNs zu kommen,
oder zu irgendeiner Theorie, die die Funktionsweise von LLMs und NNs planbar und vorhersagbar macht und sich über pure Empirik erhebt.
Er macht dies mit verschiedenen Visualisierungen von Koeffizienten auf die unterschiedlichsten Weisen,
aber er findet nur quälende Muster, die wie Inhalt wirken und nichts enthüllen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-23.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Vergröberung einer ChatGPT Koeffizientenmatrix und Einfärbung nach bestimmten Werten erzeugt eine interessante Teal-and-Orange Batik,
die nichts bedeutet.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Am Ende geht es dann darum,
wie man mit solchen riesigen Koeffizienten-Matrizen und einem austrainierten Modell generativ arbeitet und &amp;ldquo;interessante&amp;rdquo; Texte erzeugt.
Dabei geht es auch um den Parameter der &amp;ldquo;Temperatur&amp;rdquo; und den &amp;ldquo;Seed&amp;rdquo;:&lt;/p&gt;
&lt;p&gt;Würde man ein generatives LLM mit einer Null-Temperatur laufen lassen,
würde es immer dasselbe, wahrscheinlichste Folgetoken wählen, um einen Satz zu komplettieren.
Indem man die Wahrscheinlichkeiten der Folgetoken sortiert,
und dann zufällig ein anderes wahrscheinliches Token wählt, bekommt man immer noch &amp;ldquo;gültige&amp;rdquo; Fortsetzungen, die aber variabel sind.&lt;/p&gt;
&lt;p&gt;Das Seed ist dabei der Startwert des Pseudo-Zufallszahlen-Generators,
die Temperatur die &amp;ldquo;Sprungweite&amp;rdquo; vom wahrscheinlichsten Wert weg.
Auch hierzu gibt es keine Theorie, wir wissen nur, daß &amp;ldquo;0.8 ein guter Wert ist&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Wolfram schließt:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;So … What Is ChatGPT Doing, and Why Does It Work?&lt;/p&gt;
&lt;p&gt;The basic concept of ChatGPT is at some level rather simple.
Start from a huge sample of human-created text from the web, books, etc.
Then train a neural net to generate text that’s “like this.”
And in particular, make it able to start from a “prompt” and then continue with text that’s “like what it’s been trained with”.&lt;/p&gt;
&lt;p&gt;As we’ve seen, the actual neural net in ChatGPT is made up of very simple elements — though billions of them.
And the basic operation of the neural net is also very simple, consisting essentially
of passing input derived from the text it’s generated so far “once through its elements” (without any loops, etc.)
for every new word (or part of a word) that it generates.&lt;/p&gt;
&lt;p&gt;But the remarkable—and unexpected—thing is that this process can produce text that’s successfully “like” what’s out there on the web,
in books, etc.
And not only is it coherent human language, it also “says things” that “follow its prompt” making use of content it’s “read”.
It doesn&amp;rsquo;t always say things that “globally make sense”
(or correspond to correct computations because it’s just saying things that “sound right” based on what things “sounded like” in its training material).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Das ist der Stochastische Papagei, von dem bei LLMs gerne mal die Rede ist.
Er ist wortwörtlich gemeint.&lt;/p&gt;
&lt;p&gt;Ein LLM reproduziert Versatzstücke aus Texten, die es verarbeitet hat,
auf der Basis von Auftretenswahrscheinlichkeiten von &amp;ldquo;großes n&amp;rdquo;-Grammen von chinesischen Schriftzeichen (&amp;ldquo;Token&amp;rdquo;).
n ist dabei gerne groß zweistellig.&lt;/p&gt;
&lt;p&gt;Ein Konzept von Korrektheit gibt es nicht.
Wir wissen auch nicht, wie es das geben kann, denn es gibt keine Theorie.&lt;/p&gt;
&lt;p&gt;Die Idee, daß ein LLM in &amp;ldquo;full autopilot&amp;rdquo; Mode irgendwas Funktionales in irgendeiner Gesellschaft leisten kann – Arbeiten kann – ist lächerlich.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Es reproduziert und würfelt.&lt;/li&gt;
&lt;li&gt;Es hat kein Weltmodell.&lt;/li&gt;
&lt;li&gt;Es kennt keine Grenzen in den Termen von Ethik, Moral, Physik oder Logik.&lt;/li&gt;
&lt;li&gt;Es reiht nur Token aneinander.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ein LLM kann Menschen Arbeit abnehmen, indem es bestimmte Standardfunktionen erleichtert,
und es ist wahrscheinlich ein ausgezeichneter Sprachübersetzer,
und sicher ein wunderbarer Imitator, denn das ist, als was es konstruiert ist.&lt;/p&gt;
&lt;p&gt;Aber Imitation schafft nicht.&lt;/p&gt;
&lt;p&gt;Die Redewendung des &amp;ldquo;Blurry JPEG of the Internet&amp;rdquo; ist wieder exakt zutreffend,
denn das ist, was der Konstruktionsprozeß eines LLM produziert – eine verlustbehaftete Kompression von Wort-Folge-Wahrscheinlichkeiten.&lt;/p&gt;
&lt;p&gt;In meiner beruflichen Karriere habe ich um mich herum eine Reihe von KI-Projekten in kommerzieller Anwendung gelingen und scheitern sehen.
Das Muster, daß sich dabei ergeben hat, bestätigt sich auch bei LLMs:&lt;/p&gt;
&lt;p&gt;Wann immer meine Arbeitgeber KI eingesetzt haben, um Menschen full-auto zu ersetzen ist das Projekt ein unmitigiertes Desaster gewesen,
das der Firma geschadet und den Kunden Leid zugefügt hat.&lt;/p&gt;
&lt;p&gt;Wann immer meine Arbeitgeber KI eingesetzt haben um Menschen zu augmentieren war das Projekt eine Effizienzsteigerung
um eine halbe Größenordnung (den Faktor 3-5), die durch Feedback menschlicher Entscheidungen in den Trainingskorpus noch verbessert werden konnte.
Dabei war oft entscheidend, Confidence-Werte (aus der Modell-Fehler-Metrik abgeleitete Werte) herauszuführen und für Menschen sichtbar zu machen.&lt;/p&gt;
&lt;p&gt;Die Grundidee dahinter ist, daß wir eine Maschine bauen, die wir zwingen eine Entscheidung zu treffen, egal wie groß die Fehlermetrik ist.
Wenn die Maschine sich sicher ist, daß ein Standardfall in einer oder ander Weise vorliegt, ist das wahrscheinlich gut.
Wenn die Maschine aber eine hohe Fehlermetrik anzeigt, dann erzwingen wir eine Entscheidung, die wahrscheinlich zufällig ist.&lt;/p&gt;
&lt;p&gt;Hier ist es gut, den Fall herauszunehmen und Menschen vorzulegen.
Anders als die KI haben diese ein Weltmodell, und insbesondere ein Modell der ganzen Welt inklusive all der Informationsquellen,
Kontexte und Eskalationsstufen, die dem KI-Modell nicht zugänglich sind.
Menschen können Dinge auf Weisen kontextualisieren und umordnen, die einem Reproduktions-Papagei nicht möglich sind.
Und diese Menschen sind glücklicher, schneller und effektiver, wenn sie mit den Standardfällen nichts zu tun haben.&lt;/p&gt;
&lt;p&gt;Wir können KI erfolgreich einsetzen, wenn wir es nach diesem Modell tun.&lt;/p&gt;
&lt;p&gt;Wir können die Hölle auf Erden erschaffen, indem wir Menschen einer unkontrollierten Papagei-KI aussetzen,
die nach zufällig aufgerufenen Reproduktionen vorheriger Fälle entscheidet, ohne Ausweg.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Sitzende Tätigkeit</title>
      <link>https://blog.koehntopp.info/2023/10/10/sitzende-taetigkeit.html</link>
      <pubDate>Tue, 10 Oct 2023 02:03:04 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/10/10/sitzende-taetigkeit.html</guid>
      <description>&lt;p&gt;Ich arbeite im Sitzen, 8h am Tag beruflich, und dann noch ein wenig mehr aus Spaß:
&lt;a href=&#34;https://blog.koehntopp.info/2022/02/21/spaces.html&#34;&gt;Spaces&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Ich habe meinen eigenen Platz daheim, immer schon gehabt.
Das habe ich von meinem Vater gelernt, der Amateurfunker war und daheim seinen höchst eigenen Bastel- und Arbeitsplatz hatte,
seinen Ort und Rückzugplatz.
Zu einem ordentlichen Arbeitsplatz gehört auch ein Sitz.
Der Sitz ist ein Arbeitsgerät und da sollte man angesichts der Anzahl der darin verbrauchten Stunden nicht kaspern, sondern klotzen.&lt;/p&gt;
&lt;p&gt;Meinen alten Stuhl habe ich 2003 in Karlsruhe gekauft, ein Dauphin Shape Comfort XT mit nahezu allen Optionen.
Der hat 20 Jahre gehalten.
Aber inzwischen wurde es Zeit für einen Ersatz:
Nicht nur ist die Gasdruckfeder im Eimer (die habe ich schon einige Male getauscht, sicher ist sicher),
sondern intern ist die Mechanik auch abgenudelt und verschiedene Einstellmöglichkeiten haben nicht mehr gut funktioniert.&lt;/p&gt;
&lt;p&gt;Andererseits: 20 Jahre.
Das Teil hat in Karlsruhe, 2 Orten in Berlin, und in Amsterdam Dienst getan.
Dann ist auch gut.
Hier ist der neue, wieder ein Dauphin Shape XT.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/10/sitz-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Anlieferung fertig montiert in einem sehr stabilen Monsterkarton.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/10/sitz-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ausstattung, wie bestellt, via &lt;a href=&#34;https://www.objectservice.de/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.objectservice.de/&lt;/a&gt;

.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Da der Sitz vormontiert bestellt war, gestaltete sich das Auspacken schnell und einfach.
Dachte ich, aber es gab Luftpolsterfolie!&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/10/sitz-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Luftpolsterfolie!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Der Stuhl kommt mit einem ausführlichen Handbuch und einer Erklärung der Grundlagen der Ergonomie.
Das braucht es auch, denn dies ist ein richtiger Bürostuhl,
und kein Gamer-Stuhl oder gar, wie einige Kollegen auch im Jahr 3 der Pandemie, ein Küchenstuhl.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/10/sitz-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Bild des Bürostuhls am Arbeitsort: Höhenverstellbarer Schreibtisch, jede Menge Strom, eine Rollmatte und ein ordentlicher Stuhl.
Tageslicht von Links.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Der Stuhl kommt mit einer Vielzahl an Einstellmöglichkeiten.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/10/sitz-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Übersicht der Einstellmöglichkeiten.&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Sitzhöhe.&lt;/li&gt;
&lt;li&gt;Sitztiefe. Die Sitzfläche gleitet nach vorn, und ich passe auf den Stuhl.&lt;/li&gt;
&lt;li&gt;Armlehnen weit ausfahren: Ein wichtiger Handgriff, damit mein breiter Hintern in den Sessel passt.&lt;/li&gt;
&lt;li&gt;Rückenlehne fixieren oder losdrehen.&lt;/li&gt;
&lt;li&gt;Wenn man 4 losmacht, kann man Einstellen, wie stark die Rückenlehne Gegendruck macht.&lt;/li&gt;
&lt;li&gt;Nicht sichtbar: Armlehnen Höhe.&lt;/li&gt;
&lt;li&gt;Lordosenstütze Höhe.&lt;/li&gt;
&lt;li&gt;Die Rückenlehne ist höhenverstellbar, und das ist so auch notwendig bei mir.&lt;/li&gt;
&lt;li&gt;Rückenlehne und Sitzfläche neigen sich zusammen nach vorne und hinten (&amp;ldquo;Synchromechanik&amp;rdquo;).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Es gibt noch besser ausgestattete Versionen von diesem Stuhl,
bei denen die Armlehnen auch in Neigung und Winkel verstellbar in mehreren Dimensionen sind,
aber das ist meiner Erfahrung nach nicht dringend.
Eine Version mit Nackenstütze ist auch zu haben.&lt;/p&gt;
&lt;p&gt;Bezüge kommen in mehreren Preiskategorien (bis &amp;ldquo;Chefsessel Leder&amp;rdquo;) und sind auf Beanspruchung ausgelegt.&lt;/p&gt;
&lt;p&gt;Zum Einstellen kann man einfach die Anleitung im Handbuch befolgen.
Die Schritte sind im Grunde bei jedem Stuhl dieselben, sofern die betreffenden Einstellmöglichkeiten vorhanden sind:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Die Synchronmechanik und andere Schwingteile blockieren (z.B. die Rückenlehne aufrecht fixieren) und die Armlehnen ausfahren auf maximale Breite.
Das macht Platz im Stuhl und erzeugt eine neutrale Sitzposition. Hinsetzen.&lt;/li&gt;
&lt;li&gt;Sitzhöhe einstellen. Füße platt auf den Boden, dann müssen die Oberschenkel waagrecht im 90 Grad Winkel stehen.
Manche Menschen wollen die Sitzhöhe noch ein wenig höher haben.&lt;/li&gt;
&lt;li&gt;Sitztiefe einstellen, also die Sitzfläche so weit ausfahren, daß sie bis auf 2-3 Finger an die Kniekehlen heranreicht und die Beine unterstützt.&lt;/li&gt;
&lt;li&gt;Nun die Position der Rückenlehne einstellen: Neigung, und wenn höhenverstellbar auch Höhe, bis die Unterstützung im Kreuz angenehm ist.
Eventuell vorhandene Lordosenstütze in die richtige Position (über dem Becken ins Kreuz) bringen.&lt;/li&gt;
&lt;li&gt;Jetzt Sitzflächenneigung einstellen, also die Synchro loslösen und schaukeln, dann in einer angenehmen Position fixieren,
und danach die Rücken-Neigung noch mal nachstellen.&lt;/li&gt;
&lt;li&gt;Armlehnen einstellen - Breite, Höhe, Position.&lt;/li&gt;
&lt;li&gt;Danach Feineinstellung justieren: Synchro los, und Rückenlehnen-Gegendruck anpassen, Lordosenstütze Druck einstellen
und was sonst noch an Hilfseinstellungen da ist.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Zentral sind Höhe, Sitztiefe und Stellung der fixierten Rückenlehne in Neigung und Höhe der Lordosenstütze.
Der Rest ist dann drumherum zu arrangieren.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Flugtaxi</title>
      <link>https://blog.koehntopp.info/2023/09/18/flugtaxi.html</link>
      <pubDate>Mon, 18 Sep 2023 02:03:04 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/09/18/flugtaxi.html</guid>
      <description>&lt;p&gt;Golem schreibt: &lt;a href=&#34;https://www.golem.de/news/urban-air-mobility-ueber-200-skydrive-lufttaxis-vorbestellt-2309-177728.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Über 2000 Skydrive-Lufttaxis vorbestellt&lt;/a&gt;

.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Das eVTOL Skydrive ist 13 x 13 Meter groß und 3 Meter hoch.
Angetrieben wird es von zwölf Elektropropellern, die auf einem Gestell angebracht sind, ähnlich wie bei den Volocoptern.
In dem eVTOL ist Platz für drei Personen: zwei Passagiere und eine, die es fliegt.
Die Fluggeräte, die später ohne Pilot fliegen sollen, können auf einer relativ kleinen Fläche senkrecht starten und landen.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;und&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Urban Air Mobility (UAM) ist eine neue Form der Luftfahrt:
Passagiere sollen mit Lufttaxis oder Taxidrohnen kürzere oder mittlere Strecken in der Stadt zurücklegen.
Dadurch, dass ein Teil des Verkehrs in die Luft verlagert wird, sollen die Straßen weniger belastet werden.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;lärm&#34;&gt;
    &lt;a href=&#34;#l%c3%a4rm&#34;&gt;
	Lärm
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Hier ist ein Video von einem Vorläufer dieses Modells, von 2020.
Der Soundtrack ist wichtig:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=4Yc2L5koWZY&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Skydrive Piloted Flight Demo.
SkyDrive performed the first public flight demonstration of its SD-03 eVTOL on Aug. 25, 2020
(&lt;a href=&#34;https://www.youtube.com/watch?v=4Yc2L5koWZY&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Video&lt;/a&gt;

)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Beim Deutschlandfunk Nova heißt es zum selben Problemkomplex:
&lt;a href=&#34;https://www.deutschlandfunknova.de/nachrichten/drohnen-wenn-die-kettensaege-kommt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Drohnen: Wenn die Kettensäge kommt&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Die Drohnen werden aber nicht nur Päckchen bringen, sondern vor allem Lärm.
Kommerzielle Drohnen, die Lasten transportieren, sind deutlich lauter als kleine Kameradrohnen.
Je schwerer das Päckchen, desto lauter.
Der Lärmpegel ist vergleichbar mit Laubsaugern, Rasenmähern und Kettensägen.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;und&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Videos, die die Lieferdrohnen bewerben, sind gerne mit Musik unterlegt, das Drohnengeräusch ist nicht zu hören.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;downwash&#34;&gt;
    &lt;a href=&#34;#downwash&#34;&gt;
	Downwash
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Ein anderer Effekt von Rotorflüglern jeder Art ist Newtons Gesetz:
Jede Kraft erzeugt eine gleiche, entgegengesetzte Gegenkraft.
Wenn ein Flugtaxi also bei Erdanziehung 1250 kg Schub aufwärts erzeugt, dann muß es auch einen 1250 kg Downwash geben.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://wiki.ivao.aero/en/home/training/documentation/Ground_effect&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Luftströme am Rotorflügler, in der Luft (&amp;ldquo;out of ground effect&amp;rdquo;) und in Bodennähe (&amp;ldquo;in ground effect&amp;rdquo;).
(&lt;a href=&#34;https://wiki.ivao.aero/en/home/training/documentation/Ground_effect&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ausführliche Erläuterungen&lt;/a&gt;

)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In der Luft befindet sich unter einem Rotorflügler ein Abwindkorridor, dem andere Flieger fern bleiben müssen.
Nahe dem Grund können Sand, Schnee oder Steine aufgewirbelt werden (Brownout, Whiteout).&lt;/p&gt;
&lt;p&gt;In
&lt;a href=&#34;https://jjryan.com.au/index.php/helicopter-rotor-downwash-excessive-wind-fod-and-brownouts-what-are-the-risks/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helicopter Rotor Downwash – Excessive wind, FOD and brownouts, what are the risks?&lt;/a&gt;


haben wir eine bildliche Darstellung von Downwash und auch eine Tabelle von Mindestabständen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Beispiele für Helicopter Rotor Downwash.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Generell werden 3-5 Rotordurchmesser als sicherer Abstand zu einem landenden oder startenden Helikopter genannt.
Dies gilt für Personen, aber auch andere am Grund parkende Fluggeräte
oder andere Gegenstände mit einer großen Angriffsfläche für Wind wie etwa belaubte Bäume.&lt;/p&gt;
&lt;p&gt;Bei einem Volocopter mit einer Größe von 13x13 Metern also circa 50 x 50 Meter.
Zum Vergleich: Ein frei stehendes Einzelhaus hat eine Grundfläche von 8x8 Metern, und steht auf einem Grundstück von 12x20 Metern.&lt;/p&gt;
&lt;p&gt;Hier zwei Starts:
der Hubschrauber kann relativ schnell an Höhe gewinnen, weil er nicht in seinen eigenen Downwash fliegt.
Landungen sind wesentlich gemächlicher.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=ZJD1xvVC4cA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;


&lt;em&gt;Start von D-HBLN vom Metzplatz, Berlin vor dem Wenckebach-Krankenhaus. Die Bäume sind unbelaubt.
(&lt;a href=&#34;https://www.youtube.com/watch?v=ZJD1xvVC4cA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Video&lt;/a&gt;

)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=Ur4z1woV0ak&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;


&lt;em&gt;Start eines Rettungshubschraubers von einem Spielplatz in Vijfhuizen, NL.
Die Polizei hat das Gelände abgesperrt, etwa 50-70m Sicherheitsabstand.
Der Downwash schüttelt die belaubten Bäume.
(&lt;a href=&#34;https://www.youtube.com/watch?v=Ur4z1woV0ak&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Video&lt;/a&gt;

)&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;energieverbrauch&#34;&gt;
    &lt;a href=&#34;#energieverbrauch&#34;&gt;
	Energieverbrauch
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Schließlich ist noch der Energieverbrauch zu berücksichtigen,
denn anders als Starrflügler können Rotorflügler und Drohnen nicht gleiten.
Sie müssen also jederzeit in der Luft die volle Energie aufwenden, um ihr Gewicht gegen die Gravitation zu halten.&lt;/p&gt;
&lt;p&gt;Dies setzt auch der Reichweite und Flugzeit enge und absolute Grenzen als Funktion der Energiedichte des Treibstoffs.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Flugtaxis sind für Verkehrsprobleme was Kernfusion für Energieprobleme ist.&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;bonuscontent-downwash&#34;&gt;
    &lt;a href=&#34;#bonuscontent-downwash&#34;&gt;
	Bonuscontent: Downwash
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=HjeRSDsy-nE#t=2m14s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-06.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;


&lt;em&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=HjeRSDsy-nE#t=2m14s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vuichard Recovery Technique - How to escape a Vortex Ring State&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://youtu.be/dfY5ZQDzC5s?t=336&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/flugtaxi-07.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;


&lt;em&gt;&lt;a href=&#34;https://youtu.be/dfY5ZQDzC5s?t=336&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Planes clouds and vortices&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kernfusion</title>
      <link>https://blog.koehntopp.info/2023/09/17/kernfusion.html</link>
      <pubDate>Sun, 17 Sep 2023 02:03:04 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/09/17/kernfusion.html</guid>
      <description>&lt;p&gt;Heise schreibt:
&lt;a href=&#34;https://www.heise.de/news/Kernfusion-Deutschland-fehlt-laut-Studie-eine-Strategie-9307661.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kernfusion: Deutschland fehlt laut Studie eine Strategie&lt;/a&gt;

.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;Der Fusionsenergie könnte in den nächsten zehn bis fünfzehn Jahren der entscheidende Durchbruch gelingen,
aber Deutschland schaut nur staunend oder skeptisch zu&amp;rdquo;, kritisierte von Tschirschky.
Deutschland brauche eine Fusionsstrategie für sämtliche Schritte von Lieferketten über Forschungsförderung bis zu Verwaltungsvorschriften.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Golem schreibt:
&lt;a href=&#34;https://www.golem.de/news/kernfusion-vor-durchbruch-deutschland-fehlt-laut-studie-eine-strategie-dafuer-2309-177715.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Deutschland fehlt laut Studie eine Strategie dafür&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In zehn bis fünfzehn Jahren könnte die Technik für die Stromerzeugung einsatzfertig sein, meint die Unternehmensberatung Strategy&amp;amp;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Die Studie hätte ich ja gerne mal gesehen.
Denn soweit ich weiß, sind alle bisherigen kontrollierten terrestrischen Fusionen Energie-Negativ gewesen
und haben zudem die unangenehme Eigenschaft, das Reaktorgefäß zu schmelzen, in dem sie stattfinden, würden sie lange genug laufen,
um sinnvoll Energie zu erzeugen.&lt;/p&gt;
&lt;p&gt;Aber schauen wir mal nach der Studie.
Ich habe sie runtergeladen:
&lt;a href=&#34;https://www.strategyand.pwc.com/de/en/industries/energy-utilities-resources/the-fusion-revolution/strategyand-fusion-energy.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Link&lt;/a&gt;

&lt;a href=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-fusion-energy.pdf&#34;&gt;.&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Die ist von &amp;ldquo;Strategy&amp;amp;&amp;rdquo;, einer Unternehmensberatung, die 2008 von Booz, Allen &amp;amp; Hamilton an PwC verkauft wurde.
Die Studie malt die üblichen IEA Szenarien für die Energieversorgung der Zukunft auf,
um dann auf eine hätte-könnte-würde Welt umzuschwenken, in der wir auf einmal Kernfusion haben.
Dabei wird in diesen Slides Konjunktiv verwendet, denn es gibt keine dauerhafte existierende Kernfusion in diesem Planetensystem, außer in der Sonne.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Fusion energy may be the missing key to a sustainable, sufficient and affordable energy supply:
Im Jahr 2040 taucht magisch Kernfusion auf, und im Jahr 2050 ersetzt sie komplett und just-in-time die fossile Restenergie.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Consultantwitzchen am Rande:
Das Lithium für die Fusion bekommen wir aus recycelten Batterien, hihi!
Eigentlich brauchen wir Deuterium, und Lithium nur als Zwischenschritt für Tritium, aber Witz!&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Die Zutaten und das Resultat.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Zutaten in unserem Fantasiebaukasten sind 100% Buzzword-Compliant:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Magnets! Superleitend!&lt;/li&gt;
&lt;li&gt;AI!&lt;/li&gt;
&lt;li&gt;Quantencomputerz!&lt;/li&gt;
&lt;li&gt;Und High Powered Laz0rz!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Alles muss unbedingt auf eine einsame Insel mit einem Vulkan, und wir brauchen auch eine weiße Perserkatze!&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-06.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Hier eine technisch aussehende Zeichnung einsetzen, und diesmal nicht wieder eine von diesen Perry-Rhodan Rißzeichnungen, bitte!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Und jetzt bitte: FOMO Alarm! FOMO Alarm! Release the Fördermittelkraken!
Denn: Es ist ein Rennen zwischen den Nationen!
Energy too cheap to meter!
Wir brauchen eine Strategie!
Und Geld!
Viel Geld!&lt;/p&gt;
&lt;p&gt;Bitte stoppt sofort Fernfusion, wir haben bald schon Kernfusion!
Und Perserkatzen mit Lasern!&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;The decisive advantage over existing renewables: Fusion energy is simultaneously base-load capable and easily scalable.
Und der Feenstaubverbrauch ist minimal!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Sagte ich: &amp;ldquo;Energy to cheap to meter?&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Das ist ein verbrannter Begriff aus den 50er Jahren.
Wir haben stattdessen &amp;ldquo;secure and cheap oversupply.&amp;rdquo;
Yay!&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-09.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;The amount of energy from raw materials for fusion available worldwide is sufficient for secure and cheap energy oversupply:
250 Kilo Treibstoff pro Jahr statt ganzer Güterzüge voller herkömmlicher Energieträger.
Oder Berlin-Mitte überdachen.
Halt, was?
Wieso nicht? Eine Solarmall in Mitte kann unsere Energieprobleme auch lösen?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Was fehlt denn dann noch für funktionierende Kernfusion?
Naja, im Grunde nix, außer der Technik.
An der wir schon seit 80 Jahren vergeblich herum erfinden.
Aber &lt;em&gt;diesmal&lt;/em&gt; ist es wirklich fast so weit.&lt;/p&gt;
&lt;p&gt;Großes Unternehmensberaterehrenwort!&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-11.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;The remaining challenges until fusion&amp;rsquo;s commercial maturity are expected to be manageable with technology available today.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Darum dreht jetzt unbedingt die Geldhähne auf,
dann wird unsere Zaubertechnologie die kommende Klimakrise magisch weg putzen,
ohne dass sich irgendjemand umstellen muss.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-15.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;What needs to be done now?
A National Fusion Energy Strategy can turn Germany&amp;rsquo;s current position into an agenda for success.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;und&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/strategyand-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;If Germany acts in time, fusion energy has the potential to become a new engine for the German national economy.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;ergebnis&#34;&gt;
    &lt;a href=&#34;#ergebnis&#34;&gt;
	Ergebnis
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Ich bin under-fucking-whelmed von allem.&lt;/p&gt;
&lt;p&gt;Also von diesem 18-Seiten-Null-Content Powerpoint,
und hat irgendeiner der anwesenden &amp;ldquo;Journalisten&amp;rdquo;, die die Meldung gedruckt haben, sich den Fetzen auch nur mal kursorisch angesehen?&lt;/p&gt;
&lt;p&gt;Ich sollte mehr Powerpoint machen, die Milliarden wären mein.&lt;/p&gt;
&lt;p&gt;Das Köhntopp Institut für Feenstaub, gebt mir Fördermittel!
Ihr braucht eine Strategie, Leute, sonst wird das nichts,
wenn die Feenstaub-Fässer in meinem Keller überlaufen und das Land mit Wunschpulver überfluten.&lt;/p&gt;
&lt;h2 id=&#34;sticker&#34;&gt;
    &lt;a href=&#34;#sticker&#34;&gt;
	Sticker
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/09/fernfusion.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>T-Shirts selbst designen</title>
      <link>https://blog.koehntopp.info/2023/08/17/t-shirts-selbst-designen.html</link>
      <pubDate>Mon, 21 Aug 2023 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/08/17/t-shirts-selbst-designen.html</guid>
      <description>&lt;p&gt;Hier ist ein T-Shirt/Tragetasche Unikat mit einem selbst gemachten Slogan.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xvlt.net/@frainfostudent/110917197522005126&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/tasche.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Tasche mit Aufdruck, via &lt;a href=&#34;https://xvlt.net/@frainfostudent/110917197522005126&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mastodon&lt;/a&gt;

.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Schon vor vielen Jahren, in Kiel und Karlsruhe, habe ich angefangen, meine T-Shirts drucken zu lassen.
Darauf waren selbstgemachte Slogans oder Grafiken, oder welche, die ich hemmungslos geklaut und verfremdet habe.
Auch heute ist das noch so.
Jeder kann das, es ist gar nicht schwer.&lt;/p&gt;
&lt;p&gt;Man braucht eine Quelle für T-Shirts in Größen, Qualitäten und Farben, die Euch zusagen.
Dazu einen Textslogan oder eine Grafik-Vorlage.&lt;/p&gt;
&lt;h2 id=&#34;png&#34;&gt;
    &lt;a href=&#34;#png&#34;&gt;
	PNG
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Bei den Grafiken ist ein PNG mit transparentem Hintergrund von 1000+ Pixel entlang der längeren Kante vollauf ausreichend.
Ein SVG ist manchmal möglich, aber nicht notwendig und als direkte Druckvorlage oft nicht hilfreich.
Das ist so, weil das SVG die verwendeten Zeichensätze und Grafiken nicht unbedingt direkt enthält,
und das SVG dann beim Dienstleister anders dargestellt wird als bei Euch.&lt;/p&gt;
&lt;p&gt;Auch JPG ist nicht hilfreich, weil es nicht transparent sein kann.
Dann wird beim Druck die Hintergrundfarbe auf den Stoff gedruckt, wenn man das gar nicht möchte,
und man bekommt eine 30 cmx20 cm Plastikplatte auf der Brust statt weicher, atmungsaktiver Baumwolle.&lt;/p&gt;
&lt;p&gt;1000 Pixel bei 72 dpi sind 30+ cm, vollauf formatfüllend auch bei breiter Brust oder großen Brüsten.&lt;/p&gt;
&lt;h2 id=&#34;dienstleister&#34;&gt;
    &lt;a href=&#34;#dienstleister&#34;&gt;
	Dienstleister
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Ihr braucht außerdem einen &amp;ldquo;Copyshop&amp;rdquo; auf dem Pro-Level, also einen Grafikdienstleister, der so was kann.
In Kiel habe ich im Knooper Weg gegenüber der Humboldt-Schule gewohnt
und ein wenig nach Norden rauf zur damaligen Fachhochschule war an der Ecke ein Druckladen,
der so etwas konnte und auch 3XL Shirts in Qualitäten hatte, die angenehm waren.
(EDIT: Jetzt &lt;a href=&#34;https://maps.app.goo.gl/dN3UZzpiobBmi7x66&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;am Exer&lt;/a&gt;

)&lt;/p&gt;
&lt;p&gt;Hier in Haarlem habe ich ebenfalls mehrere solche Shops (&lt;a href=&#34;https://tinto.nl/textiel-bedrukken/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tinto&lt;/a&gt;

 et al),
und es gibt natürlich immer spreadshirt.nl und spreadshirt.de, wenn man nicht nach draußen gehen mag.&lt;/p&gt;
&lt;h2 id=&#34;druck&#34;&gt;
    &lt;a href=&#34;#druck&#34;&gt;
	Druck
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Der Druck kann auf die vordere oder hintere T-Shirt-Seite oder auf die Ärmel.
Jede Stelle, die bedruckt wird, kostet extra – ein doppelseitiges Shirt also deutlich mehr als ein einseitiges.&lt;/p&gt;
&lt;p&gt;Druck von Bildmotiven und mit Farben ist weniger Haltbar, als Schrift mit dem Einbaufont des Dienstleisters
(also Text mit einem Font von der Maschine, statt Text als Grafik von Euch als PNG),
und binnen 2-3 Jahren regelmäßigen Tragens wird sich die Grafik ablösen.&lt;/p&gt;
&lt;p&gt;Strichdicke spielt eine Rolle.
Ein T-Shirt ist kein Skizzenblock&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/t-shirt.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ein mehrere Jahre altes Elite Retro-T-Shirt. Die Schrift hat sich gut gehalten, die feine Grafik vom Raumschiff nicht.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;nerdläden-in-den-usa&#34;&gt;
    &lt;a href=&#34;#nerdl%c3%a4den-in-den-usa&#34;&gt;
	Nerdläden in den USA
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Wie dem auch sei:
Es ist viel einfacher, schneller und ökonomisch und ökologisch vorteilhaft,
solche T-Shirts lokal fertigen zu lassen, als sie von irgendeinem US-Dienstleister per Luftfracht zu Euch schicken zu lassen.
Man braucht das PNG und einen lokalen Laden und kein Shirt.
Manche Dienstleister nehmen auch AI oder PSD, weniger SVG oder PDF.&lt;/p&gt;
&lt;p&gt;Es ist wirklich am einfachsten mit einem moderat aufgelöstem PNG.
PSD, AI, SVG und PDF müssen gerendert werden, und dann fehlen Fonts oder so was.
PNG sieht genau so aus wie man das will.&lt;/p&gt;
&lt;h2 id=&#34;qualitäten&#34;&gt;
    &lt;a href=&#34;#qualit%c3%a4ten&#34;&gt;
	Qualitäten
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Und schließlich:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.trigema.de/magazin/grundmaterialien-der-stoffherstellung&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stoffe&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.trigema.de/magazin/grundbegriffe-der-stoffe/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Qualitäten&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.kalani-home.com/de/stoffen/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Andere Quelle&lt;/a&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;auflösungen&#34;&gt;
    &lt;a href=&#34;#aufl%c3%b6sungen&#34;&gt;
	Auflösungen
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Hier ein Motiv 835 px hoch, und sein Druck, ca. 11 cm hoch.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/t-shirt-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Man kann sehen, daß man sich mit der Auflösung ziemlich entspannen kann.&lt;/p&gt;
&lt;p&gt;Hier ein anderes Motiv (1629px breit) und sein Druck:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/t-shirt-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Die Druckvorlage ist eine Reproduktion: Ich habe vor einigen Jahren ein Barbie &amp;amp; Dragons T-Shirt geschenkt bekommen, aber hatte keine Vorlage.
Im Jahr von Barbie-Film und Baldur&amp;rsquo;s Gate 3 mußte ich das in frisch haben, also hab ich mir das selbst neu gemacht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/t-shirt-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Deutschland der Zukunft</title>
      <link>https://blog.koehntopp.info/2023/08/10/deutschland-der-zukunft.html</link>
      <pubDate>Thu, 10 Aug 2023 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/08/10/deutschland-der-zukunft.html</guid>
      <description>&lt;p&gt;Das Statistische Bundesamt hat in
&lt;a href=&#34;https://service.destatis.de/bevoelkerungspyramide/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bevölkerungspyramide&lt;/a&gt;


eine der coolsten Bevölkerungspyramiden, ever.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/deutschland-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://service.destatis.de/bevoelkerungspyramide/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Destatis Bevölkerungspyramide&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Per Default sehr ihr Deutschland im Jahre 2022: 20 % Rentner, 19 % Jugendliche, 62 % Erwerbstätige.
Ihr könnt in dem Ding rumklicken, zum Beispiel Euer Geburtsjahr suchen und dann sehen, wie viele Leute aus dem Jahr noch leben.
Man kann die Sprache umschalten, links oben ist ein Schalter für Englisch.&lt;/p&gt;
&lt;p&gt;Indem ihr den Jahresregler verschiebt, seht ihr Bevölkerungspyramiden der Vergangenheit, oder eine simulierte Zukunft.
Die Simulationsparameter kann man rechts oben einstellen und darunter ablesen, was sie bedeuten.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/deutschland-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Legende und Erklärungen.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Auch die Altersgruppen kann man umstellen, etwa das Rentenalter hochdrehen.
Die Farbschattierungen sind Männer/Frauenüberschuß: 1.06 Männer pro 1 Frau bei der Geburt, aber Frauen leben länger.
Die Parameter sind Geburtenraten von 1.44, 1.55 und 1.67 (alle niedriger als für Reproduktion notwendig, aber 2.05 ist unrealistisch für Deutschland).
Die Parameter für Lebenserwartung sind 82/86, 84/88, 86/90.
Die Parameter für Zuwanderung sind 180k, 290k und 400k pA.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2023/08/deutschland-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;Deutschland 2070.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wir sagen &amp;ldquo;Bevölkerungspyramide&amp;rdquo;, aber das ist nur in agrarischen Gesellschaften mit hoher Reproduktion und hoher Sterblichkeit korrekt.
In Deutschland müßte man Bevölkerungsdönerspieß sagen.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>fork, exec, wait and exit</title>
      <link>https://blog.koehntopp.info/2020/12/28/fork-exec-wait-and-exit.html</link>
      <pubDate>Mon, 28 Dec 2020 18:25:00 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2020/12/28/fork-exec-wait-and-exit.html</guid>
      <description>&lt;p&gt;This is the &lt;a href=&#34;https://blog.koehntopp.info/2007/01/07/fork-exec-wait-und-exit.html&#34;&gt;english version of a 2007 article&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;In &lt;a href=&#34;news:de.comp.os.unix.linux.misc&#34;&gt;de.comp.os.unix.linux.misc&lt;/a&gt;

 somebody asked:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Are commands in a script executed strictly sequentially, that is,
will the next command only be executed when the previous command has
completed, or will the shell &lt;strong&gt;automatically&lt;/strong&gt; start the next command
if the system has spare capacity?&lt;/li&gt;
&lt;li&gt;Can I change the default behavior - whatever it may be - in any way?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you are looking into the fine manual, it may explain at some point that the shell starts each command in a separate process. Then you may continue your thought process and ask what that actually means. As soon as you get to this stage, you may want to have a look at the Unix process lifecycle.&lt;/p&gt;
&lt;h2 id=&#34;processes-and-programs&#34;&gt;
    &lt;a href=&#34;#processes-and-programs&#34;&gt;
	Processes and programs
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;A program in Unix is a sequence of executable instructions on a disk. You can use the command &lt;em&gt;size&lt;/em&gt; to get a very cursory check of the structure and memory demands of the program, or use the various invocations of &lt;em&gt;objdump&lt;/em&gt; for a much more detailed view. The only aspect that is of interest to us is the fact that a program is a sequence of instructions and data (on disk) that may potentially be executed at some point in time, maybe even multiple times, maybe even concurrently.&lt;/p&gt;
&lt;p&gt;Such a program in execution is called a process. The process contains the code and initial data of the program itself, and the actual state at the current point in time for the current execution. That is the memory map and the associated memory (check /proc/&lt;em&gt;pid&lt;/em&gt;/maps), but also the program counter, the processor registers, the stack, and finally the current root directory, the current directory, environment variables and the open files, plus a few other things (in modern Linux for example, we find the processes cgroups and namespace relationships, and so on - things became a lot more complicated since 1979).&lt;/p&gt;
&lt;p&gt;In Unix processes and programs are two different and independent things. You can run a program more than once, concurrently. For example, you can run two instances of the &lt;em&gt;vi&lt;/em&gt; editor, which edit two different texts. Program and initial data are the same: it is the same editor. But the state inside the processes is different: the text, the insert mode, cursor position and so on differ. From a programmers point of view, &amp;ldquo;the code is the same, but the variable values are differing&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;A process can run more than one program: The currently running program is throwing itself away, but asks that the operating system loads a different program into the same process. The new program will inherit some reused process state, such as current directories, file handles, privileges and so on.&lt;/p&gt;
&lt;p&gt;All of that is done in original Unix, at the system level, with only four syscalls:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fork()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;exec()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;wait()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;exit()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;usermode-and-kernel&#34;&gt;
    &lt;a href=&#34;#usermode-and-kernel&#34;&gt;
	Usermode and Kernel
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/prozesswechsel.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Context switching: Process 1 is running for a bit, but at (1) the kernel interrupts the execution and switches to process 2. Some time later, process 2 is frozen, and we context switch back to where we left off with (1), and so on. For each process, this seems to be seamless, but it happens in intervals that are not continous.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Whenever a Unix process does a system call (and at some other opportunities) the current process leaves the user context and the operating system code is being activated. This is privileged kernel code, and the activation is not quite a subroutine call, because not only is privileged mode activated, but also a kernel stack is being used and the CPU registers of the user process are saved.&lt;/p&gt;
&lt;p&gt;From the point of view of the kernel function, the user process that has called us is inert data and can be manipulated at will.&lt;/p&gt;
&lt;p&gt;The kernel will then execute the system call on behalf of the user program, and then will try to exit the kernel. The typical way to leave the kernel is through the scheduler.&lt;/p&gt;
&lt;p&gt;The scheduler will review the process list and current situation. It will then decide into which of all the different userland processes to exit. It will restore the chosen processes registers, then return into this processes context, using this processes stack. The chosen process may or may not be the one that made the system call.&lt;/p&gt;
&lt;p&gt;In short: Whenever you make a system call, you may (or may not) lose the CPU to another process.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s not too bad, because this other process at some point has to give up the CPU and the kernel will then return into our process as if nothing happened.&lt;/p&gt;
&lt;p&gt;Our program is not being executed linearly, but in a sequence of subjectively linear segments, with breaks inbetween. During these breaks the CPU is working on segments of other processes that are also runnable.&lt;/p&gt;
&lt;h2 id=&#34;fork-and-exit&#34;&gt;
    &lt;a href=&#34;#fork-and-exit&#34;&gt;
	fork() and exit()
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;In traditional Unix the only way to create a process is using the &lt;code&gt;fork()&lt;/code&gt; system call. The new process gets a copy of the current program, but new process id (pid). The process id of the parent process (the process that called &lt;code&gt;fork()&lt;/code&gt;) is registered as the new processes parent pid (ppid) to build a process tree.&lt;/p&gt;
&lt;p&gt;In the parent process, &lt;code&gt;fork()&lt;/code&gt; returns and delivers the new processes pid as a result.&lt;/p&gt;
&lt;p&gt;The new process also returns from the &lt;code&gt;fork()&lt;/code&gt; system call (because that is when the copy was made), but the result of the &lt;code&gt;fork()&lt;/code&gt; is 0.&lt;/p&gt;
&lt;p&gt;So &lt;code&gt;fork()&lt;/code&gt; is a special system call. You call it once, but the function returns twice: Once in the parent, and once in the child process. &lt;code&gt;fork()&lt;/code&gt; increases the number of processes in the system by one.&lt;/p&gt;
&lt;p&gt;Every Unix process always starts their existence by returning from a &lt;code&gt;fork()&lt;/code&gt; system call with a 0 result, running the same program as the parent process. They can have different fates because the result of the &lt;code&gt;fork()&lt;/code&gt; system call is different in the parent and child incarnation, and that can drive execution down different &lt;code&gt;if()&lt;/code&gt; branches.&lt;/p&gt;
&lt;p&gt;In Code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;pid_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fork&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the child.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the parent, the child is %d.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;perror&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;In fork():&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Running this, we get:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; make probe1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cc     probe1.c   -o probe1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; ./probe1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the child.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the parent, the child is 16959.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We are defining a variable &lt;code&gt;pid&lt;/code&gt; of the type &lt;code&gt;pid_t&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This variable saves the &lt;code&gt;fork()&lt;/code&gt; result, and using it we activate one (&amp;ldquo;I am the child.&amp;rdquo;) or the other (&amp;ldquo;I am the parent&amp;rdquo;) branch of an if().&lt;/p&gt;
&lt;p&gt;Running the program we get two result lines. Since we have only one variable, and this variable can have only one state, an instance of the program can only be in either one or the other branch of the code. Since we see two lines of output, two instances of the program with different values for &lt;code&gt;pid&lt;/code&gt; must have been running.&lt;/p&gt;
&lt;p&gt;If we called &lt;code&gt;getpid()&lt;/code&gt; and printed the result we could prove this by showing two different pids (change the program to do this as an exercise!).&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;fork()&lt;/code&gt; system call is entered once, but left twice, and increments the number of processes in the system by one. After finishing our program the number of processes in the system is as large as before. That means there must be another system call which decrements the number of system calls.&lt;/p&gt;
&lt;p&gt;This system call is &lt;code&gt;exit()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;exit()&lt;/code&gt; is a system call you enter once and never leave. It decrements the number of processes in the system by one.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;exit()&lt;/code&gt; also accepts an exit status as a parameter, which the parent process can receive (or even has to receive), and which communicates the fate of the child to the parent.&lt;/p&gt;
&lt;p&gt;In our example, all variants of the program call &lt;code&gt;exit()&lt;/code&gt; - we are calling &lt;code&gt;exit()&lt;/code&gt; in the child process, but also in the parent process. That means we terminate two processes. We can only do this, because even the parent process is a child, and in fact, a child of our shell.&lt;/p&gt;
&lt;p&gt;The shell does exactly the same thing we are doing:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;bash (16957) --- calls fork() ---&amp;gt; bash (16958) --- becomes ---&amp;gt; probe1 (16958)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;probe1 (16958) --- calls fork() ---&amp;gt; probe1 (16959) --&amp;gt; exit()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   |
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   +---&amp;gt; exit()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;exit()&lt;/code&gt; closes all files and sockets, frees all memory and then terminates the process. The parameter of &lt;code&gt;exit()&lt;/code&gt; is the only thing that survives and is handed over to the parent process.&lt;/p&gt;
&lt;h2 id=&#34;wait&#34;&gt;
    &lt;a href=&#34;#wait&#34;&gt;
	wait()
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Our child process ends with an &lt;code&gt;exit(0)&lt;/code&gt;. The 0 is the exit status of our program and can be shipped. We need to make the parent process pick up this value and we need a new system call for this.&lt;/p&gt;
&lt;p&gt;This system call is &lt;code&gt;wait()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In Code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;pid_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;   &lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fork&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the child.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the child, 10 seconds later.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the parent, the child is %d.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;End of process %d: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WIFEXITED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;The process ended with exit(%d).&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WEXITSTATUS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WIFSIGNALED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;The process ended with kill -%d.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WTERMSIG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;perror&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;In fork():&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And the runtime protocol:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; make probe2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cc     probe2.c   -o probe2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; ./probe2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the child.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the parent, the child is 17399.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the child, 10 seconds later.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;End of process 17399: The process ended with exit(0).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The variable &lt;code&gt;status&lt;/code&gt; is passed to the system call &lt;code&gt;wait()&lt;/code&gt; as a reference parameter, and will be overwritten by it. The value is a bitfield, containing the exit status and additional reasons explaining how the program ended. To decode this, C offers a number of macros with predicates such as &lt;code&gt;WIFEXITED()&lt;/code&gt; or &lt;code&gt;WIFSIGNALED()&lt;/code&gt;. We also get extractors, such as &lt;code&gt;WEXITSTATUS()&lt;/code&gt; and &lt;code&gt;WTERMSIG()&lt;/code&gt;. &lt;code&gt;wait()&lt;/code&gt; also returns the pid of the process that terminated, as a function result.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;wait()&lt;/code&gt; stops execution of the parent process until either a signal arrives or a child process terminates. You can arrange for a SIGALARM to be sent to you in order to time bound the &lt;code&gt;wait()&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;the-init-program-and-zombies&#34;&gt;
    &lt;a href=&#34;#the-init-program-and-zombies&#34;&gt;
	The &lt;code&gt;init&lt;/code&gt; program, and Zombies
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The program &lt;code&gt;init&lt;/code&gt; with the pid 1 will do basically nothing but calling &lt;code&gt;wait()&lt;/code&gt;: It waits for terminating processes and polls their exit status, only to throw it away. It also reads &lt;code&gt;/etc/inittab&lt;/code&gt; and starts the programs configured there. When something from &lt;code&gt;inittab&lt;/code&gt; terminates and is set to &lt;code&gt;respawn&lt;/code&gt;, it will be restarted by &lt;code&gt;init&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;When a child process terminates while the parent process is not (yet) waiting for the exit status, &lt;code&gt;exit()&lt;/code&gt; will still free all memory, file handles and so on, but the &lt;code&gt;struct task&lt;/code&gt; (basically the &lt;code&gt;ps&lt;/code&gt; entry) cannot be thrown away. It may be that the parent process at some point in time arrives at a &lt;code&gt;wait()&lt;/code&gt; and then we have to have the exit status, which is stored in a field in the &lt;code&gt;struct task&lt;/code&gt;, so we need to retain it.&lt;/p&gt;
&lt;p&gt;And while the child process is dead already, the process list entry cannot die because the exit status has not yet been polled by the parent. Unix calls such processes without memory or other resouces associated &lt;em&gt;Zombies&lt;/em&gt;. Zombies are visible in the process list when a process generator (a forking process) is faulty and does not &lt;code&gt;wait()&lt;/code&gt; properly. They do not take up memory or any other resouces but the bytes that make up their &lt;code&gt;struct task&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The other case can happen, too: The parent process exits while the child moves on. The kernel will set the ppid of such children with dead parents to the constant value 1, or in other words: &lt;code&gt;init&lt;/code&gt; inherits orphaned processes.&lt;/p&gt;
&lt;p&gt;When the child terminates, &lt;code&gt;init&lt;/code&gt; will &lt;code&gt;wait()&lt;/code&gt; for the exit status of the child, because that&amp;rsquo;s what &lt;code&gt;init&lt;/code&gt; does. No Zombies in this case.&lt;/p&gt;
&lt;p&gt;When we observe the number of processes in the system to be largely constant over time, then the number of calls to &lt;code&gt;fork()&lt;/code&gt;, &lt;code&gt;exit()&lt;/code&gt; and &lt;code&gt;wait()&lt;/code&gt; have to balanced. This is, because for each &lt;code&gt;fork()&lt;/code&gt; there will be an &lt;code&gt;exit()&lt;/code&gt; to match and for each &lt;code&gt;exit()&lt;/code&gt; there must be a &lt;code&gt;wait()&lt;/code&gt; somewhere.&lt;/p&gt;
&lt;p&gt;In reality, and in modern systems, the situation is a bit more complicated, but the original idea is as simple as this. We have a clean fork-exit-wait triangle that describes all processes.&lt;/p&gt;
&lt;h2 id=&#34;exec&#34;&gt;
    &lt;a href=&#34;#exec&#34;&gt;
	exec()
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;So while &lt;code&gt;fork()&lt;/code&gt; makes processes, &lt;code&gt;exec()&lt;/code&gt; loads programs into processes that already exist.&lt;/p&gt;
&lt;p&gt;In Code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;pid_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;   &lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fork&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the child.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;execl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/bin/ls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-l&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/tmp/kris&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;perror&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;In exec(): &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;I am the parent, and the child is %d.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;End of process %d: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WIFEXITED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;The process ended with exit(%d).&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WEXITSTATUS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WIFSIGNALED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;The process ended with kill -%d.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WTERMSIG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;perror&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;In fork():&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The runtime protocol:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; make probe3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cc     probe3.c   -o probe3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; ./probe3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the child.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;I am the parent, the child is 17690.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total 36
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rwxr-xr-x 1 kris users 6984 2007-01-05 13:29 probe1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 kris users  303 2007-01-05 13:36 probe1.c
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rwxr-xr-x 1 kris users 7489 2007-01-05 13:37 probe2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 kris users  719 2007-01-05 13:40 probe2.c
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rwxr-xr-x 1 kris users 7513 2007-01-05 13:42 probe3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 kris users  728 2007-01-05 13:42 probe3.c
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;End of process 17690: The process ended with exit(0).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here the code of &lt;code&gt;probe3&lt;/code&gt; is thrown away in the child process (the &lt;code&gt;perror(&amp;quot;In exec():&amp;quot;)&lt;/code&gt; is not reached). Instead the running program is being replaced by the given call to &lt;code&gt;ls&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;From the protocol we can see the parent instance of &lt;code&gt;probe3&lt;/code&gt; waits for the &lt;code&gt;exit()&lt;/code&gt;. Since the &lt;code&gt;perror()&lt;/code&gt; after the &lt;code&gt;execl()&lt;/code&gt;is never executed, it cannot be an &lt;code&gt;exit()&lt;/code&gt; in our code. In fact, &lt;code&gt;ls&lt;/code&gt; ends the process we made with an &lt;code&gt;exit()&lt;/code&gt; and that is what we receive our exit status from in our parent processes &lt;code&gt;wait()&lt;/code&gt; call.&lt;/p&gt;
&lt;h2 id=&#34;the-same-as-a-shellscript&#34;&gt;
    &lt;a href=&#34;#the-same-as-a-shellscript&#34;&gt;
	The same, as a Shellscript
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The examples above have been written in C. We can do the same, in &lt;code&gt;bash&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; cat probe1.sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt;! /bin/bash --
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;echo &amp;#34;Starting child:&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sleep 10 &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;echo &amp;#34;The child is $!&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;echo &amp;#34;The parent is $$&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;echo &amp;#34;$(date): Parent waits.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;wait
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;echo &amp;#34;The child $! has the exit status $?&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;echo &amp;#34;$(date): Parent woke up.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:/tmp/kris&amp;gt; ./probe1.sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Starting child:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;The child is 18071
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;The parent is 18070
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Fri Jan  5 13:49:56 CET 2007: Parent waits.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;The child 18071 has the exit status 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Fri Jan  5 13:50:06 CET 2007: Parent woke up.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;the-actual-bash&#34;&gt;
    &lt;a href=&#34;#the-actual-bash&#34;&gt;
	The actual bash
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;We can also trace the shell while it executes a single command. The information from above should allow us to understand what goes on, and see how the shell actually works.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:~&amp;gt; strace -f -e execve,clone,fork,waitpid bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@linux:~&amp;gt; ls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;clone(Process 30048 attached
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;child_stack=0, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;child_tidptr=0xb7dab6f8) = 30048
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[pid 30025] waitpid(-1, Process 30025 suspended
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; &amp;lt;unfinished ...&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[pid 30048] execve(&amp;#34;/bin/ls&amp;#34;, [&amp;#34;/bin/ls&amp;#34;, &amp;#34;-N&amp;#34;, &amp;#34;--color=tty&amp;#34;, &amp;#34;-T&amp;#34;, &amp;#34;0&amp;#34;],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[/* 107 vars */]) = 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Process 30025 resumed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Process 30048 detached
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&amp;lt;... waitpid resumed&amp;gt; [{WIFEXITED(s) &amp;amp;&amp;amp; WEXITSTATUS(s) == 0}], WSTOPPED
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;WCONTINUED) = 30048
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;--- SIGCHLD (Child exited) @ 0 (0) ---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Linux uses a generalization of the original Unix &lt;code&gt;fork()&lt;/code&gt;, named &lt;code&gt;clone()&lt;/code&gt;, to create child processes. That is why we do not see &lt;code&gt;fork()&lt;/code&gt; in a Linux system to create a child process, but a &lt;code&gt;clone()&lt;/code&gt; call with some parameters.&lt;/p&gt;
&lt;p&gt;Linux also uses a specialized variant of &lt;code&gt;wait()&lt;/code&gt;, called &lt;code&gt;waitpid()&lt;/code&gt;, to wait for a specific pid.&lt;/p&gt;
&lt;p&gt;Linux finally uses the &lt;code&gt;exec()&lt;/code&gt; variant &lt;code&gt;execve()&lt;/code&gt; to load programs, but that is just shuffling the paramters around. At the end of &lt;code&gt;ls&lt;/code&gt; (PID 30048) the process 30025 will wake up from the &lt;code&gt;wait()&lt;/code&gt; and continue.&lt;/p&gt;
&lt;h2 id=&#34;original-code-what-windows-does-and-what-microsoft-thinks-about-linux&#34;&gt;
    &lt;a href=&#34;#original-code-what-windows-does-and-what-microsoft-thinks-about-linux&#34;&gt;
	Original Code, what Windows does, and what Microsoft thinks about Linux
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;This text is based on &lt;a href=&#34;http://groups.google.com/group/de.comp.os.unix.linux.misc/msg/4035c67415f9bc09&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a USENET article&lt;/a&gt;

 I wrote a long time ago.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://minnie.tuhs.org/cgi-bin/utree.pl?file=V7/usr/src/cmd/sh/xec.c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Here&lt;/a&gt;

 is the original C-code of the original &lt;code&gt;sh&lt;/code&gt; from 1979, with the &lt;code&gt;fork()&lt;/code&gt; system call. Search for &lt;code&gt;case TFORK:&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Also, check out the programming style of Mr. Bourne - this is C, even if it does not look like it.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://blog.koehntopp.info/2007/01/07/fork-exec-wait-und-exit.html&#34;&gt;original 2007 blog article&lt;/a&gt;

, has a followup article &lt;a href=&#34;https://blog.koehntopp.info/2007/01/07/fork-und-exec-vs-createprocess.html&#34;&gt;on Windows CreateProcess()&lt;/a&gt;

, which has not been translated.&lt;/p&gt;
&lt;p&gt;When implementing &lt;code&gt;fork()&lt;/code&gt; in Windows as part of the WSL 1, Microsoft ran into a lot of problems with the syscall, and wrote an article about how they hate it, and why they think their &lt;code&gt;CreateProcessEx()&lt;/code&gt; (in Unix: &lt;code&gt;spawn()&lt;/code&gt;) would be better. The &lt;a href=&#34;https://www.microsoft.com/en-us/research/uploads/prod/2019/04/fork-hotos19.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PDF&lt;/a&gt;

 makes a number of good points, but is still wrong. :-)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>An unexpected pool size increase</title>
      <link>https://blog.koehntopp.info/2020/10/07/an-unexpeced-pool-size-increase.html</link>
      <pubDate>Wed, 07 Oct 2020 14:52:04 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2020/10/07/an-unexpeced-pool-size-increase.html</guid>
      <description>&lt;p&gt;At work, replication chains have a single primary database node, to which you write, and then multiple replicas, in multiple AZs.&lt;/p&gt;
&lt;p&gt;Here is what the one sample chain looks like in Orchestrator:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-orchestrator.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;instance-918d is the current primary, in the blue AZ. Replicas in orange and green are in other AZs. Blue badges indicate multiple replicas, eg (38) means 38 machines.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;When you talk to a database, you get two database handles:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A write-handle which always points at the primary, here instance-918d currently, and&lt;/li&gt;
&lt;li&gt;a read-handle.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The read-handle should be in the same AZ as your client application, and should be selected randomly from the available replicas for reading.&lt;/p&gt;
&lt;p&gt;We also have other replicas, for cloning, to make more replicas, and for example time delayed replicas to correct accidental data deletions and other Oopses quickly.&lt;/p&gt;
&lt;p&gt;Machines that are available for reading are organised in “Pools” per AZ. Many replication chains have only one Pool, “&amp;lt;name&amp;gt;-misc”, but some replication chains also have additional pools for workload isolation. For example, some chains have “&amp;lt;name&amp;gt;-slow” pools, and you get a third handle, to which you are supposed to send slow queries that cannot be optimised.&lt;/p&gt;
&lt;p&gt;Other chains are shared between different applications, and in order to prevent crosstalk we have different pools, so that your &amp;ldquo;application-xml&amp;rdquo; queries do not mess with the regular “application-misc” queries. You are still using a “application-ro” handle, but it is non-overlapping between XML and normal application clients.&lt;/p&gt;
&lt;p&gt;In any case, we run automated capacity tests on each pool, and then adjust pool sizes as needed. We also report to ourselves on that. Sometimes that report is interesting:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-pool-size-change.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The example-misc pool changed target size from 3 to 16 in the night of 05-Oct, which is a 433% increase.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The minimum pool size is three, for redundancy reasons. The example chain is not busy, ever, and the pool size should &lt;em&gt;never&lt;/em&gt; exceed three.&lt;/p&gt;
&lt;p&gt;DBA Operations talk to the customer: “I am reaching out to you because you are currently designated as owners of one or more of the database schemata in the example database chain. The schemata in question are &amp;lt;list&amp;gt;.&lt;/p&gt;
&lt;p&gt;Starting yesterday, the example chain (and, specifically, its example-misc pool) has seen a significant increase in load, mostly in the blue AZ, as shown here:”&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-threads.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;MySQL &amp;ldquo;Threads Running&amp;rdquo; going through the roof, load testing reports diminished capacity, and we ready more instances. The world is safe again! Or, is it?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;So we detected an increased number of threads running, and that led to a general reduction in the capacity, and that requires &lt;em&gt;MOAR MACHINES!&lt;/em&gt; Yay! So our bots threw more machinery to ride the load wave and that kept us afloat for the moment.&lt;/p&gt;
&lt;p&gt;Is that the story? It is not.&lt;/p&gt;
&lt;h2 id=&#34;a-mysterious-mystery&#34;&gt;
    &lt;a href=&#34;#a-mysterious-mystery&#34;&gt;
	A mysterious mystery
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Humans descend on the problem and look. What are the machines in the pool, currently? Well, if you have the privileges, you can check with our roster tool:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; sudo roster-tool list /persistent/pools/example-misc/az-west1-a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;0be2b240a6964a338f0a65f22a2bb09d-example-2016.dc1.prod.example.com
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;421e3f5c81914082b26f93cd096c4d25-example-8050.dc2.prod.example.com
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;95624c835c454bbb8ad10a2eb728f66a-example-8051.dc2.prod.example.com
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;afc7bd521a5c404582645d89598269d3-example-2015.dc1.prod.example.com
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;e5724da64f134c34810f48211f5b777c-example-2014.dc1.prod.example.com
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;So let’s have a look at example-8051:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-load.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This box is terribly idle. For 18 hours, it was slightly less idle.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This box is terribly idle. It has 16 cores, 32 threads, it can do 32 things concurrently on a good day. Running MySQL, it usually becomes flaky at a &lt;em&gt;1m load average&lt;/em&gt; of 24, because we have web loads that are having very many short term variations, so “1m average of 24” really means “anything between 12 and 40”, if you look at things in 0.1s intervals.&lt;/p&gt;
&lt;p&gt;With a target load of 24, and headroom for failover, the limit is 12 - but it will be flaky in degraded state then. We usually aim for a load of 8-10 on our boxes. For this database pool, we could do with one box instead of three in normal times, but three is the administrative lower limit for redundancy and resilience.&lt;/p&gt;
&lt;h2 id=&#34;nothing-is-busy-but-we-dont-have-capacity&#34;&gt;
    &lt;a href=&#34;#nothing-is-busy-but-we-dont-have-capacity&#34;&gt;
	Nothing is busy, but we don’t have capacity
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;During the incident it was higher, but not much. Yet, the capacity test returned a much diminished capacity and grew the chain by a factor of more than 4. Clearly, this is not load, but something else.&lt;/p&gt;
&lt;p&gt;Let’s look at a few metrics for the time between 04-Oct, noon and 05-Oct, 6am. We want to know if we can see more action than the CPU thing. Let’s check the network:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-network.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Nope. No action on the network.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;And the disk:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-disk.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;We see few writes, and almost no reads. This is a memory-saturated database.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;We see very few disk writes (a few hundred writes per minute), and almost no disk reads. This is a database with the working set residing in memory, and queries are resolved without disk reads.&lt;/p&gt;
&lt;p&gt;This makes a very low query latency, and also means that the database can really only bottleneck on Networking or CPU. Now, a MySQL is very hard to bottleneck on Networking - I have only ever seen this happen twice.&lt;/p&gt;
&lt;p&gt;So whatever is happening and limiting us is a kind of CPU problem. Likely not a CPU saturation problem: We would see load &amp;gt; 20 for this, and we are very far from that. That means it is likely to be a per-thread CPU problem.&lt;/p&gt;
&lt;h2 id=&#34;what-could-cause-cpu-saturation&#34;&gt;
    &lt;a href=&#34;#what-could-cause-cpu-saturation&#34;&gt;
	What could cause CPU saturation?
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;CPU saturation on a database can in my experience have very few and easily detectable causes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A frequent query running from memory with no index: full table scans from a memory resident table. No disk I/O, loads of memory reads. This is a badly designed table with a missing index, masked by good memory performance until the CPU is completely eaten up and the box goes down. Add the missing index to fix.&lt;/li&gt;
&lt;li&gt;A frequent query doing a lot of sorting in memory. Data is not requested in index order, so it needs to be re-sorted before given to the client in order to satisfy an &lt;code&gt;ORDER BY&lt;/code&gt; clause. Can also be caused infrequently by weird &lt;code&gt;GROUP BY&lt;/code&gt; clauses. Fixed by sorting in the client, if possible, or by finding a better index so that data is returned in index order, which is designed to match the sort order.&lt;/li&gt;
&lt;li&gt;A system is offloading computation into the database using stored procedures. This is the worst possible design, and easily fixed by nuking the entire site from orbit, starting over from scratch at a new site.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All of these cases would create a lot more load than we see, so it is none of that.&lt;/p&gt;
&lt;h2 id=&#34;query-workload&#34;&gt;
    &lt;a href=&#34;#query-workload&#34;&gt;
	Query workload?
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;What else stands out?&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-query-workload.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Queries/s stable, Select/s looking normal. A slow query &amp;ldquo;spike&amp;rdquo; of very few slow queries.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The query load did not change, the capacity did. This is getting more mysterious by the second, but I think I know the smell. See that slow query “non-spike”? We have had slow queries, but it could not have been many.&lt;/p&gt;
&lt;h2 id=&#34;what-we-know-by-now&#34;&gt;
    &lt;a href=&#34;#what-we-know-by-now&#34;&gt;
	What we know by now
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;So&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;some, very few, slow queries, queries,&lt;/li&gt;
&lt;li&gt;an unsaturated database, not bottlenecking globally on any base resource&lt;/li&gt;
&lt;li&gt;a machine load going up by 2 from 1 to 3 (per thread problem, two queries?)&lt;/li&gt;
&lt;li&gt;long-running&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We have &lt;a href=&#34;https://blog.koehntopp.info/2019/11/18/a-blast-from-the-past.html&#34;&gt;seen this before&lt;/a&gt;

, and we have seen it &lt;a href=&#34;https://blog.koehntopp.info/2011/04/28/mysql-undo-log.html&#34;&gt;a long time before that&lt;/a&gt;

 as well. Let’s check the undo-log size:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2020/10/mysql-undo-log.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Undo-Log shark fin perfectly coinciding with the incident.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;We observe a shark fin in the Undo-Log size that perfectly matches the time span of the incident and the increased CPU time.&lt;/p&gt;
&lt;h2 id=&#34;we-knew-this-is-bad&#34;&gt;
    &lt;a href=&#34;#we-knew-this-is-bad&#34;&gt;
	We knew this is bad
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;We know from &lt;a href=&#34;https://blog.koehntopp.info/2020/07/27/mysql-transactions.html&#34;&gt;MySQL Transactions - the physical side&lt;/a&gt;

 what the Undo-Log is and what it is being used for: It’s keeping old versions of a row so that a transaction can have a stable read view preventing phantom reads.&lt;/p&gt;
&lt;p&gt;We learned in &lt;a href=&#34;https://blog.koehntopp.info/2020/07/29/mysql-transactions-the-logical-view.html&#34;&gt;MySQL Transactions - the logical side&lt;/a&gt;

 how the Undo-Log is consulted, depending on the transaction isolation level setting of the reading connection. Go to that article now, and read the section on “Repeatable Read and Long Running Transactions”, now.&lt;/p&gt;
&lt;p&gt;The part where it says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Starting a transaction at the default isolation level will force the Undo-Log Purge Thread to stop at the position of our read view. Undo-Log entries will no longer be purged, filling up and growing the Undo-Log. Reads and Index Lookups become more complicated and slower, slowing down the overall performance of the database.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So it may be long-running transactions.&lt;/p&gt;
&lt;h2 id=&#34;proof&#34;&gt;
    &lt;a href=&#34;#proof&#34;&gt;
	Proof
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;How can we prove that?&lt;/p&gt;
&lt;p&gt;And this is where metrics end, and observability starts. We would need a flight recorder that takes a snapshot of the database activities in regular intervals and keeps the data for some time so that we can look at non-numeric, non-aggregated detailed system stats from the past.&lt;/p&gt;
&lt;p&gt;This is such an obvious pressing need that &lt;a href=&#34;http://blog.wl0.org/2011/02/log_processlist-sh-script-for-monitoring-mysql-instances/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Simon Mudd wrote a script&lt;/a&gt;

 to do that in the deep, dark past long before the term “observability” even existed.&lt;/p&gt;
&lt;p&gt;It runs every minute, and collects system hardware stats, MySQL processlist and other data, and stashes them compressed in a ring buffer in &lt;code&gt;/var/log/mysql_pl/&amp;lt;weekday name&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In an age of bare-metal machines and all devs having production access you log into a database, cd into that directory and grab a random snapshot from the incident interval:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/var/log/mysql_pl/Sun $ xzcat 23_48.innodb.xz &amp;gt; /tmp/kris
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/var/log/mysql_pl/Sun $ vim /tmp/kris
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/var/log/mysql_pl/Sun $ awk -F&amp;#39;\t&amp;#39; &amp;#39;($5 != &amp;#34;Sleep&amp;#34;) &amp;amp;&amp;amp; !match($7, /Waiting for/)&amp;#39; /tmp/kris | less
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With a text editor we isolate the processlist recording from 23:48 on 04-Oct. We then use Unix Tooling to look at all non-sleeping connections that are also not idle replication connections.&lt;/p&gt;
&lt;p&gt;This yields indeed two interesting queries: Both show a &lt;code&gt;cronjob=reserve_projectname_upsert_transaction_ids&lt;/code&gt; running on &lt;code&gt;cronapp-39.dc2.prod.example.com&lt;/code&gt; and on &lt;code&gt;cronapp-02.dc2.prod.example.com&lt;/code&gt;, with runtimes of 16220 and 22170 seconds.&lt;/p&gt;
&lt;p&gt;There are indeed two long-running queries, coinciding perfectly with a load increase of 2, and they are easily identifiable cron queries. They run from two different hosts, with the same cron banner.&lt;/p&gt;
&lt;p&gt;I have no idea what that job does, but we are looking at a &lt;code&gt;SELECT&lt;/code&gt; statement in &lt;code&gt;REPEATABLE READ&lt;/code&gt; isolation that has a run time of multiple hours, and unsurprisingly an Undo-Log escalation. That leads to slow query performance and reduced capacity for all things, including the capacity test, and a changed target size for the pool.&lt;/p&gt;
&lt;h2 id=&#34;what-we-can-learn-from-this&#34;&gt;
    &lt;a href=&#34;#what-we-can-learn-from-this&#34;&gt;
	What we can learn from this
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Besides the obvious, that is, fixing that cron?&lt;/p&gt;
&lt;p&gt;Well, there is a moment in time in incident analysis where you need to pivot from identifying timeframes in which the incident happened and machines that are affected to actual instances of the incident in question.&lt;/p&gt;
&lt;p&gt;This is also where you move from numeric aggregates in a dashboard to textual, structured logging information that actually has to be recorded before.&lt;/p&gt;
&lt;p&gt;This is what observability is about: The ability to do this pivot easily, within one system, without special privileges, with proper tooling, in distributed systems, at will, without access to the actual box.&lt;/p&gt;
&lt;p&gt;We don’t have observability. We need to get better at this. Go, follow &lt;a href=&#34;https://twitter.com/mipsytipsy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Charity Majors on Twitter&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;With such tooling, we need to connect what we teach with actual incidents that show how the teachings connect to real world cases.&lt;/p&gt;
&lt;p&gt;Which is why I am typing up this thing, right now and link to the actual write-ups that enabled me to show you this. Go, read these things again, please, in the light of this particular episode.&lt;/p&gt;
&lt;p&gt;You know in your head what &amp;ldquo;Undo-Log&amp;rdquo; means. Here you can understand what &amp;ldquo;Undo-Log&amp;rdquo; feels like. Go, &lt;a href=&#34;https://blog.koehntopp.info/2020/08/31/on-touching-candles.html&#34;&gt;touch the candle&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;We have all the tooling, but it is from a different age.
An age where people either routinely had access to production or sat next to a DBA in an office and could easily get at all the metrics.
Observability by shell script on a root shell is a thing we have in abundance, because that was enough in that time and age.&lt;/p&gt;
&lt;p&gt;We do no longer have access to root shells in production, and in the age of anything as a service not even to shells.&lt;/p&gt;
&lt;p&gt;Observability as taught by Charity Majors is your trusted &lt;code&gt;printf(“Checkpoint: I am here.\n”);&lt;/code&gt; or your &lt;a href=&#34;https://sourceforge.net/projects/dbug/files/dbug/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fred Fish Dbug Macros&lt;/a&gt;

 brought into the 21st century &lt;a href=&#34;https://docs.honeycomb.io/getting-data-in/python/beeline/#using-a-decorator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;age of distributed services&lt;/a&gt;

, and the tooling to create metrics from events, and &lt;a href=&#34;https://docs.honeycomb.io/getting-data-in/python/beeline/#queries-to-try&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;then slice and dice that in any dimension&lt;/a&gt;

 without having a privileged shell on the broken system.&lt;/p&gt;
&lt;p&gt;So yeah, let’s upgrade.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>What are the problems with POSIX?</title>
      <link>https://blog.koehntopp.info/2020/10/05/what-are-the-problems-with-posix.html</link>
      <pubDate>Mon, 05 Oct 2020 17:13:30 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2020/10/05/what-are-the-problems-with-posix.html</guid>
      <description>&lt;p&gt;Every once in a while there is the IT news article that kind of triggers me. This time it was &lt;a href=&#34;https://www.golem.de/news/object-storage-object-storage-protokoll-koennte-posix-abloesen-2010-151294.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&amp;ldquo;Object-Storage-Protokoll könnte Posix ablösen&amp;rdquo;&lt;/a&gt;

 in german computer news site &lt;a href=&#34;https://golem.de&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Golem&lt;/a&gt;

. The article speaks about mmap(), NVMEoF and object storage and how it could revolutionize or complete object storages, but does not link to an original article, names no persons and no paper. Also, what do these things - mmap, NVMEoF, object storage and Posix, even have in common? It is not explained anywhere in the article.&lt;/p&gt;
&lt;p&gt;In another article &lt;a href=&#34;https://blog.koehntopp.info/2018/11/29/but-is-it-atomic.html&#34;&gt;But is it atomic?&lt;/a&gt;

 we dive into the internals of the old UNIX V7 kernel, and how design decisions and technical realities from the late 1970ies became immortialized as technical requirements for filesystems in the Posix standard.&lt;/p&gt;
&lt;p&gt;So Unix is historically grown, and a lot of things have changed since that time. The original file system (for Linux users: &amp;ldquo;mkfs -t minix&amp;rdquo; is the closest thing to that which you might have) is not even used any more anywhere in a modern system. But it is basically what Posix means when we speak about &amp;ldquo;Posix File System Semantics&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;The basic design is good - I mean, it has held up almost 50 years by now, and that is a fantastic achievement. It even has value in modern systems. But it has been designed for local systems, and it is not scalable to distributed systems very well.&lt;/p&gt;
&lt;p&gt;So everybody is either cheating or slow. There is &lt;a href=&#34;https://en.wikipedia.org/wiki/GFS2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GFS2&lt;/a&gt;

 as an example for slow. There is NFS as an example for hidden cheating (I am looking at you, &lt;code&gt;actimeo&lt;/code&gt;, and at you, &lt;code&gt;lockd&lt;/code&gt;). And there is &amp;ldquo;Object Storage&amp;rdquo;, whatever that specifically means, as an example for doing things completely differently.&lt;/p&gt;
&lt;h2 id=&#34;mutability-as-the-root-of-all-evil&#34;&gt;
    &lt;a href=&#34;#mutability-as-the-root-of-all-evil&#34;&gt;
	Mutability as The Root of All Evil
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The biggest baggage Posix has, in terms of distributed systems, is mutable files. You can open a file, fseek() to an offset of 1MB and overwrite a 3MB segment in a 10MB file. I am choosing these sizes and offsets to make it abundantly clear that writes can be large, larger than a network packet, a disk block or other allocation units, and that they can take measureable, non-zero time.&lt;/p&gt;
&lt;h3 id=&#34;one-writer-per-inode-per-time&#34;&gt;
    &lt;a href=&#34;#one-writer-per-inode-per-time&#34;&gt;
	One writer per Inode, per time
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;Posix demands that writes are atomic (see link above), and it implemented that originally by locking the (only copy) of the file with a central lock at the in-memory inode of the file. This has multiple effects:&lt;/p&gt;
&lt;p&gt;There can be only one write active at a time for a file.&lt;/p&gt;
&lt;p&gt;This already is a problem for local filesystems, when you have a database that wants to write out many concurrent changes to different non-overlapping records in a database file.&lt;/p&gt;
&lt;p&gt;Databases work around the problem either by defining tablespaces from many small sized &amp;ldquo;.DBF&amp;rdquo; files (Oracle) - 1GB to 4 GB seem to be popular. Or they work around it by  foregoing the use of filesystems entirely - using raw disks, at a terrible toil cost for sysadmins and DBAs. Only XFS in O_DIRECT mode will handle this better, by not blocking concurrent writes as long as they are non-overlapping.&lt;/p&gt;
&lt;p&gt;Reads never happen concurrently with writes, too. They are either completely before or after the write instead. If they happen after the write, they will never return stale data, but always the most recently written fresh data.&lt;/p&gt;
&lt;p&gt;In distributed systems, this is very expensive: Imagine a storage cluster with dozens or hundreds of storage nodes and hundreds or thousands of clients. Parts of the file we are about to write to may have been cached anywhere in any cluster node or client to avoid excessive network transfers. These cached copies are now all invalid, because they contain data that has been overwritten with potentially different values.&lt;/p&gt;
&lt;p&gt;Because reads must not return stale data under Posix, we need to invalidate all of these copies, and - worse - we need to this under a lock to ensure atomicity and fresh reads. So each write (write, not commit/fsync, which can happen much less often) has to inform all relevant nodes with a copy of the data that there is a new write for an extent (offset, length) incoming and wait for the acknowledgement. And then let the write proceed, to wait again to collect the complete acknowledgement of all data nodes that they have the data, and all caches that the have destroyed or updated their cached copy. That&amp;rsquo;s a lot of waiting.&lt;/p&gt;
&lt;p&gt;This is unimaginably slow, and even worse, should the cluster topology change during  any operation - a node taking part in our operation leaving the cluster or similar.&lt;/p&gt;
&lt;p&gt;If you happen to have two concurrent overlapping writes (write A to node 1 at offset 0, length 3MB, and write B to node 12 at offset 1MB, length 3MB), Posix also demands ordering between these writes - A either happens in total before or after B. You will never end up with an ABABABAB block pattern in the overlap, and again, this can only be guaranteed by locking.&lt;/p&gt;
&lt;p&gt;Nothing &amp;ldquo;made&amp;rdquo; Posix specify this, this is just the natural behavior in a single core 1970ies computer when you lock interrupts (&lt;code&gt;spl()&lt;/code&gt;) or &lt;code&gt;plock()&lt;/code&gt; on an in-memory inode, which then was later officially documented and bless into a standard when the Posix specificationw as written. Our modern computers do not have these properties any more, so we need to make them wait to simulate this.&lt;/p&gt;
&lt;p&gt;In any case: The combination of Mutability and Strong Read Consistency/Atomic Write Behavior creates a cluster wide locking problem.&lt;/p&gt;
&lt;h3 id=&#34;fixed-metadata-and-synchronous-metadata-updates&#34;&gt;
    &lt;a href=&#34;#fixed-metadata-and-synchronous-metadata-updates&#34;&gt;
	Fixed metadata, and synchronous metadata updates
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;Things get even worse when we look at metadata. The set of metadata in a Unix Inode is fixed, and documented in Posix, too. We have the typical Unix access rights (ugo times rwx) and the three second-resolution times (a/m/ctime), and a file length - that is basically it.&lt;/p&gt;
&lt;p&gt;There is an attempt to extend this, using Posix File ACLs (ACL) and Posix Extended Attributes (xattr), but for example mapping NTFS access permissions to Posix ACLs is complicated - just look at what Samba has to do to get this approximately right. The fact that the Unix notion of a user identity is scoped to a local machine does not help at all - your userid 0 is different from my user id 0 in meaning, and if I am UID 0 on my box I probably should not be UID 0 on yours.&lt;/p&gt;
&lt;p&gt;Posix demands synchronus updates to metadata updates. When you extend a file, this should be visible immediately in the file length, and when you access a file, the atime should update, too. Even on local filesystems this is no longer doable - everybody mounts their Linux disks with a variant of &lt;code&gt;noatime&lt;/code&gt; or the other.&lt;/p&gt;
&lt;p&gt;But while data writes distribute themselves across the cluster, metadata updates do not. They all have to hit the relatively small number of metadata nodes, and this load often crushed metadata servers.&lt;/p&gt;
&lt;h3 id=&#34;the-key-idea-immutability&#34;&gt;
    &lt;a href=&#34;#the-key-idea-immutability&#34;&gt;
	The key idea: Immutability
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;Note that all the things we spoke about are lower file system problems - they happen at the level of individual files already, not even going into upper file system, directory hierarchies and path names. That&amp;rsquo;s not even necessary, because as long as the lower file system is not in shape looking up is kind of pointless.&lt;/p&gt;
&lt;p&gt;Object Stores have one single core idea: Files are immutable, maybe appendable (S3 is not, Google GFS and Hadoop HDFS are). The payoff is that we can cache this stuff, because the cache never becomes invalid. Maybe the end of the file is not up to date, but it will be eventually consistent.&lt;/p&gt;
&lt;p&gt;The file has a Key-Value store with metadata, which can even grow to considerable size, and which is also eventually consistent. With the upper file system we do the same: The entire namespace is one single KV store, in which the key is a binary string that cosplays a path name, and the value is the actual file data (and metadata).&lt;/p&gt;
&lt;p&gt;This has far reaching consequences: We can talk about &amp;ldquo;Log Structured Merge Trees&amp;rdquo;, why they became popular in database land, and how that plays nicely with Object Storages. Or we can talk about how &amp;ldquo;Event Sourcing&amp;rdquo; favors &amp;ldquo;append only data structures&amp;rdquo;, and how that plays nicely with Object Storages.&lt;/p&gt;
&lt;h2 id=&#34;there-is-a-timeline-and-there-is-progress&#34;&gt;
    &lt;a href=&#34;#there-is-a-timeline-and-there-is-progress&#34;&gt;
	There is a timeline, and there is progress
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The original Unix File System is, for the sake of illustration, basically the state of the art as seen in 1974.&lt;/p&gt;
&lt;p&gt;There are a lot of elementary improvements to this initial idea that we find reflected in BSD FFS, from 1984.&lt;/p&gt;
&lt;p&gt;The culmination point of these ideas, and structures, can be found in Silicon Graphics XFS, from 1994.&lt;/p&gt;
&lt;p&gt;A completely different way of thinking can be found in &lt;a href=&#34;https://en.wikipedia.org/wiki/Log-structured_file_system&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Log Structured File Systems&lt;/a&gt;

, first seen in Ousterhout&amp;rsquo;s  Sprite, in the early 1990. But performancewise the original implementation that was a failure: the first successful and performant implementation can be found  - made by Oursterhout&amp;rsquo;s students - in Solaris ZFS, and at the same time in NetApps WAFL, which promptly engaged in a legal battle over patents. In parallel, many ZFS ideas are being reimplemented about half a decade later in Btrfs. All of that would put us roughly into 2004, in terms of commercial availability.&lt;/p&gt;
&lt;p&gt;Now, widespread adoption of Object Storages in persistence products, using Log Structured Merge (LSM) Trees, has taken place. We find them in Elastic Search, in Cassandra, in RocksDB and its many applications, and many more. In a timeline, this would put us into 2014-land.&lt;/p&gt;
&lt;p&gt;LFS-like non-overwriting structures are also at the foundation of all of our storage, deep down in the block-simulation layer of flash storage devices, again around 2014.&lt;/p&gt;
&lt;h2 id=&#34;other-developments&#34;&gt;
    &lt;a href=&#34;#other-developments&#34;&gt;
	Other developments
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Flash Storage originally appeared as a simulated hard disk, SSD. So we have a PCI bus, on which there is a SATA controller, which connects to the simulated hard disks&amp;rsquo; flash controller, which talks to the flash.&lt;/p&gt;
&lt;h3 id=&#34;ssd-nvme-roce-and-nvmeof&#34;&gt;
    &lt;a href=&#34;#ssd-nvme-roce-and-nvmeof&#34;&gt;
	SSD, NVME, RoCE, and NVMEoF
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;NVME is what we get when we ask the question &amp;ldquo;What purpose does the SATA controller have in this setup, anyway?&amp;rdquo; - except slowing everything down, forcing us to use antiquated SCSI commands and serializing access to the highly parallel flash.&lt;/p&gt;
&lt;p&gt;NVME therefore is a PCI bus, which talks to flash controllers, which talk to the flash, and a revised command set for this. The great innovation is to put away the single disk queue and allow many of these. Which allows us to utilize around 800k IOPS per device, even if a single operation can take as long as 1/20.000th of a second - just go 40-way wide, if you can.&lt;/p&gt;
&lt;p&gt;Now, what if we had a way to speak to a NVME device on a different computers PCI bus as if it were local? That&amp;rsquo;s what remote DMA (RDMA) would enable us to do. RoCE (&amp;ldquo;rocky&amp;rdquo;, &amp;ldquo;RDMA over Converged Ethernet&amp;rdquo;) initially was painful - RoCE V1 was unrouteable raw Ethernet with its own Ethertype. RoCE V2 fixed that, and put the entire stuff into UDP instead, so it was routeable, at least within a single data center.&lt;/p&gt;
&lt;p&gt;Turns out, the value in RDMA is more in the Remote than in the DMA, so when RoCE became &amp;ldquo;NVME over Fabric over TCP&amp;rdquo; (NVMEoF/TCP), it was valuable and useful to have, even if you had an ultracheap Broadcom that did not properly DMA the way RoCE needs it. The resulting access to a remote NVME still was as fast as to a local SSD, or even faster.&lt;/p&gt;
&lt;h3 id=&#34;mmap&#34;&gt;
    &lt;a href=&#34;#mmap&#34;&gt;
	mmap()
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;And finally, &lt;code&gt;mmap()&lt;/code&gt; is a Unix system call that allows you to map a file into the address space of a process: when you access a memory page, this memory page is appropriately filled with the content of the file, automatically. Think &amp;ldquo;swap from any file into memory, not just from a swap file&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;For mutable files, and the kings of mutability, relational databases, mmap() is of little use and has many complexities. Databases need extending files, controlled write-out to persistent storage, not overwriting data because MVCC. Also, different data formats on disk and in memory are actually important to people who transact, and hence mmap() does help very little for most databases. We can talk about &amp;ldquo;Optane&amp;rdquo;, &amp;ldquo;PMEM&amp;rdquo;, and &amp;ldquo;transactional memory&amp;rdquo;, but that&amp;rsquo;s a different lecture for another day.&lt;/p&gt;
&lt;p&gt;Making an &lt;em&gt;immutable&lt;/em&gt; file available &lt;em&gt;read-only&lt;/em&gt; in memory has none of these complexities, and is actually very useful and efficient. This is what mmap() is really, really good at - you get clean, discardable memory pages, none of the file extension problems, none of the &amp;ldquo;which pages are written to disk at what point in time&amp;rdquo; sychronisation problems.&lt;/p&gt;
&lt;p&gt;The idea is so good that Bryan Cantrill actually had it first, and foreshadowed &amp;ldquo;Serverless&amp;rdquo; in &lt;a href=&#34;https://github.com/joyent/manta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Manta&lt;/a&gt;

. Basically, Joyent starts a &amp;ldquo;Container&amp;rdquo;, actually a BSD &amp;ldquo;jail&amp;rdquo; or Solaris &amp;ldquo;zone&amp;rdquo;, because containers weren&amp;rsquo;t fully invented, yet. It then maps a kind of not-quite-S3 object into it and your code can  access this, and emit output results into a new object in the same or a different bucket.&lt;/p&gt;
&lt;p&gt;The mmap() in this is a nice sugar on top of it, as it makes reads automatic,  en-passant and makes I/O minimal. The important fact is that Input and Output are distinguished and the input file is still immutable. Because it is, the munmap() is unimportant - exit() is also a munmap() and since the object is immutable it is unimportant if it stays mapped.&lt;/p&gt;
&lt;h2 id=&#34;putting-it-all-together&#34;&gt;
    &lt;a href=&#34;#putting-it-all-together&#34;&gt;
	Putting it all together
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;So you have a page fault and have to get a page from local storage.&lt;/p&gt;
&lt;p&gt;So why not get it from Ethernet, via RDMA, remotely, from any disk anywhere in your data center? Can we have this as a kernel extension and - more important - standardized in the NVME spec?&lt;/p&gt;
&lt;p&gt;Ah, now we&amp;rsquo;re talking. &amp;ldquo;We have standardized remote page fault reads over NVMEoF&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s the article - at least, that is what I think it is, because it does not say so, and it references nothing.&lt;/p&gt;
&lt;p&gt;But even so, it needs 50 years of Unix as a context to be understandable.&lt;/p&gt;
&lt;p&gt;I still don&amp;rsquo;t know what the original article was, but there is stuff such as &lt;a href=&#34;https://www.usenix.org/conference/nsdi20/presentation/yang&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FileMR: Rethinking RDMA Networking for Scalable Persistent Memory&lt;/a&gt;

 that is being worked on.&lt;/p&gt;
&lt;p&gt;Based on &lt;a href=&#34;https://twitter.com/isotopp/status/1313084116569645057&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a twitter tread&lt;/a&gt;

.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>

