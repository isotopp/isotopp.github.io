<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Ein Ring mit zwei MySQL-Servern und auto_increment_increment | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2010/08/17/ein-ring-mit-zwei-mysql-servern-und-auto-increment-increment.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Ein Ring mit zwei MySQL-Servern und auto_increment_increment | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="de_DE" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2010/08/17/ein-ring-mit-zwei-mysql-servern-und-auto-increment-increment.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2010-08-17T19:50:00Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Ein Ring mit zwei MySQL-Servern und auto_increment_increment' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="ein-ring-mit-zwei-mysql-servern-und-auto_increment_increment-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Ein Ring mit zwei MySQL-Servern und auto_increment_increment
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>August 17, 2010</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/mysql.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2010/08/16/fertig-gelesen-the-fuller-memorandum.html">Fertig gelesen: The Fuller Memorandum</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2010/08/18/verteilte-datenbanken-der-sonderfall-filialsysteme.html">Verteilte Datenbanken: Der Sonderfall Filialsysteme</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>Lalufu fragte in den Kommentaren von
<a href="/2010/08/16/master-master-und-distributed-transactions.html">Master-Master</a>

:</p>
<blockquote>
<p>Ich habe eine MM-Replikation mit zwei Servern.</p>
<p>Beide haben auto_increment_increment=10,</p>
<p>Server A hat auto_increment_offset=0 und Server B hat
auto_increment_offset=1.</p>
<p>Ich lege mir eine Tabelle mit einem auto_increment-Feld (id) an und mache
auf Server A einen INSERT, dann kriegt die row id=0, und wird auf B
repliziert, richtig?</p>
<p>Dann noch einen INSERT auf A, die row kriegt id=10, und wird auf B
repliziert.Wenn ich jetzt auf B einen INSERT mache, welchen Wert kriegt
das id in der row?</p></blockquote>
<p>Statt einer Antwort hier die Methode zum selber rausfinden.</p>
<p>Wir installieren zwei MySQL-Instanzen zum Testen (Mac OS X mit Macports).
Das ist recht einfach, denn dazu muß man nur zwei Datenverzeichnisse mit
mysql_install_db initialisieren und passende minimale Konfigurationen
erzeugen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:~ kris$ cd /tmp
</span></span></span><span class="line"><span class="cl"><span class="go">KK:tmp kris$ mkdir eins zwei
</span></span></span><span class="line"><span class="cl"><span class="go">KK:tmp kris$ mysql_install_db5 --datadir=/tmp/eins --user=kris
</span></span></span><span class="line"><span class="cl"><span class="go">Installing MySQL system tables...
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">KK:tmp kris$ mysql_install_db5 --datadir=/tmp/zwei --user=kris
</span></span></span><span class="line"><span class="cl"><span class="go">Installing MySQL system tables...
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">KK:tmp kris$ cd eins
</span></span></span><span class="line"><span class="cl"><span class="go">KK:eins kris$ cat &gt; my.cnf
</span></span></span><span class="line"><span class="cl"><span class="go">[mysqld]
</span></span></span><span class="line"><span class="cl"><span class="go">datadir=/tmp/eins
</span></span></span><span class="line"><span class="cl"><span class="go">socket=/tmp/eins/mysql.sock
</span></span></span><span class="line"><span class="cl"><span class="go">port=3307
</span></span></span><span class="line"><span class="cl"><span class="go">log_bin
</span></span></span><span class="line"><span class="cl"><span class="go">server_id = 1
</span></span></span><span class="line"><span class="cl"><span class="go">auto_increment_increment = 10
</span></span></span><span class="line"><span class="cl"><span class="go">auto_increment_offset = 1
</span></span></span><span class="line"><span class="cl"><span class="go">innodb
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">KK:eins kris$ cd ../zwei
</span></span></span><span class="line"><span class="cl"><span class="go">KK:zwei kris$ cat my.cnf
</span></span></span><span class="line"><span class="cl"><span class="go">[mysqld]datadir=/tmp/zwei
</span></span></span><span class="line"><span class="cl"><span class="go">socket=/tmp/zwei/mysql.sock
</span></span></span><span class="line"><span class="cl"><span class="go">port=3308
</span></span></span><span class="line"><span class="cl"><span class="go">log_bin
</span></span></span><span class="line"><span class="cl"><span class="go">server_id = 2
</span></span></span><span class="line"><span class="cl"><span class="go">auto_increment_increment = 10
</span></span></span><span class="line"><span class="cl"><span class="go">auto_increment_offset = 2
</span></span></span><span class="line"><span class="cl"><span class="go">innodb
</span></span></span></code></pre></div><p>Die Server können nun gestartet werden. Wir geben jedem Server einen Zeiger
auf seine Konfiguration mit.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:zwei kris$ cd ../eins
</span></span></span><span class="line"><span class="cl"><span class="go">KK:eins kris$ mysqld_safe5 --defaults-file=/tmp/eins/my.cnf &amp;
</span></span></span><span class="line"><span class="cl"><span class="go">100817 13:05:02 mysqld_safe Logging to &#39;/tmp/eins/KK.local.err&#39;.
</span></span></span><span class="line"><span class="cl"><span class="go">100817 13:05:02 mysqld_safe Starting mysqld daemon with databases from /tmp/eins
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">KK:eins kris$ cd ../zwei
</span></span></span><span class="line"><span class="cl"><span class="go">KK:zwei kris$ mysqld_safe5 --defaults-file=/tmp/zwei/my.cnf &amp;
</span></span></span><span class="line"><span class="cl"><span class="go">100817 13:05:40 mysqld_safe Logging to &#39;/tmp/zwei/KK.local.err&#39;.
</span></span></span><span class="line"><span class="cl"><span class="go">100817 13:05:40 mysqld_safe Starting mysqld daemon with databases from /tmp/zwei
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">KK:zwei kris$ lsof -i -n -P | grep my
</span></span></span><span class="line"><span class="cl"><span class="go">mysqld    1042 kris   10u  IPv4 0x05691740      0t0  TCP \*:3307 (LISTEN)
</span></span></span><span class="line"><span class="cl"><span class="go">mysqld    1112 kris   10u  IPv4 0x0ba7eec8      0t0  TCP \*:3308 (LISTEN)
</span></span></span></code></pre></div><p>Nachdem wir die zwei Server laufen haben und beide leer sind, können wir
eine Datenbank aufsetzen und die Replikation konfigurieren. Wir nutzen hier
den Spezialfall, daß beide Server dieselben Daten haben, weil sie leer sind,
können uns also eine Menge Arbeit sparen.</p>
<p>Ich habe die Angewohnheit, bei multiplen Instanzen auf einer Hardware
@@hostname und @@datadir abzufragen, da die Kombination beider Werte eine
Instanz eindeutig identifiziert. So kann ich sicher sein, mit dem richtigen
Server zu sprechen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:zwei kris$ mysql5 --host=127.0.0.1 --port=3307
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; select @@hostname, @@datadir;
</span></span></span><span class="line"><span class="cl"><span class="go">+------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| @@hostname | @@datadir  |
</span></span></span><span class="line"><span class="cl"><span class="go">+------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| KK.local   | /tmp/eins/ |
</span></span></span><span class="line"><span class="cl"><span class="go">+------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; create database kris;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 1 row affected (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; create table kris.t ( id integer not null primary key auto_increment, d varchar(20) charset latin1 ) engine = innodb;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.10 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; quit
</span></span></span><span class="line"><span class="cl"><span class="go">Bye
</span></span></span></code></pre></div><p>Und dasselbe drüben auch noch mal.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:zwei kris$ mysql5 --host=127.0.0.1 --port=3308
</span></span></span><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; select @@hostname, @@datadir;
</span></span></span><span class="line"><span class="cl"><span class="go">+------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| @@hostname | @@datadir  |
</span></span></span><span class="line"><span class="cl"><span class="go">+------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| KK.local   | /tmp/zwei/ |
</span></span></span><span class="line"><span class="cl"><span class="go">+------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; create database kris;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 1 row affected (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; create table kris.t ( id integer not null primary key auto_increment, d varchar(20) charset latin1 ) engine = innodb;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.06 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; quit
</span></span></span><span class="line"><span class="cl"><span class="go">Bye
</span></span></span></code></pre></div><p>Nachdem wir jetzt eine Testdatenbank mit einer leeren Testtabelle haben,
können wir replizieren. Wir setzen zunächst einmal den Server 3307 (eins)
auf. Dazu definieren wir einen Account für zwei mit dem Privileg <code>replication slave</code> und notieren die Binlog-Position von eins:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:zwei kris$ mysql5 --host=127.0.0.1 --port=3307
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; grant replication slave on \*.\* to &#39;zwei&#39;@&#39;127.0.0.1&#39; identified by &#39;s3cr3t!&#39;;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.05 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; show master status;
</span></span></span><span class="line"><span class="cl"><span class="go">+---------------+----------+--------------+------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB |
</span></span></span><span class="line"><span class="cl"><span class="go">+---------------+----------+--------------+------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| KK-bin.000003 |      106 |              |                  |
</span></span></span><span class="line"><span class="cl"><span class="go">+---------------+----------+--------------+------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; quit
</span></span></span><span class="line"><span class="cl"><span class="go">Bye
</span></span></span></code></pre></div><p>Mit diesen Daten können wir nun zwei einrichten. Auch dort muß ein Account
mit <code>replication slave</code> eingerichtet werden. Wir lassen außerdem einmal ein
<code>CHANGE MASTER</code> Statement los, und starten den Slave auf zwei, sodaß er von
eins repliziert. Am Ende notieren wir uns das Binlog von zwei, um auch auf
eins ein <code>CHANGE MASTER</code> machen zu können.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:zwei kris$ mysql5 --host=127.0.0.1 --port=3308
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; grant replication slave on \*.\* to &#39;eins&#39;@&#39;127.0.0.1&#39; identified by &#39;s3cr3t!&#39;;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; change master to master_host = &#39;127.0.0.1&#39;, master_port = 3307, master_user = &#39;zwei&#39;, master_password = &#39;s3cr3t!&#39;, master_log_file = &#39;KK-bin.000003&#39;, master_log_pos = 106;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.80 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; start slave;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.02 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; show slave status\G
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">Slave_IO_Running: Yes
</span></span></span><span class="line"><span class="cl"><span class="go">Slave_SQL_Running: Yes
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; show master status;
</span></span></span><span class="line"><span class="cl"><span class="go">+---------------+----------+--------------+------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB |
</span></span></span><span class="line"><span class="cl"><span class="go">+---------------+----------+--------------+------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| KK-bin.000003 |      246 |              |                  |
</span></span></span><span class="line"><span class="cl"><span class="go">+---------------+----------+--------------+------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; quit
</span></span></span><span class="line"><span class="cl"><span class="go">Bye
</span></span></span></code></pre></div><p>Jetzt muß nur noch auf dem Server eins das <code>CHANGE MASTER</code> mit diesen Daten
laufen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">KK:zwei kris$ mysql5 --host=127.0.0.1 --port=3307
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; change master to master_host = &#39;127.0.0.1&#39;, master_port = 3308, master_user = &#39;eins&#39;, master_password = &#39;s3cr3t!&#39;, master_log_file = &#39;KK-bin.000003&#39;, master_log_pos = 246;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.77 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; start slave;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; show slave status\G
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">Slave_IO_Running: Yes
</span></span></span><span class="line"><span class="cl"><span class="go">Slave_SQL_Running: Yes
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span></code></pre></div><p>Wir haben nun einen Ring, der zwischen zwei Instanzen auf Port 3307 und Port
3308 repliziert. Das kann man auch sehen:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">KK</span><span class="p">:</span><span class="n">zwei</span><span class="w"> </span><span class="n">kris$</span><span class="w"> </span><span class="n">lsof</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">P</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">my</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysqld</span><span class="w">    </span><span class="mi">1210</span><span class="w"> </span><span class="n">kris</span><span class="w">   </span><span class="mi">11</span><span class="n">u</span><span class="w">  </span><span class="n">IPv4</span><span class="w"> </span><span class="mi">0</span><span class="n">x06091e98</span><span class="w">      </span><span class="mi">0</span><span class="n">t0</span><span class="w">  </span><span class="n">TCP</span><span class="w"> </span><span class="err">\</span><span class="o">*</span><span class="p">:</span><span class="mi">3307</span><span class="w"> </span><span class="p">(</span><span class="k">LISTEN</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysqld</span><span class="w">    </span><span class="mi">1210</span><span class="w"> </span><span class="n">kris</span><span class="w">   </span><span class="mi">31</span><span class="n">u</span><span class="w">  </span><span class="n">IPv4</span><span class="w"> </span><span class="mi">0</span><span class="n">x0ba6def8</span><span class="w">      </span><span class="mi">0</span><span class="n">t0</span><span class="w">  </span><span class="n">TCP</span><span class="w"> </span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">3307</span><span class="o">-&gt;</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">50981</span><span class="w"> </span><span class="p">(</span><span class="n">ESTABLISHED</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysqld</span><span class="w">    </span><span class="mi">1210</span><span class="w"> </span><span class="n">kris</span><span class="w">   </span><span class="mi">37</span><span class="n">u</span><span class="w">  </span><span class="n">IPv4</span><span class="w"> </span><span class="mi">0</span><span class="n">x098bab4c</span><span class="w">      </span><span class="mi">0</span><span class="n">t0</span><span class="w">  </span><span class="n">TCP</span><span class="w"> </span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">50989</span><span class="o">-&gt;</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">3308</span><span class="w"> </span><span class="p">(</span><span class="n">ESTABLISHED</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysqld</span><span class="w">    </span><span class="mi">1282</span><span class="w"> </span><span class="n">kris</span><span class="w">   </span><span class="mi">11</span><span class="n">u</span><span class="w">  </span><span class="n">IPv4</span><span class="w"> </span><span class="mi">0</span><span class="n">x0ba7eec8</span><span class="w">      </span><span class="mi">0</span><span class="n">t0</span><span class="w">  </span><span class="n">TCP</span><span class="w"> </span><span class="err">\</span><span class="o">*</span><span class="p">:</span><span class="mi">3308</span><span class="w"> </span><span class="p">(</span><span class="k">LISTEN</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysqld</span><span class="w">    </span><span class="mi">1282</span><span class="w"> </span><span class="n">kris</span><span class="w">   </span><span class="mi">31</span><span class="n">u</span><span class="w">  </span><span class="n">IPv4</span><span class="w"> </span><span class="mi">0</span><span class="n">x0ba7faec</span><span class="w">      </span><span class="mi">0</span><span class="n">t0</span><span class="w">  </span><span class="n">TCP</span><span class="w"> </span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">3308</span><span class="o">-&gt;</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">50989</span><span class="w"> </span><span class="p">(</span><span class="n">ESTABLISHED</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysqld</span><span class="w">    </span><span class="mi">1282</span><span class="w"> </span><span class="n">kris</span><span class="w">   </span><span class="mi">35</span><span class="n">u</span><span class="w">  </span><span class="n">IPv4</span><span class="w"> </span><span class="mi">0</span><span class="n">x098b9b1c</span><span class="w">      </span><span class="mi">0</span><span class="n">t0</span><span class="w">  </span><span class="n">TCP</span><span class="w"> </span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">50981</span><span class="o">-&gt;</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">3307</span><span class="w"> </span><span class="p">(</span><span class="n">ESTABLISHED</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>Jetzt können wir testen:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">KK</span><span class="p">:</span><span class="n">zwei</span><span class="w"> </span><span class="n">kris$</span><span class="w"> </span><span class="n">mysql5</span><span class="w"> </span><span class="c1">--host=127.0.0.1 --port=3307 -e &#39;insert into kris.t values (NULL, &#34;auf eins&#34;);&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">KK</span><span class="p">:</span><span class="n">zwei</span><span class="w"> </span><span class="n">kris$</span><span class="w"> </span><span class="n">mysql5</span><span class="w"> </span><span class="c1">--host=127.0.0.1 --port=3308 -e &#39;insert into kris.t values (NULL, &#34;auf zwei&#34;);&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">KK</span><span class="p">:</span><span class="n">zwei</span><span class="w"> </span><span class="n">kris$</span><span class="w"> </span><span class="n">mysql5</span><span class="w"> </span><span class="c1">--host=127.0.0.1 --port=3308 -e &#39;select \* from kris.t;&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">+</span><span class="c1">----+----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">d</span><span class="w">        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">auf</span><span class="w"> </span><span class="n">eins</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">auf</span><span class="w"> </span><span class="n">zwei</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+----------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">KK</span><span class="p">:</span><span class="n">zwei</span><span class="w"> </span><span class="n">kris$</span><span class="w"> </span><span class="n">mysql5</span><span class="w"> </span><span class="c1">--host=127.0.0.1 --port=3307 -e &#39;insert into kris.t values (NULL, &#34;nochmal eins&#34;);&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">KK</span><span class="p">:</span><span class="n">zwei</span><span class="w"> </span><span class="n">kris$</span><span class="w"> </span><span class="n">mysql5</span><span class="w"> </span><span class="c1">--host=127.0.0.1 --port=3307 -e &#39;select \* from kris.t;&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">+</span><span class="c1">----+--------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">d</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+--------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">auf</span><span class="w"> </span><span class="n">eins</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">auf</span><span class="w"> </span><span class="n">zwei</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">nochmal</span><span class="w"> </span><span class="n">eins</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+--------------+
</span></span></span></code></pre></div><p>Die Antwort lautet also:</p>
<p>Jeder Server hat seinen eigenen AUTO_INCREMENT-Zähler an der Tabelle, der
mit dem <code>auto_increment_offset</code> initialisiert wird und der in Schritten von
<code>auto_increment_increment</code> hochgezählt wird. Das geschieht jedoch nur, wenn
ein Nullwert in die Tabelle eingetragen wird, also nur bei lokalen
INSERT-Statements. Statements, die durch Replikation übermittelt werden,
bringen einen Wert vom Master mit und zählen nichts hoch.</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysql
				</a>
				
				<a href="/tags/#replication" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				replication
				</a>
				
				<a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_de
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2010-08-17-ein-ring-mit-zwei-mysql-servern-und-auto-increment-increment.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2010/08/16/fertig-gelesen-the-fuller-memorandum.html">Fertig gelesen: The Fuller Memorandum</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2010/08/18/verteilte-datenbanken-der-sonderfall-filialsysteme.html">Verteilte Datenbanken: Der Sonderfall Filialsysteme</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
