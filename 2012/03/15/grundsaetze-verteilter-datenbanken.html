<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Grundsätze verteilter Datenbanken | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2012/03/15/grundsaetze-verteilter-datenbanken.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Grundsätze verteilter Datenbanken | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="de_DE" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2012/03/15/grundsaetze-verteilter-datenbanken.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2012-03-15T08:59:42Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Grundsätze verteilter Datenbanken' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/mysql.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="grunds%C3%A4tze-verteilter-datenbanken-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Grundsätze verteilter Datenbanken
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>March 15, 2012</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/mysql.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2012/03/12/wie-man-einen-graph-plottet.html">Wie man einen Graph plottet</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2012/04/27/alle-vier-stunden-zum-nutzen-von-antivirus-und-zum-nutzen-von-testverfahren.html">Alle vier Stunden - zum Nutzen von Antivirus und zum Nutzen von Testverfahren</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>Wonka&gt;
Die <a href="http://www.toppoint.de%27%3ehttp://www.toppoint.de" target="_blank" rel="noopener">Toppoint</a>

  z.B. wird vermutlich nie was haben, was in nennenswerte Last-Regionen kommt, aber ich will - akademisches Interesse und so - schon wissen, wie man das da am besten täte.
Was mich auch für die Toppoint interessiert: irgendeine Sorte Redundant Array of Inexpensive Databases :)</p>
<p>Lalufu&gt;
MySQL mit Replication?  Alternativ mit DRBD?</p>
<p>Isotopp&gt;
Mit DRBD. Nicht mit Replikation.</p>
<p>Wonka&gt;
Lalufu: Hm, Master-Master-Replication geht ja nur mit Zweien.
Wenn man nun mehr als das haben will, kann man zwar Ringe bauen, aber nur einfach verkettete.</p>
<p>Isotopp&gt;
Wonka: Argh!
Master-Master geht nicht mit Replikation.
Nie.</p>
<p>Wonka&gt;
huh?</p>
<p>Isotopp&gt;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="c1">-- Thread 1 schreibt auf Master 1:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="nf">t</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="no">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;eins&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Zeitgleich schreibt thread 2 auf master 2: 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="nf">t</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="no">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;zwei&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>Isotopp&gt;
Was steht in der Datenbank <code>master1</code>, was steht in der Datenbank <code>master2</code>?
Wenn man mal annimmt, dass MySQL <code>auto_increment_increment</code> und <code>auto_increment_offset</code> korrekt gesetzt sind?</p>
<p>Wonka&gt;
Isotopp: ok, Problem.
Trotzdem gibts reichlich HOWTOs dazu.</p>
<p>Isotopp&gt;
Wonka: Das ist noch kein Problem.  Du kriegst <code>(1, 'eins')</code> und <code>(2, 'zwei')</code>.
So weit funktioniert das.</p>
<p>kv_&gt;
Bei <code>UPDATE</code> sieht&rsquo;s anders aus.</p>
<p>Isotopp&gt;
Jetzt macht aber Thread 1 auf <code>master1</code> ein <code>UPDATE</code>.
Und zwar <code>update t set d = 'een' where id =1;</code>.
Und Thread 2 macht auf <code>master2</code> ein <code>UPDATE</code>.
Und zwar <code>update t set d = 'one' where id  = 1;</code>
Was steht auf <code>master1</code> und was steht auf <code>master2</code>?</p>
<p>Isotopp&gt;
Der Punkt ist, daß es keine global für die Domain des ganzen Ringes gültige Serialisierung von Ereignissen gibt.
Es gibt also keine globale Festlegung der Reihenfolge von Ereignissen.
Sondern jeder lokale Knoten hat seine eigene Reihenfolge von Ereignissen.
Im Klartext heißt das, daß auf <code>master1</code> die Reihenfolge der Events <code>een</code>, <code>one</code> sein kann,
auf Master 2 aber <code>one</code>, <code>een</code> oder umgekehrt.</p>
<p>Lalufu&gt;
Genaugenommen ist das Problem, daß Leute sowas gerne hätten, aber MySQL das nicht liefern kann.</p>
<p>Isotopp&gt;
Lalufu: Nein, die Situation ist weitaus komplizierter.
Laß mich zu Ende erklären.</p>
<p>Wonka&gt;
<a href="http://www.howtoforge.com/mysql_master_master_replication" target="_blank" rel="noopener">http://www.howtoforge.com/mysql_master_master_replication</a>

:</p>
<blockquote>
<p>&ldquo;This tutorial describes how to set up MySQL master-master replication.
We need to replicate MySQL servers to achieve high-availability (HA).
In my case I need two masters that are synchronized with each other so that if one of them drops down, other could take over and no data is lost.
Similarly when the first one goes up again, it will still be used as slave for the live one.&rdquo;</p></blockquote>
<p>Wonka&gt;
Also haben die&rsquo;s nicht verstanden&hellip;</p>
<p>Isotopp&gt;
Richtig.
Genauer: Sie glauben, sie können gewinnen.
Aber das Universum kann man nicht bescheißen.</p>
<p>Isotopp&gt;
Wonka: Du willst also eine solche Serialisierung erzwingen.
In SQL erzwingt man eine bestimmte Reihenfolge von Ereignissen, indem man für die Domain, in der man arbeitet eine Sperre (englisch: lock) setzt.
Man braucht also ein Locking, das in der ganzen Domain gilt.</p>
<p>Isotopp&gt;
Die Domain ist nun aber nicht mehr eine Kiste, dafür hat Dein SQL Server ja Locks, sondern der Ring.
Und MySQL Replikation hat spezifisch kein Locking Protokoll.
Es gibt solche Protokolle, 2PC, 3PC, Paxos, Raft und noch ein paar mehr.
2PC ist das schnellste, in dem Sinne, daß es minimale Umlaufanzahlen/Lockzeiten hat.
Paxos und Raft sind im Sinne der Ausfallsicherheit/Recoverability das Sicherste.</p>
<p>Ohne ein solches Locking Protokoll kannst Du nirgendwo konkurrente Writes sicher durchführen, weil Du eben keine für die Domain gültige Serialisierung von Ereignissen erzwingen kannst.
Jedes Setup mit mehr als einem Writer ohne ein distributed locking protocol ist also kaputt.</p>
<p>Lesen wir also die Anleitung zu <code>mmm</code>, MySQL Multi Master.
Steht drin: »schreiben nur in einem Knoten.«
Also: ein Ring, kein Multi-Master - der Name ist Betrug.</p>
<p>Gucken wir irgendwo sonst, total egal wo:
ENTWEDER Synchronisation durch Locking ODER nur ein Master ODER kaputt.</p>
<p>Das ist die Wahl.
Die ganze Wahl.
Es gibt keine weiteren Möglichkeiten.</p>
<p>kv_&gt;
Wonka: Und wenn man die Leute fragt, warum die Master-Master oder circular replication aufsetzen, kommt immer die falsche Antwort:
&ldquo;Ausfallsicherheit&rdquo; oder &ldquo;Lastverteilung&rdquo;.
Für Ausfallsicherheit nimmt man ein Shared Storage und baut sich eine failover-Lösung auf OS-Ebene drüber - also NetApp oder DRBD.
Und für Lastverteilung beim Lesen nimmt man one-way Replication.
Schreibverteilung kann MySQL nicht.
Da fängt man dann an, auf Anwendungsebene Sharding-Architekturen zu bauen.</p>
<p>Isotopp&gt;
Exakt.</p>
<p>Isotopp&gt;
Lalufu: So, jetzt zu MySQL und liefern.
MySQL liefert ein Produkt mit mehreren Knoten und 2PC.
Es heißt MySQL Cluster.
Es verwendet nicht MYSQL Replikation, um das zu tun.</p>
<p>Isotopp&gt;
Und zu HA:
MySQL 5.1, 5.5 und 5.6 haben verschiedene Inkremente von MySQL SemiSynchronous Replication (SSR).
Damit hat man EINEN Master, aber Slaves, die das Commit auf dem Master VERZÖGERN (den Master also langsamer machen).
Und zwar so lange, bis wenigstens ein Slave existiert, der denselben Stand hat wie der Master.</p>
<p>Das kombiniert die Nachteile von 2PC (warten) mit den Nachteilen von Replikation, die da sind:</p>
<p>In MySQL Replikation ist der Slave ja abhängig von der MySQL <code>binlog position</code>.
Die verwaltet jeder Knoten aber selber.
Und das heißt, man kann den Slave 3, der an Master 1 hängt, nicht einfach an Slave 2 hängen, von dem wir wissen, daß er Dank SSR auf demselben Stand wie Master 1 ist.
Das ist so, weil der Stand von Master 1 in binlog position (mname, mpos) ausgedrückt wird, derselbe Stand auf slave 2 aber (s2name, s2pos) ausgedrückt wird.</p>
<p>Und es gibt keinen Übersetzungsmechanismus.
Man kann einen bauen, das tut dann unterschiedlich weh, je nachdem wie korrekt man das im Falle eines Desasters haben will.
Und wir reden über HA, man will es also korrekt haben.</p>
<p>In MySQL 5.6 gibt es dann die Global Transaction ID (GTID) und einen Übersetzungsmechanismus (transparent, automatisch) von GTID in lokale Position.
Mit SSR und GTID zusammen kann man dann in 5.6 auch endlich Replikation als HA Mechanismus verwenden und könnte einen Ring mit genau einem aktiven Master als HA-System stabil verwenden.
Das heißt, man hat immer noch Waits wegen der Synchronisation in SSR, aber keine Probleme mit dem Failover mehr.</p>
<p>Wonka&gt;
MySQL Cluster ist aber nicht FOSS, oder?</p>
<p>Isotopp&gt;
Wonka: MYSQL Cluster war früher FOSS.
Was es jetzt ist, habe ich nicht nachgesehen, weil mich Cluster aus anderen Gründen nicht interessiert.</p>
<p>Es ist strukturell nicht möglich, normale Anwendungen, die gegen vanilla MySQL performen, gegen Cluster laufen zu lassen und Performance zu erwarten.
Cluster-Software ist immer speziell gegen Cluster geschrieben.</p>
<p>Aktueller Cluster ist inzwischen VIEL BESSER darin als der Cluster, den ich gekannt habe, aber es bleibt schwierig.</p>
<p>Du suchst einfache Lösungen für distributed databases.
So etwas existiert nicht.
So etwas KANN nicht existieren ohne daß du an c drehst.</p>
<p>Du willst also mit Q (aus Star Trek: The Next Generation) reden, oder Dir eine von Grace Hoppers Mikrosekunden um den Hals hängen.</p>
<p>Lalufu&gt;
Würden Sie diesem Mann Ihre Replikation anvertrauen?</p>
<p><p class="md__image">
  <img src="http://images5.fanpop.com/image/photos/25400000/Discord-dance-random-25482674-500-378.gif" alt=""  />
</p>

</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#cluster" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				cluster
				</a>
				
				<a href="/tags/#database" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				database
				</a>
				
				<a href="/tags/#erklaerbaer" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				erklaerbaer
				</a>
				
				<a href="/tags/#distributed-computing" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				distributed computing
				</a>
				
				<a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysql
				</a>
				
				<a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_de
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2012-03-15-grundsaetze-verteilter-datenbanken.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2012/03/12/wie-man-einen-graph-plottet.html">Wie man einen Graph plottet</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2012/04/27/alle-vier-stunden-zum-nutzen-von-antivirus-und-zum-nutzen-von-testverfahren.html">Alle vier Stunden - zum Nutzen von Antivirus und zum Nutzen von Testverfahren</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
