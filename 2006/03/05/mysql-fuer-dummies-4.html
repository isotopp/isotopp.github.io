<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>MySQL für Dummies (4) | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2006/03/05/mysql-fuer-dummies-4.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='MySQL für Dummies (4) | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="de_DE" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2006/03/05/mysql-fuer-dummies-4.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2006-03-05T17:00:00Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='MySQL für Dummies (4)' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="mysql-f%C3%BCr-dummies-4-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						MySQL für Dummies (4)
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>March 5, 2006</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2006/03/04/mysql-fuer-dummies-3.html">MySQL für Dummies (3)</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2006/03/06/mysql-fuer-dummies-5.html">MySQL für Dummies (5)</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>Wie wir in den vorangegangenen Beispielen gesehen haben, reicht es nicht aus, einer Datenbank zu sagen, welche Daten sie zu suchen hat.
Wir müssen ihr auch noch Hilfen geben, mit denen sie in der Lage ist, diese Aufgabe schnell zu erfüllen.
Eine sehr wichtige solche Hilfe ist ein Index.</p>
<p>Eine MYD-Datei wird, wenn sie keine Lücken hat, durch Anfügen von neuen Datensätzen verlängert.
Die natürliche Reihenfolge der Datensätze in einer MYD-Datei ohne Löschen ist also chronologisch.
Wenn in der MYD-Datei auch gelöscht wird, werden die Dinge komplizierter, denn MySQL wird versuchen, die Lücken aufzufüllen.
Die Reihenfolge der Datensätze ist dann zufällig.</p>
<p>Das gleicht einer Bücherei, bei der neu gekaufte Bücher einfach hinten in die freien Regale gestellt werden, und wenn Lücken vorhanden sind, diese aufgefüllt werden.</p>
<p>Ein Index ist eine Struktur, die uns erlaubt, bestimmte Suchen schneller durchzuführen.
Büchereien haben zum Beispiel oft einen Titelkatalog oder einen Autorenkatalog.
Ein Autorenkatalog entsteht, indem wir die Autoren aller Bücher in der Bücherei zusammen mit dem Regalstandort des Buches auf Notizkarten aufschreiben und diese Karten dann alphabetisch nach Autoren sortieren.</p>
<p>In einem sortierten Datenbestand kann man nämlich sehr schnell suchen.
Wenn auf den Autorenkarten keine Reiter &ldquo;a&rdquo;, &ldquo;b&rdquo;, &ldquo;c&rdquo;, &hellip; vorhanden sind, kann man &ldquo;Suchen durch Halbieren&rdquo;:
Ein Buch von &ldquo;Jeremy Zawodny&rdquo; findet man, indem man die Autorenliste halbiert und dann prüft, ob der Autor in der ersten oder zweiten Hälfte der Bücher zu finden ist.
Diese Hälfte halbiert man dann wieder, und so weiter und so weiter.</p>
<p>Für zwei Bücher kann man so mit einer Operation entscheiden, welches von beiden Büchern das gesuchte ist.
Für vier Bücher braucht man eine Operation, um dies auf den Fall mit zwei Büchern zurückzuführen, also zwei Operationen insgesamt.
Für acht Bücher kann man dies mit einer Operation auf den Fall mit vier Büchern reduzieren.</p>
<p>Allgemein braucht man für n Bücher dann also log(2,n) Operationen, um ein Buch eines bestimmten Autors zu finden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">Bücher   Suchoperationen
</span></span></span><span class="line"><span class="cl"><span class="go">     2   1 (2^[b]1[/b] = 2)
</span></span></span><span class="line"><span class="cl"><span class="go">     4   2 (2^[b]2[/b] = 4)
</span></span></span><span class="line"><span class="cl"><span class="go">     8   3 (2^[b]3[/b] = 8)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">     n   e = log(2, n) (2^e = n)
</span></span></span></code></pre></div><p>Aus einer Bibliothek mit 20 Millionen Büchern kann man also mit weniger als 24-25 Operationen die Bücher von Jeremey Zawodny finden, wenn man einen nach Autorennamen sortierten Katalog zur Verfügung hat:
Man bekommt so eine Liste der Standorte, und muss dann zu den auf den Karten notierten Standorten laufen, um die Bücher tatsächlich abzuholen.</p>
<pre tabindex="0"><code class="language-consonle" data-lang="consonle">root@localhost [(none)]&gt; select log(20000000)/log(2) as ops;
+-----------------+
| ops             |
+-----------------+
| 24.253496664212 |
+-----------------+
1 row in set (0.00 sec)
</code></pre><p>Das Beispiel macht Gebrauch von der Beobachtung, daß man mit einer beliebigen Logarithmusfunktion jede andere Logarithmusfunktion berechnen kann, indem man einfach <code>log(b, n) in log(n)/log(b)</code> umformt.
MySQL stellt mit den Funktionen <code>exp()</code> und <code>log()</code> die Exponentialfunktionen und Logarithmusfunktionen zur Basis <code>e = 2.718281828459</code> zur Verfügung, sodass <code>log(20000000)/log(2)</code> hier den <code>log(2, 20000000)</code> bestimmt.</p>
<p>Tatsächlich befinden sich auf den Karten in einer Bibliothek aber Reiter, sodass man gleich unter &ldquo;Z&rdquo; nachschauen kann, also bei gleich verteilten Autorennamen schon mit dem ersten Schritt nur noch ein Sechsundzwanzigstel aller Bücher durchsuchen muss statt die Hälfte.
Wäre nun auf allen Z-Karten &ldquo;Za&rdquo;, &ldquo;Zb&rdquo;, und so weiter notiert, würde auch der zweite Schritt nur sechsundzwanzigsteln, und so weiter.
Man bräuchte dann bei 20 Millionen Büchern nur noch 5-6 Schritte, um alle Bücher von Jeremy Zawodny zu finden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; select log(20000000)/log(26);
</span></span></span><span class="line"><span class="cl"><span class="go">+-----------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| log(20000000)/log(26) |
</span></span></span><span class="line"><span class="cl"><span class="go">+-----------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">|       5.1598357001807 |
</span></span></span><span class="line"><span class="cl"><span class="go">+-----------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span></code></pre></div><p>Nun sind die Namen von Buchautoren aber nicht gleich verteilt.
Stattdessen könnte man aber auch wie bei einem Lexikon vorgehen und in regelmäßigen Abständen, etwa für jeweils eine Million Autoren, Proben nehmen:
Band 1 von A-E, Band 2 von F-L und so weiter.
Innerhalb der Million würde man dann für jeweils einen 100.000er Block vermerken A-Be, Bf-Ca, und so weiter, und auf den weiteren Ebenen genauso.
Dann hätte man gleich große Blöcke und wüsste für jeden Block, welche Buchstabenintervalle darin enthalten sind.</p>
<p>Beim Einfügen von Werten muss man jedoch unter Umständen Werte aus dem 1. 100.000er-Block in den Zweiten verschieben und so weiter:
Kommt Arnold dazu, muss Bertram unter Umständen in den 2. Block und die Blockgrenzen sind nun A-Bd, Be-Ca.</p>
<p>So einen Index bezeichnet man als balancierten Baum (Btree), und das ist genau das, was MySQL verwendet.
Die Schiebeoperationen nennt man Rebalancing des Baumes, und die will man gerne vermeiden.</p>
<p>Eine MYI-Datei besteht also aus Blöcken von <code>key_cache_block_size</code> (normal 1024) Byte Größe.
Ein Key Cache Block enthält was immer wir indizieren wollen und Zeiger in die MYD-Datei.
Das sind entweder Byte-Offsets (<code>Row_format: dynamic</code>) oder Datensatznummern (<code>Row_format: fixed</code>).
Wenn wir also eine INTEGER-Spalte indizieren, braucht jeder Eintrag im Index 4 Byte für die zu indizierende Spalte plus 4 Byte Zeiger in die Daten.
In einen 1024-Block passen so also 1024/8 = 2^10/2^3 = 2^(10-3) = 2^7 = 128 Einträge.</p>
<p>Durch Laden dieses Blocks können wir also die Suche im Index nicht &ldquo;durch Halbieren&rdquo; oder &ldquo;durch sechsundzwanzigsteln&rdquo; durchführen, sondern wir reduzieren die zu durchsuchende Datenmenge in jedem Schritt auf ein Hundertachtundzwanzigstel.
Oder würden dies tun, wenn wir die Indexblöcke alle immer ganz voll machen würden.</p>
<p>Das tun wir aber nicht, weil wir dann bei jedem Einfügen von Daten rebalancieren müssten.
Stattdessen machen wir die Blöcke nur zu 2/3 voll.
Dadurch 128teln wir nicht, sondern 84teln nur, aber das macht fast nichts aus.
20 Millionen Datensätze durchsuchen wir so mit maximal 4 Operationen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; select 128*0.66;
</span></span></span><span class="line"><span class="cl"><span class="go">+----------+
</span></span></span><span class="line"><span class="cl"><span class="go">| 128*0.66 |
</span></span></span><span class="line"><span class="cl"><span class="go">+----------+
</span></span></span><span class="line"><span class="cl"><span class="go">|    84.48 |
</span></span></span><span class="line"><span class="cl"><span class="go">+----------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [(none)]&gt; select log(20000000)/log(84.48);
</span></span></span><span class="line"><span class="cl"><span class="go">+--------------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| log(20000000)/log(84.48) |
</span></span></span><span class="line"><span class="cl"><span class="go">+--------------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">|          3.7892903582541 |
</span></span></span><span class="line"><span class="cl"><span class="go">+--------------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span></code></pre></div><p>Einen &ldquo;sortierten Autorenkatalog&rdquo; nennt man in einer Datenbank einen &ldquo;Index auf eine Spalte&rdquo;.
In unserer Beispieltabelle haben wir die Spalten id, d, e und i.
Wir wollen einen Index auf die Spalte i (INTEGER, 4 Byte) legen, also braucht ein Indexeintrag 8 Byte (4 Byte für den Integer und 4 Byte für den Datenzeiger).
Für 20 Millionen Einträge rechnen wir also mit einer ca. 230 MB großen MYI-Datei.</p>
<p>Die Rechnung geht so:
20 Mio Einträge zu 8 Byte sind 152 MB, aber wir machen die Blöcke nur zu ca. 2/3 voll, also müssen wir das ganze durch 2/3 teilen:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [rootforum]&gt; select 20000000*8/1024/1024/(2/3)\G
</span></span></span><span class="line"><span class="cl"><span class="go">20000000*8/1024/1024/(2/3): 228.881836166382
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span></code></pre></div><p>Den Index erzeugen wir mit dem Kommando <code>CREATE INDEX</code>.
Das Kommando geht dann die Spalte i durch, notiert die Werte und für jeden Wert die Datensatznummer, in der der Wert zu finden ist.
Die Werte müssen sortiert werden, und dazu braucht MySQL Platz.
Der Puffer für diesen Platz kann online definiert werden, und sollte sehr groß gewählt werden (bei uns: Mindestens 230 MB groß, wie wir eben vorgerechnet haben).
Der Name des Puffers ist <code>myisam_sort_buffer_size</code>.</p>
<p>Im folgenden Beispiel verwenden wir Sessionvariablen, hier die Variable <code>@old_buffer</code>, um den alten Wert für <code>myisam_sort_buffer_size zu speichern</code>.
Wir definieren dann für unsere Verbindung zur Datenbank und nur für diese einen größeren Wert für <code>myisam_sort_buffer_size</code>, und erzeugen den Index mit <code>CREATE INDEX</code>.
Danach setzen wir <code>myisam_sort_buffer_size</code> wieder auf den alten Wert zurück.</p>
<p>Wir verändern nicht <code>@@global.myisam_sort_buffer_size</code>, weil das ein großes Risiko wäre:
Jedes <code>CREATE INDEX</code>, <code>ALTER TABLE ... ADD INDEX</code> oder <code>REPAIR TABLE</code> würde dann den großen Puffer verwenden und bis zu 300 MB Speicher verlangen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [rootforum]&gt; select @@session.myisam_sort_buffer_size;
</span></span></span><span class="line"><span class="cl"><span class="go">+-----------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| @@session.myisam_sort_buffer_size |
</span></span></span><span class="line"><span class="cl"><span class="go">+-----------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">|                          31457280 |
</span></span></span><span class="line"><span class="cl"><span class="go">+-----------------------------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.04 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [rootforum]&gt; set @old_buffer=@@session.myisam_sort_buffer_size;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [rootforum]&gt; set @@session.myisam_sort_buffer_size = 300*1024*1024;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.02 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [rootforum]&gt; create index i on t(i);
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 20000000 rows affected (4 min 33.35 sec)
</span></span></span><span class="line"><span class="cl"><span class="go">Records: 20000000  Duplicates: 0  Warnings: 0
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [rootforum]&gt; set @@session.myisam_sort_buffer_size = @old_buffer;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.00 sec)
</span></span></span></code></pre></div><p>Da diese Aktion auf meinem Rechner über 4 Minuten dauert, kann ich MySQL beim Erzeugen des Index zusehen:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; show processlist\G
</span></span></span><span class="line"><span class="cl"><span class="go">     Id: 5
</span></span></span><span class="line"><span class="cl"><span class="go">   User: root
</span></span></span><span class="line"><span class="cl"><span class="go">   Host: localhost
</span></span></span><span class="line"><span class="cl"><span class="go">     db: rootforum
</span></span></span><span class="line"><span class="cl"><span class="go">Command: Query
</span></span></span><span class="line"><span class="cl"><span class="go">   Time: 48
</span></span></span><span class="line"><span class="cl"><span class="go">  State: copy to tmp table
</span></span></span><span class="line"><span class="cl"><span class="go">   Info: create index i on t(i)
</span></span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span></code></pre></div><p>Das will ich genauer beobachten:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@linux:/var/lib/mysql/data/rootforum # ls -l
</span></span></span><span class="line"><span class="cl"><span class="go">total 1493641
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql  527958016 Feb 12 17:15 #sql-26a5_5.MYD
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql       1024 Feb 12 17:14 #sql-26a5_5.MYI
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql       8628 Feb 12 17:14 #sql-26a5_5.frm
</span></span></span><span class="line"><span class="cl"><span class="go">drwx------  2 mysql mysql        240 Feb 12 17:14 ./
</span></span></span><span class="line"><span class="cl"><span class="go">drwxr-xr-x  6 mysql mysql        440 Feb 12 17:06 ../
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql         61 Feb 12 17:01 db.opt
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql 1000000000 Feb 12 17:07 t.MYD
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql       1024 Feb 12 17:07 t.MYI
</span></span></span><span class="line"><span class="cl"><span class="go">-rw-rw----  1 mysql mysql       8628 Feb 12 17:02 t.frm
</span></span></span></code></pre></div><p>Die Prozessgröße ist dabei eher klein:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@linux:/var/lib/mysql/data/rootforum # ps axuwww| grep mysql[d]
</span></span></span><span class="line"><span class="cl"><span class="go">mysql     9893  2.2  1.2 351420 13152 pts/1    Sl   15:13   2:41 /usr/local/mysql-max-5.0.18-linux-i686-glibc23/bin/mysqld ...
</span></span></span></code></pre></div><p>Der mysqld hat hier also das Potenzial, bis zu 351420 KB zu belegen, da er aber für diese Übung frisch gestartet wurde, belegt er tatsächlich nur 13152 KB Speicher.</p>
<p>Nach dem Abschluss der Kopieroperation ist die #sql-26a5_5.MYD genauso groß wie die t.MYD, und die eigentliche Sortieroperation kann beginnen.
Der mysqld wächst um die vereinbarte Puffergröße (genauer: nur um die benötigte Größe und das nur schrittweise).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [(none)]&gt; show processlist\G
</span></span></span><span class="line"><span class="cl"><span class="go">     Id: 5
</span></span></span><span class="line"><span class="cl"><span class="go">   User: root
</span></span></span><span class="line"><span class="cl"><span class="go">   Host: localhost
</span></span></span><span class="line"><span class="cl"><span class="go">     db: rootforum
</span></span></span><span class="line"><span class="cl"><span class="go">Command: Query
</span></span></span><span class="line"><span class="cl"><span class="go">   Time: 124
</span></span></span><span class="line"><span class="cl"><span class="go">  State: Repair by sorting
</span></span></span><span class="line"><span class="cl"><span class="go">   Info: create index i on t(i)
</span></span></span></code></pre></div><p>Dies ist die Anzeige von <code>SHOW PROCESSLIST</code>, während sortiert wird und <code>der myisam_sort_buffer_size</code> tatsächlich benutzt wird.
Sieht man sich den Prozess in der Unix-Prozessliste an, kann man sehen, daß auch Speicher belegt wird:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@linux:/var/lib/mysql/data/rootforum # !ps
</span></span></span><span class="line"><span class="cl"><span class="go">ps axuwww| grep mysql[d]
</span></span></span><span class="line"><span class="cl"><span class="go">mysql     9893  3.5 27.6 624744 286388 pts/1   Sl   15:13   4:24 /usr/local/mysql-max-5.0.18-linux-i686-glibc23/bin/mysqld ... 
</span></span></span></code></pre></div><p>Und der Gewinn? Operationen wie <code>select * from t where i = 193306751</code> sind jetzt sehr schnell durchzuführen, und zwar unabhängig davon, ob der Wert am Anfang oder am Ende der Tabelle gefunden wird.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">root@localhost [rootforum]&gt; flush query cache;
</span></span></span><span class="line"><span class="cl"><span class="go">Query OK, 0 rows affected (0.03 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [rootforum]&gt; select * from t where i = 193306751;
</span></span></span><span class="line"><span class="cl"><span class="go">+----+--------------+---------------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="go">| id | d            | e                         | i         |
</span></span></span><span class="line"><span class="cl"><span class="go">+----+--------------+---------------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="go">|  9 | jilrmbmbujaw | vegmospiyoenpnovopofogiof | 193306751 |
</span></span></span><span class="line"><span class="cl"><span class="go">+----+--------------+---------------------------+-----------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">root@localhost [rootforum]&gt; select * from t where i = 1830603510;
</span></span></span><span class="line"><span class="cl"><span class="go">+----------+--------------+---------------------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| id       | d            | e                         | i          |
</span></span></span><span class="line"><span class="cl"><span class="go">+----------+--------------+---------------------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">| 19999990 | hctjfsosiobb | zyxhrbyvbtsrnpwjijtgqrfcb | 1830603510 |
</span></span></span><span class="line"><span class="cl"><span class="go">+----------+--------------+---------------------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="go">1 row in set (0.03 sec)
</span></span></span></code></pre></div><p>(geschrieben für
<a href="http://www.rootforum.de/forum/viewforum.php?f=23" target="_blank" rel="noopener">Rootforum</a>


und hier herüber geschafft zur Archivierung)</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#mysql" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				mysql
				</a>
				
				<a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_de
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2006-03-05-mysql-fuer-dummies-4.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2006/03/04/mysql-fuer-dummies-3.html">MySQL für Dummies (3)</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2006/03/06/mysql-fuer-dummies-5.html">MySQL für Dummies (5)</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
