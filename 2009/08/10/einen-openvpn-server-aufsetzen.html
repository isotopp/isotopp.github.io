<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Einen  openvpn Server aufsetzen | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2009/08/10/einen-openvpn-server-aufsetzen.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Einen  openvpn Server aufsetzen | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="de_DE" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2009/08/10/einen-openvpn-server-aufsetzen.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2009-08-10T07:59:34Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/schloss.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Einen  openvpn Server aufsetzen' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/schloss.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="einen-openvpn-server-aufsetzen-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Einen  openvpn Server aufsetzen
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>August 10, 2009</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/schloss.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2009/08/10/piratenthemen.html">Piratenthemen</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2009/08/19/meister-der-enteignung.html">Meister der Enteignung</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>openvpn ist ein bequem aufzusetzender VPN-Server, der mit einer
einfachen TCP-Verbindung angesprochen werden kann. Da kein
gesonderter IP-Pakettyp verwendet wird, funktioniert openvpn
sehr einfach auch mit dummen Routern oder in eingeschränkt
konnektierten Netzwerken.</p>
<p>Insbesondere kann der openvpn-Server auch etwa auf Port 443
laufen. Daher ist openvpn sehr bequem, wenn man hinter einem
Proxy-Server eines Netzwerkes sitzt, der ausgehende
https-Verbindungen nur auf https-Ports zuläßt, wie es etwa in
vielen Firmen der Fall ist.</p>
<p>Mit einem openvpn-Server, der auf Port 443 lauscht, kommt man
aus den meisten dieser Netze bequem heraus und kann alle seine
Zugriffe dann über die VPN-Verbindung tunneln. Der Proxy sieht
nur eine normale CONNECT-Anweisung auf einen https-Port, danach
ist alles verschlüsselt. Der Verbindung ist also nicht
anzusehen, daß es sich nicht um eine https-Verbindung handelt -
um das zu erkennen müßte der Proxy schon umschlüsseln, dann wäre
die Verbindung aber wegen des durch den Proxy gefälschten
Zertifikates aus unsicher zu erkennen.</p>
<p>Das Kommanzeilenprogramm openvpn ist sowohl Server als auch
Client. Auf dem Server wird es so gestartet:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">/usr/sbin/openvpn \
</span></span></span><span class="line"><span class="cl"><span class="go">  --daemon \
</span></span></span><span class="line"><span class="cl"><span class="go">  --writepid /var/run/openvpn/openvpn.pid \
</span></span></span><span class="line"><span class="cl"><span class="go">  --config /etc/openvpn/openvpn.conf \
</span></span></span><span class="line"><span class="cl"><span class="go">  --cd /etc/openvpn
</span></span></span></code></pre></div><p>Die Konfiguration ist kurz und schmerzlos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">h743107:~ # cat /etc/openvpn/openvpn.conf
</span></span></span><span class="line"><span class="cl"><span class="go">daemon openvpn-server.koehntopp
</span></span></span><span class="line"><span class="cl"><span class="go">dev tun
</span></span></span><span class="line"><span class="cl"><span class="go">local {SERVERIP}
</span></span></span><span class="line"><span class="cl"><span class="go">port 443
</span></span></span><span class="line"><span class="cl"><span class="go">proto tcp
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">user nobody
</span></span></span><span class="line"><span class="cl"><span class="go">group nobody
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">cd /etc/openvpn
</span></span></span><span class="line"><span class="cl"><span class="go">ca keys/ca.crt
</span></span></span><span class="line"><span class="cl"><span class="go">cert keys/server.crt
</span></span></span><span class="line"><span class="cl"><span class="go">key keys/server.key
</span></span></span><span class="line"><span class="cl"><span class="go">dh keys/dh1024.pem
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">server 192.168.168.0 255.255.255.0
</span></span></span><span class="line"><span class="cl"><span class="go">ifconfig-pool-persist ipp.txt
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">comp-lzo
</span></span></span><span class="line"><span class="cl"><span class="go">persist-key
</span></span></span><span class="line"><span class="cl"><span class="go">persist-tun
</span></span></span><span class="line"><span class="cl"><span class="go">status openvpn-status.log
</span></span></span><span class="line"><span class="cl"><span class="go">verb 3
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">keepalive 10 60
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="gp">#</span> client config dir
</span></span><span class="line"><span class="cl"><span class="go">client-config-dir client-config-dir
</span></span></span></code></pre></div><p>Dies erzeugt einen Server, der auf Port 443 an der an Stelle von
{SERVERIP} eingesetzten IP lauscht. Der Server läßt Verbindungen
von Clients zu, die ein Zertifikat haben, das mit ca.crt
signiert ist -
<a href="http://www.openvpn.net/index.php/open-source/documentation/howto.html#pki" target="_blank" rel="noopener">Zertifikate erzeugen</a>

.</p>
<p>Der Client bekommt eine IP aus dem im server-Statement genannten
Pool zugeteilt, und die IP ist persistent. Wir verwenden
komprimierte Verbindungen und versuchen den Tunnel auch über
Server-Restarts (persist-tun) zu halten, ditto für den Key. Der
Server schreibt ein openvpn-status.log auf dem Verbosity-Level
3. Wir pingen unsere Verbindung alle 10 Sekunden und starten sie
nach 60 Sekunden fehlenden Pings neu (viele https-Proxies
trennen die Verbindungen sehr aggressiv, also halten wir sie so
beschäftgt). Im client-config-dir könnten wir noch weitere
Client-spezifische Konfigurationen unterbringen.</p>
<p>Auf demselben Rechner starte ich auch einen Squid, den ich auf
127.0.0.1:3128 binde und dem ich Zugriffe aus dem
192.168.168.0/24 erlaube. Dadurch kann ich all meinen privaten
Webtraffic durch meinen Proxy schicken, statt meine URLs an den
anderen Proxy auszuliefern, bei dem ich nicht weiß, was die
Betreiber mit den Logs oder meinen Daten machen.</p>
<p>Auf dem Client (bei mir ein Mac) verwende ich Tunnelblick als
openvpn-Starter und habe in $HOME/Library/openvpn eine
openvpn.conf hinterlegt:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">client
</span></span></span><span class="line"><span class="cl"><span class="go">dev tun
</span></span></span><span class="line"><span class="cl"><span class="go">proto tcp
</span></span></span><span class="line"><span class="cl"><span class="go">remote {SERVERIP} 443
</span></span></span><span class="line"><span class="cl"><span class="go">resolv-retry infinite
</span></span></span><span class="line"><span class="cl"><span class="go">nobind
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">user nobody
</span></span></span><span class="line"><span class="cl"><span class="go">group nobody
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">persist-key
</span></span></span><span class="line"><span class="cl"><span class="go">persist-tun
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">ca ca.crt
</span></span></span><span class="line"><span class="cl"><span class="go">cert client.crt
</span></span></span><span class="line"><span class="cl"><span class="go">key client.key
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">comp-lzo
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">verb 3
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">keepalive 1 5
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">; firmenproxy
</span></span></span><span class="line"><span class="cl"><span class="go">http-proxy {COMPANY_PROXY} 3128
</span></span></span><span class="line"><span class="cl"><span class="go">http-proxy-retry
</span></span></span></code></pre></div><p>Hier ist dieselbe {SERVERIP} einzutragen wie bei der
Server-Konfiguration. Wenn die Verbindung durch einen Web-Proxy
getunnelt werden muß, muß man die beiden http-proxy Kommandos am
Ende der Datei anpassen, zum Testen daheim kann man sie
weglassen. Der Rest der Konfiguration entspricht der
Server-Config, nur die Keepalives habe ich für mich noch
aggressiver setzen müssen.</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#security" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				security
				</a>
				
				<a href="/tags/#privacy" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				privacy
				</a>
				
				<a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_de
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2009-08-10-einen-openvpn-server-aufsetzen.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2009/08/10/piratenthemen.html">Piratenthemen</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2009/08/19/meister-der-enteignung.html">Meister der Enteignung</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
