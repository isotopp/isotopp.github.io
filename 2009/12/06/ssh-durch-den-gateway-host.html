<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>ssh durch den Gateway Host | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">
<link rel="canonical" href="https://blog.koehntopp.info/2009/12/06/ssh-durch-den-gateway-host.html">


<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">




<meta name="generator" content="Hugo 0.110.0">
<meta property="og:title" content='ssh durch den Gateway Host' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />


<meta property="og:locale" content="de_DE" />


<meta name="description" content='' />
<meta property="og:description" content='' />

<meta property="og:url" content="https://blog.koehntopp.info" />


<meta property="og:type" content="article" />
<meta name="article:published_time" content='2009-12-06T12:20:51Z' />



<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content='@isotopp' />
<meta name="twitter:creator" content='@isotopp' />
<meta property="twitter:title" content='ssh durch den Gateway Host' />
<meta property="twitter:description" content='' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />

<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebSite","description":null,"headline":"ssh durch den Gateway Host","image":"/assets/img/background/rijksmuseum.jpg","name":"Die wunderbare Welt von Isotopp","url":"https://blog.koehntopp.info"}
</script>

    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.6b600fb66ca1591ba6dcc9b3bdfc59ebd5c0fdc49622889f839fc36f71dde892.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            




<div class="page">
  <article class="ssh-durch-den-gateway-host-page">
    <div class='row  justify-content-center text-center my-4 mx-0'>
      <header>
        <div class='col'>
          <h1 class="title mb-lg-4 text-white">
            ssh durch den Gateway Host
          </h1>
          <div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
            <img alt='isotopp image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0' style='width: 1.9rem; border-radius: 1rem;'>
            <a href="https://chaos.social/@isotopp" class='text-light text-decoration-none'>
                Kristian Köhntopp
            </a>

            
              <span class='d-none d-lg-inline'>-</span>
              <div class='d-block d-lg-inline'>December 6, 2009</div>
            

          </div>
        </div>
        
          <img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
        
      </header>
    </div>

    <div class='row justify-content-center mx-0 mt-5 mb-5'>
      <div class='col-lg-8'>
        <p>Ich sitze hier daheim beim PHPlätzchenbacken und Kore fragt mich eben: &ldquo;Sage
einmal, ich habe daheim so einen Router, der NAT macht und den ich als
Sprunghost verwende, und dahinter meinen Desktop-Rechner. Kann ich
eigentlich Dateien von daheim von meinem Desktop auf mein Netbook kopieren,
ohne daß ich die auf dem Router als Zwischenkopie ablegen muß?&rdquo;</p>
<p>Es geht sogar besser als das, und dafür braucht man eine
$HOME/.ssh/config-Datei auf seinem Netbook und eine Kopie von &rsquo;netcat&rsquo; oder
&rsquo;nc&rsquo; auf dem Router. Das ist bei Kore mit dem Busybox-Netcat auch der Fall.</p>
<p>So geht&rsquo;s:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ServerAliveInterval 10
</span></span></span><span class="line"><span class="cl"><span class="go">ServerAliveCountMax 3
</span></span></span><span class="line"><span class="cl"><span class="go">Compression yes
</span></span></span><span class="line"><span class="cl"><span class="go">HashKnownHosts no
</span></span></span><span class="line"><span class="cl"><span class="go">TCPKeepAlive yes
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">ControlMaster auto
</span></span></span><span class="line"><span class="cl"><span class="go">ControlPath ~/.ssh/ssh_control_%h_%p_%r
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Host router
</span></span></span><span class="line"><span class="cl"><span class="go">    Hostname name.homeunix.org
</span></span></span><span class="line"><span class="cl"><span class="go">    User name
</span></span></span><span class="line"><span class="cl"><span class="go">    Port 4444
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Host desktop
</span></span></span><span class="line"><span class="cl"><span class="go">    Hostname 192.168.1.2
</span></span></span><span class="line"><span class="cl"><span class="go">    User name
</span></span></span><span class="line"><span class="cl"><span class="go">    Port 22
</span></span></span><span class="line"><span class="cl"><span class="go">    ProxyCommand ssh router nc -w30 %h %p
</span></span></span><span class="line"><span class="cl"><span class="go">    LocalForward 6667 127.0.0.1:6667
</span></span></span><span class="line"><span class="cl"><span class="go">    LocalForward 1993 127.0.0.1:993
</span></span></span><span class="line"><span class="cl"><span class="go">    LocalForward 1587 127.0.0.1:587
</span></span></span><span class="line"><span class="cl"><span class="go">    LocalForward 1999 news.mein-freund.de:119
</span></span></span><span class="line"><span class="cl"><span class="go">    DynamicForward 1080
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Host *
</span></span></span><span class="line"><span class="cl"><span class="go">    ForwardAgent yes
</span></span></span></code></pre></div><p>Der Router ist dabei ein wenig langsam und es ist sehr mühsam, die erste
dieser Verbindungen aufzubauen. Sobald die Verbindung aber steht, ist sie
normal schnell. Der ControlMaster sorgt dafür, daß überhaupt nur eine
ssh-Verbindung per Host aufgebaut wird. ssh tunnelt dann die anderen
ssh-Verbindungen zum selben Host wegen des ControlMaster per Multiplexer
durch die eine bestehende Verbindung. Das ist in diesem Fall nett, weil es
schnell ist.</p>
<p>In meinem eigenen Anwendungsfall ist sogar noch ein RSA Security Dreckstoken
involviert und ich habe keine Lust für jedes ssh oder scp jedesmal einen RSA
Security Dreckscode abzutippen. Durch den ControlMaster brauche ich mich nur
einmal pro Tag morgens einzuloggen und multiplexe dann alle meine
Verbindungen durch die eine bestehende Verbindung in die Firma.</p>
<p>Dabei helfen mir die verschiedenen KeepAlive- und
AliveInterval-Einstellungen die bestehende Verbindungen gegen alle
Timeout-Versuche der Firmenkonfiguration am Leben zu halten, auch dann, wenn
ich die Leitung mal ein wenig vor sich hin idlen lasse.</p>
<p>Der Eintrag router ist dabei ein Kurzname (eine ssh Bookmark), die intern
auf einen tatsächlichen Hostnamen, einen Usernamen und einen Port expandiert
wird. Ein &lsquo;ssh router&rsquo; wird also zu einem &lsquo;ssh -P4444
<a href="mailto:name@name.homeunix.org">name@name.homeunix.org</a>

&rsquo; umgeschrieben.</p>
<p>Der Eintrag desktop wird genau so expandiert. Der Trick ist dabei jedoch das
ProxyCommand. Ein &lsquo;ssh desktop&rsquo; wird also in Wahrheit zu einem &lsquo;ssh router
$kommando&rsquo; expandiert, das von der ssh wegen des Eintrages darüber jedoch zu
einem &lsquo;ssh -P4444 <a href="mailto:name@name.homeunix.org">name@name.homeunix.org</a>

 $kommando&rsquo; erweitert wird.</p>
<p>Dabei ist das Kommando &rsquo;nc -w30 desktop 22&rsquo;, also ein transparenter Tunnel
von router zu desktop auf Port 22.</p>
<p>Das Kommando &lsquo;ssh desktop&rsquo; baut also eine Verbindung vom Netbook (wo immer
das gerade ist) zum router auf und von dort automatisch weiter zum Desktop.
Das funktioniert so gut, daß man nicht nur auf dem Laptop &lsquo;ssh desktop&rsquo;
tippen kann und dann daheim ist, sondern daß man sogar &lsquo;scp
desktop:/etc/my.cnf Desktop/&rsquo; auf dem Netbook tippen kann und die Datei wird
durch den Router hindurch von daheim geholt und auf dem lokalen Desktop
abgelegt.</p>
<p>Als KDE-Anwender kann man sogar im Editor auf dem Netbook einfach
&lsquo;fish://desktop/etc/my.cnf&rsquo; zu bearbeiten öffnen, die Datei bearbeiten und
dann einfach mit Control-S auf dem Desktop daheim abspeichern.</p>
<p>Man kann noch mehr tun:</p>
<p>Die LocalForward-Anweisungen bauen weitere Tunnel auf. Der Port 6667 auf dem
Netbook verbindet einen also mit dem Irc-Bouncer auf dem Desktop-Rechner,
die Ports 127.0.0.1:1993 und 127.0.0.1:1587 auf dem Netbook verbinden einen
mit den imaps- und
<a href="https://blog.koehntopp.info/2004/10/29/submission-port-587.html">submission</a>

-Ports
des Desktop-Rechners und der Port 1999 des Netbook gibt nun eine Verbindung
zum NNTP-Server von news.mein-freund.de. Dabei sieht es für
news.mein-freund.de so aus, als käme die Verbindung vom Desktop-Rechner und
nicht vom Netbook und die Datenübertragung vom Netbook zum Desktop ist
natürlich ssh-verschlüsselt.</p>
<p>Der DynamicForward 1080 bewirkt, daß die ssh auf dem Netbook ein
SOCKS5-Proxy ist. Stellt man in seinem Firefox in den Proxy-Einstellungen
einen SOCKS5-Proxy auf 127.0.0.1:1080 ein, dann reicht Firefox als URLs über
ssh an den Desktop-Rechner weiter, der dann an Stelle des Netbook die Daten
beschafft und an den Firefox weiter gibt. Mein gibt also - egal wo man ist -
keine URLs an einen Firmenproxy weiter, sondern greift, egal wo man ist,
durch sein heimisches Desktop-DSL auf das Web zu.</p>
<p>Im Zusammenhang mit einem Dedi irgendwo und einem
<a href="https://blog.koehntopp.info/2009/08/10/einen-openvpn-server-aufsetzen.html">passenden openvpn-Server</a>


sollte man außerdem aus jedem Firmennetz eine Verbindung nach draußen
bekommen und sich so in jedem Fall freischwimmen können, egal wie restriktiv
das Firmennetz konfiguriert ist.</p>
<p><strong>Update:</strong> oliof schlägt vor, noch ein &lsquo;Compression yes&rsquo; an geeigneter
Stelle einzustreuen.</p>

      </div>
    </div>

    
    
    <div class='row justify-content-center mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Share</span>
        <a href='https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.koehntopp.info%2f2009%2f12%2f06%2fssh-durch-den-gateway-host.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#facebook'/></svg>
        </a>

        <a href='http://www.reddit.com/submit?url=https%3a%2f%2fblog.koehntopp.info%2f2009%2f12%2f06%2fssh-durch-den-gateway-host.html&title=ssh%20durch%20den%20Gateway%20Host' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>
        <a href='mailto:?subject=ssh%20durch%20den%20Gateway%20Host&body=https%3a%2f%2fblog.koehntopp.info%2f2009%2f12%2f06%2fssh-durch-den-gateway-host.html' target='_blank' class='text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope-fill'/></svg>
        </a>
      </div>
    </div>

    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
        
          <a href="/tags/#lang_de" class='btn btn-sm btn-outline-primary mb-1'>
            <svg class="bi" width="1rem" height="1rem" fill="currentColor"><use xlink:href="/bootstrap-icons.svg#tag-fill"></use></svg>
            lang_de
          </a>
        
      </div>
    </div>

    
    
    
    
    <div class='row justify-content-center py-3 mb-3 mx-0'>
      <div class='col-lg-8 text-center'>
        <a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2009-12-06-ssh-durch-den-gateway-host.md" rel="noopener noreferrer" target="_blank">
            <span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
        </a>
      </div>
    </div>
    

    <div class='row justify-content-center mb-5 pt-5 border-top mx-0'>
      <div class='col-lg-4 text-center text-lg-start'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Next Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2009/12/15/google-baut-ein-telefon.html">Google baut ein Telefon</a>
          </div>
        
      </div>

      <div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
        
          <div>
            <div class='letter-spacing-01 text-uppercase text-secondary'>
              Previous Post
            </div>
            <a class='text-decoration-none' href="https://blog.koehntopp.info/2009/12/04/google-dns.html">Google DNS</a>
          </div>
        
      </div>
    </div>

    
    </article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff. 
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#rss-fill'/></svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#envelope'/></svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#github'/></svg>
        </a>

	<a rel="me" href="https://chaos.social/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#mastodon'/></svg>
	</a>

        <a href='https://www.reddit.com/user/isotopp' title='Follow on Reddit' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#reddit'/></svg>
        </a>

        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#steam'/></svg>
        </a>



        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#youtube'/></svg>
        </a>

      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
