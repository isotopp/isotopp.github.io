<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Software Supply Chain Issues | Die wunderbare Welt von Isotopp</title>
<meta name="description" content="Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">
<link rel="canonical" href="https://blog.koehntopp.info/2022/10/18/software-supply-chain-issues.html">

<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/feed.xml' title="Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/mysql/feed.xml' title="Feed: mysql Articles for Die wunderbare Welt von Isotopp">
<link rel="alternate" type="application/rss+xml" href='https://blog.koehntopp.info/tags/review/feed.xml' title="Feed: review Articles for Die wunderbare Welt von Isotopp">


<meta name="generator" content="Hugo 0.145.0">
<meta property="og:title" content='Software Supply Chain Issues | Die wunderbare Welt von Isotopp' />
<meta property="og:site_name" content='Die wunderbare Welt von Isotopp' />
<meta property="og:locale" content="en_US" />
<meta name="description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="og:url" content="https://blog.koehntopp.info/2022/10/18/software-supply-chain-issues.html" />
<meta property="og:type" content="article" />
<meta name="article:published_time" content='2022-10-18T06:07:08Z' />
<meta name="fediverse:creator" content="@isotopp@infosec.exchange">
<meta property="og:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content='@isotopp@infosec.exchange' />
<meta property="twitter:title" content='Software Supply Chain Issues' />
<meta property="twitter:description" content='Kris Köhntopp&#39;s blog (Fedi: @isotoppinfosec.exchange)' />
<meta property="twitter:image" content='https://blog.koehntopp.info/assets/img/background/rijksmuseum.jpg' />


    



<link rel="stylesheet" href="https://blog.koehntopp.info/style.min.dd9d518fe6cac55191b6af874e18327dff051055754ffc7e106131baf826e6d3.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light px-lg-4 pt-lg-4">
    <div class="container-fluid">
        <a class="navbar-brand justify-content-center" href="https://blog.koehntopp.info/" rel="home" title="Die wunderbare Welt von Isotopp">
            <img alt="Kris" height='48' width='48' src='/assets/img/avatars/isotopp.jpg' class='p-0 me-3 d-block d-lg-inline'>
            <span class='h4 d-block d-lg-inline'>Die wunderbare Welt von Isotopp</span>
        </a>

        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">
                        <span class="">About</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/contribute/">
                        <span class="">Contribute</span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/search/">
                        <span class=""><svg class='bi' height='1.5rem' width='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#search'/></svg></span>
                        
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">
                        <span class=""><svg class='bi' width='1.5rem' height='1.5rem' fill='currentColor'><use xlink:href='/bootstrap-icons.svg#tags-fill'/></svg></span>
                        
                    </a>
                </li>
                
            </ul>
            
        </div>

    </div>
</nav>


        <main role="main" class="container-fluid p-0">

            









<div class="page">
	<article class="software-supply-chain-issues-page">
		<div class='row  justify-content-center text-center my-4 mx-0'>
			<header class="headerbanner">
				<div class='col'>
					<h1 class="title mb-lg-4 text-white">
						Software Supply Chain Issues
					</h1>
					<div class='text-uppercase text-light' style='letter-spacing: 0.1rem;'>
						<img alt='@isotopp@infosec.exchange image' src='/assets/img/avatars/isotopp.jpg' class='me-1 p-0'
						     style='width: 1.9rem; border-radius: 1rem;'>
						<a href="https://infosec.exchange/@isotopp" class='text-light text-decoration-none'>
							Kristian Köhntopp
						</a>
						
						<span class='d-none d-lg-inline'>-</span>
						<div class='d-block d-lg-inline'>October 18, 2022</div>
						
					</div>
				</div>
				
				<img alt='a featured image' src="/assets/img/background/rijksmuseum.jpg">
				
			</header>
		</div>

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2022/10/12/groups-and-places.html">Groups and Places</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2022/10/25/proper-o11y-for-mysql.html">Proper O11y for MySQL</a>
				</div>
				
			</div>
		</div>

		<div class='row justify-content-center mx-0 mt-3 mb-5'>
			<div class="col-lg-8 mb-3">
				
			</div>
			<div class='col-lg-8'>
				<p>The GitHub Security Lab has a long hard look at &ldquo;Apache Commons Text&rdquo; in March this year.
That resulted in <a href="https://securitylab.github.com/advisories/GHSL-2022-018_Apache_Commons_Text/" target="_blank" rel="noopener">CVE-2022-42889</a>

.
The exploit goes like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">final</span><span class="w"> </span><span class="n">StringSubstitutor</span><span class="w"> </span><span class="n">interpolator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringSubstitutor</span><span class="p">.</span><span class="na">createInterpolator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interpolator</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&#34;${script:javascript:java.lang.Runtime.getRuntime().exec(&#39;touch /tmp/foo&#39;)}&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">out</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>Next to <code>${script:...}</code> there are apparently also a <code>${url:...}</code> and `${dns} as other unsuitable substitutions, and they nest.</p>
<p>This was fixed in October 2022, after being reminded by GHSL in May and August.</p>
<p>It was introduced in October 2018, in Version 1.5, and only discovered in March this year.</p>
<h1 id="whats-wrong-with-this">
    <a href="#whats-wrong-with-this">
	What&rsquo;s wrong with this?
    </a>
</h1>
<p>The security impact of this new feature is obvious, when discussed.
Yet, it was integrated in October 2018, and that apparently did not raise any red flags in a security or merge review.
Also, none of the users of the library found anything weird.</p>
<p>The package has <a href="https://commons.apache.org/proper/commons-text/userguide.html" target="_blank" rel="noopener">documentation</a>

.
String substitution is described in the manpage for that class, <a href="https://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/StringSubstitutor.html" target="_blank" rel="noopener">StringSubstituror</a>

.
The &ldquo;fix&rdquo; for the CVS was to disable some substitutors.
This is described in <a href="https://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/lookup/StringLookupFactory.html" target="_blank" rel="noopener">StringLookupFactory</a>

.</p>
<p>It took almost 3.5 years for somebody to look at this and find that to be a security risk.</p>
<p>After reporting the risk, it took Apache 2 reminders and way more than the standard 90 days to react and publish a mitigation.</p>
<p>This means</p>
<ul>
<li>nonfunctional feature and security impact review for code merges.</li>
<li>slow reaction to security issues (CVSS 3.x score: 9.8)</li>
</ul>
<p>Clearly, the security process of the Apache organisation has huge room for improvement.</p>
<h1 id="is-that-a-good-mitigation">
    <a href="#is-that-a-good-mitigation">
	Is that a good mitigation?
    </a>
</h1>
<p>You decide. Among the interpolations that are still enabled by default are</p>
<ul>
<li><a href="https://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/lookup/StringLookupFactory.html#fileStringLookup--" target="_blank" rel="noopener">fileStringLookup</a>

, which replaces the <code>${file:UTF-8:/filename}</code> with the content of a file.</li>
<li><a href="https://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/lookup/StringLookupFactory.html#propertiesStringLookup--" target="_blank" rel="noopener">propertiesStringLookup</a>

, which replaces a value for a key in a properties file.</li>
<li><a href="https://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/lookup/StringLookupFactory.html#environmentVariableStringLookup--" target="_blank" rel="noopener">environmentVariableStringLookup</a>

, which replaces <code>${env:USER}</code> with the content of an environment variable.</li>
</ul>
<p>All have the potential, if controlled by an attacker, to read and leak data, and maybe secrets.
That is not remote code execution, but probably still arbitrary file read and secrets leak.</p>
<p>Such a string interpolation under control of a user is risky at best, but the default configuration is still far from secure, even if the fix improves things.</p>
<h1 id="not-the-first-time">
    <a href="#not-the-first-time">
	Not the first time
    </a>
</h1>
<p>This situation seems to be a repeat of the <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" target="_blank" rel="noopener">log4j exploit</a>

 from the year before.
In the log4j case, the initial find was presented on a conference and dismissed as unimportant.
It only escalated after the exploit was used in the wild against Minecraft servers and their associated Discords, and then it quickly escalated to the full scope we observed last year.</p>
<p>Handling this was imperfect as well, with a series of fixes trying to mitigate the problem, and failing to do so in the first round.</p>
<p>So both projects/packages</p>
<ul>
<li>accepted contribution of text interpolation without understanding the implications that thing would have</li>
<li>bungled the security response process, in various ways (slow response, or no response at all)</li>
</ul>
<p>This points to non-functional processes inside the collection of Apache projects.
They are either not executed, or they are not effective, when executed.
The meta-question is if the collection of Apache projecs are aware of that, and how they are trying to address this?</p>
<h1 id="are-there-more-packages-that-have-this-issue">
    <a href="#are-there-more-packages-that-have-this-issue">
	Are there more packages that have this issue?
    </a>
</h1>
<p>As a developer or organisation that makes software, you sometimes take on external dependencies.
You are still being asked to be able to answer questions about the whole product, so you need a way to form an opinion about the state of the dependencies and their dependencies.</p>
<p>That starts with an inventory, and some useful scoping.
And the mostly liveness, quality and maturity of processes.</p>
<h2 id="one-evaluation-approach">
    <a href="#one-evaluation-approach">
	One evaluation approach
    </a>
</h2>
<p>One quick evaluation approach is documented <a href="https://askcloudarchitech.com/posts/tutorials/open-source-security-dependency-review/" target="_blank" rel="noopener">here</a>

.
I&rsquo;d reorder things a bit.</p>
<ul>
<li>&ldquo;Is it necessary&rdquo;-Phase: Do we need that dependency?</li>
<li>&ldquo;Is it popular&rdquo;-Phase: Who else is using this?</li>
<li>&ldquo;Is it maintained&rdquo;-Phase: Do we see commits? Do we understand the code and the commits?</li>
<li>&ldquo;Is Security considered&rdquo;-Phase: Check their security response process and the execution</li>
<li>&ldquo;Is it supported&rdquo;-Phase: Go check out their presence on various media.
How do you reach them?
Are they approachable or more on the Hugo/Cyrus spectrum of interaction?</li>
</ul>
<h2 id="another-evaluation-approach">
    <a href="#another-evaluation-approach">
	Another evaluation approach
    </a>
</h2>
<p>Another approach is documented <a href="https://opensource.com/life/14/1/evaluate-sustainability-open-source-project" target="_blank" rel="noopener">here</a>

.</p>
<p>It is similar, and asks you to</p>
<ul>
<li>check contributions, and contributors. Read a bit of code.</li>
<li>Look at the release history. Are the regular releases? A schedule?</li>
<li>The user community. Are they talking to people? How?</li>
<li>Longevity.</li>
<li>The general ecosystem.</li>
</ul>
<p>I&rsquo;d add some kind of metric around process execution.
Check merge reviews, execution of security process and again, approachability and response times.</p>
<h2 id="another-commercial-approach">
    <a href="#another-commercial-approach">
	Another, commercial approach
    </a>
</h2>
<p>Some vendors are starting to approach this, for example <a href="https://socket.dev/npm/package/@webassemblyjs/ast/overview/1.11.1" target="_blank" rel="noopener">this</a>

.</p>
<p>All in all, this seems to be a largely unsolved problem.
Criteria are uneven across various attempts, projects and ecosystems.
Some languages or projects seem to have problems even with creating an inventory of dependencies.</p>

			</div>
		</div>

		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Tags</span>
				
				<a href="/tags/#lang_en" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				lang_en
				</a>
				
				<a href="/tags/#security" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				security
				</a>
				
				<a href="/tags/#software" class='btn btn-sm btn-outline-primary mb-1'>
				<svg class="bi" width="1rem" height="1rem" fill="currentColor">
					<use xlink:href="/bootstrap-icons.svg#tag-fill"></use>
				</svg>
				software
				</a>
				
			</div>
		</div>

		
		
		
		
		<div class='row justify-content-center py-3 mb-3 mx-0'>
			<div class='col-lg-8 text-center'>
				<a href="https://github.com/isotopp/isotopp.github.io/edit/main/content/posts/2022-10-18-software-supply-chain-issues.md"
				   rel="noopener noreferrer" target="_blank">
					<span class='letter-spacing-01 text-uppercase text-secondary me-2'>Suggest Changes</span>
				</a>
			</div>
		</div>
		

		<div class='row justify-content-center mx-0'>
			<div class='col-lg-4 text-center text-lg-start'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Previous Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2022/10/12/groups-and-places.html">Groups and Places</a>
				</div>
				
			</div>

			<div class='col-lg-4 text-lg-end mt-5 mt-lg-0 text-center'>
				
				<div>
					<div class='letter-spacing-01 text-uppercase text-secondary'>
						Next Post
					</div>
					<a class='text-decoration-none' href="https://blog.koehntopp.info/2022/10/25/proper-o11y-for-mysql.html">Proper O11y for MySQL</a>
				</div>
				
			</div>
		</div>


		
	</article>
</div>



            <footer class='row justify-content-center mb-4 pb-4 mx-0'>
  <div class='col-8 text-center'>
    <div>
      A collection of old stuff, new stuff and random stuff.
    </div>
    <div class='row text-primary mt-4'>
      <div class='col'>

        <a href='/feed.xml' title='Follow RSS feed' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#rss-fill'/>
          </svg>
        </a>

        <a href='mailto:kristian.koehntopp@gmail.com' title='Email' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#envelope'/>
          </svg>
        </a>

        <a href='https://github.com/isotopp' title='Follow on GitHub' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#github'/>
          </svg>
        </a>

        <a rel="me" href="https://infosec.exchange/@isotopp" title='Follow on Mastodon' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#mastodon'/>
          </svg>
        </a>

        
        <a href='http://steamcommunity.com/id/ixotopp' title='Follow on Steam' class='me-3 text-decoration-none'>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#steam'/>
          </svg>
        </a>

        

        <a href='https://www.youtube.com/user/isotopp' title='Follow on YouTube' class=''>
          <svg class='bi' height='2.5rem' width='2.5rem' fill='currentColor'>
            <use xlink:href='/bootstrap-icons.svg#youtube'/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</footer>


        </main>

	





<script src="https://blog.koehntopp.info/js/bootstrap.js"></script>




<script src="https://blog.koehntopp.info/js/lunr.js"></script>





<script src="https://blog.koehntopp.info/js/app.js"></script>


    </body>
</html>
